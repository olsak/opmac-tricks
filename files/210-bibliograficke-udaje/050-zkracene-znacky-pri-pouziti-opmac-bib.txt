anchor-name:bibmark
id:0097
author:P. O.
date:2015-04-12

----lang:cs--title:Zkrácené značky při použití opmac-bib
Příkaz `\cite` vypisuje značky místo čísel, pokud je nastaveno
`\nonumcitations`. Makro pro přímé čtení `.bib` souborů `opmac-bib.tex` nabízí
dva stylové soubory (`simple` a `iso690`), které generují tyto značky v dlouhém
formátu `Jméno prvního autora, rok`. Některá nakladatelství preferují styl,
ve kterém jsou tyto značky zkráceny. Třeba na první dvě písmena jména
prvního autora následovaná dvěma ciframi určujícími rok, tedy například
[Kn84]. Jak takové zkrácené značky dostat i do seznamu literatury popisuje
[OPmac trik 0096](http://petr.olsak.net/opmac-tricks.html#abib).
Nyní si ukážeme, jak předefinovat generování těchto značek při použití
`opmac-bib`, abychom dosáhli zkrácený formát bez nutnosti doplňovat pro
každý záznam výjimku do `.bib` souboru pomocí bibmark.

Stylové soubory `opmac-bib-styl.tex` (od verze Apr. 2015) používají k
vygenerování značek makro `\setbibmark`. Je tedy potřeba si definovat vlastní
makro `\mysetbibmark` a dále pomocí `\bibtexhook` toto makro nastavit:

```
\def\mysetbibmark{%
   \ifx\dobibmark\undefined \def\dobibmark{}\fi
   \RetrieveFieldIn{bibmark}\tmp
   \ifx\tmp\empty
      \RetrieveFieldIn{year}\tmp
      \edef\tmp{\expandafter\bibmarkA\dobibmark{}{}\relax \expandafter\bibmarkB\tmp{}{}{}{}\relax}%
   \fi
   \bibmark=\expandafter{\tmp}%
}
\def\bibmarkA#1#2#3\relax{#1#2}     % first two letters from the author name
\def\bibmarkB#1#2#3#4#5\relax{#3#4} % lats two digits from the year

\def\bibtexhook{\let\setbibmark=\mysetbibmark}
```

Makro využije jméno autora uložené stylovým souborem v \dobibmark a přidá k
němu rok. Z prvého extrahuje první dva tokeny použitím \bibmarkA a z druhého
extrahuje cifry roku použitím `\bibmarkB`.

Pokud máte v seznamu dvě stejné značky (např. citujete plodného
autora, který vytvořil více literárních výstupů za jeden rok), můžete
deklarovat výjimku pomocí pole bibmark v `.bib` souboru. Nebo je možné zařadit
do automatického generování přidávání písmen a, b, c atd. To ponechám jako
cvičení pro šikovného makroprogramátora.

----lang:en--title:Short cite-marks generated by opmac-bib
The `\cite` prints cite-marks (called bibmark) instead numbers when
`\nonumcitations` is set. The `opmac-bib.tex` macro for direct reading of .bib
databases provides two style files (`simple` and `iso690`). They generate long
bibmarks by default, like (Knuth, 1984). Sometimes we need to generate the marks
in the short form, like [Kn84]. We can set such marks as an exception using bibmark
field in `.bib` file and we can use
[OPmac trick 0096](http://petr.olsak.net/opmac-tricks-e.html#abib)
to print them in the bibliography list. Now, we show how to redefine the
bibmark generator in order to it generates the marks in short form. We
needn't use bibmark exception field.

```
\def\mysetbibmark{%
   \ifx\dobibmark\undefined \def\dobibmark{}\fi
   \RetrieveFieldIn{bibmark}\tmp
   \ifx\tmp\empty
      \RetrieveFieldIn{year}\tmp
      \edef\tmp{\expandafter\bibmarkA\dobibmark{}{}\relax\expandafter\bibmarkB\tmp{}{}{}{}\relax}
   \fi
   \bibmark=\expandafter{\tmp}%
}
\def\bibmarkA#1#2#3\relax{#1#2}     % first two letters from the author name
\def\bibmarkB#1#2#3#4#5\relax{#3#4} % last two digits from the year

\def\bibtexhook{\let\setbibmark=\mysetbibmark}
```

The macro uses the last name of the first author saved in `\dobibmark` by the
style file and extracts two first tokens from it by `\bibmarkA` and two digits
from the year by `\bibmarkB`.

If you have generated two equal marks (citing a fertile author with more
publications in one year) then you can declare an exception by bibmark field
in the `.bib` file to distinguish the bibmarks. Another possibility is to
create more intelligent macro which generates unique bibmarks by adding the
letters a, b, c etc if needed. This is an exercise for a skilful macro
programmer.
