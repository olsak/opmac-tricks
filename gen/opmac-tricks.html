<!DOCTYPE html>
<html lang="cs">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, shrink-to-fit=no">

	<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">

	<link rel="alternate" hreflang="cs" href="opmac-tricks.html">
	<link rel="alternate" hreflang="en" href="opmac-tricks-e.html">

	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.10/css/all.css" integrity="sha384-+d0P83n9kaQMCwj8F4RJB66tzIwOKmrdb46+porD/OvrJ+37WqIM7UoBtwHO6Nlg" crossorigin="anonymous">

	<title>OPmac - tipy, triky, návody</title>

	<style>
		.my-sidebar-toc {
			max-height: 48vh;
			overflow-y: auto;
			max-width: 480px;
			box-shadow: 0 0 1rem 0 rgba(0,0,0,.15) inset;
		}

		.my-sidebar-toc ul {
			list-style-type: none;
		}

		.my-sidebar-toc ul ul {
			padding-left: 1.25rem;
		}

		.my-sidebar-toc ul a {
			display: block;
			padding: 0.1rem 1rem 0 2rem;
			color: #6c757d;
			text-decoration: none;
		}

		.my-sidebar-toc ul a:hover {
			color: #007bff;
		}

		.my-content {
			max-width: 720px;
		}

		.my-content pre {
			padding: 0.5rem;
			background-color: #f8f9fa;
			border-radius: .25rem;
			box-shadow: 0 0 1rem 0 rgba(0,0,0,.15) inset;
		}

		@media (min-width: 992px) {
			.my-sidebar-toc {
				max-height: initial;
			}

			@supports (position: sticky) or (-webkit-position:sticky) {
				.my-sidebar-toc {
				    max-height: calc(100vh - 8rem);
				    position: sticky;
				    top: 7rem;
				}

				.my-sidebar {
					-webkit-position: sticky;
					position: sticky;
					top: 0;
					max-height: 100vh;
				}

				.my-sidebar > h2 {
				    position: sticky;
				    top: 2.25rem;
				}
			}
		}

		.back-to-top {
			cursor: pointer;
			position: fixed;
			bottom: 20px;
			right: 20px;
			display:none;
		}

		.my-shadow {
			box-shadow: 0 0 1rem 0 rgba(0,0,0,.15);
		}

		a.list-group-item small {
		  white-space: nowrap;
		}
	</style>
</head>
<body style="min-width: 448px">

	<nav class="navbar navbar-expand-md navbar-dark bg-dark px-5">
		<a class="navbar-brand" href="opmac.html">OPmac</a>
		<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
			<span class="navbar-toggler-icon"></span>
		</button>

		<div class="collapse navbar-collapse" id="navbarSupportedContent">
			<ul class="navbar-nav mr-auto">
				<li class="nav-item active">
					<a class="nav-link" href="#">OPmac - tipy, triky, návody<span class="sr-only"> (tato stránka)</span></a>
				</li>
			</ul>
			<ul class="navbar-nav ml-auto">
				<li class="nav-item">
					<a class="nav-link" href="opmac-tricks-cs.pdf">PDF <i class="far fa-file-pdf"></i></a>
				</li>
				<li class="nav-item">
					<a class="nav-link" href="opmac-tricks-e.html">English <img src="img/en.png" style="max-height: 1.33rem"></a>
				</li>
			</ul>
		</div>
	</nav>

	<div class="container-fluid">
		<div class="row flex-xl-nowrap">

			<aside class="my-sidebar col-12 col-lg-4 p-0 bg-light">
				<h2 class="text-center my-2">Obsah</h2>
				<nav class="my-sidebar-toc mx-auto mb-3 mb-lg-0 bg-white pb-3">
					<ul class='my-3 p-0'>                  <li><a href='#pismo'>Písmo</a>
	<ul>
                          <li><a href='#svyska'>Korekce střední výšky písma</a></li><li><a href='#currvf'>Chytřejší \typosize a \typoscale</a></li><li><a href='#scaleto'>Font dle požadované šířky</a></li><li><a href='#showfonts'>Výpis načtených fontů</a></li><li><a href='#onlycm'>Méně implicitně zavedených fontů</a></li><li><a href='#embrac'>Stojaté závorky v kurzívě</a></li><li><a href='#capinsert'>První písmeno odstavce větší</a></li><li><a href='#fakebold'>Nepravý bold</a></li><li><a href='#jumping'>Podtržení respektuje dolní přetahy</a></li>
	</ul>
</li>                  <li><a href='#barvy'>Barvy</a>
	<ul>
                          <li><a href='#coluser'>Přepínače barev jako přepínače fontů</a></li><li><a href='#collatex'>Přepínače barev jako v LaTeXu</a></li><li><a href='#colmnote'>Barvy společně s poznámkami mnote</a></li><li><a href='#colmath'>Obarvení pouze jádra bez indexu a exponentu</a></li><li><a href='#colaccent'>Obarvení pouze matematického akcentu</a></li><li><a href='#setrgbcolor'>Barvy zadávané v RGB</a></li><li><a href='#rgb'>Barvy překlopené do RGB</a></li><li><a href='#cmixdef'>Míchání barev, jako na paletě malíře</a></li><li><a href='#normalcmyk'>Normalizování barvy CMYK</a></li><li><a href='#x11rgb'>Deklarace sady barev z X11</a></li>
	</ul>
</li>                  <li><a href='#transformace'>Transformace</a>
	<ul>
                          <li><a href='#transformbox'>Transformovaný box s přepočtenými rozměry</a></li><li><a href='#rotsimple'>Jednoduché otočení boxu</a></li><li><a href='#shbox'>Jednoduché zvětšení/zmenšení boxu</a></li><li><a href='#sipky'>Různě zakřivené šipky</a></li><li><a href='#cancel'>Přeškrtnutý text</a></li><li><a href='#circletext'>Text podél kružnice</a></li><li><a href='#nopt'>Úprava makra \ignorept a návrh makra \nopt </a></li>
	</ul>
</li>                  <li><a href='#stranka'>Stránka</a>
	<ul>
                          <li><a href='#headline'>Plovoucí záhlaví</a></li><li><a href='#podklad'>Podkladový obrázek nebo barva na každé straně</a></li><li><a href='#maybebreak'>Zlom stránky jen někdy</a></li><li><a href='#sloupce'>Sazba do sloupců jako v novinách</a></li><li><a href='#crop'>Ořezové značky</a></li><li><a href='#nopageno'>Jednostránkový dokument bez čísla stránky</a></li><li><a href='#outbox'>PDF stránečky dle velikosti boxu</a></li>
	</ul>
</li>                  <li><a href='#verbatim-prostredi'>Verbatim prostředí</a>
	<ul>
                          <li><a href='#loctt'>Lokální tthook</a></li><li><a href='#code'>Verbatim v nadpisech sekcí</a></li><li><a href='#ttpenalty'>Zákaz zlomu mezi řádky výpisu</a></li><li><a href='#hisyntax'>Automatické zvýraznění/obarvení syntaxe</a></li><li><a href='#hisyntaxhtml'>Zvýraznění HTML kódu</a></li><li><a href='#hisyntaxpy'>Zvýraznění kódu Pythonu</a></li><li><a href='#hisyntaxcss'>Zvýraznění kódu C#</a></li><li><a href='#ttram'>Listingy v rámečku</a></li><li><a href='#verbbreak'>Zalamování řádků ve verbatim listingu</a></li><li><a href='#verbtab'>Tabulátory ve verbatim výpisech</a></li><li><a href='#verbindent'>Řízené odsazení řádků kódu ve verbatim listingu</a></li>
	</ul>
</li>                  <li><a href='#poznamky'>Poznámky</a>
	<ul>
                          <li><a href='#footcat'>Změny kategorií v poznámce pod čarou</a></li><li><a href='#thefnote'>Rozdílné formátování značky poznámky pod čarou</a></li><li><a href='#hyperlinkfnote'>Odkaz s poznámkou spojený hyperlinky</a></li><li><a href='#fnoteshape'>Nastavení tvaru odstavce poznámky pod čarou</a></li><li><a href='#fnotebroken'>Poznámky pod čarou na více stránkách s barevnými texty</a></li><li><a href='#tnote'>Lokální poznámky pod tabulkami</a></li><li><a href='#rotmnote'>Poznámky mnote pootočené</a></li><li><a href='#nmnote'>Číslované poznámky mnote</a></li>
	</ul>
</li>                  <li><a href='#odrazky'>Odrážky</a>
	<ul>
                          <li><a href='#vnoreni'>Odrážka pro vnořené \begitems...\enditems</a></li><li><a href='#vnoreniB'>Jiné řešení vnořeného \begitems...\enditems</a></li><li><a href='#vertii'>Vertikální mezerování při použití \begitems...\enditems</a></li><li><a href='#noindent'>Po výčtu neodsazovat odstavec</a></li><li><a href='#gitemnum'>Průběžné číslování items</a></li>
	</ul>
</li>                  <li><a href='#draft'>Draft</a>
	<ul>
                          <li><a href='#draftlabels'>Tisk lejblíků při \draft</a></li><li><a href='#rfc'>Interní poznámky</a></li>
	</ul>
</li>                  <li><a href='#cislovani-odkazy'>Číslování, odkazy</a>
	<ul>
                          <li><a href='#cislovani'>Přehledná deklarace číslování</a></li><li><a href='#pictab'>Seznam obrázků a tabulek</a></li><li><a href='#caplisting'>Popisky pro výpisy kódů</a></li><li><a href='#capformat'>Změna formátu popisků pod obrázky a tabulkami</a></li><li><a href='#urlbreakpoint'>Zlom v dlouhém URL</a></li>
	</ul>
</li>                  <li><a href='#kapitoly-sekce'>Kapitoly, sekce</a>
	<ul>
                          <li><a href='#seccc'>Podpodsekce</a></li><li><a href='#notoc'>Zlom nadpisu v textu a v obsahu</a></li><li><a href='#part'>Přidání další úrovně nadpisů včetně zařazení do obsahu</a></li><li><a href='#notopins'>Úvodní stránka kapitoly neobsahuje \topinsert</a></li><li><a href='#globnonum'>Nastavení \nonum pro všechny kapitoly a sekce</a></li>
	</ul>
</li>                  <li><a href='#pracovni-soubor'>Pracovní soubor</a>
	<ul>
                          <li><a href='#refconsistent'>Kontrola konzistence REF souboru</a></li><li><a href='#qrcode'>Data QR kódu v REF souboru</a></li>
	</ul>
</li>                  <li><a href='#vyznacovani'>Vyznačování</a>
	<ul>
                          <li><a href='#soul'>Podtržení, přeškrtnutí, prostrkání</a></li><li><a href='#hyphprocess'>Vyhledání míst pro dělení slov ve slově</a></li><li><a href='#coltext'>Podbarvený text</a></li><li><a href='#specline'>Čára v okraji vyznačující text</a></li>
	</ul>
</li>                  <li><a href='#makro-premety'>Makro přemety</a>
	<ul>
                          <li><a href='#replacestrings'>Využití \replacestrings</a></li><li><a href='#argofvector'>Výpočet směru vektoru</a></li><li><a href='#optdef'>Definování makra s nepovinným parametrem</a></li><li><a href='#noendspace'>Odstranění poslední mezery v parametru</a></li><li><a href='#eoldef'>Makro s parametrem do konce řádku</a></li><li><a href='#keyval'>Slovníky tvaru klíč=hodnota</a></li><li><a href='#flags'>Přepínače ve slovnících tvaru klíč=hodnota</a></li><li><a href='#balanced'>Vnořené závorky jiného typu než {}</a></li><li><a href='#readtoks'>Čtení parametru token po tokenu</a></li><li><a href='#etoks'>Expandující čtení textu token po tokenu</a></li><li><a href='#appendto'>Vylepšené \addto pro makra s parametry</a></li><li><a href='#patchto'>Makro \patchto na modifikaci makra</a></li><li><a href='#for'>Cyklus typu for</a></li><li><a href='#rep'>Cyklus na úrovni expand procesoru</a></li><li><a href='#newcommand'>LaTeXové newcommand</a></li><li><a href='#lipsum'>Testovací text Lorem ipsum dolor sit</a></li><li><a href='#showif'>Přeskakování textu podle čtenářů</a></li><li><a href='#plists'>Spojové seznamy</a></li><li><a href='#revlist'>Expanze seznamu v obráceném pořadí</a></li><li><a href='#sb'>Podtržítko se chová mimo matematický mód normálně</a></li><li><a href='#stripspace'>Odstranění koncové mezery z parametru</a></li><li><a href='#varsep'>Variantní separátory parametrů</a></li><li><a href='#vardelim'>Čtení parametru po variantní separátor</a></li>
	</ul>
</li>                  <li><a href='#struktura'>Struktura</a>
	<ul>
                          <li><a href='#latexchap'>LaTeXové značkování kapitol a sekcí</a></li><li><a href='#sec'>Řešení konfliktu jména \sec</a></li>
	</ul>
</li>                  <li><a href='#jazyky'>Jazyky</a>
	<ul>
                          <li><a href='#multilang'>Texty ve více jazycích</a></li><li><a href='#nextlang'>Přidání dalšího jazyka</a></li><li><a href='#Uppercase'>Uppercase německého ß</a></li><li><a href='#exseven'>Konverze frází z \mtext na velká písmena</a></li><li><a href='#hebrew'>Hebrejština -- sazba zprava doleva</a></li>
	</ul>
</li>                  <li><a href='#matematicka-sazba'>Matematická sazba</a>
	<ul>
                          <li><a href='#alphachars'>České texty v matematice</a></li><li><a href='#eqnum'>Odkaz na předchozí rovnici</a></li><li><a href='#overtilde'>Natahovací tilde nad vzorcem jakékoli velikosti</a></li><li><a href='#mathbox'>Box s textem ve velikosti podle kontextu (index, indexindex)</a></li><li><a href='#mrepeat'>Opakování symbolu na zlomu řádku</a></li><li><a href='#dots'>Inteligentní \dots jako v AMSTeXu</a></li><li><a href='#dddot'>\dddot pro třetí derivaci</a></li><li><a href='#bbgreek'>Řecká písmena jako \bbchar</a></li><li><a href='#smartgreek'>Nekurzivní řecká písmena</a></li><li><a href='#bfmath'>Normální \bf a \bi v matematickém módu</a></li><li><a href='#vecmath'>Vektory včetně řeckých znaků tučně bez serifů</a></li><li><a href='#dfam'>Matematické rodiny dynamicky přidělené</a></li><li><a href='#matrixR'>Matice s vysunutým sloupcem</a></li><li><a href='#matrixA'>Matice s vysunutým řádkem</a></li><li><a href='#mspecdef'>Názorné zkratky v matematické sazbě</a></li><li><a href='#varstyle'>Sazba závislá na mathstylu</a></li>
	</ul>
</li>                  <li><a href='#tabulky'>Tabulky</a>
	<ul>
                          <li><a href='#etable'>Ukázka tabulky s přesahy položek do více řádků a sloupců</a></li><li><a href='#tabcrow'>Umístění textu vertikálně centrovaného ve více řádcích tabulky</a></li><li><a href='#tabpmod'>Modifikace formátu odstavce při použití deklarátoru p</a></li><li><a href='#tablemb'>Odstavce v položkách jinak vertikálně usazené</a></li><li><a href='#crlpvv'>\crlp a dvojité svislé linky</a></li><li><a href='#tableverb'>Verbatim text v tabulkách</a></li><li><a href='#booktabs'>Tabulky jako v balíčku booktabs</a></li><li><a href='#crx'>Střídavě podbarvené řádky v tabulce</a></li><li><a href='#cellcolor'>Jednotlivě podbarvené položky v tabulce</a></li><li><a href='#multispanc'>Podbarvené položky přes více sloupců</a></li><li><a href='#tableto'>Tabulky se stanovenou šířkou</a></li><li><a href='#partab'>Rozšířitelný sloupec v tabulce typu „odstavec“</a></li><li><a href='#decltab'>Deklarátory v tabulce z více písmen</a></li><li><a href='#dekadic'>Desetinná čísla v tabulkách</a></li><li><a href='#dekadic2'>Desetinná čísla v tabulkách podruhé</a></li><li><a href='#ltable1'>Tabulka přes více stránek</a></li><li><a href='#ltable2'>Dlouhá tabulka s opakujícím titulkem</a></li>
	</ul>
</li>                  <li><a href='#obrazky'>Obrázky</a>
	<ul>
                          <li><a href='#inspicspace'>Mezera separující parametr makra \inspic</a></li><li><a href='#inkinspic'>Popisky k obrázkům z programu Inkscape</a></li><li><a href='#captiform'>Jinak formátované \caption</a></li><li><a href='#capside'>Popisek vedle obrázku</a></li><li><a href='#inspic'>\inspic natáhne do PDF stejný obrázek jen jednou</a></li>
	</ul>
</li>                  <li><a href='#odstavec'>Odstavec</a>
	<ul>
                          <li><a href='#setparshape'>Pohodlné zadávání \parshape</a></li><li><a href='#putshape'>Obrázek v obdélníkovém výřezu odstavce</a></li>
	</ul>
</li>                  <li><a href='#slidy'>Slídy</a>
	<ul>
                          <li><a href='#sparta'>Slídy ve spartánské úpravě</a></li><li><a href='#slidekuk'>Slideshow -- postupné odhalování</a></li>
	</ul>
</li>                  <li><a href='#bibliograficke-udaje'>Bibliografické údaje</a>
	<ul>
                          <li><a href='#pcite'>Odkazy s vloženou poznámkou</a></li><li><a href='#ccite'>Komprimované odkazy typu [jméno, rok]</a></li><li><a href='#modcite'>Modifikace odkazů typu (jméno rok)</a></li><li><a href='#abib'>Značky v seznamu literatury při \nonumcitations</a></li><li><a href='#bibmark'>Zkrácené značky při použití opmac-bib</a></li><li><a href='#bibmarkcheck'>Kontrola unikátnosti značek bibmark</a></li><li><a href='#bibnumindent'>Odsazení seznamu literatury dle největšího čísla</a></li><li><a href='#bibmarkindent'>Odsazení seznamu literatury dle nejširší značky</a></li><li><a href='#morebibs'>Více nezávislých seznamů literatury v dokumentu</a></li><li><a href='#bibtexenc'>OPmac-bib: konec problémů s BibTeXem</a></li>
	</ul>
</li>                  <li><a href='#slovnicek'>Slovníček</a>
	<ul>
                          <li><a href='#gloslast'>Slovníček pojmů na konci dokumentu</a></li><li><a href='#glosfirst'>Slovníček pojmů na začátku dokumentu</a></li><li><a href='#glossort'>Slovníček pojmů setříděný dle českých pravidel</a></li><li><a href='#glosref'>Slovníček pojmů s hyperlinky</a></li><li><a href='#acronym'>Akronymy</a></li>
	</ul>
</li>                  <li><a href='#rejstrik'>Rejstřík</a>
	<ul>
                          <li><a href='#sort'>Využití řadicího algoritmu rejstříku pro jiné účely</a></li><li><a href='#klikpgr'>Klikací stránky v rejstříku</a></li><li><a href='#iindexb'>Alternativní seznamy stránek v rejstříku</a></li><li><a href='#iibe'>Heslo pro rejstřík dané rozsahem od--do</a></li><li><a href='#strcmp'>Experiment s lexikografickým řazením</a></li><li><a href='#currchar'>Rozdělení rejstříku do oddílů nadepsaných písmeny</a></li>
	</ul>
</li>                  <li><a href='#meta'>Meta</a>
	<ul>
                          <li><a href='#opformat'>Makra OPmac vložená do formátu</a></li><li><a href='#curl'>Zobrazení seřazených názvů triků z této stránky</a></li>
	</ul>
</li></ul>
				</nav>
			</aside>

			<div class="col-12 col-lg-8 px-0 my-shadow">
				<div class="py-3 px-2 px-sm-3">
					<main class="my-content mx-auto ml-xl-5" role="main">

						<section class="mb-5">
							<img src="img/opmac-logo.jpg" class="img-fluid rounded mx-auto d-block" style="max-height: 80px">

							<h1 class="text-center font-weight-light">OPmac - tipy, triky, návody</h1>

							<p>Tato stránka obsahuje návody na řešení rozličných úkolů při využití <a href="opmac.html">OPmac</a>. Popis jednoho návodu by neměl překročit rozsah výšky prohlížeče. Schéma každého návodu je stejné: uživatelký popis následovaný krátkým makrem, které si uživatel může seškrábout myší do svého dokumentu, následované případným vysvětlením, jak makro funguje.</p>
							<p>Mají-li další uživatelé OPmac také nějaký takový tip, prosím o jeho zaslání na můj email. Uvítám jej a zařadím na tuto stránku (pochopitelně s uvedením autora).</p>

							<div class="alert alert-info" role="alert">
								Můžete si také stáhnout PDF verzi tohoto dokumentu
								<a href="opmac-tricks-cs.pdf" class="btn btn-secondary btn-sm">PDF <i class="far fa-file-pdf"></i></a>
							</div>
						</section>


		                
                    <div class="card mx-auto mb-5 my-shadow" style="max-width: 520px">
                    <div class="card-header text-center">
                        <strong>Nejnovější články</strong>
                    </div>
                    <div class="list-group list-group-flush">

                    <a href="#hyperlinkfnote" class="list-group-item list-group-item-action d-flex justify-content-between">
    Odkaz s poznámkou spojený hyperlinky
    <small>19. 03. 2020</small>
</a> <a href="#dekadic2" class="list-group-item list-group-item-action d-flex justify-content-between">
    Desetinná čísla v tabulkách podruhé
    <small>07. 12. 2019</small>
</a> <a href="#vecmath" class="list-group-item list-group-item-action d-flex justify-content-between">
    Vektory včetně řeckých znaků tučně bez serifů
    <small>20. 10. 2019</small>
</a> <a href="#nopt" class="list-group-item list-group-item-action d-flex justify-content-between">
    Úprava makra \ignorept a návrh makra \nopt 
    <small>23. 06. 2019</small>
</a> <a href="#hisyntaxcss" class="list-group-item list-group-item-action d-flex justify-content-between">
    Zvýraznění kódu C#
    <small>21. 06. 2019</small>
</a>

                    </div></div>


		                 <section id="pismo" class="mb-5 rounded my-shadow" style="background-color: #778c94">
                                <header class="text-center">
                                  <div class="py-2">
                                    <h2 class="d-inline text-light font-weight-light">Písmo</h2>
                                    <a href="#pismo"><i class="fas fa-link"></i></a>
                                  </div>
                                </header>
                                <article id='svyska' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Korekce střední výšky písma</h3> <a href='#svyska'><i class='fas fa-link'></i></a></div></header><section><p>Pro některá písma se může stát, že například strojopis <code>\tt</code> neladí se základním písmem. Nastává to tehdy, když není stejná střední výška písma, třebaže obě písma jsou zavedana ve stejné velikosti (například <code>at11pt</code>). Korekci lze v&nbsp;OPmac udělat jednoduše využitím <code>\thefontscale</code>, který škáluje vzhledem k&nbsp;aktuální velikosti písma (nikoli vzhledem k&nbsp;fixní designované velikosti). Takže stačí třeba psát: </p><pre class='pr-3'><code>\def\tt{\tentt\thefontscale[1120]} 
</code></pre><p>Uvedená definice zvětší <code>\tt</code> font 1,12 krát vzhledem k&nbsp;velikosti okolního fontu. Přepínač <code>\tt</code> toto udělá kdekoli při jakékoli aktuální velikosti okolního fontu. Uvedený poměr se hodí například pro kombinaci Bookman s&nbsp;Courier. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#svyska' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0001</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2013-08-13'>13. 08. 2013</time></span> </footer></article> <article id='currvf' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Chytřejší \typosize a \typoscale</h3> <a href='#currvf'><i class='fas fa-link'></i></a></div></header><section><p>OPmac definuje makra <code>\typosize</code> a&nbsp;<code>\typoscale</code> tak, že nastaví odpovídající velikost fontu a&nbsp;resetují variantu fontu na <code>\rm</code> bez ohledu na to, jaká byla zvolena před použitím makra. Tedy </p><pre class='pr-3'><code>\bf text \typosize[13/15] velký 
</code></pre><p>způsobí, že slovo „velký“ je vytištěno ve variantě <code>\rm</code>, nikoli <code>\bf</code>. Pokud chceme, aby makra <code>\typosize</code> a&nbsp;<code>\typoscale</code> respektovala naposledy zvolenou variantu fontu, pak je možné použít tento kód: </p><pre class='pr-3'><code>\let\currvf=\rm 
\addto\rm{\let\currvf\rm}   \addprotect\rm 
\addto\it{\let\currvf\it}   \addprotect\it 
\addto\bf{\let\currvf\bf}   \addprotect\bf 
\addto\bi{\let\currvf\bi}   \addprotect\bi 
 
\def\textfontsize[#1]{\if$#1$\else 
  \fontdim=#1\ptunit \ifx\fontdimB\undefined \edef\fontdimB{\the\fontdim}\fi 
  \let\dgsize=\fontdim 
  \edef\sizespec{at\the\fontdim}% 
  \resizeall \currvf 
  \let\dgsize=\undefined 
  \fi 
} 
</code></pre><p>Makra <code>\rm</code>, <code>\bf</code>, <code>\it</code> a&nbsp;<code>\bi</code> nyní kromě nastavení varianty uloží zprávu o&nbsp;aktuálně nastavené variantě do sekvence <code>\currvf</code>. Aby nedošlo ke kolizi při expandování ve <code>\write</code>, je třeba makra označit pomocí <code>\addprotect</code>. Interní makro OPmac <code>\textfontsize</code> je předefinováno tak, že místo makra <code>\rm</code> původně se vyskytujícího za voláním <code>\resizeall</code> je vloženo <code>\currvf</code>. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#currvf' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0132</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2015-11-23'>23. 11. 2015</time></span> </footer></article> <article id='scaleto' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Font dle požadované šířky</h3> <a href='#scaleto'><i class='fas fa-link'></i></a></div></header><section><p>Připravíme makro <code>\scaleto rozměr {text}</code>, které vytiskne text aktuálním fontem zvětšeným/zmenšeným tak, že šířka textu zaujme specifikovaný rozměr. Takže třeba <code>\scaleto5cm{ahoj}</code> vytvoří box s&nbsp;textem „ahoj“ zvětšeným tak, že šířka textu je <code>5cm</code>. Tuto vlastnost asi při běžné sazbě nevyužijeme, ale může se hodit při sazbě plakátů nebo pro umístění nadpisu přesně do <code>\hsize</code> atd. </p><pre class='pr-3'><code>\def\scaleto#1#{\bgroup\def\bw{#1}\scaletoA} 
\def\scaletoA #1{\expandafter\let \expandafter\thefont \the\font 
   \calculatefontdim{#1}\edef\dgsize{\the\fontdim}\letfont\thefont=\thefont at\fontdim 
   \calculatefontdim{#1}\letfont\thefont=\thefont at\fontdim 
   \hbox to\bw{\thefont#1}% 
   \egroup 
} 
\def\calculatefontdim#1{% 
   \setbox0=\hbox{\thefont #1}\tmpdim=\bw \tmpnum=\wd0 
   \divide\tmpnum by256 \divide\tmpdim by\tmpnum \multiply\tmpdim by256 
   \fontdim=\expandafter\ignorept\the\tmpdim\fontdim 
} 
</code></pre><p>Makro vypočítává správné zvětšení tak, že spočítá poměr požadované šířky boxu ku skutečné šířce textu a&nbsp;tímto poměrem násobí <code>\fontdim</code>. Výpočet dělá nadvakrát. Při prvním výpočtu <code>\fontdim</code> nastaví podle něj také <code>\dgsize</code>, tj. vyzvedne se také font odpovídající optické velikosti. To ale může změnit skutečnou šířku textu. Takže přepočet je proveden podruhé, a&nbsp;po něm už proběhne jen geometrické zvětšení fontu z&nbsp;předchozího kroku. </p><p>Je-li aktivován eTeX, je možné vypočítat poměr dvou velikostí přesněji a&nbsp;pohodlněji. Stačí definovat <code>\dividedimen</code> a&nbsp;využít toho, že toto makro pracuje na úrovni expandprocesoru. </p><pre class='pr-3'><code>\def\dividedimen (#1/#2){\expandafter\ignorept\the 
   \dimexpr\numexpr\number\dimexpr#1\relax*65536/\number\dimexpr#2\relax\relax sp\relax 
} 
\def\calculatefontdim#1{% 
   \setbox0=\hbox{\thefont #1}% 
   \fontdim=\dividedimen(\bw/\wd0)\fontdim 
} 
</code></pre></section><footer class='text-right'><a href='opmac-tricks-e.html#scaleto' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0027</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2013-09-05,2013-11-22'>05. 09. 2013</time></span> </footer></article> <article id='showfonts' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Výpis načtených fontů</h3> <a href='#showfonts'><i class='fas fa-link'></i></a></div></header><section><p>Po načtení fontů (např. pomocí <code>\input lmfonts</code>) a&nbsp;po jejich zvětšení (např. pomocí <code>\typosize[11/13]</code>) je někdy užitečné si připravené fonty vypsat do logu a&nbsp;na terminál, aby si v&nbsp;tom člověk udělal jasno. Stačí napsat <code>\showfonts</code>, pokud je tento příkaz definován například takto: </p><pre class='pr-3'><code>\def\showfonts{\bgroup 
   \def\wterm##1{\immediate\write16{##1}} 
   \def\resizefont##1{\wterm{##1= \fontname##1}}\resizeall 
   \tmpnum=0 \loop 
      \wterm{\the\tmpnum: \fontname\textfont\tmpnum\space/ 
                          \fontname\scriptfont\tmpnum\space/ 
                          \fontname\scriptscriptfont\tmpnum} 
      \advance\tmpnum by1 \ifnum\tmpnum&lt;16 \repeat 
   \egroup} 
</code></pre><p>Příkaz vypíše názvy všech textových fontů registrovaných pomocí <code>\regfont</code> a&nbsp;dále názvy všech matematických fontů rodin 0&nbsp;až 15 ve všech velikostech. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#showfonts' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0029</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2013-09-24'>24. 09. 2013</time></span> </footer></article> <article id='onlycm' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Méně implicitně zavedených fontů</h3> <a href='#onlycm'><i class='fas fa-link'></i></a></div></header><section><p>Použijeme-li <code>\showfonts</code> z&nbsp;předchozího OPmac triku, shledáme, že OPmac implicitně pro matematickou sazbu zavádí kromě standardních CM fontů i&nbsp;AMS fonty a&nbsp;EC fonty. Může se stát, že tyto fonty nepotřebujeme a&nbsp;navíc je nemáme třeba ani instalovány v&nbsp;TeXové distribuci. </p><p>Obejít závislost OPmac na těchto fontech lze pomocí <code>\let\normalmathloading=\relax</code>, které je třeba vložit před <code>\input opmac</code>. Pak musí následovat definice matematické sady <code>\normalmath</code> a&nbsp;<code>\boldmath</code> následovaná příkazem <code>\normalmath</code>. Pokud například chceme používat výhradně CM fonty (v csplainu CSfonty) a&nbsp;žádné jiné, pak je možné psát: </p><pre class='pr-3'><code>\let\normalmathloading=\relax 
\input opmac 
 
\def\normalmath{% 
  \loadmathfamily 0 cmr  % CM Roman 
  \loadmathfamily 1 cmmi % CM Math Italic 
  \loadmathfamily 2 cmsy % CM Standard symbols 
  \loadmathfamily 3 cmex % CM extra symbols 
  \loadmathfamily 8 cmbx % bold 
  \setmathfamily  9 \tenbi % bold slanted 
  \setmathfamily 10 \tenrm 
  \setmathfamily 11 \tenit 
  \setmathdimens 
} 
\def\boldmath{% 
  \loadmathfamily 0 cmbx  % CM Roman Bold Extended 
  \loadmathfamily 1 cmmib % CM Math Italic Bold 
  \loadmathfamily 2 cmbsy % CM Standard symbols Bold 
  \loadmathfamily 3 cmex  % CM extra symbols 
  \loadmathfamily 8 cmbx  % bold 
  \setmathfamily  9 \tenbi % bold slanted 
  \setmathfamily 10 \tenrm 
  \setmathfamily 11 \tenit 
  \setmathdimens 
} 
\normalmath 
</code></pre><p>Pochopitelně, po tomto nastavení nebudou fungovat matematické znaky z&nbsp;ignorovaných fontů, tj. nebude dosažitelné množství AMS symbolů, nebude fungovat <code>\script</code>, <code>\frak</code>, <code>\bbchar</code>, přepínače <code>\bf</code> a&nbsp;<code>\bi</code> vrátí v&nbsp;matematickém módu běžné serifové znaky (nikoli bezserifové). Na druhé straně OPmac v&nbsp;tuto chvíli není závislý na AMS fontech ani EC fontech a&nbsp;tyto fonty nemusejí být ani instalovány. </p><p>Jiným řešením stejného problému může být zkopírování souboru <code>ams-math.tex</code> do nového souboru (řekněme <code>my-math.tex</code>), pozměnění obsahu tohoto souboru dle soukromých požadavků a&nbsp;načtení tohoto souboru *před příkazem* <code>\input opmac</code>. Tedy: </p><pre class='pr-3'><code>\input my-math 
\input opmac 
</code></pre><p>Zdůvodnění: Jestliže je <code>\normalmath</code> definován před <code>\input opmac</code>, tak OPmac soubor <code>ams-math.tex</code> vůbec nepoužije. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#onlycm' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0111</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2015-06-17'>17. 06. 2015</time></span> </footer></article> <article id='embrac' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Stojaté závorky v kurzívě</h3> <a href='#embrac'><i class='fas fa-link'></i></a></div></header><section><p>Ukážeme, jak lze jediným řádkem implementovat vlastnost, kterou řeší cca 300 řádků naprosto nečitelného kódu v&nbsp;balíčku <code>embrac.sty</code>. </p><p>Občas se objeví typografický požadavek ponechat závorky <code>()</code> a&nbsp;případně další i&nbsp;v kurzívě stojaté. Takže když napíšeme <code>{\em kurzíva se (závorkami)}</code>, měli bychom dostat </p><pre class='pr-3'><code>{\it kurzíva se {\rm(}závorkami{\/\rm)}} 
</code></pre><p>Toto se dá řešit následující definicí: </p><pre class='pr-3'><code>\addto\em{\adef({\ifmmode(\else{\rm(}\fi}\adef){\ifmmode)\else{\/\rm)}\fi}} 
</code></pre><p>Definice aktivuje závorky v&nbsp;kurzívě a&nbsp;navíc řeší ponechání závorek v&nbsp;původním významu v&nbsp;matematickém módu. takže funguje </p><pre class='pr-3'><code>{\em Text $\bigl((yxy)+z\bigr)$ a něco dalšího (v závorce)}. 
</code></pre></section><footer class='text-right'><a href='opmac-tricks-e.html#embrac' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0064</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2013-06-07'>07. 06. 2013</time></span> </footer></article> <article id='capinsert' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>První písmeno odstavce větší</h3> <a href='#capinsert'><i class='fas fa-link'></i></a></div></header><section><p>Navrhneme makro <code>\Capinsert</code>, které zvětší první písmeno v&nbsp;odstavci: </p><pre class='pr-3'><code>\Capinsert První písmeno bude větší, tj. P v tomto případě... 
nebo 
\Capinsert {co vytisknout vlevo} První písmeno bude větší... 
</code></pre><p>Je třeba deklarovat, jak moc chceme písmeno zvětšit a&nbsp;jak jej zabudovat do řádků odstavce. Deklarační část bude vypadat takto: </p><pre class='pr-3'><code>\newdimen\ptem     \ptem=.1em        % jednotka závislá na em 
\newdimen\Capsize  \Capsize=44\ptem  % požadovaná velikost 
\newdimen\Capabove \Capabove=8\ptem  % horní přesah přes účaří 
\newdimen\Capafter \Capafter=1\ptem  % mezera za písmenem 
\def\Capprefix{\localcolor\Red}      % makro provedené před písmenem 
 
%% Deklarace k jednotlivým písmenům ve tvaru: 
% \declCap písmeno {přesah doleva; korekce prvního řádku, druhého, atd.} 
\declCap {default} {0;0,0,0}  % výchozí hodnota pro nedeklarovaná písmena 
\declCap W {3;0,4,6} 
\declCap A {1;6,2,-2} 
\declCap L {0;9,0,0} 
... 
</code></pre><p>Makro, které řeší požadovaný úkol (podobnou věc řeší LaTeXový balíček <code>lettrine</code>) může vypadat takto: </p><pre class='pr-3'><code>\def\declCap #1#2{\sxdef{cap:=#1}{#2}} 
\def\Capinsert{\def\leftCapmaterial{}\futurelet\next\CapinsertA} 
\def\CapinsertA{\ifx\next\bgroup \expandafter\CapinsertB \else 
\expandafter\CapinsertC \fi} 
\def\CapinsertB #1{\def\leftCapmaterial{#1}\CapinsertC} 
\def\CapinsertC #1{\par 
  \isdefined{cap:=#1}\iftrue \edef\tmp{\csname cap:=#1\endcsname}% 
                     \else   \edef\tmp{\csname cap:=default\endcsname}\fi 
  \setbox0=\hbox{{\thefontsize[\expandafter\ignorept\the\Capsize]\Capprefix#1}\kern\Capafter}% 
  \expandafter \CapinsertD \tmp,,% 
  \noindent\kern-\firstlineindent \rlap{\kern-\protrudeCap\ptem\llap{\leftCapmaterial}% 
                                        \vbox to0pt{\kern-\Capabove\box0\vss}}% 
  \kern\firstlineindent 
} 
\def\CapinsertD #1;{\tmpnum=1 \let\firstlineindent=\undefined 
   \def\parshapeparams{}\def\protrudeCap{#1}\CapinsertE} 
\def\CapinsertE #1,{\ifx,#1,\parshape =\tmpnum \parshapeparams 0pt \hsize 
  \else 
     \advance\tmpnum by1 
     \tmpdim=\wd0 \advance\tmpdim by-#1\ptem \advance\tmpdim by-\protrudeCap\ptem 
     \edef\parshapeparams{\parshapeparams\the\tmpdim}% 
     \ifx\firstlineindent\undefined \let\firstlineindent\parshapeparams \fi 
     \advance\tmpdim by-\hsize \tmpdim=-\tmpdim 
     \edef\parshapeparams{\parshapeparams\the\tmpdim}% 
     \expandafter \CapinsertE \fi 
} 
</code></pre><p>Podrobný popis fungování makra je na <a href='http://tex.stackexchange.com/questions/186701/thoughts-on-turning-this-dropcap-lettrine-code-into-a-macro' title='tex.stackexchange'>tex.stackexchange</a>. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#capinsert' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0075</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2014-06-27'>27. 06. 2014</time></span> </footer></article> <article id='fakebold' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Nepravý bold</h3> <a href='#fakebold'><i class='fas fa-link'></i></a></div></header><section><p>Někdy není k&nbsp;dizpozici tučný řez fontu, a&nbsp;přitom (zvláště v&nbsp;matematických vzorcích) potřebujeme nějaké písmeno nebo znak zdůraznit tučně. Například nejsou k&nbsp;dispozici matematické symboly ze sady AMS-A a&nbsp;AMS-B v&nbsp;tučné variantě, případně skript. V&nbsp;takovém případě může pomoci podvržený bold, který použijeme například takto: </p><pre class='pr-3'><code>Vzorec: $a+b\fakebold{+}c = \fakebold{\script D}$. 
</code></pre><p>Makro <code>\fakebold</code> se opírá o&nbsp;PDF kód vložený pomocí <code>\pdfliteral</code>: </p><pre class='pr-3'><code>\def\fakebold#1{\pdfliteral{2 Tr .3 w}#1\pdfliteral{0 Tr 0 w}} 
</code></pre><p>Kód <code>2 Tr .3 w</code> dává PDF rasterizéru pokyn, aby písmo definované okrajem jednotlivých písmen nejen vyplnil barvou, ale také okraj obtáhl čarou tloušťky <code>.3 bp</code>. Tím každé písmeno dostane výraznější duktus. </p><p>Pro další výtvarné efekty můžete experimentovat i&nbsp;s tím, že písmena vůbec nebudou vyplněna, jen budou obtažena. To zajistí příkaz <code>1 Tr</code> a&nbsp;samozřejmě musíte nastavit nenulovou tloušťku obtahu například pomocí <code>.2 w</code>. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#fakebold' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0095</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2015-04-08'>08. 04. 2015</time></span> </footer></article> <article id='jumping' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Podtržení respektuje dolní přetahy</h3> <a href='#jumping'><i class='fas fa-link'></i></a></div></header><section><p>Za pomocí předchozího OPmac triku vytvoříme makro <code>\underlinee{text}</code>, které podtrhne text, ale podtrhující čára se nedotýká dolních přetahů. Test: <code>\underlinee{jumping quickly}</code> vytvoří: </p><p><img src='img/jumping-ukazka.png' alt='jumping quickly' title='jumping quickly' class='img-fluid rounded mx-auto my-2 d-block'> </p><p>Pro písmo Computer Modern <code>10pt</code> může makro <code>\underlinee</code> vypadat takto: </p><pre class='pr-3'><code>\def\underlinee#1{% 
   \leavevmode\vbox to0pt{\vss 
      \hrule height.3pt 
      \vskip-\baselineskip \kern2.5pt 
      \localcolor 
      \hbox{\strut\rlap{\White\pdfliteral{2 Tr 1.1 w}#1\pdfliteral{0 Tr 0 w}}#1} 
}} 
</code></pre><p>Chcete-li podtrhávat jiné písmo, je vhodné individuálně nastavit konstanty <code>.3pt</code>, <code>2.5pt</code> a&nbsp;<code>1.1</code>, abyste dosáhli co nejlepšího vizuálního efektu. </p><p>Uvedené makro podtrhne text zapouzdřený v&nbsp;boxu, takže nedovolí zlomit řádek. Pokud byste chtěli vytvořit chytřejší podtrhávání včetně automatického zlomu řádků, můžete se dále inspirovat <a href='http://petr.olsak.net/opmac-tricks.html#soul' title='OPmac trikem 0063'>OPmac trikem 0063</a>. Analogický problém je řešen na <a href='http://tex.stackexchange.com/questions/249850/' title='tex.sx.com'>tex.sx.com</a> </p></section><footer class='text-right'><a href='opmac-tricks-e.html#jumping' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0112</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2015-06-19'>19. 06. 2015</time></span> </footer></article>
                            </section>  <section id="barvy" class="mb-5 rounded my-shadow" style="background-color: #778c94">
                                <header class="text-center">
                                  <div class="py-2">
                                    <h2 class="d-inline text-light font-weight-light">Barvy</h2>
                                    <a href="#barvy"><i class="fas fa-link"></i></a>
                                  </div>
                                </header>
                                <article id='coluser' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Přepínače barev jako přepínače fontů</h3> <a href='#coluser'><i class='fas fa-link'></i></a></div></header><section><p>Tento OPmac trik měl své opodstatnění pro verze OPmac do Nov. 2014. Od verze Dec. 2014 stačí na začátek dokumentu napsat <code>\localcolor</code> a&nbsp;je vystaráno. Barvy se pak přepínají lokálně uvnitř TeXových skupin. Je ale potřeba dát pozor na konstrukce typu: </p><pre class='pr-3'><code>\setbox0=\hbox{text \Red text}   % nefunguje, návrat na původní barvu 
                                 % se provede za \setbox0 
\setbox0=\hbox{{text \Red text}} % funguje, návrat na původní barvu 
                                 % se provede uvnitř boxu 
</code></pre></section><footer class='text-right'><a href='opmac-tricks-e.html#coluser' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0026</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2013-09-03'>03. 09. 2013</time></span> </footer></article> <article id='collatex' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Přepínače barev jako v LaTeXu</h3> <a href='#collatex'><i class='fas fa-link'></i></a></div></header><section><p>V&nbsp;LaTeXu po zavedení příslušného balíčku je k&nbsp;dispozici makro <code>\color</code>, které přepíná lokálně ve skupině barvu podle svého argumentu (např. <code>{\color{red}červený text}</code>). Makro <code>\color</code> je možné definovat takto: </p><pre class='pr-3'><code>\def\color#1{\localcolor\colorA#1\relax} 
\def\colorA#1#2\relax{\uppercase{\csname#1}#2\endcsname\ignorespaces} 
 
Text {\color{red} červený} a taky {\color{blue} modrý} i normální. 
</code></pre><p>Toto makro nastaví barvu jako <code>\localcolor</code> a&nbsp;spustí příkaz se jménem, jako je parametr příkazu, jen první písmeno je velké. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#collatex' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0034</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2013-11-29'>29. 11. 2013</time></span> </footer></article> <article id='colmnote' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Barvy společně s poznámkami mnote</h3> <a href='#colmnote'><i class='fas fa-link'></i></a></div></header><section><p>Chcete-li přepínat barvy v&nbsp;odstavci a&nbsp;současně používat poznámky na okraji <code>\mnote</code>, dočkáte se pravděpodobně barevného zmatení. Poznámky <code>\mnote</code> jsou dodatečně vloženy jakoby pod aktuální řádek odstavce, takže přebírají barvu, jakou má řádek na svém konci. Pokud chcete mít barvu poznámek stále stejnou, pište na začátek dokumentu třeba: </p><pre class='pr-3'><code>\def\mnotehook{\noindent\localcolor\Blue} 
</code></pre><p>Příkaz <code>\noindent</code> je potřebný, protože jinak se značka barvy vloží do vertikálního módu a&nbsp;<code>\mnote</code> nebude mít správné vertikální umístění. </p><p>Proč nedefinuje OPmac <code>\mnotehook</code> jako <code>\Black</code> implicitně? Protože implicitní chování předpokládá, že poznámky budou přebírat barvu textu, ve kterém jsou napsány, a&nbsp;tato barva může být neměnná (např. přes několik odstavců). </p><p>V&nbsp;parametru <code>\mnote</code> je možné mít další vnořené barvy, které jsou ohraničeny skupinami. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#colmnote' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0037</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2014-03-22'>22. 03. 2014</time></span> </footer></article> <article id='colmath' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Obarvení pouze jádra bez indexu a exponentu</h3> <a href='#colmath'><i class='fas fa-link'></i></a></div></header><section><p>Úkolem je obarvit jinou barvou jen základ vzorečku bez indexu a&nbsp;exponentu. Tedy, když napíšu <code>$\colormath\Red Y_i^2$</code>, pak bude červené jen písmeno Y&nbsp;a index i&nbsp;exponent bude stejnou barvou, jako je vnější okolí. Jednoduché <code>${\localcolor\Red Y}_i^j$</code> nefunguje správně, protože za konec skupiny se vloží návrat k&nbsp;původní barvě a&nbsp;to znemožní umístit index těsně k&nbsp;písmenu. Byla totiž před tímto návratem k&nbsp;původní barvě už vložena italická korekce. Řešením je neukončovat barvu na konci jádra (základu vzorečku), ale případně obarvit index nebo exponent zapamatovanou vnější barvou a&nbsp;teprve po sazbě indexu a&nbsp;exponentu ukončit skupinu a&nbsp;vrátit se k&nbsp;původní bravě. </p><pre class='pr-3'><code>\def\colormath#1#2{% #1=color #2=colored text 
   \bgroup \let\tmpc=\currentcolor % saving current color 
   \localcolor#1#2% 
   \isnextchar_{\colormathA}{% 
      \ifcat\next.\insertmukern{#2}\next\fi 
      \ifcat\next x\insertmukern{#2}\next\fi 
      \egroup}% 
} 
\def\colormathA_#1{_{\setcmykcolor\tmpc#1}\isnextchar^{\colormathB}{\egroup}} 
\def\colormathB^#1{^{\setcmykcolor\tmpc#1}\egroup} 
 
\def\ignorefracpart#1.#2\relax{#1} 
\newmuskip\tmpmudim 
\def\insertmukern #1#2{\setbox0=\hbox{$#1#2$}\setbox1=\hbox{$#1\null#2$}% 
   \tmpdim=\wd0 \advance\tmpdim by-\wd1 
   \tmpmudim=\expandafter\ignorept\the\tmpdim mu \tmpmudim=288\tmpmudim 
   \tmpdim=16em \divide\tmpmudim by\expandafter\ignorefracpart\the\tmpdim\relax 
   \mkern\tmpmudim 
} 
</code></pre><p>Makro řeší ještě jeden problém. Mezi znaky „Y“ a&nbsp;čárkou v&nbsp;<code>cmmi10</code> je záporný kern, který by nebyl uplatněn, pokud bychom mezi těmi znaky jen ukončili skupinu a&nbsp;vrátli se k&nbsp;původní barvě. Je tedy potřeba kern manuálně spočítat a&nbsp;vložit pomocí <code>\insertmukern</code>. Makro <code>\insertmukern</code> zjistí hodnotu kernu porovnámím šířky dvou boxů v&nbsp;<code>\textstyle</code>. Tím získá hodnotu v&nbsp;<code>pt</code>. Protože se ale sazba může odehrávat v&nbsp;<code>\scriptstyle</code> nebo <code>\scriptscriptstyle</code>, je v&nbsp;makru hodnota v&nbsp;<code>pt</code> přepočítána na hodnotu v&nbsp;mu jednotkách pomocí vzorce <code>mu = (288 / 16em) pt = 18/\quad pt</code>. Pronásobení <code>em</code> šestnácti sníží zaokrouhlovací chyby při dělení celým číslem. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#colmath' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0066</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2014-06-12'>12. 06. 2014</time></span> </footer></article> <article id='colaccent' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Obarvení pouze matematického akcentu</h3> <a href='#colaccent'><i class='fas fa-link'></i></a></div></header><section><p>Toto je podobný problém, jako v&nbsp;předchozím triku 0066. Můžeme dát akcentu barvu, ale pak chceme předsunout před základ nastavení černé barvy (resp. barvy vnějšího okolí) a&nbsp;toto přepnutí se dělá pomocí <code>\pdfliteral</code>. Když vyzkoušíme </p><pre class='pr-3'><code>$\widetilde{E}\ \widetilde{\pdfliteral{}E}\ \coloredaccent\Red\widetilde{E}$ 
</code></pre><p>dostaneme </p><p><img src='img/coloredaccent.png' alt='Barvený akcent' title='Barvený akcent' class='img-fluid rounded mx-auto my-2 d-block'> </p><p>Je vidět, že prostřední výskyt akcentu dopadl špatně, protože byl do základu vložen <code>\pdfliteral{}</code>, což znemožnilo usazení akcentu podle kernigového páru se <code>\skewchar</code>. Ani nebylo nutné do toho <code>\pdfliteral{}</code> psát přepnutí na barvu. Poslední výskyt je obarvený a&nbsp;správně, protože používá makro <code>\coloredaccent</code>, které je definováno takto: </p><pre class='pr-3'><code>\newmuskip\tmpmudim 
 
\def\coloredaccent#1#2#3{% #1=color, #2=accent, #3=base 
   {\ifnum\skewchar\textfont1&lt;0 \tmpmudim=0mu \else \calculatemukern {#3}{\char\skewchar\textfont1}\fi 
    \let\tmpc=\currentcolor % saving current color 
    \localcolor #1\mkern2\tmpmudim #2{\setcmykcolor\tmpc \mkern-2\tmpmudim#3} 
   } 
} 
\def\calculatemukern #1#2{\setbox0=\hbox{\the\textfont1 #1#2}\setbox1=\hbox{\the\textfont1 #1\null#2}% 
   \tmpdim=\wd0 \advance\tmpdim by-\wd1 
   \tmpmudim=\expandafter\ignorept\the\tmpdim mu \tmpmudim=288\tmpmudim 
   \tmpdim=16em \divide\tmpmudim by\expandafter\ignorefracpart\the\tmpdim\relax 
} 
\def\ignorefracpart#1.#2\relax{#1} 
</code></pre><p>Makro <code>\coloredaccent</code> při nastaveném <code>\skewchar</code> proměří kerningový pár základu se skewchar a&nbsp;převede ho na mu jednotky podobně jako v&nbsp;předchozím triku. Pak usadí akcent posunutý o&nbsp;vypočtenou hodnotu doprava a&nbsp;základ vrátí o&nbsp;stejnou hodnotu doleva. Není mi jasné, proč musím vypočtenou hodnotu vynásobit dvěma. nějak jsem se ve skewchar algoritmu TeXu ztratil. Pokud mi to nějaký čtenář vysvětlí, dostane ode mne pochvalu před nastoupenou jednotkou. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#colaccent' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0074</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2014-06-24'>24. 06. 2014</time></span> </footer></article> <article id='setrgbcolor' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Barvy zadávané v RGB</h3> <a href='#setrgbcolor'><i class='fas fa-link'></i></a></div></header><section><p>OPmac nastavuje barvy interně v&nbsp;CMYK. Jak překlopit toto chování celkově do RGB je popsáno v&nbsp;následujícím <a href='#rgb' title='OPmac triku 0090'>OPmac triku 0090</a>. Nyní je naším cílem zůstat interně v&nbsp;CMYK, ale umožnit uživateli zadávat barvy v&nbsp;RGB. Třeba </p><pre class='pr-3'><code>\def\Pink{\setRGBcolor{213 30 101}} 
nebo 
\def\Pink{\setrgbcolor{.835 .118 .396}} 
nebo 
\def\Pink{\setHEXcolor{D51E65}} 
</code></pre><p>Ve všech třech případech tohoto příkladu je definována stejná barva, která je interně realizována jako <code>\setcmykcolor{0 .859 .526 .165}</code>. Implementace může vypadat takto: </p><pre class='pr-3'><code>\def\setRGBcolor#1{\setRGBcolorA#1 } 
\def\setRGBcolorA#1 #2 #3 {\def\tmpb{}\tmpdim=0pt 
   \ifdim#1pt&gt;\tmpdim \tmpdim=#1pt \fi 
   \ifdim#2pt&gt;\tmpdim \tmpdim=#2pt \fi 
   \ifdim#3pt&gt;\tmpdim \tmpdim=#3pt \fi 
   \tmpnum=\expandafter\onedecimaldigit\the\tmpdim\relax \relax 
   \ifnum\tmpnum=0 \def\tmpb{0 0 0 1}\else 
      \setRGBcolorB{#1}\setRGBcolorB{#2}\setRGBcolorB{#3}% 
      \tmpdim=2550pt \advance\tmpdim by-\tmpnum pt \divide\tmpdim by2550 
      \edef\tmpb{\tmpb\expandafter\ignorept\the\tmpdim}\fi 
   \setcmykcolor\tmpb 
} 
\def\setRGBcolorB#1{\tmpdim=#1pt 
   \tmpdim=-\expandafter\onedecimaldigit\the\tmpdim\relax pt 
   \advance\tmpdim by\tmpnum pt \divide\tmpdim by\tmpnum 
   \edef\tmpb{\tmpb\expandafter\ignorept\the\tmpdim\space}% 
} 
\def\onedecimaldigit#1.#2#3\relax{#1#2} 
\def\setHEXcolor#1{\setHEXcolorA#1} 
\def\setHEXcolorA #1#2#3#4#5#6{\setRGBcolorA "#1#2 "#3#4 "#5#6 } 
\def\setrgbcolor#1{\setrgbcolorA#1 } 
\def\setrgbcolorA#1 #2 #3 {\def\tmpb{}\dimen0=255pt 
   \setrgbcolorB{#1}\setrgbcolorB{#2}\setrgbcolorB{#3}% 
   \expandafter\setRGBcolorA\tmpb 
} 
\def\setrgbcolorB#1{\tmpdim=#1\dimen0 
   \edef\tmpb{\tmpb\expandafter\ignorept\the\tmpdim \space}} 
\addprotect\setRGBcolor  \addprotect\setrgbcolor  \addprotect\setHEXcolor 
</code></pre><p>Makro <code>\setRGBcolor</code> provádí konverzi RGB na CMYK dle jednoduchého vzorce (bez použití ICC profilů): </p><p><code>K'=max(R,G,B),  C=(K'-R)/K', M=(K'-G)/K', Y=(K'-B)/K', K=(255-K')/255</code>. </p><p>Makro umožní pracovat s&nbsp;jedním desetinným místem v&nbsp;údajích <code>R,G,B</code>. Proto jsou tyto údaje zpracovány makrem <code>\onedecimaldigit</code> a&nbsp;dělíme číslem 2550 a&nbsp;nikoli 255. </p><p>Makro <code>\setrgbcolor</code> násobí své parametry číslem 255 a&nbsp;převádí výpočet na <code>\setRGBcolor</code>. Konečně makro <code>\setHEXcolor</code> uvodí své parametry symbolem <code>"</code> a&nbsp;převede je rovněž na <code>\setRGBcolor</code>. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#setrgbcolor' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0089</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2015-01-25'>25. 01. 2015</time></span> </footer></article> <article id='rgb' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Barvy překlopené do RGB</h3> <a href='#rgb'><i class='fas fa-link'></i></a></div></header><section><p>OPmac interně pracuje v&nbsp;barevném prostoru CMYK. Konverzi z&nbsp;RGB do tohoto barevného prostoru může obstarat <a href='#setrgbcolor' title='OPmac trik 0089'>OPmac trik 0089</a>. Někdy se může ale stát, že potřebujeme, aby interně byly barevné povely vkládány přímo v&nbsp;RGB. Například proto, že tento barevný prostor nabízí gamut s&nbsp;jásavějšími barvami a&nbsp;dokument chceme použít pouze na obrazovce počítače, která je RGB zařízením. Nebo proto, že chcete barevně sladit obrázky z&nbsp;Inkscape s&nbsp;barvami v&nbsp;dokumentu, přitom Inkscape exportuje obrázky bohužel výhradně v&nbsp;RGB. </p><p>Barvy pak můžete definovat pomocí <code>\def\Pink{\setrgbcolor{.835 .118 .396}}</code>. </p><p>V&nbsp;OPmac od verze Jul. 2019 je makro <code>\setrgbcolor</code> přímo k&nbsp;dispozici. Pokud navíc chcete jednoduchou konverzi z&nbsp;CMYK do RGB, pak lze použít: </p><pre class='pr-3'><code>\def\setcmykcolor#1{\expandafter\setcmykcolorA#1 } 
\def\setcmykcolorA #1 #2 #3 #4 {\def\tmpb{}% 
   \tmpdim=1pt \advance\tmpdim by-#4pt 
   \edef\tmpa{\expandafter\ignorept\the\tmpdim}% 
   \setcmykcolorB{#1}\addto\tmpb{ }\setcmykcolorB{#2}\addto\tmpb{ }\setcmykcolorB{#3}% 
   \setrgbcolor\tmpb 
} 
\def\setcmykcolorB#1{\tmpdim=1pt \advance\tmpdim by-#1pt 
\tmpdim=\tmpa\tmpdim 
   \edef\tmpb{\tmpb\expandafter\ignorept\the\tmpdim}% 
} 
\def\setRGBcolor#1{\setRGBcolorA#1 } 
\def\setRGBcolorA#1 #2 #3 {\def\tmpb{}\setRGBcolorB{#1}\setRGBcolorB{#2}\setRGBcolorB{#3}% 
   \setrgbcolor\tmpb 
} 
\def\setRGBcolorB#1{\tmpdim=#1pt \divide\tmpdim by255 
   \edef\tmpb{\tmpb\expandafter\ignorept\the\tmpdim\space}% 
} 
</code></pre><p>Toto makro interně vkládá barvy v&nbsp;RGB pomocí <code>setrgbcolor</code>  a&nbsp;také předefinuje <code>\setcmykcolor</code> tak, že toto makro se postará  o&nbsp;konverzi a&nbsp;zavolá pak <code>\setrgbcolor</code>. Používá přitom vzorce: </p><p><code>R = (1-C)*(1-K),  G = (1-M)*(1-K), B = (1-Y)*(1-K)</code>. </p><p>Dále je zde definováno makro <code>\setRGBcolor</code>, které vydělí své tři parametry číslem 255 a&nbsp;zavolá <code>\setrgbcolor</code>. </p><p>Poznámka: máte-li starší verzi OPmac než Jul. 2019, pak musíte nejprve <code>\setrgbcolor</code> definovat: </p><pre class='pr-3'><code>\let\setrgbcolor=\setcmykcolor  \addprotect\setrgbcolor 
\def\colorstackpush#1{\pdfcolorstack\colorstackcnt push{#1 rg #1 RG}} 
\def\colorstackset#1{\pdfcolorstack\colorstackcnt set{#1 rg #1 RG}} 
\ifx\XeTeXversion\undefined \else 
   \def\colorstackpush#1{\colorspecialinit \special{color push rgb #1} 
   \def\colorstackset#1{\colorspecialinit \special{color pop}\special{color push rgb #1}} 
\fi 
\def\Black{\setrgbcolor{0 0 0}} 
\def\pdfblackcolor{0 0 0} \xdef\currentcolor{\pdfblackcolor} 
 
</code></pre></section><footer class='text-right'><a href='opmac-tricks-e.html#rgb' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0090</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2015-01-25'>25. 01. 2015</time></span> </footer></article> <article id='cmixdef' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Míchání barev, jako na paletě malíře</h3> <a href='#cmixdef'><i class='fas fa-link'></i></a></div></header><section><p>Makro <code>\cmixdef\NovaBarva{lineární kombinace barev}</code> definuje novou barvu jako lineární kombinaci daných barev. Název <code>\cmixdef</code> značí „color mix define“. Příklad: </p><pre class='pr-3'><code>\cmixdef\myCyan {.3\Green + .5\Blue}  % směs 30 % zelené, 50 % modré, zbytek bílá 
\cmixdef\myColor {.1\Blue + .4\Brown + .5\Yellow} 
\cmixdef\LightBlue {.6\Blue} % Světle modrá: 60 % modré, zbytek bílá 
\cmixdef\DarkBlue {\Blue + .4\Black} % Modrá s přimícháním 40 % černé 
</code></pre><p>Míchání barev probíhá na úrovni aditivního barevného prostoru CMYK. Pokud má výsledný součet největší složku větší než 1, jsou v&nbsp;závěru všechny složky pronásobeny takovým koeficientem, aby tato složka byla přesně rovna jedné. Chcete-li emulovat činnost malíře, použijte konvexní kombinaci, jako například v&nbsp;druhém řádku ukázky: jeden díl modré, čtyři díly hnědé a&nbsp;pět dílů žluté. Není ale nutné se konvexních kombinací držet, například: </p><pre class='pr-3'><code>\cmixdef\Blue{\Cyan + \Magenta} % vskutku, protože výchozí barvy jsou z CMYK 
zatímco: 
\cmixdef\myBlue{.5\Cyan + .5\Magenta} je totéž jako \cmixdef\myBlue{.5\Blue}. 
</code></pre><p>Místo symbolu plus v&nbsp;lineární kombinaci je možné použít symbol mínus. Pak se barva odečte a&nbsp;v okamžiku odečtení příslušné barvy se záporné složky redukují na nulu. Třeba <code>\cmixdef\Barva{\Brown-\Black}</code> odstraní z&nbsp;barvy její „znečištění černou“. Konečně je možné těsně před makro pro barvu napsat symbol <code>^</code>, což značí, že se místo této barvy použije barva doplňková. </p><pre class='pr-3'><code>\cmixdef\mycolor{\Grey + .6^\Blue} stejné jako \cmixdef\mycolor{\Grey+.6\Yellow} 
</code></pre><p>Implementace je následující: </p><pre class='pr-3'><code>\def\cmixdef#1#2{\bgroup 
   \let\setcmykcolor=\relax \edef\tmpb{+#2}% 
   \replacestrings{ }{}\replacestrings{+}{\addcolor}\replacestrings{-}{\addcolor-}% 
   \replacestrings{^\setcmykcolor}{\setcmykcolor^}% 
   \replacestrings{-\setcmykcolor}{-1\setcmykcolor}% 
   \def\C{0}\def\M{0}\def\Y{0}\def\K{0}% 
   \tmpb \checkcmyk 
   \xdef#1{\setcmykcolor{\C\space \M\space \Y\space \K}}% 
   \egroup 
} 
\def\addcolor#1\setcmykcolor#2{\def\tmp{}% 
   \tmpdim=\ifx$#1$1\else#1\fi pt 
   \ifx^#2\expandafter \addcolorC 
   \else \addcolorA#2 \fi 
} 
\def\addcolorA #1 #2 #3 #4 {% 
   \addcolorB\C{#1}n\addcolorB\M{#2}n\addcolorB\Y{#3}n\addcolorB\K{#4}k% 
} 
\def\addcolorB#1#2#3{\dimen0=#2\tmpdim 
   \ifx\tmp\empty\else 
      \ifx#3n\advance\dimen0 by\K\tmpdim \dimen0=-\dimen0 \advance\dimen0 by\tmpdim 
      \else \dimen0=0pt 
   \fi\fi 
   \advance\dimen0 by#1pt 
   \ifdim\dimen0&lt;0pt \def#1{0}\else \edef#1{\expandafter\ignorept\the\dimen0}\fi 
} 
\def\addcolorC#1{\def\tmp{^}\addcolorA#1 } 
 
\def\checkcmyk{\tmpdim=\C pt 
   \ifdim\M pt&gt;\tmpdim \tmpdim=\M pt \fi 
   \ifdim\Y pt&gt;\tmpdim \tmpdim=\Y pt \fi 
   \ifdim\K pt&gt;\tmpdim \tmpdim=\K pt \fi 
   \ifdim\tmpdim&gt;1pt %\tmpdim=1/\tmpdim: 
      \tmpnum=1073741824 \divide\tmpnum by\tmpdim \multiply\tmpnum by4 \tmpdim=\tmpnum sp 
      \checkcmykA\C \checkcmykA\M \checkcmykA\Y \checkcmykA\K 
   \fi 
} 
\def\checkcmykA#1{\dimen0=#1\tmpdim 
   \ifdim\dimen0&gt;1pt \def#1{1}\else \edef#1{\expandafter\ignorept\the\dimen0}\fi 
} 
</code></pre></section><footer class='text-right'><a href='opmac-tricks-e.html#cmixdef' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0105</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2015-04-24'>24. 04. 2015</time></span> </footer></article> <article id='normalcmyk' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Normalizování barvy CMYK</h3> <a href='#normalcmyk'><i class='fas fa-link'></i></a></div></header><section><p>Základní barvy CMYK by měly fungovat tak, že smíchání <code>a*C+a*M+a*Y</code> dá výsledek stejný jako <code>a*K</code>, tj. při plném smíchání <code>C+M+Y</code> bychom měli dostat černou. (To platí jen pro ideální tonery, ve skutečnosti dostaneme hodně tmavě hnědou.) Je tedy vidět, že pokud <code>min(C,M,Y)</code> není nula, dá se zhruba řečeno odečíst toto minimum od všech tří složek a&nbsp;nahradit složkou černou. Normalizovaná barva popsaná v&nbsp;CMYK tedy má toto minimum nulové, takže obsahuje nejvýše dvě ze tří barevných složek CMY nenulové. Normalizovaná barva CMYK tedy šetří barevnými tonery. </p><p>Míchání barev pomocí <code>\cmixdef</code> z&nbsp;<a href='#cmixdef' title='předchozího OPmac triku'>předchozího OPmac triku</a> může často způsobit, že výsledná barva není normalizovaná. Můžeme ji pak normalizovat makrem <code>\normalcmyk\Barva</code>, tedy třeba takto: </p><pre class='pr-3'><code>\cmixdef\myColor{lineární kombinace barev} \normalcmyk\myColor 
</code></pre><p>Makro <code>\normalcmyk</code> odstraní z&nbsp;každé složky <code>C,M,Y</code> jejich společné minimum a&nbsp;přidá to k&nbsp;černé. Toto odstranění a&nbsp;přidání není přímočaré, ale do hry jsou zapojeny vzorečky na konverzi CMYK do RGB (<a href='#rgb' title='OPmac trik 0090'>OPmac trik 0090</a>) a&nbsp;zpětně z&nbsp;RGB do CMYK (<a href='#setrgbcolor' title='OPmac trik 0089'>OPmac trik 0089</a>), tentokrát v&nbsp;normalizovaném tvaru. Implementace je následující: </p><pre class='pr-3'><code>\def\normalcmyk#1{\bgroup \let\setcmykcolor=\relax 
   \edef\tmp{#1}\def\tmpa{#1}\expandafter\normalcmykA\tmp 
} 
\def\normalcmykA#1#2{\normalcmykB #2 } 
\def\normalcmykB#1 #2 #3 #4 {\tmpdim=#1pt 
   \ifdim#2pt&lt;\tmpdim \tmpdim=#2pt \fi  \ifdim#3pt&lt;\tmpdim \tmpdim=#3pt \fi 
   \ifdim\tmpdim=0pt \else 
      \ifdim\tmpdim&lt;1pt 
         \dimen2=\tmpdim % \dimen2=min(C,M,Y) 
         \tmpdim=-\tmpdim \advance\tmpdim by1pt \dimen1=\tmpdim % \dimen1 = 1-min 
         \tmpnum=1073741824 \divide\tmpnum by\tmpdim \multiply\tmpnum by4 \tmpdim=\tmpnum sp 
         \edef\tmp{\expandafter\ignorept\the\tmpdim}% \tmp = 1 / (1-min) 
         \normalcmykC\C{#1}\normalcmykC\M{#2}\normalcmykC\Y{#3}% 
         \dimen0=-#4\dimen2 \advance\dimen0 by\dimen2 \advance\dimen0 by#4pt 
         \edef\K{\expandafter\ignorept\the\dimen0}% K_new = 1 - (1-min)*(1-K_old) 
         \expandafter\xdef\tmpa{\setcmykcolor{\C\space\M\space\Y\space\K}}% 
      \else \expandafter\xdef\tmpa{0 0 0 1}% 
   \fi\fi \egroup 
} 
\def\normalcmykC#1#2{\ifdim\dimen2=#2pt \def#1{0}\else 
      \dimen0=\dimen1 % C_new = ((1-min) - (1-C_old)) / (1-min) 
      \advance\dimen0 by#2pt \advance\dimen0 by-1pt 
      \dimen0=\tmp\dimen0 \ifdim\dimen0&gt;1pt \dimen0=1pt \fi 
      \edef#1{\expandafter\ignorept\the\dimen0}% 
   \fi 
} 
</code></pre></section><footer class='text-right'><a href='opmac-tricks-e.html#normalcmyk' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0106</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2015-04-24'>24. 04. 2015</time></span> </footer></article> <article id='x11rgb' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Deklarace sady barev z X11</h3> <a href='#x11rgb'><i class='fas fa-link'></i></a></div></header><section><p>Soubor <code>rgb.txt</code> obsahuje názvy barev a&nbsp;jejich RGB deklarace používané v&nbsp;X&nbsp;Window System. Tato sada názvů je přepsána v&nbsp;LaTeXovém souboru <code>x11nam.def</code>. Pokud jej správně načteme, budeme mít k&nbsp;dispozici sadu as tří set přepínačů barev s&nbsp;názvy dle tohoto souboru, tj. třeba <code>\DeepPink</code>, <code>\Azure</code>, <code>\CadetBlue</code> atd. Tyto jednotlivé názvy jsou v&nbsp;souboru navíc vždy ve čtyřech variantách. Jedničkou jsou označeny barvy nejvíc zářivé a&nbsp;další v&nbsp;pořadí 2, 3&nbsp;a 4&nbsp;jsou barvy odvozené tak, že je postupně ubrána barva a&nbsp;přidána šedá. </p><p>Načteme soubor <code>x11nam.def</code> tak, aby barvy označené jedničkou byly přístupné v&nbsp;přímém názvu (tj. místo <code>\Chocolate1</code> přímo <code>\Chocolate</code>) a&nbsp;barva s&nbsp;označením 2&nbsp;měla v&nbsp;názvu připojeno písmeno <code>B</code>, barva 3&nbsp;připojuje v&nbsp;názvu <code>C</code> a&nbsp;barva 4&nbsp;připojuje <code>D</code>. Například </p><pre class='pr-3'><code>\def\zkus#1{{#1\vrule height10pt depth5pt width20pt}\kern2pt} 
\zkus\DeepPink \zkus\DeepPinkB \zkus\DeepPinkC \zkus\DeepPinkD 
</code></pre><p>vytvoří sadu čtyř růžových obdélníčků, každý další je poněkud zašpiněnější než ten předchozí. Povšimněte si, že barva <code>\DeepPinkA</code> neexistuje. </p><p>Načtení souboru <code>x11nam.def</code> provedeme takto: </p><pre class='pr-3'><code>\long\def\tmp#1\preparecolorset#2#3#4#5{\tmpa #5;,,,;} 
\def\tmpa#1,#2,#3,#4;{\ifx,#1,\else 
   \def\tmpb{#1}\replacestrings{1}{}\replacestrings{2}{B}% 
   \replacestrings{3}{C}\replacestrings{4}{D}% 
   \expandafter\def\csname\tmpb\endcsname{\setrgbcolor{#2 #3 #4}}% 
   \expandafter\tmpa\fi 
} 
\expandafter\tmp\input x11nam.def 
</code></pre><p>Dále je potřeba buď překlopit správu barev na RGB (podle OPmac triku <a href='#rgb' title='0090'>0090</a>) nebo nastavit konverzi z&nbsp;RGB do CMYK (podle OPmac triku <a href='#setrgbcolor' title='0089'>0089</a>). </p></section><footer class='text-right'><a href='opmac-tricks-e.html#x11rgb' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0108</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2015-05-01'>01. 05. 2015</time></span> </footer></article>
                            </section>  <section id="transformace" class="mb-5 rounded my-shadow" style="background-color: #778c94">
                                <header class="text-center">
                                  <div class="py-2">
                                    <h2 class="d-inline text-light font-weight-light">Transformace</h2>
                                    <a href="#transformace"><i class="fas fa-link"></i></a>
                                  </div>
                                </header>
                                <article id='transformbox' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Transformovaný box s přepočtenými rozměry</h3> <a href='#transformbox'><i class='fas fa-link'></i></a></div></header><section><p>Vytvoříme makro <code>\transformbox{transformace}{obsah boxu}</code>, které vloží transformovaný <code>\hbox</code> do vnějšího boxu takových rozměrů, že minimálně obklopuje transformovaný box. Počátek transformace zůstává na účaří. Například </p><p><img src='img/cmelak-ukazka.png' alt='Ukázka čmeláka' title='Ukázka čmeláka' class='img-fluid rounded mx-auto my-2 d-block'> </p><pre class='pr-3'><code>\picw=5cm \transformbox{\pdfrotate{45}}{\inspic cmelak.jpg } 
</code></pre><p>vytiskne čmeláka otočeného o&nbsp;45 stupňů. Je-li dejme tomu tento obrázek čtvercový, bude mít vnější box výšku i&nbsp;šířku <code>5cm * sqrt(2)</code>, hloubka zůstane nulová. </p><p>Čáry kolem naznačují hranici vnějšího boxu, ve skutečnosti se nevytisknou. Nebo třeba </p><pre class='pr-3'><code>\transformbox{\pdfscale{2}{1.2}\pdfrotate{-30}}{Box} 
</code></pre><p>vytvoří box šířky, výšky a&nbsp;hloubky tak, jak je naznačeno na obrázku: </p><p><img src='img/box-ukazka.png' alt='Ukázka boxu' title='Ukázka boxu' class='img-fluid rounded mx-auto my-2 d-block'> </p><p>Je také možné definovat otáčení boxu jako <code>\rotbox{úhel}{text boxu}</code> jednoduše takto: </p><pre class='pr-3'><code>\def\rotbox#1#2{\transformbox{\pdfrotate{#1}}{#2}} 
</code></pre><p>Makro <code>\transformbox</code> je definováno takto: </p><pre class='pr-3'><code>\newdimen\vvalX \newdimen\vvalY 
\newdimen\newHt \newdimen\newDp \newdimen\newLt \newdimen\newRt 
\let\oripdfsetmatrix=\pdfsetmatrix 
 
\def\multiplyMxV #1 #2 #3 #4 {% matrix * (vvalX, vvalY) 
   \tmpdim = #1\vvalX \advance\tmpdim by #3\vvalY 
   \vvalY  = #4\vvalY \advance\vvalY  by #2\vvalX 
   \vvalX = \tmpdim 
} 
\def\multiplyMxM #1 #2 #3 #4 {% currmatrix := currmatrix * matrix 
   \vvalX=#1pt \vvalY=#2pt \expandafter\multiplyMxV \currmatrix 
   \edef\tmpb{\expandafter\ignorept\the\vvalX\space \expandafter\ignorept\the\vvalY}% 
   \vvalX=#3pt \vvalY=#4pt \expandafter\multiplyMxV \currmatrix 
   \edef\currmatrix{\tmpb\space 
      \expandafter\ignorept\the\vvalX\space \expandafter\ignorept\the\vvalY\space}% 
} 
\def\transformbox#1#2{\hbox{\setbox0=\hbox{#2}\preptransform{#1}% 
   \kern-\newLt \vrule height\newHt depth\newDp width0pt 
   \setbox0=\hbox{\box0}\ht0=0pt \dp0=0pt \pdfsave#1\rlap{\box0}\pdfrestore \kern\newRt}% 
} 
\def\preptransform #1{\def\currmatrix{1 0 0 1 }% 
   \def\pdfsetmatrix##1{\edef\tmpb{##1 }\expandafter\multiplyMxM \tmpb\unskip}#1% 
   \setnewHtDp 0pt  \ht0  \setnewHtDp 0pt  -\dp0 
   \setnewHtDp \wd0 \ht0  \setnewHtDp \wd0 -\dp0 
   \let\pdfsetmatrix=\oripdfsetmatrix 
} 
\def\setnewHtDp #1 #2 {% 
   \vvalX=#1\relax \vvalY=#2\relax \expandafter\multiplyMxV \currmatrix 
   \ifdim\vvalX&lt;\newLt \newLt=\vvalX \fi \ifdim\vvalX&gt;\newRt \newRt=\vvalX \fi 
   \ifdim\vvalY&gt;\newHt \newHt=\vvalY \fi \ifdim-\vvalY&gt;\newDp \newDp=-\vvalY \fi 
} 
</code></pre><p>Makro implementuje maticovou aritmetiku pro currentmatrix. Dále dočasně (během <code>\preptranform</code>) předefinuje <code>\pdfsetmatrix</code> tak, že zadané transformace matici nenastaví, ale jen ji spočítají. Pak touto maticí pronásobíme čtyři body, které tvoří vrcholy boxu, a&nbsp;podíváme se na jejich obrazy. Podle jejich obrazů nastavíme nové rozměry vnějšího boxu <code>\newHt</code>, <code>\newDp</code> a&nbsp;dále prostor před počátkem transformace <code>\newLt</code> a&nbsp;za ním <code>\newRt</code>. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#transformbox' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0046</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2014-04-07'>07. 04. 2014</time></span> </footer></article> <article id='rotsimple' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Jednoduché otočení boxu</h3> <a href='#rotsimple'><i class='fas fa-link'></i></a></div></header><section><p>Velice často potřebujeme sazbu otočit jen o&nbsp;90 nebo -90 stupňů. V&nbsp;takovém případě nemusíme používat složitá makra z&nbsp;předchozího <a href='#transformbox' title='OPmac triku'>OPmac triku</a> a&nbsp;vystačíme si s&nbsp;podstatně jednodušším makrem </p><pre class='pr-3'><code>\rotsimple{90}\hbox{obsah otočeného boxu} 
nebo 
\rotsimple{-90}\vbox to\hsize{...} 
</code></pre><p>které může být implementováno takto: </p><pre class='pr-3'><code>\def\rotsimple#1{\hbox\bgroup\def\tmpb{#1}\afterassignment\rotsimpleA \setbox0=}% 
\def\rotsimpleA{\aftergroup\rotsimpleB} 
\def\rotsimpleB{\setbox0=\hbox{\box0}% 
   \ifnum\tmpb&gt;0 \kern\ht0 \tmpdim=\dp0 \else \kern\dp0 \tmpdim=\ht0 \fi 
   \vbox to\wd0{\ifnum\tmpb&gt;0 \vfill\fi 
                \vfil \wd0=0pt \dp0=0pt \ht0=0pt 
                \pdfsave\pdfrotate{\tmpb}\box0 \pdfrestore 
                \vfil}% 
   \kern\tmpdim 
   \egroup} 
</code></pre><p>Povšimněte si, že toto makro dává celou původní šířku boxu do výšky nového boxu bez ohledu na to, zda otáčíme o&nbsp;90 nebo -90 stupňů. Tím se toto makro také liší od <code>\rotbox</code> z&nbsp;předchozího <a href='#transformbox' title='OPmac triku'>OPmac triku</a>, ve kterém při záporném úhlu rotace se obsah boxu stěhuje do hloubky nového boxu. </p><p>Chcete rotovat box kolem jeho středu? Pište třeba </p><pre class='pr-3'><code>\rotsimple{90}\hbox to0pt{\hss obsah otočeného boxu\hss} 
</code></pre><p>Pravda, text výsledného otočeného boxu bude nahoru a&nbsp;dolu přesahovat přes nulové rozměry boxu, ale to v&nbsp;konkrétní aplikaci typicky nevadí. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#rotsimple' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0101</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2015-04-18'>18. 04. 2015</time></span> </footer></article> <article id='shbox' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Jednoduché zvětšení/zmenšení boxu</h3> <a href='#shbox'><i class='fas fa-link'></i></a></div></header><section><p>Vytvoříme makra </p><pre class='pr-3'><code>\shbox to rozměr{text} 
\svbox to rozměr{text} 
</code></pre><p>která se chovají jako <code>\hbox</code> to <code>rozměr{text}</code> a&nbsp;<code>\vbox</code> to <code>rozměr{text}</code>, ale s&nbsp;tím rozdílem, že materiál uvnitř boxu nepruží a&nbsp;sestaví se se základní velikostí. Následně pomocí lineární transformace se celý box zvětší nebo změnší, aby se dosáhla požadovaná šířka (pro <code>\hbox</code>) nebo výška (pro <code>\vbox</code>). </p><p>Implementace může být následující: </p><pre class='pr-3'><code>\def\shbox to#1#{\sboxA\hbox\wd{#1}} 
\def\svbox to#1#{\sboxA\vbox\ht{#1}} 
\def\sboxA#1#2#3#4{#1to#3{% 
   \setbox0=#1{#4}\tmpdim=#3\relax \tmpnum=#20 
   \divide\tmpnum by256 \divide\tmpdim by\tmpnum \multiply\tmpdim by256 
   \edef\tmp{\expandafter\ignorept\the\tmpdim}% 
   \ifx#1\hbox \vrule height\tmp\ht0 depth\tmp\dp0 width0pt 
   \else \hrule width\tmp\wd0 height0pt \tmpdim=\dp0 \fi 
   \ht0=0pt \dp0=0pt \wd0=0pt \pdfsave\pdfscale{\tmp}{\tmp}\box0\pdfrestore 
   \ifx#1\hbox\hfil 
   \else \vfil \hrule height0pt width0pt depth\tmp\tmpdim \fi}% 
} 
</code></pre><p>Nejprve je setaven box0, pak je vypočítán poměr požadované velikosti ku skutečné velikosti a&nbsp;je uložen do <code>\tmp</code>. Pak je pomocí <code>\pdfscale</code> tento box umístěn do vnějšího boxu s&nbsp;rozměry nastavenými pomocí neviditelných <code>\hrule</code>, <code>\vrule</code>. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#shbox' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0104</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2015-04-23'>23. 04. 2015</time></span> </footer></article> <article id='sipky' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Různě zakřivené šipky</h3> <a href='#sipky'><i class='fas fa-link'></i></a></div></header><section><p>Vytvoříme makro </p><pre class='pr-3'><code>\arrowcc x0 y0 {cx0 cy0 cx1 cy1} x1 y1 (dx1 dy1) {Text} 
</code></pre><p>které nakreslí čáru od <code>x0 y0</code> po <code>x1 y1</code> zakončenou šipkou. Část <code>{cx0 cy0 cx1 cy1}</code> může být prázdná, tedy <code>{}</code>, pak se vykreslí úsečka zakončená šipkou. Jinak čísla <code>{cx0 cy0 cx1 cy1}</code> udávají kontrolní body Bézierovy křivky. Na konci šipky se vypíše Text posunutý od konce šipky o&nbsp;<code>xd1 dy1</code>. Čísla <code>cx0 cy0 cx1 cy1 x1 y1</code> jsou relativní k&nbsp;počátku <code>x0 y0</code>. Tento počátek je relativní k&nbsp;pozici aktuálního bodu sazby. Vše je implicitně v&nbsp;jednotkách <code>bp</code>. V&nbsp;makru <code>\arrowccparams</code> je možné uložit výchozí nastavení (barvu, tloušťku čáry) a&nbsp;v makru <code>\arrowccspike</code> je možné deklarovat jinou kresbu hrotu, než je předdefinovaná. Například: </p><pre class='pr-3'><code>\vglue5cm 
\def\arrowccparams{1 0 0 rg 1 0 0 RG}  % kresba bude červená 
 
Pokus \arrowcc 0 10 {-30 20 -30 50} 20 50 (3 -3) {Text 1} 
dále \arrowcc 0 -3 {} 40 -30 (3 -3) {Text 2} 
a ještě \arrowcc 0 2 {10 20 20 30} 40 40 (3 -2) {Text 3}. 
</code></pre><p>vytvoří: </p><p><img src='img/sipky-ukazka.png' alt='Ukázka šipek' title='Ukázka šipek' class='img-fluid rounded mx-auto my-2 d-block'> </p><pre class='pr-3'><code>\def\arrowccspike{2 0 m -5 2 l -5 -2 l h f} 
\def\arrowcc #1 #2 #3 #4 #5 (#6)#7{% 
   % x0 y0 {cx1 cy1 cx2 cy2} x1 y1 (dx1 dy1) {Text} 
   \pdfsave\rlap{\pdfliteral{% 
   .7 w \arrowccparams\space 1 0 0 1 #1 #2 cm 0 0 m 
   \if ^#3^#4 #5 l \else #3 #4 #5 c \fi S 1 0 0 1 #4 #5 cm}% 
   \if^#3^\calculateargofvector(0 0) (#4 #5)\else \preparedirection #3 (#4 #5)\fi 
   \pdfsave\pdfrotate{\argofvector}\pdfliteral{\arrowccspike}\pdfrestore 
   \if^#7^\else\pdfliteral{1 0 0 1 #6 cm}\hbox{#7}\fi}\pdfrestore 
} 
\def\preparedirection #1 #2 #3 #4 {\calculateargofvector(#3 #4) } 
\def\arrowccparams{} 
</code></pre><p>Makro využívá jednoduchou PDF grafiku a&nbsp;výpočet směru podle <a href='#argofvector' title='OPmac triku 0061'>OPmac triku 0061</a>. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#sipky' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0062</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2014-05-24'>24. 05. 2014</time></span> </footer></article> <article id='cancel' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Přeškrtnutý text</h3> <a href='#cancel'><i class='fas fa-link'></i></a></div></header><section><p>Makro <code>\cancel typ {text}</code> vytiskne text přeškrtnutý podle typ. Je-li typ <code>/</code>, bude text přeškrtnutý zdola nahoru, je-li typ <code>\\</code>, bude text přeškrtnutý shora dolů a&nbsp;je-li typ <code>X</code> nebo <code>x</code>, bude text přeškrtnutý oběma čarami. Tedy například </p><pre class='pr-3'><code>\cancel /{Tady je text} 
\cancel X {U} 
</code></pre><p>vytvoří první dva řádky ukázky: </p><p><img src='img/cancel-ukazka.png' alt='Ukázka škrtanců' title='Ukázka škrtanců' class='img-fluid rounded mx-auto my-2 d-block'> </p><p>K&nbsp;implementaci potřebujeme následující kód: </p><pre class='pr-3'><code>\def\cancel#1#2{\setbox0=\hbox{#2}% 
   \dimen0=.9963\wd0  \dimen1=.9963\ht0 \advance\dimen1 by.9963\dp0 
   \hbox{\rlap{#2}\vbox to0pt{\kern\dp0 \csname cancel:\string#1\endcsname \vss}\kern\wd0}% 
} 
\def\cancelB#1{\expandafter\ignorept\the\dimen#1 } 
\sdef{cancel:x}{\pdfliteral{q 0.4 w 1 J \cancelcolor\space 0 0 m \cancelB0 \cancelB1 l 
                            0 \cancelB1 m \cancelB0 0 l S Q}} 
\expandafter\let\csname cancel:X\expandafter\endcsname \csname cancel:x\endcsname 
\sdef{cancel:/}{\pdfliteral{q 0.4 w 1 J \cancelcolor\space 0 0 m \cancelB0 \cancelB1 l S Q}} 
\sdef{cancel:\string\\}{\pdfliteral{q 0.4 w 1 J \cancelcolor\space 0 \cancelB1 m \cancelB0 0 l S Q}} 
\def\cancelcolor{1 0 0 RG} 
</code></pre><p>Chceme-li škrtat šipkou (jak ukazujeje poslední řádek v&nbsp;ukázce), je možné použít makro <code>\cancel</code> s&nbsp;typem <code>^</code> (šipka šikmo nahoru) nebo <code>_</code> (šipka šikmo dolů). Ukázka byla vytvořena pomocí <code>\cancel_{Přeškrtnutý šipkou}</code>. </p><p>V&nbsp;implementaci je využito makro <code>\arrowcc</code> z&nbsp;předchozího <a href='#sipky' title='OPmac triku 0062'>OPmac triku 0062</a> </p><pre class='pr-3'><code>\sdef{cancel:^}{\arrowcc 0 0 {} \cancelB0 \cancelB1 (0 0) {}} 
\sdef{cancel:_}{\arrowcc 0 \cancelB1 {} \cancelB0 -\cancelB1 (0 0) {}} 
\def\arrowccparams{1 0 0 rg 1 0 0 RG .4 w 1 J}  % kresba bude červená 
\def\arrowccspike{4 0 m -.3 1 l -.3 -1 l h f} 
</code></pre></section><footer class='text-right'><a href='opmac-tricks-e.html#cancel' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0082</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2014-12-19'>19. 12. 2014</time></span> </footer></article> <article id='circletext' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Text podél kružnice</h3> <a href='#circletext'><i class='fas fa-link'></i></a></div></header><section><p>Navrhneme makro <code>\circletext {poloměr}{úhel}{TEXT}{korekce}</code>, které vypíše TEXT podél kružnice s&nbsp;daným poloměrem, přitom první písmeno začíná v&nbsp;místě výchozího úhlu. Čtvrtý parametr umožňuje doplnit mezi dvojicemi znaků korekce (kerningové páry) k&nbsp;lepšímu vizuálnímu vyrovnání písmen, protože standardní tabulka kerningových párů je v&nbsp;při sazbě do kružnice vypnuta. Text jde při kladném údaji <code>poloměr</code> ve směru hodinových ručiček a&nbsp;střed kružnice je pod písmeny. Při záporném údaji <code>poloměr</code> jde text proti směru hodinových ručiček a&nbsp;střed kružnice je nad písmeny. Makro vytvoří bezrozměrnou sazbu, střed kružnice je v&nbsp;místě aktuálního bodu sazby. Například </p><p><img src='img/uni-ukazka.png' alt='Ukázka kruhu' title='Ukázka kruhu' class='img-fluid rounded mx-auto my-2 d-block'> </p><pre class='pr-3'><code>\hbox{% 
\circletext {1.7cm} {212}  {{$\bullet$} UNIVERSITAS CAROLINA PRAGENSIS {$\bullet$}} 
                           {\spaceskip=.5em \kpcirc TA{-.1}\kpcirc NA{-.05}} 
\circletext {-1.7cm} {237} {Facultas MFF} 
                           {\kpcirc Fa{-.1}} 
} 
</code></pre><p>Ve čtvrtém parametru <code>korekce</code> je možné nastavit mezislovní mezeru pomocí <code>\spaceskip=...</code> a&nbsp;dále korekci mezi písmeny pomocí makra <code>\kpcirc AB{num}</code>, které vloží mezi každou dvojici písmen AB <code>\kern num</code> v&nbsp;jednotkách <code>em</code>. V&nbsp;ukázce je také sazba „složitějšího“ objektu (<code>$\bullet$</code>), který musí být v&nbsp;textu uzavřen do svorek. </p><p>Jednotlivá písmena ve slovech mohou být prostrkaná, pokud definujete <code>\def\circletextS{\kern hodnota prostrkání}</code>. Implicitně je nastaveno nulové prostrkání. </p><p>Makro <code>\circletext</code> může být definováno takto: </p><pre class='pr-3'><code>\newdimen\tmpdimA 
\def\circletext#1#2#3#4{\hbox\bgroup 
    \tmpdim=14668pt \tmpdimA=#1 \divide\tmpdimA by256 \divide\tmpdim by\tmpdimA 
    \edef\tmpC{\expandafter\ignorept\the\tmpdim}% \tmpC=(180/pi)/R 
    \setbox0=\hbox{\ifdim#1&lt;0pt X\fi}% lap letters by X height if R&lt;0 
    \tmpdimA=0pt \baselineskip=#1 \advance\baselineskip by-\ht0 \lineskiplimit=-\maxdimen 
    \tmpdim=#2pt \advance\tmpdim by-\ifdim#1&lt;0pt-\fi 90pt 
    \def\tmpb{{}#3}\replacestrings{ }{{ }}#4% spaces =&gt; {spaces} 
    \pdfsave \pdfrotate{\expandafter\ignorept\the\tmpdim}% 
    \expandafter\circletextA\tmpb\relax 
} 
\def\circletextA#1{\ifx#1\relax\pdfrestore\egroup\ignorespaces\else 
    \ifx^#1^\else \setbox0=\hbox{#1\circletextS}% 
       \ifdim\tmpdimA=0pt \else 
          \advance\tmpdimA by.5\wd0 \dimen0=\tmpC\tmpdimA 
          \pdfrotate{-\expandafter\ignorept\the\dimen0}% 
       \fi 
       \tmpdimA=.5\wd0 
       \vbox to0pt{\vss\hbox to0pt{\hss#1\hss}\null}% 
    \fi 
    \expandafter\circletextA\fi 
} 
\def\kpcirc#1#2#3{\replacestrings{#1#2}{#1{\kern#3em}#2}} 
\def\circletextS{} 
</code></pre></section><footer class='text-right'><a href='opmac-tricks-e.html#circletext' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0109</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2015-06-01'>01. 06. 2015</time></span> </footer></article> <article id='nopt' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Úprava makra \ignorept a návrh makra \nopt </h3> <a href='#nopt'><i class='fas fa-link'></i></a></div></header><section><p>Při použití <code>\pdfliteral</code> se často vyskytne potřeba použít makro <code>\ignorept</code>. Pak stojí za to, aby <code>\ignorept</code> generovalo co nejmíň číslic do výsledného kódu. To lze zařídít následujícím předefinováním makra <code>\ignorept</code>: </p><pre class='pr-3'><code>\begingroup \lccode`\?=`\p \lccode`\!=`\t \lowercase{\endgroup 
   \def\ignorept #1.#2?!{% Print minimized point value 
       \ifnum#2=0 #1\else \ifnum#1=0 \expandafter\remzero\fi #1.#2\fi} 
} 
\def\remzero #10{#1}% Remove zero and leave minus if present 
</code></pre><p>Makro vygeneruje číslo v&nbsp;minimální možné formě. Pro PDF kód ušetříme  mnoho zbytečných nul a&nbsp;teček. Vše se provádí v&nbsp;expand procesoru. </p><p>Dále je užitečné zavést makro <code>\nopt</code>, které se postará o&nbsp;zachování mezery za použitím makra a&nbsp;umožní výpočet uvnitř svého parametru, tj.  třeba <code>\nopt[1.65\hoffset + 1in]</code> vygeneruje v&nbsp;argumentu <code>\pdfliteral</code> odpovídající konstantu. </p><pre class='pr-3'><code>\def\nopt[#1]{\expandafter\ignorept\the\dimexpr #1\relax} 
</code></pre><p>Například kód v&nbsp;<a href='#podklad' title='OPmac triku 0021'>OPmac triku 0021</a> pak vypadá tato: </p><pre class='pr-3'><code>\def\prepghook{\dimen0=.996264truein  
  \pdfliteral{q \bgcolor\space k -0.996264 0 0 0.996264 -\nopt[\dimen0] \nopt[\dimen0] cm  
  \nopt[\hoffset] \nopt[\voffset] -\nopt[\pdfpagewidth] -\nopt[\pdfpageheight] re f Q}} 
</code></pre></section><footer class='text-right'><a href='opmac-tricks-e.html#nopt' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0169</span> <span class='badge badge-info'>Autor: Petr Krajník</span> <span class='badge badge-info'>Publikováno <time datetime='2019-06-23'>23. 06. 2019</time></span> </footer></article>
                            </section>  <section id="stranka" class="mb-5 rounded my-shadow" style="background-color: #778c94">
                                <header class="text-center">
                                  <div class="py-2">
                                    <h2 class="d-inline text-light font-weight-light">Stránka</h2>
                                    <a href="#stranka"><i class="fas fa-link"></i></a>
                                  </div>
                                </header>
                                <article id='headline' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Plovoucí záhlaví</h3> <a href='#headline'><i class='fas fa-link'></i></a></div></header><section><p>OPmac neřeší záhlaví v&nbsp;duchu myšlenky, že návrh typografie dokumentu patří do jiného souboru maker. Nicméně názvy sekcí vkládá do <code>\mark</code>, takže je můžeme rovnou vyzvednout pomocí <code>\firstmark</code> nebo něčeho podobného. Následující kód navíc přidává na sudé stránky názvy kapitol. Kapitoly vždy zahajují stránku a&nbsp;na stránce se zahájením kapitoly záhlaví záměrně chybí -- je až na dalších stránkách. </p><pre class='pr-3'><code>\edef\oriheadline{\the\headline} 
\def\printchap#1{\vfil\break 
   \headline={\oriheadline\hfil\global\headline={\oriheadline\printheadline}} 
   \xdef\headchap{\ifnonum\else\thechapnum. \fi}\global\addto\headchap{#1} 
   {\chapfont \noindent \mtext{chap} \dotocnum{\thetocnum}\par 
    \nobreak\smallskip\noindent #1\nbpar}\mark{}% 
   \nobreak \remskip\bigskipamount \firstnoindent 
} 
\def\printheadline{\lower4pt\null\vadjust{\hrule}\tenit\thefontsize[10] 
   \ifodd\pageno \hfill\firstmark \else \headchap\hfill \fi} 
</code></pre><p>Tento kód zachovává původní <code>\headline</code> v&nbsp;<code>\oriheadline</code> (OPmac jej používá na tisk vodoznaku DRAFT). Dále je z&nbsp;OPmac opsáno makro <code>\printchap</code>, ve kterém jsou navíc přidány druhý a&nbsp;třetí řádek. Tam je vyřešeno odložené záhlaví a&nbsp;uložení názvu kapitoly do <code>\headchap</code> (expandované číslo a&nbsp;neexpandovaný zbytek). Tisk samotného záhlaví provádí makro <code>\printheadline</code>. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#headline' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0020</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2013-08-30'>30. 08. 2013</time></span> </footer></article> <article id='podklad' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Podkladový obrázek nebo barva na každé straně</h3> <a href='#podklad'><i class='fas fa-link'></i></a></div></header><section><p>Tento trik je možné použít obecně pro jakýkoli dokument, ale nejčastější použití bude asi mít pro slídy, aby přestaly být spartánského vzhledu. V&nbsp;nějakém rozumném editoru pro obrázky si připravíme soubor background.pdf a&nbsp;do dokumentu na každou stránku jej dopravíme takto: </p><pre class='pr-3'><code>\def\prepghook{\vbox to0pt{\kern-\voffset\kern-1in 
   \hbox to0pt{\kern-\hoffset\kern-1in\background\hss}\vss}% 
   \nointerlineskip 
} 
\pdfximage width\pdfpagewidth height\pdfpageheight {background.pdf} 
\mathchardef\picbackground=\pdflastximage 
\def\background{\pdfrefximage\picbackground} 
</code></pre><p>Od verze OPmac May 2015 je k&nbsp;dispozici <code>\prepghook</code>, který se spustí před konečným sestavením strany ve výstupní rutině. Je třeba box s&nbsp;obrázkem posunout o&nbsp;<code>\voffset+1in</code> nahoru a&nbsp;<code>\hoffset+1in</code> doleva. </p><p>Pomocí <code>\pdfximage</code> je načten do dokumentu obrázek požadovaných rozměrů a&nbsp;odkaz na něj se jmenuje <code>\picbackground</code>. Makro <code>\background</code> pak vloží obrázek odkazem, tj. nepřidává do PDF nová data s&nbsp;obrázkem a&nbsp;tím minimalizuje velikost výstupního PDF. </p><p>Pokud chceme mít podklad pouze v&nbsp;jedné barvě (jiné než bílá), není třeba kvůli tomu vytvářet podkladový obrázek. Stačí barevný podklad vložit pomocí <code>\pdfliteral</code>: </p><pre class='pr-3'><code>\def\prepghook{\pdfliteral{q \bgcolor\space k -0.996264 0 0 0.996264 -72 72 cm 
  \nopt{\hoffset} \nopt{\voffset} -\nopt{\pdfpagewidth} -\nopt{\pdfpageheight} re f Q}} 
\def\nopt#1{\expandafter\ignorept\the#1} 
 
\def\setbasecolor#1{#1\expandafter\setbasecolorA#1\pdfblackcolor} 
\def\setbgcolor#1{\expandafter\setbasecolorA#1\bgcolor} 
\def\setbasecolorA#1#2#3{\def#3{#2}} 
 
\setbasecolor\Yellow 
\setbgcolor\Blue 
 
Ahoj. Tady je žlutý text na modrém podkladu. 
</code></pre><p>Výše uvedený kód předpokládá, že nepoužijete v&nbsp;dokumentu změnu velikosti pomocí <code>\magnification</code> nebo <code>\magscale</code>. Máte-li toto v&nbsp;úmyslu, musíte čísla <code>-72 72</code> nahradit „přepočítanou“ velikostí <code>1 in</code>: </p><pre class='pr-3'><code>\def\prepghook{\dimen0=.996264truein 
  \pdfliteral{q \bgcolor\space k -0.996264 0 0 0.996264 -\nopt{\dimen0 } \nopt{\dimen0 } cm 
  \nopt{\hoffset} \nopt{\voffset} -\nopt{\pdfpagewidth} -\nopt{\pdfpageheight} re f Q}} 
</code></pre></section><footer class='text-right'><a href='opmac-tricks-e.html#podklad' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0021</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2013-08-30'>30. 08. 2013</time></span> </footer></article> <article id='maybebreak' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Zlom stránky jen někdy</h3> <a href='#maybebreak'><i class='fas fa-link'></i></a></div></header><section><p>PlainTeX nabízí pro zlom stránky použít <code>\vfill\break</code>. Pokud autor toto začne vpisovat do svého dokumentu, aby „vylepšil“ stránkový zlom, a&nbsp;později připíše dopředu nějaké další informace a&nbsp;na toto své vylepšení zapomene, dostane ke své škodě třeba jen popolrázdnou stránku. OPmac proto nabízí od verze May 2014 makro <code>\maybebreak rozměr</code> (například <code>\maybebreak 2cm</code>), které zlomí stránku nebo řádek, pokud do konce stránky nebo řádku zbývá zhruba méně než <code>rozměr</code>. Když je tam místa více, makro neudělá nic. </p><p>Makro v&nbsp;horizontálním módu řeší řádkový zlom a&nbsp;ve vertikálním módu stránkový zlom. Pokud tedy chcete stránkový zlom, pište třeba </p><pre class='pr-3'><code>\par\maybebreak 3.5cm 
</code></pre></section><footer class='text-right'><a href='opmac-tricks-e.html#maybebreak' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0058</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2014-05-12'>12. 05. 2014</time></span> </footer></article> <article id='sloupce' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Sazba do sloupců jako v novinách</h3> <a href='#sloupce'><i class='fas fa-link'></i></a></div></header><section><p>Sazeč novin může natáhnout jednotlivé články do boxů pomocí: </p><pre class='pr-3'><code>\setbox\clanekA=\vbox{\hsize=sirka sloupce \penalty0 \input clanekA.tex } 
\setbox\clanekB=\vbox{\hsize=sirka sloupce \penalty0 \input clanekB.tex } 
... 
</code></pre><p>a&nbsp;dále může ulamovat z&nbsp;těchto boxů jednotlivé části a&nbsp;vkládat je do struktury stránky, kterou sám navrhne pomocí <code>\hbox/\vbox/\vtop</code> aritmetiky. Tato myšlenka je rozebrána v&nbsp;TBN na straně 275 a&nbsp;zde jsou některá makra doplněna, aby bylo přesně dodrženo řádkování. Například třísloupcová sazba, ve které druhému a&nbsp;třetímu sloupci vodorovně překáží obrázek (<a href='sloupce.pdf' title='ukázka je zde'>ukázka je zde</a>) může být naprogramována takto: </p><pre class='pr-3'><code>\ulamuj\clanekA 
\hbox{\ulom[18]\kern\colsep 
      \vtop{\hbox {\ulom[3]\kern\colsep \ulom[3]} 
      \vynech[13] \placepic[0pt,\twocols,\picw=9cm]{ovce1.jpg} 
      \hbox {\ulom[2]\kern\colsep \ulom[2]} 
      }} 
</code></pre><p>Makra <code>\ulom</code> a&nbsp;<code>\vynech</code> mají parametr v&nbsp;hranaté závorce udávající počet odlomených řádků nebo počet vynechaných řádků. V&nbsp;této ukázce čtenář musí nejprve přečíst vše nad obrázkem (druhý i&nbsp;třetí sloupec) a&nbsp;pak pokračuje pod obrázkem. Pokud naopak chceme, aby čtenář nejprve přečetl kompletní druhý sloupec (bez ohledu na obrázek) a&nbsp;pak třetí, pak program pro strukturu stránky může vypadat takto: </p><pre class='pr-3'><code>\hbox{\ulom[21]\kern\colsep 
      \vtop{\ulom[3]% 
            \vynech[14] \placepic[0pt,\twocols,\picw=10.5cm]{ovce2.jpg} 
            \ulom[4]}\kern\colsep 
      \vtop{\ulom[3]\vynech[14]\ulom[4]}% 
     } 
</code></pre><p>Makro <code>\ulamuj</code> připraví článek k&nbsp;odlamování. Makro <code>\ulom</code> odlomí řádky pomocí <code>\vsplit</code> a&nbsp;vypočte hloubku posledního řádku pomocí triku s&nbsp;<code>\lastbox</code> (viz TBN str.&nbsp;450) a&nbsp;uloží ji do <code>\lastdepth</code>. Je-li <code>\ulom</code> v&nbsp;horizontálním módu, tj. např. <code>\hbox{\ulom[9]\ulom[9]\ulom[9]}</code>, pak další výpočet využívající pomocnou proměnnou <code>\maxhdepth</code> zajistí, že nakonec je v&nbsp;<code>\lastdepth</code> největší hloubka ze všech <code>\ulom</code>, které byly v&nbsp;<code>\hbox</code> použity. Makro <code>\vynech</code> pak údaj z&nbsp;<code>\lastdepth</code> použije. </p><pre class='pr-3'><code>\tmpdim=\baselineskip  \splittopskip=\tmpdim plus.1pt minus.1pt 
\def\ulom[#1]{\setbox0=\vsplit\celybox to #1\baselineskip 
   \vtop{\kern-.3\baselineskip \unvbox0 
         \nointerlineskip\lastbox \global\lastdepth=\prevdepth}% 
   \ifhmode \ifdim\lastdepth&lt;\maxhdepth \global\lastdepth=\maxhdepth \fi 
            \maxhdepth=\lastdepth \fi 
} 
\def\ulamuj#1{\let\celybox=#1\setbox0=\vsplit\celybox to0pt} 
\def\vynech[#1]{\vskip-.7\baselineskip\vskip#1\baselineskip \prevdepth=\lastdepth} 
</code></pre><p>Kompletně celý kód ukázky včetně deklarace a&nbsp;nastavení rozměrů a&nbsp;včetně definice makra </p><pre class='pr-3'><code>\placepic[vertikální posun, šířka boxu, makra před \inspic] {obrázek.přípona} 
</code></pre><p>které vloží obrázek tak, aby nezbíral v&nbsp;sazbě žádné místo, je v&nbsp;<a href='sloupce.tex' title='samostatnném souboru'>samostatnném souboru</a>. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#sloupce' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0076</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2014-07-28'>28. 07. 2014</time></span> </footer></article> <article id='crop' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Ořezové značky</h3> <a href='#crop'><i class='fas fa-link'></i></a></div></header><section><p>Vytvoříme makro <code>\cropmarks</code>, které po použití makra <code>\margins</code> přidá ke stránce ořezové značky. Tj. například: </p><pre class='pr-3'><code>\sdef{pgs:spec}{(150,170)mm} 
\margins/1 spec (7,7,7,7)mm \cropmarks 
</code></pre><p>Tento příklad deklaruje stránku rozměru <code>150x170mm</code> s&nbsp;okraji <code>7mm</code>. Příkaz <code>\cropmarks</code> zvětší stránku na všech čtyřech stranách o&nbsp;<code>10mm</code> a&nbsp;v tomto přidaném okraji v&nbsp;rozích umístí ořezové značky. Je možné po takové deklaraci použít ještě třeba: </p><pre class='pr-3'><code>\margins/1 a4 (,,,)mm \cropcenter 
</code></pre><p>což zachová značky vzhledem k&nbsp;sazbě na stejném místě, ale vše umístí doprostřed stránky A4. </p><p>Implementace makra může být následující: </p><pre class='pr-3'><code>\newdimen\cropw \cropw=10mm 
\def\ltcrop{\vbox{\hbox to\cropw{\hfil\vrule height\cropw depth-.2\cropw} 
                  \hbox to\cropw{\vrule height.4pt width.8\cropw \hfil}}} 
\def\rtcrop{\vbox{\hbox to\cropw{\vrule height\cropw depth-.2\cropw\hfil} 
                  \hbox to\cropw{\hfil\vrule height.4pt width.8\cropw}}} 
\def\lbcrop{\vbox{\hbox to\cropw{\vrule height.4pt width.8\cropw \hfil} 
                  \kern.2\cropw \hbox to\cropw{\hfil\vrule height.8\cropw}}} 
\def\rbcrop{\vbox{\hbox to\cropw{\hfil\vrule height.4pt width.8\cropw} 
                  \kern.2\cropw \hbox to\cropw{\vrule height.8\cropw\hfil}}} 
 
\newdimen\lmar \newdimen\tmar \tmar=1truein \lmar=1truein 
\def\cropmarks{% 
   \ifx\cropwidth\undefined 
      \advance\lmar by\hoffset \advance\tmar by\voffset 
      \hoffset=-1truein \voffset=-1truein 
      \advance\pdfpagewidth by2\cropw \advance\pdfpageheight by2\cropw 
      \dimen0=\pgwidth \advance\dimen0 by2\cropw \edef\cropwidth{\the\dimen0}% 
      \edef\cropheight{\the\pgheight} 
      \let\shipoutori=\shipout 
      \def\shipout##1 {\shipoutori % \opmacoutput uses \shipout\box0 
         \vbox{\let\vrule=\orivrule \let\hrule=\orihrule 
               \offinterlineskip \kern.2pt 
               \hbox to\cropwidth{\kern.2pt\ltcrop\hfil\rtcrop\kern.2pt}% 
               \kern-.2pt 
               \vbox to\cropheight{\kern\tmar\hbox{\kern\cropw\kern\lmar\box0}\vss} 
               \kern-.2pt 
               \hbox to\cropwidth{\kern.2pt\lbcrop\hfil\rbcrop\kern2.pt}}}% 
   \else\errmessage{\noexpand\cropmarks can't by used twice}\fi 
} 
\def\cropcenter{\advance\hoffset by-\lmar \advance\hoffset by-\cropw 
                \advance\voffset by-\tmar \advance\voffset by-\cropw} 
</code></pre></section><footer class='text-right'><a href='opmac-tricks-e.html#crop' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0081</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2014-12-16'>16. 12. 2014</time></span> </footer></article> <article id='nopageno' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Jednostránkový dokument bez čísla stránky</h3> <a href='#nopageno'><i class='fas fa-link'></i></a></div></header><section><p>Při psaní krátkých dokumentů často dopředu nevíme, jestli budou mít jednu, nebo více stran. Přitom, pokud bude mít dokument jen jednu stranu, nechceme, aby obsahoval číslo stránky. Abychom se nemuseli starat, jestli číslo stránky má být, nebo nemá být, stačí na začátek dokumentu napsat </p><pre class='pr-3'><code>\openref\ifnum\lastpage=1\footline{\hss}\fi 
</code></pre><p>Pro správné fungování je nutné TeXovat dokument dvakrát. </p><p>Trik využívám například při psaní posudků, které mívají 1--2 stránky. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#nopageno' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0133</span> <span class='badge badge-info'>Autor: Jan Šustek</span> <span class='badge badge-info'>Publikováno <time datetime='2015-12-19'>19. 12. 2015</time></span> </footer></article> <article id='outbox' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>PDF stránečky dle velikosti boxu</h3> <a href='#outbox'><i class='fas fa-link'></i></a></div></header><section><p>Vytvoříme makro <code>\outbox</code>, které okamžitě vloží do stránky PDF dokumentu následující box, přitom rozměry stránky (medium size) budou stejné, jako rozměry tohoto boxu (zvětšené o&nbsp;okraje). Okraje kolem boxu se dají nastavit pomocí <code>\outboxmargins(levý,pravý,horní,dolní)jednotka</code> a&nbsp;jsou implicitně nastaveny na 1pt z&nbsp;každé strany. Takže například: </p><pre class='pr-3'><code>\outboxmargins(1,1,2,2)pt 
 
\outbox\hbox{text}     % vytvoří maličkou stránku s textem "text" 
                       % a se stanovenými okraji 
\outbox\vbox{odstavec} % vytvoří stránku o šířce odstavce 
                       % a výšce textu v odstavci. 
</code></pre><p>Implementace je následující </p><pre class='pr-3'><code>\def\outbox{\afterassignment\outboxA \setbox0=} 
\def\outboxA{\aftergroup\outboxC} 
\def\outboxC{\setbox0=\outboxB 
   \begingroup 
      \hoffset=-1in \voffset=-1in 
      \pdfpagewidth=\wd0 \pdfpageheight=\ht0 
      \shipout\box0 
   \endgroup 
} 
\def\outboxmargins (#1,#2,#3,#4)#5 {\def\outboxB{% 
   \vbox{\kern#3#5\hbox{\kern#1#5\box0 \kern#2#5}\kern#4#5}}% 
} 
\outboxmargins (1,1,1,1)pt 
</code></pre><p>Makro <code>\outbox</code> spustí po přečtení následujícího boxu makro <code>\outboxC</code>. To je potřeba udělat přechodně pomocí <code>\outboxA</code>, důvod je vysvětlen v&nbsp;TBN na straně 338. Dále makro <code>\outboxmargins</code> připraví makro <code>\outboxB</code>, které přidá boxu 0&nbsp;požadované okraje. Konečně makro <code>\outboxC</code> přeboxuje box0 tak, že jsou přidány okraje a&nbsp;velikosti tohoto nového boxu použije pro velikosti média nastavením <code>\pdfpagewidth</code> a&nbsp;<code>\pdfpageheight</code>. Nakonec se box 0&nbsp;vyvrhne do samostatné stránky pomocí <code>\shipout</code>, což obchází <code>\output</code> rutinu. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#outbox' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0147</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2017-05-16'>16. 05. 2017</time></span> </footer></article>
                            </section>  <section id="verbatim-prostredi" class="mb-5 rounded my-shadow" style="background-color: #778c94">
                                <header class="text-center">
                                  <div class="py-2">
                                    <h2 class="d-inline text-light font-weight-light">Verbatim prostředí</h2>
                                    <a href="#verbatim-prostredi"><i class="fas fa-link"></i></a>
                                  </div>
                                </header>
                                <article id='loctt' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Lokální tthook</h3> <a href='#loctt'><i class='fas fa-link'></i></a></div></header><section><p>Napíšeme-li <code>\def\tthook{kód}</code>, ovlivní tato definice všechna následující prostředí <code>\begtt...\endtt</code>. My bychom chtěli ale před <code>\begtt</code> psát kódy, které ovlivní jen jedno následující prostředí. Navíc je problém se zdvojováním křížů při zápisu kódu, který způsobuje, že nelze jednoduše použít například <code>\addto\tthook{kód}</code>. </p><p>Řešením jsou dva registry typu toks: <code>\gtthook</code> (obsahuje globální kód ovlivňující všechny následující <code>\begtt...\endtt</code> prostředí) a&nbsp;<code>\ltthook</code> (obsahuje kód, který se použije jen v&nbsp;následujícím verbatim prostředí). Uživatel může psát například: </p><pre class='pr-3'><code>\gtthook {\typosize[9/11]}    % všechna prostředí budou v 9pt 
\ltthook {\adef!#1.{{\it#1}}} % aktivní ! jen pro jedno následující prostředí 
\begtt 
... !aha. ... 
\endtt 
</code></pre><p>Kód makra: </p><pre class='pr-3'><code>\newtoks\gtthook  \newtoks\ltthook 
\def\tthook{\the\gtthook \the\ltthook \global\ltthook{}} 
</code></pre><p>Pokud navíc definujeme </p><pre class='pr-3'><code>\def\addtoks#1#2{#1\expandafter{\the#1#2}} 
</code></pre><p>je možné použít například: </p><pre class='pr-3'><code>\bgroup \addtoks\gtthook{kód} ... \egroup 
</code></pre><p>a&nbsp;příslušný kód ovlivní všechna verbatim prostředí v&nbsp;rozmezí <code>\bgroup ... \egroup</code>. Kódy nevyžadují zdvojování křížů. </p><p>Analogická myšlenka se dá použít pro ostatní <code>\cosihook</code> z&nbsp;OPmac. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#loctt' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0002</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2013-08-13'>13. 08. 2013</time></span> </footer></article> <article id='code' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Verbatim v nadpisech sekcí</h3> <a href='#code'><i class='fas fa-link'></i></a></div></header><section><p>Verbatim prostředí deklarované pomocí <code>\activettchar</code> (např. <code>\activettchar"</code>) funguje jen tehdy, když je text mimo parametr jiného makra. Rozhodně nefunguje v&nbsp;nadpisech (např. nelze psát <code>\sec Cosi "\uff#$"</code>). Nyní zavedeme makro <code>\code{text}</code>, které vytvoří to samé, jako „text“, ale bude možné je bez obav vkládat do parametrů maker včetně nadpisů, ze kterých se texty správně propagují do obsahu, do záhlaví a&nbsp;do PDF záložek. Za cenu této vymoženosti bude občas potřeba zapsat text pro <code>\code</code> ne zcela doslova, ale se znaky backlash navíc. Pravidla jsou tato: </p><p>* Místo <code>\</code> pište <code>\\</code>, místo <code>#</code> pište <code>\#</code> a&nbsp;místo <code>%</code> pište <code>\%</code>. <br>* Vše ostatní se přepisuje doslova. <br>* Před další speciální znaky <code>{</code>, <code>}</code>, <code>$</code>, <code>&</code>, <code>^</code>, <code>_</code>, <code>␣</code> (mezera), <code>~</code>   můžete ale nemusíte psát backlash. Tento backlash se nezobrazí. <br>* Parametr <code>{text}</code> musí být balancovaný vzhledem k&nbsp;závorkám <code>{}</code>. Chcete-li   vložit do textu nebalancovanou závorku, pište <code>\{</code>. <br>* Dvojice zobáků <code>^^ab</code> se promění ve specifikovaný znak. Pokud tomu chcete   zabránit, pište <code>^\^ab</code>. <br>* Více mezer za sebou se slijí do jediné mezery. Pokud tomu chcete   zabránit, pište <code>\␣\␣</code> atd. </p><p>Příklady: </p><pre class='pr-3'><code>\code{ah_a uff{} &amp;$^}           % vytvoří: ah_a uff{} &amp;$^ 
\code{\\def\\cosi\#1{cosi=\#1}} % vytvoří: \def\cosi#1{cosi=#1} 
\code{a\%b\ \ \ c\%d}           % vytvoří: a%b   c%d 
</code></pre><p>Implementace: </p><pre class='pr-3'><code>\def\code#1{\def\tmpb{#1}\edef\tmpb{\expandafter\stripm\meaning\tmpb\relax}% 
   \expandafter\replacestrings\expandafter{\string\\}{\bslash}% 
   \expandafter\replacestrings\bslash{}% 
   \codeP{\leavevmode\hbox{\tt\tmpb}}} 
\def\codeP#1{#1} 
\def\stripm#1-&gt;#2\relax{#2} 
\addprotect\code \addprotect\\ \addprotect\{ \addprotect\} 
\addprotect\^ \addprotect\_ \addprotect\~ 
\setcnvcodesA 
\addto\cnvhook{\let\code=\codeP} 
</code></pre><p>Makro <code>\code</code> detokenizuje svůj parametr pomocí <code>\meaning</code> a&nbsp;dále pomocí <code>\replacestrings</code> provede záměnu <code>\\</code> za jediný \ a&nbsp;ostatní jediné <code>\</code> odstraní. Při <code>\write</code> se <code>\code</code> ani <code>\\</code>, <code>\{</code>, <code>\}</code>, <code>\$</code> atd. neexpandují a&nbsp;zapíší se do REF souboru tak, jak jsou. Při zápisu do záložek se v&nbsp;klasickém módu zapíše text stejně jako při <code>\write</code> a&nbsp;PDF prohlížeč automaticky nezobrazí backslashe. Pokud ale používáte záložky s&nbsp;<code>pdfuni.tex</code>, je potřeba detokenizovat parametry <code>\code</code> před použitím <code>\pdfunidef</code>, což udělá makro <code>\precode</code>: </p><pre class='pr-3'><code>\ifx\pdfunidef\undefined\else \def\cnvhook #1#2{#2\precode \pdfunidef\tmp\tmp}\fi 
\def\precode{\def\codeP##1{}\let\bslash=\Bslash 
   \edef\tmp{\expandafter}\expandafter\precodeA\tmp\code{}} 
\def\precodeA#1\code#2{\addto\tmp{#1}% 
   \ifx\end#2\end \else 
      \codeA{#2}% 
      \expandafter\addto\expandafter\tmp\expandafter{\tmpb}% 
      \expandafter\precodeA \fi 
} 
\let\codeA=\code 
</code></pre></section><footer class='text-right'><a href='opmac-tricks-e.html#code' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0102</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2015-04-22'>22. 04. 2015</time></span> </footer></article> <article id='ttpenalty' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Zákaz zlomu mezi řádky výpisu</h3> <a href='#ttpenalty'><i class='fas fa-link'></i></a></div></header><section><p>Balíček fancyvrb z&nbsp;LaTeXu umožňuje vkládat <code>\clubpenalty</code> za první řádek výpisu a&nbsp;<code>\widowpenalty</code> před poslední řádek, takže dokážete zamezit stránkovému zlomu, kdy na stránce zbyde jen osiřelý řádek výpisu. Implementace ve fancyvrb je poněkud těžkopádná. My to uděláme elegantněji a&nbsp;navíc umožníme vkládat údaje pomocí eTeXových primitivů <code>\clubpenalties</code> a&nbsp;<code>\widowpenalties</code>, tedy postihneme penaltou i&nbsp;více řádků na začátku a&nbsp;na konci výpisu. To fancyvrb nedokáže. </p><pre class='pr-3'><code>\def\tthook{% 
   \clubpenalties   3 10000 10000 25 
   \widowpenalties  3 10000 10000 25 
   \setbox0=\vbox\bgroup \aftergroup\tthookA} 
\def\tthookA{\setbox2=\hbox{}\setbox0=\vbox\bgroup\unvbox0 \tthookB} 
\def\tthookB{\unskip\unskip\unpenalty \setbox0=\lastbox 
   \ifvoid0 \egroup \noindent\unhbox2 \par \egroup 
   \else \global\setbox2=\hbox{\box0\penalty0\unhbox2}% 
      \expandafter\tthookB 
   \fi} 
</code></pre><p>Následující výpis se zlomí jedině mezi třetím a&nbsp;čtvrtým řádkem: </p><pre class='pr-3'><code>\begtt 
  první 
  druhý 
  třetí 
  čtvrtý 
  pátý 
  šestý 
\endtt 
</code></pre><p>Pomocí <code>\tthook</code> necháme celý verbatim výpis setavit do boxu0, ten pak pomocí <code>\tthookA</code> rozebereme na řádky a&nbsp;tyto řádky vložíme vedle sebe do hboxu2. Nakonec spustíme <code>\noindent\unhbox2\par</code>, takže vystartujeme běžný TeXový odstavec, který se rozlomí do právě připravených řádků a&nbsp;pod řádky pochopitelně vloží deklarované penalty. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#ttpenalty' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0123</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2015-09-11'>11. 09. 2015</time></span> </footer></article> <article id='hisyntax' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Automatické zvýraznění/obarvení syntaxe</h3> <a href='#hisyntax'><i class='fas fa-link'></i></a></div></header><section><p>Zvýraznění syntaxe (syntax highlighting) nějakého programovacího jazyka mezi <code>\begtt</code> a&nbsp;<code>\endtt</code> provedeme pomocí <code>\hisyntax{jazyk}</code>, což napíšeme těsně před <code>\begtt</code> nebo před <code>\verbinput</code>. Například: </p><p><img src='img/hisyntax-ukazka.png' alt='Ukázka hisyntax' title='Ukázka hisyntax' class='img-fluid rounded mx-auto my-2 d-block'> </p><pre class='pr-3'><code>\hisyntax{C} 
\begtt 
#include &lt;stdio.h&gt; 
int main(int argc, char **argv) 
{ 
   printf("Hello World!\n"); // Prints the message 
   return 0; 
} 
\endtt 
</code></pre><p>Makro <code>\hisyntax</code> lokálně předefinuje zpracování stringu mezi <code>\begtt...\endtt</code> pomocí <code>\ptthook</code> (od verze OPmac Oct. 2015). Makro <code>\ghisyntax</code> na začátku dokumentu způsobí obarvení všech výpisů v&nbsp;dokumentu. Při <code>\hisyntax{C}</code> (resp. <code>\ghisyntax{C}</code>) se spustí interní <code>\hisyntaxC</code> a&nbsp;analogicky to můžete udělat pro jiné jazyky. Definice <code>\hisyntaxC</code> může vypadat takto: </p><pre class='pr-3'><code>\def\hisyntax#1{\bgroup\def\ptthook{\csname hisyntax#1\endcsname}} 
\def\ghisyntax#1{\def\ptthook{\bgroup\csname hisyntax#1\endcsname}} 
 
\def\hisyntaxC#1\egroup{\let\n=\relax \let\NLh=\relax \let\U=\relax 
   \let\TABchar=\relax % pro OPmac trik 0151 
   \adef{ }{\n\ \n}\adef\^^M{\n\NLh\n}\edef\tmpb{#1\egroup}% 
   \replacestrings{\n\egroup}{\egroup}% 
   \replacestrings{/*}{\tmp}\def\tmp##1*/{\U{commentC}{##1}}\edef\tmpb{\tmpb}% 
   \replacestrings{//}{\tmp}\def\tmp##1\NLh{\U{commentCpp}{##1}}\edef\tmpb{\tmpb}% 
   \edef\tmp{\noexpand\replacestrings{\string\"}{\n{\string\"}}}\tmp 
   \replacestrings{"}{\tmp}\def\tmp##1\tmp{\U{stringC}{##1}}\edef\tmpb{\tmpb}% 
   \doreplace{##1}{\n{\chCcolor##1}\n}\charsC{}% 
   \doreplace{\n##1\n}{\kwC{##1}}\keywordsC{}% 
   \edef\tmp{\noexpand\replacestrings{\NLh\n\string##}{\NLh\noexpand\preprocC}}\tmp 
   \doreplace{\n##1}{\numberC##1}0123456789{}% 
   \let\NLh=\par \def\n{}\def\U##1{\csname##1\endcsname}% 
   \tentt\localcolor\tmpb\egroup} 
\def\doreplace#1#2{\def\do##1{\ifx^##1^\else \replacestrings{#1}{#2}\expandafter\do\fi}% 
   \expandafter\do} 
\def\printttline{\llap{\sevenrm\Black\the\ttline\kern.9em}} % \Black added 
 
\def\commentC#1{{\Green/*#1*/}} 
\def\commentCpp#1{{\Green//#1}\NLh} 
\def\stringC#1{{\def\ {\char32 }\Magenta"#1"}} 
\def\preprocC#1\n{{\Blue\##1}} 
\def\numberC#1\n{{\Cyan#1}} 
\edef\keywordsC{{auto}{break}{case}{char}{continue}{default}{do}{double}% 
   {else}{entry}{enum}{extern}{float}{for}{goto}{if}{int}{long}{register}% 
   {return}{short}{sizeof}{static}{struct}{switch}{typedef}{union} 
   {unsigned}{void}{while}} % zde jsou všechna klíčová slova jazyka C 
\def\kwC#1{{\Red#1}} 
\edef\charsC{()\string{\string}+-*/=[]&lt;&gt;,:;\percent\string&amp;\string^|!?} 
\let\chCcolor=\Blue 
</code></pre><p>Načtený verbatim string je nejpre expandován do <code>\tmpb</code>, kde bude dále postupně měněn pomocí <code>\replacestrings</code>. Při vstupní expanzi jsou mezery vyměněny za <code>\n\ \n</code> a&nbsp;konce řádků za <code>\n\NLh\n</code>. Symbol <code>\n</code> je netisknoucí značka, která se tak objeví na okrajích slov, takže půjde vyměnit třeba klíčové slovo <code>\n if\n</code> za <code>\kwC{if}</code>, a&nbsp;přitom se nevymění úsek slova <code>if</code> třeba v&nbsp;proměnné <code>diff</code>. Dále jsou provedeny náhrady: </p><pre class='pr-3'><code>/* cosi */              --&gt;   \U{commentC}{ cosi } 
// cosi (konec řádku)   --&gt;   \U{commentCpp}{ cosi } 
\"                      --&gt;   \n{\"} 
"cosi"                  --&gt;   \U{stringC}{cosi} 
</code></pre><p>Všimněte si, že text „cosi“ je po náhradě uvězněn mezi <code>{...}</code>, takže takový text je imunní vůči pozdějším pokusům o&nbsp;náhrady. Konečně jsou všechny znaky typu <code>(){}+-...</code> nahrazeny <code>\n{\chColor znak}\n</code>, a&nbsp;dále jsou nahrazena všechna klíčová slova a&nbsp;slova preprocesoru. Co nebylo nahrazeno, zůstává černé (měly by to být jen identifikátory jazyka). Také je provedena náhrada <code>\n číslo</code> za <code>\numC číslo</code>, aby mohlo makro <code>\numC</code> obarvit samotná čísla, která nejsou součástí identifikátorů. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#hisyntax' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0124</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2015-09-27'>27. 09. 2015</time></span> </footer></article> <article id='hisyntaxhtml' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Zvýraznění HTML kódu</h3> <a href='#hisyntaxhtml'><i class='fas fa-link'></i></a></div></header><section><p><img src='img/html-ukazka.png' alt='Ukázka HTML' title='Ukázka HTML' class='img-fluid rounded mx-auto my-2 d-block'> </p><p>Předvedeme příklad modifikace předchozího OPmac triku na zvýrazňování jazyka C, tentokrát zvýrazníme HTML nebo XML kód. Po: </p><pre class='pr-3'><code>\hisyntax{HTML} 
\begtt 
&lt;div class="navis"&gt; 
&lt;nav id="site"&gt; 
... 
&lt;/nav&gt; 
&lt;/div&gt; 
\endtt 
</code></pre><p>dostaneme výstup, jak je znázorněno vpravo. Implementace: </p><pre class='pr-3'><code>\def\hisyntax#1{\bgroup\def\ptthook{\csname hisyntax#1\endcsname}} 
\def\ghisyntax#1{\def\ptthook{\bgroup\csname hisyntax#1\endcsname}} 
 
\def\hisyntaxHTML#1\egroup{\let\n=\relax \let\NLh=\relax \let\U=\relax 
   \let\TABchar=\relax % pro OPmac trik 0151 
   \adef{ }{\n\ }\adef\^^M{\n\NLh}\edef\tmpb{#1\egroup}% 
   \replacestrings{&lt;!--}{\tmp}\def\tmp##1--&gt;{\U{commentH}{##1}}\edef\tmpb{\tmpb}% 
   \replacestrings{&lt;}{\tmp}\def\tmp##1&gt;{\U{tagH}{##1}}\edef\tpb{\tmpb}% 
   \expandafter\replacestrings\expandafter{\string&amp;}{\entityH}% 
   \let\NLh=\par \def\n{}\def\U##1{\csname##1\endcsname}% 
   \tentt\localcolor\tmpb\egroup} 
 
\def\commentH#1{{\Green&lt;!--#1--&gt;}} 
\def\tagH#1{\tagHa#1\n^} 
\def\tagHa#1\n#2^{\def\tmpb{#2}\replacestrings{"}{\stringH}% 
   {\Cyan&lt;}{\Red#1}{\Cyan\tmpb&gt;}} 
\def\stringH#1\stringH{{\def\ {\char32 }\Magenta"#1"}} 
\def\entityH#1;{{\Blue\&amp;#1;}} 
 
\let\hisyntaxXML=\hisyntaxHTML 
</code></pre><p>Makro <code>\hisyntaxHTML</code> nejprve převede mezery na <code>\n\ </code> a&nbsp;konce řádků na <code>\n\NLh</code>. Pak převede komentáře <code><!--cosi--></code> na <code>\U{commentH}{cosi}</code> a&nbsp;následně tagy <code><cosi></code> na <code>\U{tagH}{cosi}</code>. Makro <code>\tagH</code> dále separuje jméno tagu od případných parametrů a&nbsp;provede konverzi stringů. Stringy jsou tedy vyznačeny jen uvnitř parametrů tagu. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#hisyntaxhtml' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0125</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2015-10-03'>03. 10. 2015</time></span> </footer></article> <article id='hisyntaxpy' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Zvýraznění kódu Pythonu</h3> <a href='#hisyntaxpy'><i class='fas fa-link'></i></a></div></header><section><p>Jako semestrální práce z&nbsp;předmětu BI-TeX bylo odevzdáno makro vycházející z&nbsp;předchozích dvou OPmac triků a&nbsp;implementující zvýraznění kódu Pythonu. Úkol to byl ještě obtížnější než v&nbsp;případě jazyků C&nbsp;a HTML. Pan Krajník se toho zhostil velice pečlivě a&nbsp;dobře a&nbsp;výsledek je dostupný na <a href='https://gitlab.fit.cvut.cz/krajnpet/PySyntax' title='gitlab'>gitlab</a>. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#hisyntaxpy' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0152</span> <span class='badge badge-info'>Autor: Petr Krajník</span> <span class='badge badge-info'>Publikováno <time datetime='2016-06-03'>03. 06. 2016</time></span> </footer></article> <article id='hisyntaxcss' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Zvýraznění kódu C#</h3> <a href='#hisyntaxcss'><i class='fas fa-link'></i></a></div></header><section><p>Jako semestrální práce z&nbsp;předmětu BI-TeX bylo odevzdáno makro vycházející z&nbsp;předchozích dvou OPmac triků a&nbsp;implementující zvýraznění kódu C#.  Výsledek je dostupný na <a href='https://gitlab.fit.cvut.cz/francmi4/cssyntax' title='gitlab'>gitlab</a>. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#hisyntaxcss' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0168</span> <span class='badge badge-info'>Autor: Michal Franc</span> <span class='badge badge-info'>Publikováno <time datetime='2019-06-21'>21. 06. 2019</time></span> </footer></article> <article id='ttram' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Listingy v rámečku</h3> <a href='#ttram'><i class='fas fa-link'></i></a></div></header><section><p>Chceme, aby listingy produkované pomocí <code>\begtt...\endtt</code> nebo pomocí <code>\verbinput</code> byly zarámované. Rámeček se má zlomit, pokud listing přesahuje na další stránku. </p><p>Od verze OPmac Oct. 2015 je možné tento úkol vyřešit bez redefinování celého makra <code>\begtt</code> a&nbsp;<code>\doverbinput</code>. Je totiž možné vložit do <code>\tthook</code> přiřazení <code>\everypar</code>, které vloží čáry vlevo a&nbsp;vpravo každého řádku. Zbytek kódu se věnuje předefinování makra <code>\ttskip</code>, které vytvoří nejprve zahajovací díl rámečku (<code>\ttskipA</code>) a&nbsp;poté ukončovací díl rámečku (<code>\ttskipB</code>). </p><pre class='pr-3'><code>\def\srule{\line{\vrule height 3pt \hfil\vrule}} 
\def\ttskipA{\bigskip\hrule\srule \global\let\ttskip=\ttskipB} 
\def\ttskipB{\nointerlineskip\srule\hrule\bigskip \global\let\ttskip=\ttskipA} 
\let\ttskip=\ttskipA 
\def\tthook{\offinterlineskip \everypar={\rlap{\kern-\ttindent\line{\vrule\strut\hss\vrule}}}} 
</code></pre></section><footer class='text-right'><a href='opmac-tricks-e.html#ttram' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0126</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2015-10-07'>07. 10. 2015</time></span> </footer></article> <article id='verbbreak' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Zalamování řádků ve verbatim listingu</h3> <a href='#verbbreak'><i class='fas fa-link'></i></a></div></header><section><p>OPmac implicitně neřeší automatické zalamování řádků v&nbsp;listingu, pokud je řádek příliš dlouhý. Řádek sice ulomí, ale doplní hlášení o&nbsp;overfull box. V&nbsp;následující ukázce si ukážeme nastavení, při kterém jsou řádky zlomitelné v&nbsp;mezerách a&nbsp;při zlomení se v&nbsp;místě zlomu na konci řádku objeví smluvená značka (v ukázce <code>$\setminus$</code>) a&nbsp;pokračovací řádek respektuje odsazení výchozího řádku. Takže při: </p><pre class='pr-3'><code>\begtt 
if i=0 
   tady je velmi dlouhý řádek kódu, který se bohužel nevejde do šířky výstupního řádku 
fi 
\endtt 
</code></pre><p>bude pokračovací řádek začínat o&nbsp;tři mezery posunut, tedy přesně pod slovem „tady“. </p><pre class='pr-3'><code>\def\tthook{\rightskip=0pt plus1fil 
   \def\ {\discretionary{\hbox{$\;\setminus$}}{}{\kern.5em}}% 
   \everypar={\countspaces}} 
\def\countspaces#1\fi{#1\fi\hangindent=\ttindent \countspacesA} 
\def\countspacesA{\futurelet\next\countspacesB} 
\def\countspacesB{\ifx\next\spacemacro \expandafter\countspacesC\fi} 
\def\countspacesC#1{\advance\hangindent by.5em\ \countspacesA} 
\def\spacemacro{\ } 
</code></pre><p>Makro <code>\countspaces</code> spuštěné v&nbsp;<code>\everypar</code> nejprve dokončí práci předefinovaného <code>\par</code> (až po <code>\fi</code>) a&nbsp;pak spočítá mezery ze začátku řádku. Za každou mezeru zvětší <code>\hangindent</code> o&nbsp;šířku mezery. </p><p>Toto řešení není v&nbsp;souladu s&nbsp;možností orámovat listing dle předchozího OPmac triku. Rámeček se nám v&nbsp;pokračovacích řádcích po stranách začne trhat. Aby se netrhal, je třeba do definice <code>\tthook</code> vložit <code>\offinterlineskip\everypar={\makeframe}</code> a&nbsp;makro <code>\makeframe</code> definovat takto: </p><pre class='pr-3'><code>{\catcode`\^^M=13 
\gdef\makeframe#1^^M{\endgraf\hbox{\vrule\vbox{% 
   \normalbaselines\everypar={}\strut\countspaces#1\strut}\vrule}^^M}% 
} 
</code></pre></section><footer class='text-right'><a href='opmac-tricks-e.html#verbbreak' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0127</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2015-10-11'>11. 10. 2015</time></span> </footer></article> <article id='verbtab' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Tabulátory ve verbatim výpisech</h3> <a href='#verbtab'><i class='fas fa-link'></i></a></div></header><section><p>PlainTeX nastavuje znaku <code>^^I</code> (tabulátor, ASCII 9) význam jedné mezery. Pokud užíváte ve výpisech zpracovaných pomocí <code>\begtt...\endtt</code> nebo <code>\verbinput</code> tento znak, vytiskne se místo něj jedna mezera. To může být málo. Chcete-li místo něj vytisknout více mezer, definujte třeba: </p><pre class='pr-3'><code>\def\tthook{\adef\^^I{\space\space\space}} % TAB = 3 mezery 
</code></pre><p>Tabulátor v&nbsp;textovém souboru se ale chová obvykle ještě inteligentněji. Vytvoří aspoň jednu mezeru a&nbsp;další text pokračuje za nejbližším násobkem osmé pozice. Například, pokud předchozí text obsahuje 19 znaků, tabulátor vytvoří 5&nbsp;mezer, takže další text začíná za pozicí 24. Pokud ale předchozí text zabírá 23 znaků, tabulátor vytvoří jednu mezeru a&nbsp;další text začíná také za pozicí 24. V&nbsp;TeXu s&nbsp;užitím OPmac můžeme tuto inteligenci naprogramovat takto: </p><pre class='pr-3'><code>{\obeylines\gdef\everyttline#1^^M{\setbox0=\hbox\bgroup#1\egroup \box0 ^^M}}% 
\def\tthook{\everypar={\everyttline}\adef\^^I{\TABchar}} 
 
\def\TABchar{\egroup 
   \tmpdim=\TABskip \advance\tmpdim by-.1em 
   \loop \ifdim\tmpdim&lt;\wd0 \advance\tmpdim by\TABskip\relax \repeat 
   \advance\tmpdim by-\wd0 \advance\tmpdim by.1em 
   \box0 \kern\tmpdim 
   \setbox0=\hbox\bgroup 
} 
\def\TABskip{4em} % 4em = 8 pozic, protože každý znak má šířku .5em 
</code></pre><p>Uvedené makro pomocí <code>\everypar</code> zpracovává každý řádek jako <code>\setbox0=\hbox{text řádku}\box0</code>. Pokud ale se v&nbsp;textu řádku vyskytne tabulátor, spustí se <code>\TABchar</code>, který čtení řádku předčasně ukončí, změří jeho šířku a&nbsp;podle ní vloží odpovídající <code>\kern</code> a&nbsp;znovu zahájí činnost <code>\setbox0=\hbox\bgroup</code>. </p><p>Pro odsazování řádků zdrojového kódu je vhodnější použít následující makro, kde v&nbsp;prostoru pro odsazení můžete míchat mezery a&nbsp;tabulátory a&nbsp;navíc celkové odsazení můžete nastavit dle potřeby tisku. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#verbtab' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0150</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2016-06-02'>02. 06. 2016</time></span> </footer></article> <article id='verbindent' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Řízené odsazení řádků kódu ve verbatim listingu</h3> <a href='#verbindent'><i class='fas fa-link'></i></a></div></header><section><p>Existují konvence, kolik dát mezer pro každou další úrověň odsazení řádků v&nbsp;listingu programu. Například první úroveň je bez odsazení, druhá posunuje řádky o&nbsp;čtyři znaky doprava, další o&nbsp;8 znaků atd. Tj. odsazení <code>\verbindentIN</code> je rovno čtyřem. Při tisku kódu pomocí <code>\begtt...\endtt</code> nebo <code>\verbinput</code> může být takové velké odsazení méně vhodné. Uděláme makro, které místo vstupního odsazení <code>\verbindentIN</code> užitého skutečně ve vstupním kódu vytiskne jiné odsazení <code>\verbindentOUT</code>. Například nastavíme <code>\verbindentOUT</code> na dvojku a&nbsp;všechna odsazení budou ve výstupu poloviční. </p><pre class='pr-3'><code>\def\tthook{\everypar={\everyttline}\adef\^^I{\TABchar}} 
\def\everyttline#1\fi{\fi \def\TABchar{{\ }}% 
   \ifx\NLh\undefined \def\spaceGEN{\ }\def\spaceTAB{\TABchar}\else 
      \let\spaceGEN=\ \let\spaceTAB=\TABchar\fi 
   \tmpnum=0 \def\everyttlineC##1{\everyttlineA}\everyttlineA 
} 
\def\everyttlineA{\futurelet\next\everyttlineB} 
\def\everyttlineB{\ifx\next\n \else 
   \ifx\next\spaceGEN \advance\tmpnum by1 \else 
   \ifx\next\spaceTAB \divide\tmpnum by\TABskipIN % TAB position 
      \advance\tmpnum by1 \multiply\tmpnum by\TABskipIN \relax \else 
   \def\everyttlineC{\everyttlineD\everyttlineE}\fi\fi\fi 
   \everyttlineC 
} 
\def\everyttlineD{% maybe line numbers: 
   \ifnum\ttline&lt;0 \else 
      \ifx\glob\undefined \global \else \glob\fi \advance\ttline by1 \printttline\fi 
} 
\def\everyttlineE{% recalculation of indentation: 
   \tmpdim=.5em \tmpdim=\the\tmpnum\tmpdim \tmpdim=\verbindentOUT\tmpdim 
   \divide\tmpdim by\verbindentIN \kern\tmpdim 
} 
\def\TABskipIN{8}     % vzdalenost zarazek pro TAB (ASCII 9) 
\def\verbindentIN{4}  % velikost odsazeni na vstupu 
\def\verbindentOUT{2} % velikost odsazeni na vystupu 
</code></pre><p>Makro zjistí pro každý řádek velikost jeho odsazení, tuto vzdálenost vynásobí <code>\verbindentOUT</code> a&nbsp;vydělí <code>\verbindentIN</code> a&nbsp;takto upravenou vzdálenost skutečně při tisku použije. Při zjišťování velikosti odsazení si makro všímá jednak mezer a&nbsp;jednak tabulátorů, které jsou typicky s&nbsp;těmi mezerami všelijak smíchány. Pro každý tabulátor vypočte následující pozici tabulátorové zarážky dle vzdálenosti zarážek, která je dána v&nbsp;<code>\TABskipIN</code>. Při běžném nastavení <code>\TABskipIN</code> na 8&nbsp;dává například <code>mezera mezera tabulátor tabulátor mezera</code> celkové vstupní odsazení 17 znaků. </p><p>Mezery mezi slovy na řádku nejsou nijak dotčeny. Tabulátor mezi slovy se chová jako jedna mezera. Makro spolupracuje i&nbsp;s makry na automatické obarvení textů dle triku 0124 a&nbsp;0125. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#verbindent' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0151</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2016-06-02'>02. 06. 2016</time></span> </footer></article>
                            </section>  <section id="poznamky" class="mb-5 rounded my-shadow" style="background-color: #778c94">
                                <header class="text-center">
                                  <div class="py-2">
                                    <h2 class="d-inline text-light font-weight-light">Poznámky</h2>
                                    <a href="#poznamky"><i class="fas fa-link"></i></a>
                                  </div>
                                </header>
                                <article id='footcat' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Změny kategorií v poznámce pod čarou</h3> <a href='#footcat'><i class='fas fa-link'></i></a></div></header><section><p>Pokud napíšeme například <code>\activettchar"</code> a&nbsp;dále <code>\fnote{tady je příkaz "\cosi"}</code>, tak to nebude fungovat, neboť <code>\fnote</code> čte svůj parametr bez změny kategorií. Problém je vyložen podrobně v&nbsp;TBN na str. 26. Nicméně lze snadno předefinovat <code>\fnote</code> tak, aby změny kategorií v&nbsp;parametru fungovaly: </p><pre class='pr-3'><code>\expandafter\def\expandafter\afnote\expandafter{\fnote{\unhbox0}} 
\def\fnote{\setbox0=\hbox\bgroup\typobase\typoscale[800/800]\aftergroup\afnote\let\next} 
</code></pre><p>Po takovém předefinování <code>\fnote</code> nemá parametr, ale načte následující text jako součást <code>\setbox0=\hbox</code>. Po ukončení <code>\hboxu</code> se provede původní <code>\fnote</code> z&nbsp;OPmac tentokrát s&nbsp;parametrem <code>\unhbox0</code>. Povšimněte si, že je pořeba nastavit přepínače ovlivňující font už při čtení obsahu <code>\hboxu</code>, protože nastavení fontů při <code>\unhbox0</code> už není účinné (sazba už byla provedena). </p><p>Podobně jako <code>\fnote</code> je možné předefinovat <code>\mnote</code> a&nbsp;mnohá další podobná makra: </p><pre class='pr-3'><code>\expandafter\def\expandafter\amnote\expandafter{\mnote{\unhbox0}} 
\def\mnote{\setbox0=\hbox\bgroup\aftergroup\amnote\let\next} 
</code></pre></section><footer class='text-right'><a href='opmac-tricks-e.html#footcat' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0030</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2013-09-27'>27. 09. 2013</time></span> </footer></article> <article id='thefnote' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Rozdílné formátování značky poznámky pod čarou</h3> <a href='#thefnote'><i class='fas fa-link'></i></a></div></header><section><p>Může se stát, že potřebujeme v&nbsp;textu vyznačit číslo poznámky pod čarou jinak, než podruhé před vlastní poznámkou pod čarou. K&nbsp;tomu je možné využít <code>\fnotehook</code>, který lokálně předefinuje <code>\thefnote</code>. </p><p>Použijete-li ukázkový kód uvedený níže, dostanete do textu v&nbsp;místě odkazů šipku dolů následovanou horním indexem s&nbsp;číslem poznámky a&nbsp;před vlastní poznámku bude umístěno číslo poznámky přímo na řádku a&nbsp;bez šipky. </p><pre class='pr-3'><code>\def\thefnote{$\,\downarrow^{\locfnum}$} 
\def\fnotehook{\def\thefnote{\locfnum}} 
</code></pre></section><footer class='text-right'><a href='opmac-tricks-e.html#thefnote' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0044</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2014-04-02'>02. 04. 2014</time></span> </footer></article> <article id='hyperlinkfnote' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Odkaz s poznámkou spojený hyperlinky</h3> <a href='#hyperlinkfnote'><i class='fas fa-link'></i></a></div></header><section><p>Požadavek je propojit odkaz v&nbsp;textu na poznámku hyperlinkovým odkazem a&nbsp;zpět,  poznámku propojit s&nbsp;jejím odkazem v&nbsp;hlavním textu. To lze udělat třeba takto: </p><pre class='pr-3'><code>\hyperlinks\Green\Green 
 
\let\fnmarkboth=\fnmarkx 
 
\def\fnmarkx{\link[fnx:\the\fnotenum]{\localcolor\Red} {\fnmarkboth}% 
             \dest[fny:\the\fnotenum]} 
\def\fnmarky{\link[fny:\the\fnotenum]{\localcolor\Blue}{\fnmarkboth}% 
             \dest[fnx:\the\fnotenum]} 
 
\def\fnote{\fnoteG\fnmarky} 
\def\fnotemark#1{{\advance\fnotenum by#1\relax \fnmarky}} 
 
\def\fnxborder{1 0 0} 
\def\fnyborder{0 0 1} 
</code></pre><p>Ukázka zavádí pro dva nové druhy odkazů barvy <code>\Red</code> a&nbsp;<code>\Blue</code> a&nbsp;definuje pro ně také červený a&nbsp;modrý rámeček <code>\fnxborder</code> a&nbsp;<code>\fnyborder</code>.  Rámečky definovat nemusíte.  </p></section><footer class='text-right'><a href='opmac-tricks-e.html#hyperlinkfnote' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0044</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2020-03-19'>19. 03. 2020</time></span> </footer></article> <article id='fnoteshape' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Nastavení tvaru odstavce poznámky pod čarou</h3> <a href='#fnoteshape'><i class='fas fa-link'></i></a></div></header><section><p>OPmac formátuje odstavec poznámky pod čarou stejně jako běžný odstavec s&nbsp;odstavcovou zarážkou, do které umístí značku poznámky. Pokud chcete mít druhý a&nbsp;další řádky odsazeny o&nbsp;<code>\parindent</code> (takže celý odstavec je zleva zarovnán a&nbsp;odsazen o&nbsp;<code>\parindent</code>, jen značka je vysunuta do vzniklého levého okraje), je možné přistoupit k&nbsp;následujícímu triku: </p><pre class='pr-3'><code>\addto\footstrut{\hang} 
</code></pre><p>Tento trik rozšiřuje makro plainTeXu <code>\footstrut</code> o&nbsp;nastavení <code>\hangindent=\parindent</code>. Makro <code>\footstrut</code> zřejmě není (dle názvu) k&nbsp;tomu původně určeno, ale v&nbsp;plainTeXu se použije jen v&nbsp;poznámce pod čarou. Přitom přidat takové nastavení do \fnotehook je neúčinné, protože uvnitř makra plainTeXu <code>\vfootnote</code> se zahajuje <code>\insert</code> a&nbsp;v rámci tohoto zahájení se automaticky zresetuje <code>\hangindent</code> (jako při <code>\par</code>). Také <code>\leftskip</code> a&nbsp;<code>\rightskip</code> jsou uvnitř <code>\vfootnote</code> přenastaveny, takže jejich změna uvnitř <code>\fnotehook</code> rovněž nebude mít vliv. Pokud je ale nastavíte v&nbsp;rámci <code>\footstrut</code>, změna se projeví. Při rozsáhlejší změně designu poznámek pod čarou asi bude vhodné předefinovat celé makro plainTeXu <code>\vfootnote</code>. </p><p>Vzdálenost značky poznámky od prvního znaku textu je v&nbsp;plainTeXu nastavena na <code>\enspace</code> v&nbsp;rámci makra <code>\textindent</code>. Usazení této značky můžete změnit předefinováním makra <code>\textindent</code>, ovšem plainTeX toto makro používá ještě v&nbsp;rámci <code>\item</code> a&nbsp;<code>\itemitem</code>. OPmac <code>\texindent</code> ani <code>\item</code> a&nbsp;<code>\itemitem</code> nepouživá (pro prostředí <code>\begitems...\enditems</code> má vlastní makra), takže když klasická plainTeXová makra v&nbsp;dokumentu nevyužijete, je možné usazení značky v&nbsp;poznámce řídit novou definicí makra <code>\textindent</code>. Například </p><pre class='pr-3'><code>\def\texindent#1{\indent\llap{#1\kern3pt}} 
</code></pre></section><footer class='text-right'><a href='opmac-tricks-e.html#fnoteshape' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0107</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2015-04-30'>30. 04. 2015</time></span> </footer></article> <article id='fnotebroken' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Poznámky pod čarou na více stránkách s barevnými texty</h3> <a href='#fnotebroken'><i class='fas fa-link'></i></a></div></header><section><p>V&nbsp;TeXu je konceptuální problém s&nbsp;barevnými texty, které mají přecházet z&nbsp;jedné strany na další. Pro barvy jsou užity barevné přepínače, které PDF rasterizér na každé stránce resetuje. PdfTeX proto zavádí pro práci s&nbsp;barvami tzv. colorstack a&nbsp;OPmac to využívá a&nbsp;funguje to v&nbsp;případě barevných textů, které přecházejí ze strany na stranu v&nbsp;hlavním bloku. Ale v&nbsp;případě takto rozdělených textů v&nbsp;pznámkách pod čarou se z&nbsp;toho stává  hodně komplikovaný problém interně v&nbsp;pdfTeXu (zatím) neřešený. Když napíšete <code>{\localcolor\Red text ... text}</code> v&nbsp;hlavním textu, tak přechod ze strany na stranu funguje, ale v&nbsp;poznámkách pod čarou to fungovat nemůže, pokud jde o&nbsp;dlouhou poznámku rozdělenou na více stránek a&nbsp;obarvený úsek textu v&nbsp;poznámce přeteče na další stranu. </p><p>Pokud přesto chcete, aby Váš text i&nbsp;v dlouhých poznámkách pod čarou (přecházejících na více stran) hýřil všemi barvami, je možné v&nbsp;poznámkách psát <code>{\fnotecolor\Red text ... text}</code> a&nbsp;využít následující makro: </p><pre class='pr-3'><code>\def\fnotecolor#1{\expandafter\definecolor#1% 
   \expandafter\fnoteRedA\expandafter{\iffalse}\fi} 
\def\definecolor#1#2{\def\everyColor{#2 k}} 
\long\def\fnoteRedA#1{\everyspacecolor#1 {} \egroup\pdfliteral{0 g}} 
\long\def\everyspacecolor#1 {\ifx\end#1\end \unskip \else  
   \pdfliteral{\everyColor}#1 \expandafter\everyspacecolor\fi 
} 
 
</code></pre><p>Toto makro vkládá před každé slovo obarveného textu přepínač na příslušnou (stále stejnou) barvu. Je to v&nbsp;99 procentech zbytečné, ale když se takto obarvený text přelomí přes stranu v&nbsp;poznámce pod čarou, přepínač před prvním slovem nové strany zabere. Navíc je použit PDF primitivní přepínač barev, který obchází colorstack, takže implicitní řešení barev pomocí colorstacku  bude dále fungovat v&nbsp;hlavním textu. </p><p>V&nbsp;tomto případě trochu spoléháme na to, že se v&nbsp;poznámkách pod čarou (zvláště na rozhraní mezi stránkami) nebudou dělit slova a&nbsp;obarvený text nebude obsahovat další složitější makrokonstrukce, které by způsobily konflikt s&nbsp;makrem rozkládajícím tento text na slova. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#fnotebroken' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0167</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2019-02-12'>12. 02. 2019</time></span> </footer></article> <article id='tnote' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Lokální poznámky pod tabulkami</h3> <a href='#tnote'><i class='fas fa-link'></i></a></div></header><section><p>Kromě poznámek pod čarou je často potřeba označit jednotlivé položky v&nbsp;tabulce a&nbsp;přidat k&nbsp;nim poznámky přímo pod tabulku. Nikoli tedy poznámky pod čarou, které se vztahují k&nbsp;celé stránce. Uživatel například napíše </p><pre class='pr-3'><code>\table{lll}{ 
  aha\tnote{projev pochopení}  &amp; bha &amp; ha \cr 
  uha\tnote{údiv}              &amp; eha &amp; ha \cr 
  xha\tnote{extra pochopení}   &amp; fha &amp; nha \cr 
} 
\nobreak\medskip\tnotes 
</code></pre><p>a&nbsp;u položek aha, uha, xha se zjeví exponenty 1, 2, 3&nbsp;a pod tabulkou v&nbsp;místě <code>\tnotes</code> se vytisknou tytéž exponenty následované slovy projev pochopení, údiv a&nbsp;extra pochopení. K&nbsp;tomu účelu může posloužit následující makro: </p><pre class='pr-3'><code>\newcount\tnotenum  \newbox\tnotebox 
\def\tnote#1{\global\advance\tnotenum by1 
   \hbox{\thetnote}% 
   \global\setbox\tnotebox=\vbox{\unvbox\tnotebox 
      \typobase\typoscale[800/800] \noindent\enspace\llap{\thetnote\ }#1\strut}} 
\def\tnotes{\global\tnotenum=0 \box\tnotebox} 
\def\thetnote{$^{\the\tnotenum}$} 
</code></pre><p>Chcete-li místo čísel mít v&nbsp;exponentech písmena, pište třeba </p><pre class='pr-3'><code>\def\thetnote{$^{\rm\athe{\the\tnotenum}}$} 
</code></pre><p>Poznámky se postupně kumulují do boxu <code>\tnotebox</code> a&nbsp;nakonec je tento box vytištěn. Box s&nbsp;poznámkami má šířku <code>\hsize</code>, takže pokud máte krátké poznámky a&nbsp;štíhlou tabulku a&nbsp;chcete obojí centrovat, je třeba například psát: </p><pre class='pr-3'><code>\centerline{\vbox{\table{...}{...}\medskip\rlap{\tnotes}}} 
</code></pre></section><footer class='text-right'><a href='opmac-tricks-e.html#tnote' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0033</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2013-10-07'>07. 10. 2013</time></span> </footer></article> <article id='rotmnote' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Poznámky mnote pootočené</h3> <a href='#rotmnote'><i class='fas fa-link'></i></a></div></header><section><p>Pokud chcete pootočit poznámky na okraji o&nbsp;45 nebo 90 stupňů, stačí psát: </p><pre class='pr-3'><code>\fixmnotes\right 
\def\mnotehook#1\endgraf{\noindent\pdfsave\pdfrotate{45}\rlap{#1}\pdfrestore} 
</code></pre><p>Rotace proběhne kolem výchozího bodu první řádky poznámky. Možná bude na základě toho potřeba upravit rozměry <code>\mnoteindent</code> a&nbsp;<code>\mnotesize</code>. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#rotmnote' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0071</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2014-06-18'>18. 06. 2014</time></span> </footer></article> <article id='nmnote' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Číslované poznámky mnote</h3> <a href='#nmnote'><i class='fas fa-link'></i></a></div></header><section><p>Vyřešíme požadavek číslovat poznámky po straně podobným způsobem, jako poznámky pod čarou. Tj. v&nbsp;textu se objeví číslo a&nbsp;stejné číslo uvozuje postranní poznámku. Takové řešení najdeme třeba <a href='https://dl.dropboxusercontent.com/u/502901/naurtf.pdf' title='zde'>zde</a>. </p><p>Vytvoříme makro <code>\note{text}</code>, které způsobí číslovanou poznámku po straně. Makro může být implementováno třeba takto: </p><pre class='pr-3'><code>\margins/1 a4 (2,6,2,2)cm 
\mnotesize=4.5cm 
 
\newcount\notenum 
\fixmnotes\right 
\def\note#1{\global\advance\notenum by 1 
   $^{\the\notenum}$% 
   \mnote{\typoscale[800/800]$^{\the\notenum}$\kern.3em #1}% 
} 
</code></pre><p>Zde je pomocí <code>\margins</code> vytvořeno více místa v&nbsp;pravém okraji, kde budou poznámky. Čítač <code>\notenum</code> se při každém <code>\note</code> zvětší o&nbsp;jedničku a&nbsp;zobrazí se v&nbsp;textu i&nbsp;v poznámce. </p><p>Protože <code>\note</code> je implementována pomocí jednoduchého OPmac makra <code>\mnote</code>, neřeší automat případné překrývání poznámek a&nbsp;vystrčení poznámky dole na stránce. Doporučuji při přípravě dokumentu si těchto problémů nevšímat a&nbsp;v závěrečné korektuře, kdy už je jasné definitivní rozmístění textu na stránkách, případně posunout vertikálně postranní poznámky pomocí <code>\mnoteskip</code> a&nbsp;doladit tak vzhled jednotlivých stran manuálně. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#nmnote' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0122</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2015-08-25'>25. 08. 2015</time></span> </footer></article>
                            </section>  <section id="odrazky" class="mb-5 rounded my-shadow" style="background-color: #778c94">
                                <header class="text-center">
                                  <div class="py-2">
                                    <h2 class="d-inline text-light font-weight-light">Odrážky</h2>
                                    <a href="#odrazky"><i class="fas fa-link"></i></a>
                                  </div>
                                </header>
                                <article id='vnoreni' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Odrážka pro vnořené \begitems...\enditems</h3> <a href='#vnoreni'><i class='fas fa-link'></i></a></div></header><section><p>Prostředí <code>\begitems...\enditems</code> pracuje s&nbsp;implicitní odrážkou, která se použije, pokud se nepoužije <code>\style</code>. Je přitom možné mít tuto implicitní odrážku automaticky nastavenu jinak pro vnořená prostředí <code>\begitems...\enditems</code> a&nbsp;ani pro ně tedy autor nemusí používat <code>\style</code>. Stačí přidat na začátek dokumentu následující kód: </p><pre class='pr-3'><code>\def\slet#1#2{\expandafter\let\csname#1\expandafter\endcsname\csname#2\endcsname} 
\addto\begitems{\slet{normalitem}{item:o}} 
</code></pre><p>Implicitně je <code>\normalitem</code> nastaven na velký puntík. Po aplikaci uvedeného kódu budou mít odrážky první úrovně velký puntík a&nbsp;odrážky druhé úrovně malý puntík bez nutnosti používat <code>\style</code>. Chcete-li mít odlišné i&nbsp;odrážky třetí úrovně, pište místo předchozího druhého řádku toto: </p><pre class='pr-3'><code>\addto\begitems{\slet{normalitem}{item:o}\addto\begitems{\slet{normalitem}{item:-}}} 
</code></pre></section><footer class='text-right'><a href='opmac-tricks-e.html#vnoreni' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0003</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2013-08-13'>13. 08. 2013</time></span> </footer></article> <article id='vnoreniB' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Jiné řešení vnořeného \begitems...\enditems</h3> <a href='#vnoreniB'><i class='fas fa-link'></i></a></div></header><section><p>Abychom nemuseli ve výčtovém prostředí pokaždé psát příkaz <code>\style</code>, můžeme si nadefinovat implicitní styl. Tak navíc jednodušeji zajistíme jednotnost odrážek v&nbsp;celém dokumentu. Implicitní styl můžeme nadefinovat i&nbsp;pro vnořené výčty. </p><pre class='pr-3'><code>\addto\begitems{\style a 
   \addto\begitems{\style n 
      \addto\begitems{\style i }}} 
</code></pre><p>Syntaxi <code>\begitems\style</code> můžeme používat i&nbsp;nadále, čímž podle očekávání přebijeme implicitní chování. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#vnoreniB' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0031</span> <span class='badge badge-info'>Autor: Jan Šustek</span> <span class='badge badge-info'>Publikováno <time datetime='2013-09-28'>28. 09. 2013</time></span> </footer></article> <article id='vertii' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Vertikální mezerování při použití \begitems...\enditems</h3> <a href='#vertii'><i class='fas fa-link'></i></a></div></header><section><p>Nad a&nbsp;pod každé prostředí <code>\begitems...\enditems</code> je přidána vertikální mezera z&nbsp;makra <code>\iiskip</code>, kterou OPmac nastavuje na <code>\medskip</code> (poloviční řádek). Tyto mezery se při vnořených prostředích pro výčty mohou sčítat a&nbsp;to nevypadá dobře. Zrušit zcela tuto mezeru lze pomocí: </p><pre class='pr-3'><code>\def\iiskip{} 
</code></pre><p>Chcete-li mezeru zrušit jen ve vnořených výčtech, pište </p><pre class='pr-3'><code>\addto\begitems{\def\iiskip{}} 
</code></pre><p>Chcete-li naopak mít mezeru mezi každou položkou ve výčtu a&nbsp;stejnou kolem prostředí výčtu, je možné to udělat takto: </p><pre class='pr-3'><code>\newdimen\iiskipamount  \iiskipamount=3pt 
\def\iiskip{\vskip\iiskipamount} 
\addto\begitems{\removelastskip\parskip=\iiskipamount \def\iiskip{}} 
</code></pre><p>Toto makro ruší vertikální mezery kolem vnořených výčtů a&nbsp;přidává mezery mezi každým odstavcem ve výčtech pomocí <code>\parskip</code>. U&nbsp;výčtu na vnější úrovni potřebujeme odstranit pomocí <code>\removelastskip</code> mezeru před první položkou z&nbsp;<code>\iiskip</code>. Na konci výčtu na vnější úrovni ale <code>\iiskip</code> potřebujeme, za ním už totiž nebudou mezery z&nbsp;parskip. </p><p>Pokud nechcete mezery mezi odstavci uvnitř položek (obsahujících více odstavců) ale chcete mezery mezi položkami, je potřeba předefinovat makro <code>\startitem</code>, které OPmac používá při startu každé položky: </p><pre class='pr-3'><code>\newdimen\iiskipamount  \iiskipamount=3pt 
\def\addbefore#1#2{\toks1=\expandafter{#1}\toks2={#2}\edef#1{\the\toks2 \the\toks1}} 
 
\def\iiskip{\vskip\iiskipamount} 
\addto\begitems{\removelastskip \def\iiskip{}} 
\addbefore\startitem{\vskip\iiskipamount\relax} 
</code></pre></section><footer class='text-right'><a href='opmac-tricks-e.html#vertii' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0004</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2013-08-13'>13. 08. 2013</time></span> </footer></article> <article id='noindent' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Po výčtu neodsazovat odstavec</h3> <a href='#noindent'><i class='fas fa-link'></i></a></div></header><section><p>Existuje typografické pravidlo, které praví, že první odstavec po seznamu opatřeném odrážkami by neměl mít odsazení, protože odsazeny jsou údaje v&nbsp;seznamu a&nbsp;může to působit jako matoucí. Při použítí <code>\begitems...\enditems</code> v&nbsp;OPmac stačí do definice na začátek dokumentu napsat: </p><pre class='pr-3'><code>\addto\enditems{\afternoindent} 
</code></pre><p>a&nbsp;je uvedenému typografickému pravidlu vyhověno. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#noindent' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0019</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2013-08-27'>27. 08. 2013</time></span> </footer></article> <article id='gitemnum' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Průběžné číslování items</h3> <a href='#gitemnum'><i class='fas fa-link'></i></a></div></header><section><p>Někdy chceme, aby číslování ve výčtu začalo tam, kde skončilo číslování v&nbsp;předcházejícím výčtu. Toho docílíme vytvořením globálního čítače <code>\gitemnum</code>, do nějž vložíme poslední hodnotu <code>\itemnum</code> z&nbsp;předchozího výčtu, kterou potom načteme na začátku následujícího výčtu. </p><pre class='pr-3'><code>\newcount\gitemnum 
\addto\begitems{\itemnum\gitemnum} 
\addbefore\enditems{\global\gitemnum\itemnum} 
</code></pre><p>V&nbsp;definici jsme využili makro <code>\addbefore</code> z&nbsp;OPmac triku 0004. Trik funguje pouze pro jednoúrovňové výčty. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#gitemnum' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0134</span> <span class='badge badge-info'>Autor: Jan Šustek</span> <span class='badge badge-info'>Publikováno <time datetime='2015-12-19'>19. 12. 2015</time></span> </footer></article>
                            </section>  <section id="draft" class="mb-5 rounded my-shadow" style="background-color: #778c94">
                                <header class="text-center">
                                  <div class="py-2">
                                    <h2 class="d-inline text-light font-weight-light">Draft</h2>
                                    <a href="#draft"><i class="fas fa-link"></i></a>
                                  </div>
                                </header>
                                <article id='draftlabels' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Tisk lejblíků při \draft</h3> <a href='#draftlabels'><i class='fas fa-link'></i></a></div></header><section><p>V&nbsp;případě, že je aktivní <code>\draft</code> (tj. dokument je určen ke korekturám), se mi osvědčilo tisknout do dokumentu lejblíky v&nbsp;místě cílů odkazů <code>\ref</code> a&nbsp;<code>\cite</code>. Autor nemusí vzpomínat, jaký použil lejblík, vidí to totiž přímo před očima. </p><pre class='pr-3'><code>\addto\draft{\let\destbox=\draftdestbox} 
\def\draftdestbox[#1#2:#3]{\vbox to0pt{\kern-\destheight 
   \ifx\pdfdest\undefined\special{pdf:dest (#1#2:#3) [@thispage /XYZ @xpos @ypos null]}% 
   \else\pdfdest name{#1#2:#3} xyz\relax\fi 
   \if#1r\llap{\localcolor\Red\tt\thefontsize[10][\detokenize\expandafter{#3}]}\vss 
   \else \if#1c\vss\llap{\localcolor\Red\tt[\detokenize\expandafter{\tmpb}] }\kern-\prevdepth 
   \else \vss \fi\fi}} 
</code></pre><p>Toto makro předefinovává <code>\destbox</code> z&nbsp;OPmac. Hlavním účelem <code>\destbox</code> je umístit do výšky <code>\destheight</code> cíl odkazu. Navíc v&nbsp;makru přidáváme při odkazech typu <code>ref</code> (<code>#1=r</code>) <code>\llap</code> následovaný <code>\vss</code> (tj. <code>\llap</code> je taky ve výšce odkazu) a&nbsp;při odkazech typu <code>cite</code> (<code>#1=c</code>) je přidáno <code>\vss \llap</code>, tedy <code>\llap</code> je na účaří a&nbsp;vyskytne se v&nbsp;seznamu literatury. Lejblík je tištěn zelenou barvou a&nbsp;v sazbě nepřekáží, tj. sazba bez něj dopadne zcela stejně. </p><p>Příkaz <code>\detokenize</code> (z eTeXu) je v&nbsp;kódu použit proto, aby bylo možné tisknout lejblíky, ve kterých se vyskytuje podtržítko. Bez použití eTeXu by bylo potřeba tisk provést pomocí kombinace <code>\string</code> a&nbsp;<code>\csname...\endcsname</code>. Další možnost je vyhnout se použití lejblíků s&nbsp;podtržítkem. </p><p>Kromě toho je praktické při <code>\draft</code> přidat třeba do patičky datum zpracování: </p><pre class='pr-3'><code>\addto\draft{\def\drafttext{\llap{\the\day. \the\month. \the\year\Black}}} 
\def\drafttext{} 
\footline={\hss\rm\thefontsize[10]\the\pageno\hss\drafttext} 
</code></pre></section><footer class='text-right'><a href='opmac-tricks-e.html#draftlabels' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0005</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2013-08-13'>13. 08. 2013</time></span> </footer></article> <article id='rfc' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Interní poznámky</h3> <a href='#rfc'><i class='fas fa-link'></i></a></div></header><section><p>Je užitečné si do textu psát interní poznámky typu „k tomu se ještě musím vrátit“, „tady je třeba doplnit obrázek“, které se v&nbsp;dokumentu objeví jen při nastaveném <code>\draft</code>. Nabízím řešení pomocí maker <code>\rfc</code> a&nbsp;<code>\makerfc</code>. První z&nbsp;nich (request for correction) vloží do textu neviditelnou poznámku a&nbsp;druhé z&nbsp;nich sepíše seznam všech poznámek na novou stránku (na konci dokumentu) a&nbsp;u každé poznámky je zpětný odkaz do místa, kde byla poznámka napsaná. To vše ale funguje jen při zapnutém <code>\draft</code>. Jakmile je <code>\draft</code> vypnuté, žádný seznam poznámek se netiskne. Použití vypadá takto: </p><pre class='pr-3'><code>Tady je normální text\rfc{ověřit, zda netvrdím blbosti}. 
Tady pokračuje další text\rfc{zjistit, zda naměřené hodnoty nejsou moc ulítlé}. 
... 
% na konci dokumentu: 
\makerfc 
</code></pre><p>Při <code>\draft</code> se objeví nyní závěrečná stránka, kde je řečeno: </p><p>[rfc-1]  ověřit, zda netvrdím blbosti <br>[rfc-2]  zjistit, zda naměřené hodnoty nejsou moc ulítlé </p><p>a&nbsp;přitom při <code>\hyperlinks</code> jsou odkazy [rfc-1] a&nbsp;[rfc-2] klikací a&nbsp;zpětně navedou do místa textu, kterého se poznámka týká. </p><p>Implementace může vypadat takto: </p><pre class='pr-3'><code>\newcount\rfcnum 
 
\def\rfclist{} 
\def\rfcactive#1{\global\advance\rfcnum by1 
   \dest[rfc:rfc-\the\rfcnum]\global\addto\rfclist{\rfcitem #1}} 
\def\rfc#1{} 
\def\rfcitem{\advance\rfcnum by1 
   \medskip\noindent\llap{\link[rfc:rfc-\the\rfcnum]{\localcolor\Red}{[rfc-\the\rfcnum] }}} 
 
\addto\draft{\let\rfc=\rfcactive} 
 
\def\makerfc{\ifx\rfc\rfcactive 
   \vfil\break {\secfont \noindent Requests for correction}\par 
   \bgroup\rfcnum=0 \rfclist\egroup\fi} 
</code></pre><p>Makro definuje <code>\rfc</code> jako prázdné a&nbsp;do <code>\draft</code> přidá <code>\let\rfc=\rfcactive</code>, tj. při <code>\draft</code> se <code>\rfc</code> probudí k&nbsp;životu: přidá do <code>\rfclist</code> text poznámky uvozený makrem <code>\rfcitem</code>, které se stará o&nbsp;zpětné odkazy. Makro <code>\makerfc</code> prostě spustí <code>\rfclist</code>. Navíc při aktivaci lejblíků, jak je posáno v&nbsp;předchozím triku, se v&nbsp;textu, kterého se poznámka týká, objeví v&nbsp;hranaté závorce [rfc-číslo]. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#rfc' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0056</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2014-05-11'>11. 05. 2014</time></span> </footer></article>
                            </section>  <section id="cislovani-odkazy" class="mb-5 rounded my-shadow" style="background-color: #778c94">
                                <header class="text-center">
                                  <div class="py-2">
                                    <h2 class="d-inline text-light font-weight-light">Číslování, odkazy</h2>
                                    <a href="#cislovani-odkazy"><i class="fas fa-link"></i></a>
                                  </div>
                                </header>
                                <article id='cislovani' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Přehledná deklarace číslování</h3> <a href='#cislovani'><i class='fas fa-link'></i></a></div></header><section><p>OPmac používá <code>\tnum</code> pro čísla tabulek, <code>\fnum</code> pro čísla obrázků a&nbsp;<code>\dnum</code> pro čísla rovnic. Dále je <code>\chapnum</code> číslo kapitoly, <code>\secnum</code> číslo sekce a&nbsp;<code>\seccnum</code> číslo podsekce. Čísla tabulek, obrázků i&nbsp;rovnic OPmac resetuje v&nbsp;každé sekci a&nbsp;vypisuje pro tabulku trojici čísel <code>chap.sec.tab</code>, pro obrázek <code>chap.sec.fig</code> a&nbsp;rovnice vypisuje ve formátu (rce). Pokud bychom toto chování chtěli změnit a&nbsp;mít nad tím přehled, je možné nejprve vykostit originální resetování registrů v&nbsp;kódu maker <code>\chap</code>, <code>\sec</code>, <code>\secc</code> a&nbsp;převzít řízení do svých rukou. Výmaz uvedených kódů obstarají makra <code>\chaphook</code>, <code>\sechook</code> a&nbsp;<code>\secchook</code>, která ve svém parametru <code>#1</code> sejmou resetovací kód až po <code>\relax</code> (to ukončuje resetovací kód). </p><pre class='pr-3'><code>\def\chaphook#1\relax{\dochaphook}  \def\dochaphook{} 
\def\sechook#1\relax{\dosechook}    \def\dosechook{} 
\def\secchook#1\relax{\dosecchook}  \def\dosecchook{} 
 
\def\chapreset#1{\addto\dochaphook{\global#1=0 }} 
\def\secreset#1{\addto\dosechook{\global#1=0 }\chapreset#1} 
\def\seccreset#1{\addto\dosecchook{\global#1=0 }\secreset#1} 
 
\chapreset\secnum   \secreset\seccnum 
</code></pre><p>Makrem <code>\chapreset\counter</code> dáváme najevo, že chceme <code>\counter</code> resetovat jen v&nbsp;kapitole, dále <code>\secreset\num</code> zresetuje <code>\num</code> v&nbsp;kapitole i&nbsp;sekci a&nbsp;konečně <code>\seccreset\cosi</code> zresetuje <code>\cosi</code> v&nbsp;kapitole, sekci i&nbsp;podesekci. Dejme tomu, že chceme obrázky, tabulky i&nbsp;rovnice mít resetovány jen v&nbsp;kapitole a&nbsp;průběžně číslovány v&nbsp;sekcích a&nbsp;podsekcích. Chceme je oznažovat pomocí dvojice <code>chap.tab</code> nebo <code>chap.fig</code> a&nbsp;v případě rovnice zvolíme formát (<code>chap.rce</code>). Pak stačí psát: </p><pre class='pr-3'><code>\chapreset\tnum   \def\thetnum{\the\chapnum.\the\tnum} 
\chapreset\fnum   \def\thefnum{\the\chapnum.\the\fnum} 
\chapreset\dnum   \def\thednum{(\the\chapnum.\the\dnum)} 
</code></pre><p>Nechť dále třeba chceme číslovat věty (propositions) a&nbsp;budeme třeba úplně praštění při návrhu číslování: budou se resetovat v&nbsp;každé podsekci a&nbsp;tisknout ve tvaru čtveřice <code>chap.sec.secc.prop</code>. Pak můžeme psát: </p><pre class='pr-3'><code>\newcount\propnum  \seccreset\propnum 
\def\thepropnum{\the\chapnum.\the\secnum.\the\seccnum.\the\propnum} 
 
\def\proposition{\global\advance\propnum by 1 
   \noindent\wlabel{\thepropnum}{\bf Proposition \thepropnum.}\space} 
</code></pre></section><footer class='text-right'><a href='opmac-tricks-e.html#cislovani' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0007</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2013-08-15'>15. 08. 2013</time></span> </footer></article> <article id='pictab' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Seznam obrázků a tabulek</h3> <a href='#pictab'><i class='fas fa-link'></i></a></div></header><section><p>OPmac nabízí jen automaticky generovaný obsah kapitol, sekcí a&nbsp;podsekcí. Chceme-li vytvořit automaticky generovaný obsah obrázků a&nbsp;tabulek, je třeba to naprogramovat například takto: </p><pre class='pr-3'><code>\def\totlist{} \def\toflist{} 
\def\Xtab#1#2#3{\addto\totlist{\totline{#1}{#2}{#3}}} 
\def\Xfig#1#2#3{\addto\toflist{\tofline{#1}{#2}{#3}}} 
 
\input opmac 
 
\def\tofline#1#2#3{{\leftskip=\iindent \rightskip=\iindent plus1em 
   \noindent\llap{\bf\ref[#1].\enspace}% 
   {#3\unskip}\nobreak\tocdotfill\pgref[#1]\nobreak\hskip-\iindent\null\par}} 
\let\totline=\tofline 
 
\def\captionhook#1{\typosize[10/12]% 
   \ifx\clabeltext\undefined \else 
      \ifx#1t{\protectlist\immediate\wref\Xtab{{\lastlabel}{\thetnum}{\clabeltext}}}% 
      \else  {\protectlist\immediate\wref\Xfig{{\lastlabel}{\thefnum}{\clabeltext}}}% 
   \fi\fi 
   \global\let\clabeltext=\undefined 
} 
\def\clabel[#1]#2{\gdef\clabeltext{#2}\label[#1]} 
</code></pre><p>Je zde využit soubor REF z&nbsp;OPmac a&nbsp;do něj jsou zapisovány údaje tvaru <code>\Xtab{lejblík}{číslo}{text}</code> a&nbsp;<code>\Xfig{leblík}{číslo}{text}</code>. Tyto údaje jsou zapisovány okamžitě, protože neobsahují číslo strany. Číslo strany v&nbsp;obsahu obrázků a&nbsp;tabulek je nakonec vytištěno pomocí <code>\pgref[lejblík]</code>. Soubor REF je čten během <code>\input opmac</code>, proto je potřeba makra <code>\Xtab</code>, <code>\Xref</code> definovat před načtením opmac. Tato makra si data pouze zapamatují do <code>\totlist</code> a&nbsp;<code>\toflist</code>, kde se kumulují údaje ve tvaru <code>\totline{lejblík}{číslo}{text}</code> a&nbsp;podobně pro <code>\tofline</code>. Definice maker <code>\tofline</code>, <code>\totline</code> je inspirovaná makrem <code>\tocline</code> z&nbsp;OPmac. </p><p>Uživatel musí napsat <code>\clabel[lejblík]{text}</code> následovaný tabulkou nebo obrázkem včetně příkazu <code>\caption/t</code> nebo <code>\caption/f</code>. Makro <code>\clabel</code> založí lejblík a&nbsp;makro <code>\caption</code> prostřednictvím <code>\captionhook</code> pošle potřebné údaje do REF souboru. Použití může vypadat například takto: </p><pre class='pr-3'><code>\nonum\notoc\sec Seznam obrázků 
 
\toflist 
 
\nonum\notoc\sec Seznam tabulek 
 
\totlist 
 
\clabel[tabA]{Tabule A} 
... Tabulka A\par\nobreak 
\caption/t Toto je velmi zajímavá tabulka A. 
 
\clabel[tabB]{Tabule B} 
... Tabulka B\par\nobreak 
\caption/t Nyní se můžete pokochat tabulkou B. 
</code></pre></section><footer class='text-right'><a href='opmac-tricks-e.html#pictab' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0013</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2013-08-17'>17. 08. 2013</time></span> </footer></article> <article id='caplisting' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Popisky pro výpisy kódů</h3> <a href='#caplisting'><i class='fas fa-link'></i></a></div></header><section><p>OPmac nabízí dva druhy nezávisle číslovaných popisků: obrázky pomocí <code>\caption/f</code> a&nbsp;tabulky pomocí <code>\caption/t</code>. Ukážeme si, jak doplnit třetí druh. Například popisky pod výpisy kódů pomocí <code>\caption/l</code>. </p><pre class='pr-3'><code>\newcount\lnum 
\def\thelnum{\thechapnum.\the\lnum} 
\sdef{mt:l:en}{Listing} \sdef{mt:l:cs}{Výpis} \sdef{mt:l:sk}{Výpis} 
\def\chaphook#1\relax{{\globaldefs=1 \chapnums}} 
\def\chapnums{\secnum=0 \seccnum=0 \tnum=0 \fnum=0 \dnum=0 \lnum=0 } 
 
\chyph  % Zkouška v češtině: 
 
\chap Pokus 
 
\begtt 
int main() { ... } 
\endtt 
\nobreak \label[main] 
\caption/l Toto je výpis funkce main. 
</code></pre><p>Uvedená ukázka zavádí čítač <code>\lnum</code> a&nbsp;definuje vzhled čísla <code>\thelnum</code>. Dále jsou uvedeny tři jazykové varianty slova Výpis a&nbsp;přidáno resetování čísla <code>\numl</code> v&nbsp;každé kapitole. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#caplisting' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0035</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2013-11-29'>29. 11. 2013</time></span> </footer></article> <article id='capformat' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Změna formátu popisků pod obrázky a tabulkami</h3> <a href='#capformat'><i class='fas fa-link'></i></a></div></header><section><p>OPmac sází popisek jako odstavec s&nbsp;centrovaným posledním řádkem. Využívá k&nbsp;tomu trik popsaný v&nbsp;TBN na straně 234. Může se ovšem vyskytnout jiný požadavek na formátování popisků. Třeba takový: je-li popisek jednořádkový, pak má centrovat. Přeteče-li na více řádků, má se chovat jako normální odstavec. Řešení tohoto požadavku přinese následující kód: </p><pre class='pr-3'><code>\def\printcaption#1#2{\leftskip=\iindent \rightskip=\iindent 
   \setbox0=\hbox\bgroup \aftergroup\docaption{\bf#1 #2.}\enspace} 
\def\docaption{\tmpdim=\hsize \advance\tmpdim by-2\iindent 
   \ifdim\wd0&gt;\tmpdim \unhbox0 \else \hfil\hfil\unhbox0 \fi \endgraf \egroup} 
</code></pre><p>Makro přeměří text popisku uložený v&nbsp;boxu0 a&nbsp;pokud se vejde na jeden řádek, předřadí před něj <code>\hfil\hfil</code>, což je pružinka stejné síly, jako <code>\parfillskip</code> (v popiscích dle OPmac) a&nbsp;text centruje. Je-li popisek delší, žádná pružinka se nepředřadí a&nbsp;vysází se obyčejný odstavec. </p><p>Nenapadlo mě řešení této úlohy postavené na záporných fill, jako to je v&nbsp;případě centrování posledního řádku. Moje inteligence na to nestačí. Ani se mi nedaří najít důkaz, že to nemá řešení. Má-li někdo jedno nebo druhé, prosím o&nbsp;informaci. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#capformat' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0048</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2014-04-26'>26. 04. 2014</time></span> </footer></article> <article id='urlbreakpoint' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Zlom v dlouhém URL</h3> <a href='#urlbreakpoint'><i class='fas fa-link'></i></a></div></header><section><p>OPmac nabízí makro <code>\url</code> na tisk internetových odkazů. Toto makro dává potenciální místa zlomu za lomítka, tečky, otazníky a&nbsp;rovnítka. Dále od verze May 2014 nabízí OPmac makro <code>\|</code>, které se dá použít v&nbsp;argumentu <code>\url</code> pro vyznačení dalších míst zlomu. Toto makro se při tisku \url chová jako <code>\urlspecchar</code>, přitom <code>\urlspecchar</code> je definováno implitině jako <code>\penalty10</code>. Protože je ale v&nbsp;argumentu <code>\url</code> schována jen malá pružnost, nemusí vhodné místo zlomu přesně vyhovovat. Je možné předefinovat <code>\urlspecchar</code> tak, aby v&nbsp;případě, že se v&nbsp;tomto místě zlomí, zůstal řádek nezarovnán na pravý okraj. </p><pre class='pr-3'><code>\def\urlspecchar{\nobreak\hskip0pt plus2em \penalty110 \hskip0pt plus-2em\relax} 
</code></pre><p>Makro umožní zlomit v&nbsp;penaltě 110, pak před ní zůstává pružná mezera. Pokud ale ke zlomu nedojde, pak se dvě za sebou jdoucí pružné mezery vyruší, takže v&nbsp;sazbě není žádná mezera. </p><p>Další možností je vložit mezi každé dva znaky v&nbsp;argumentu <code>\url</code> pružnou mezeru. To se dá udělat takto: </p><pre class='pr-3'><code>\addto\urlfont{\replacestrings{}{\nobreak\hskip0pt plus.05em minus.03em\relax}} 
</code></pre><p>Odeberete-li <code>\nobreak</code>, bude argument <code>\url</code> zlomitelný mezi každými dvěma znaky. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#urlbreakpoint' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0050</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2014-04-26'>26. 04. 2014</time></span> </footer></article>
                            </section>  <section id="kapitoly-sekce" class="mb-5 rounded my-shadow" style="background-color: #778c94">
                                <header class="text-center">
                                  <div class="py-2">
                                    <h2 class="d-inline text-light font-weight-light">Kapitoly, sekce</h2>
                                    <a href="#kapitoly-sekce"><i class="fas fa-link"></i></a>
                                  </div>
                                </header>
                                <article id='seccc' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Podpodsekce</h3> <a href='#seccc'><i class='fas fa-link'></i></a></div></header><section><p>Opmac nabízí jen třístupňovou hiearchii nadpisů: kapitoly, sekce a&nbsp;podsekce. Často se sektávám s&nbsp;požadavkem zařadit i&nbsp;možnost tisku podpodsekcí. Osobně to nepovažuji za příliš účelné a&nbsp;zbytečně to mate čtenáře. Ale je-li k&nbsp;tomu pádný důvod, můžete si vytvořit makro <code>\seccc</code> takto: </p><pre class='pr-3'><code>\newcount\secccnum 
 
\eoldef\seccc#1{% 
   \ifx\prevseccnum\theseccnum \global\advance\secccnum by1 
   \else \global\let\prevseccnum=\theseccnum \global\secccnum=1 
   \fi 
   \edef\thesecccnum{\theseccnum.\the\secccnum}% 
   \printseccc{#1}% 
} 
\def\printseccc#1{\norempenalty-100 \medskip 
   {\bf \noindent \thesecccnum\quad #1\nbpar}% 
   \nobreak \smallskip \firstnoindent 
} 
</code></pre><p>Makro řeší uvedený požadavek co nejjednodušším způsobem: zavádí číslování v&nbsp;registru <code>\secccnum</code> a&nbsp;tiskne ve fontu <code>\bf</code> (nezvětšená velikost). Neřeší dopravení informací do obsahu (tam je to stejně nevhodné) ani do záhlaví. Byl-li by takový požadavek, je potřeba využít makro <code>\wcontents</code> pro obsah a&nbsp;primitiv <code>\mark</code> pro záhlaví. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#seccc' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0055</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2014-05-11'>11. 05. 2014</time></span> </footer></article> <article id='notoc' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Zlom nadpisu v textu a v obsahu</h3> <a href='#notoc'><i class='fas fa-link'></i></a></div></header><section><p>V&nbsp;textu se doporučuje lámat dlouhé nadpisy kapitol, sekcí atd. pomocí příkazu <code>\nl</code>. Ten se v&nbsp;textu projeví jako zlom řádku a&nbsp;v obsahu se projeví jako obyčejná mezera. Někdy se ovšem může stát, že potřebujeme specifikovat i&nbsp;zlom nadpisu v&nbsp;obsahu. Pak je možné použít: </p><pre class='pr-3'><code>\let\NL=\nl  \addprotect\NL 
</code></pre><p>Nyní je k&nbsp;dispozici příkaz <code>\NL</code>, který způsobí zlom nadpisu v&nbsp;textu i&nbsp;obsahu zároveň. Ovšem je možné, že potřebujeme zlom jen v&nbsp;obsahu a&nbsp;ne v&nbsp;textu. Pak lze připravit makro <code>\toclonly{text}</code>, které zpracuje text jen v&nbsp;obsahu, zatímco v&nbsp;běžném textu se neprojeví. Píšeme třeba: </p><pre class='pr-3'><code>\sec Příliš\nl dlouhý\toconly\NL\ nadpis 
</code></pre><p>a&nbsp;v obsahu máme „Příliš dlouhý/nadpis“ zatímco v&nbsp;textu je „Příliš/dlouhý nadpis“. K&nbsp;tomu můžeme použít tento kód: </p><pre class='pr-3'><code>\let\NL=\nl  \addprotect\NL 
\def\toconly#1{} \addprotect\toconly 
\let\maketocori=\maketoc \def\maketoc{{\def\toconly##1{##1}\maketocori}} 
</code></pre><p>Makro <code>\toconly</code> implicitně nedělá nic, ale v&nbsp;obsahu je lokálně předefinováno. </p><p>Pokud nechcete, aby <code>\toconly</code> rozbořilo PDF záložky, použijte <code>\input pdfuni</code> nebo (xor) definujte <code>\def\cnvhook{\def\toconly##1{}}</code>. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#notoc' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0057</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2014-05-12'>12. 05. 2014</time></span> </footer></article> <article id='part' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Přidání další úrovně nadpisů včetně zařazení do obsahu</h3> <a href='#part'><i class='fas fa-link'></i></a></div></header><section><p>Vytvoříme makro <code>\part <text></code>, které bude vytvářet číslované části díla, jež jsou nadřazeny nad kapitoly. Při <code>\maketoc</code> se vytisknou do obsahu i&nbsp;informace o&nbsp;dělení knihy na části. </p><pre class='pr-3'><code>\newcount\partnum 
\def\part#1\par{% 
  \chaphook {\globaldefs=1 \chapnum=0 \secnum=0 \seccnum=0 \tnum=0 \fnum=0 \dnum=0}\relax 
  \edef\thepartnum{\the\partnum}\let\thetocnum=\thepartnum \xdef\tocilabel{\thepartnum}% 
  \vfil\break\null 
  \vskip3cm 
  \centerline{\typosize[15/18]\bf Part \uproman\partnum} 
  \wtotoc{-1}\bfshape{#1}\dest[toc:part.\thepartnum] 
  \tit #1\par 
  \vfil\break 
} 
\def\printpart#1{\vfil\break\null 
   \vskip3cm 
   \centerline{\typosize[15/18]\bf Part \uproman\partnum} 
   \tit #1\par 
   \vfil\break 
} 
\def\uproman#1{\uppercase\expandafter{\romannumeral#1}} 
\let\optocline=\tocline % original OPmac \tocline is saved. 
\def\tocline#1{\ifnum#1=-1 \let\next=\ptocline \else \def\next{\optocline{#1}}\fi \next} 
\def\ptocline#1#2#3#4{\medskip 
   \def\tocilabel{#2}% 
   \centerline{#1Part \uproman{#2}}\nobreak 
   \centerline{#1#3\unskip}\nobreak 
} 
\addto\maketoc{\def\tocilabel{}} 
</code></pre><p>Makro vkládá informace do obsahu pomocí <code>\wtotoc</code> (k dispozici od verze OPmac Apr. 2015). Následuje číslo úrovně nadpisu, kapitola má úroveň 0, sekce 1&nbsp;a podsekce 2. Při použití <code>\part</code> tedy vkládáme údaj -1. Dále je zde upraveno makro <code>\tocline</code>, které při úrovni 0&nbsp;a více spustí originální <code>\tocline</code>, zatíco při úrovni -1 se spustí <code>\ptocline</code>, které vloží dva řádky do obsahu. Makro <code>\part</code> rovněž nastaví interní lejblík <code>\tocilabel</code>, aby byly odlišeny části obsahu pro jednotlivé části při použití <code>\hyperlinks</code>. Samotná čísla kapitol totiž v&nbsp;jednotlivých částech nezaručují unikátnost hyperlinkového lejblíku. </p><p>Pokud chceme, aby <code>\part</code> fungoval i&nbsp;při <code>\outlines</code>, je třeba ještě vyvinout další úsilí: </p><pre class='pr-3'><code>\let\outlinesAA=\outlinesA 
\def\outlinesA#1{\ifnum#1=-1 \def\next{}\else \def\next{\outlinesAA{#1}}\fi \next} 
\let\outlinesBB=\outlinesB 
\def\outlinesB#1{\ifnum#1=-1 \def\next{\outlinesBp}\else \def\next{\outlinesBB{#1}}\fi \next} 
\def\outlinesBp#1#2#3#4{\def\tocilabel{#2}% 
   \pdfoutline goto name{toc:part.#2} count 0 {PART: #3}\relax 
} 
</code></pre></section><footer class='text-right'><a href='opmac-tricks-e.html#part' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0099</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2015-04-15'>15. 04. 2015</time></span> </footer></article> <article id='notopins' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Úvodní stránka kapitoly neobsahuje \topinsert</h3> <a href='#notopins'><i class='fas fa-link'></i></a></div></header><section><p>Při užití <code>\topinsert ...\endinsert</code> bychom chtěli vyloučit umístění obrázku či tabulky na první stránku kapitoly, tedy nad nadpis kapitoly. To lze provést poměrně snadno vložením následujících řádků na začátek dokumentu: </p><pre class='pr-3'><code>\addto\chaphook{\global\dimen\topins=0pt } 
\addto\endoutput{\global\dimen\topins=\vsize} 
</code></pre></section><footer class='text-right'><a href='opmac-tricks-e.html#notopins' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0135</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2015-12-21'>21. 12. 2015</time></span> </footer></article> <article id='globnonum' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Nastavení \nonum pro všechny kapitoly a sekce</h3> <a href='#globnonum'><i class='fas fa-link'></i></a></div></header><section><p>Nechcete psát <code>\nonum</code> před každou <code>\chap</code>, <code>\sec</code> a&nbsp;<code>\secc</code> a&nbsp;chcete svou vůli deklarovat jedinkrát na začátku dokumentu. V&nbsp;takovém případě lze psát: </p><pre class='pr-3'><code>\nonum \def\nonumfalse{\pagedepth=\pagedepth} 
</code></pre><p>Trik spočívá v&nbsp;tom, že je zneplatněno makro <code>\nonumfalse</code>, které přestane vracet logickou hodnotu <code>\ifnonum</code> na false. Makru <code>\nonumfalse</code> předchází v&nbsp;místě jeho užití v&nbsp;makrech OPmac prefix <code>\global</code>, takže potřebujeme tento prefix uspokojit nějakým přiřazením. Zvolil jsem přiřazení registru <code>\pagedepth</code>, který je globální sám o&nbsp;sobě, takže výše uvedené přiřazení opravdu neudělá vůbec nic. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#globnonum' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0142</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2016-04-10'>10. 04. 2016</time></span> </footer></article>
                            </section>  <section id="pracovni-soubor" class="mb-5 rounded my-shadow" style="background-color: #778c94">
                                <header class="text-center">
                                  <div class="py-2">
                                    <h2 class="d-inline text-light font-weight-light">Pracovní soubor</h2>
                                    <a href="#pracovni-soubor"><i class="fas fa-link"></i></a>
                                  </div>
                                </header>
                                <article id='refconsistent' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Kontrola konzistence REF souboru</h3> <a href='#refconsistent'><i class='fas fa-link'></i></a></div></header><section><p>Výjimečně se může stát, že změny v&nbsp;textech odkazů mohou změnit stránkování a&nbsp;tato změna stránkování změní po dalším průchodu TeXem texty odkazů. Přitom i&nbsp;po opakovaném TeXování se sazba neustálí na konečné podobě. Nelze snadno a&nbsp;univerzálně tento problém vyřešit, ale je možné na něj aspoň uživatele upozornit. Uživatel si pak může uložit dva po sobě jdoucí obsahy REF souborů a&nbsp;porovnat je třeba pomocí diff. Na základě toho zjistí, kde je problém a&nbsp;pokusí se to řešit manuálně. </p><p>OPmac neimplementuje upozornění na nekonzistenci REF souborů po dvou za sebou jdoucích průchodech. Je to ovšem možné doprogramovat tímto kódem: </p><pre class='pr-3'><code>\let\Xend=\relax 
\long\def\readREFcontents #1\Xend{\def\REFcontents{#1}} 
\openin0=\jobname.ref 
\ifeof0 \def\REFcontents{} 
\else \expandafter \readREFcontents \input \jobname.ref 
\fi 
 
\input opmac 
 
\let\endprimitive=\end 
\def\end{% 
   \ifx\wref\wrefrelax \else 
      \vfil\break 
      \immediate\write\reffile{\string\Xend} 
      \immediate\closeout\reffile 
      \let\tmpa=\REFcontents 
      \expandafter \readREFcontents \input \jobname.ref 
      \ifx\tmpa\REFcontents \message{Congratulations, references are consistent} 
      \else                 \opwarning{Inconsistent REF file, TeX me again} 
   \fi\fi 
   \endprimitive 
} 
</code></pre><p>V&nbsp;tomto makru na začátku uložíme do <code>\REFcontents</code> kompletní obsah REF souboru z&nbsp;předchozího běhu. To je potřeba učinit ještě před <code>\input opmac</code>, protože OPmac nám REF soubor přemaže. Dále na konci zpracování dokumentu (předefinováním <code>\end</code>) proběhne kontrola, zda obsah REF souboru zůstal stejný, jako na začátku. REF soubor je v&nbsp;obou případech čten makrem <code>\readREFcontents</code>, které očekává na konci souboru zarážku <code>\Xend</code>. Proto je tato zarážka do souboru na konci zpracování vložena. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#refconsistent' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0045</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2014-04-05'>05. 04. 2014</time></span> </footer></article> <article id='qrcode' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Data QR kódu v REF souboru</h3> <a href='#qrcode'><i class='fas fa-link'></i></a></div></header><section><p><img src='img/qrkuk.png' alt='QRcode' title='QRcode' class='img-fluid rounded mx-auto my-2 d-block'> </p><p>Pro tvorbu QR kódů je možné použít balíček <a href='ftp/olsak/makra/qrcode.tex' title='qrcode.tex'>qrcode.tex</a> pro plainTeX, který je dostupný <a href='http://petr.olsak.net/ftp/olsak/makra/' title='zde'>zde</a>. Tento balíček sice ukládá výsledek výpočtu QR kódu do makra <code>\qrdata</code> k&nbsp;rychlému opakovanému použití, ale tyto údaje nejsou uloženy do pracovního souboru. Použít při dalším běhu TeXu už jednou předpočítaná data výrazně urychlí zpracování dokumentu, protože výpočet QR kódu zabere jistý výpočetní čas. Ukážeme, jak k&nbsp;tomu účelu využít REF soubor. </p><p>Makro <code>\qrcode</code> z&nbsp;<code>qrcode.tex</code> obsahuje (implicitně prázdná) „hook“ makra <code>\qrbeginhook</code> a&nbsp;<code>\qrendhook</code>, která definujeme tak, aby se do REF souboru ukládala informace o&nbsp;QR kódu ve tvaru: </p><pre class='pr-3'><code>\Xqrdata{kódovaný-text}{velikost}{11111110111110...0010111001} 
</code></pre><p>kde <code>velikost</code> a&nbsp;jedničky a&nbsp;nuly jsou údaje z&nbsp;<code>\qrdata</code> vypočteného QR kódu. Dále je třeba před <code>\input opmac</code> definovat <code>\Xqrdata</code>, které definuje řídicí sekvenci <code>\qr:kódovaný-text</code> tak, že obsahuje vypočtená data. Konečně je potřeba modifikovat chování makra <code>\qrcode</code> tak, aby v&nbsp;případě, že existuje již definovaná řídicí sekvence <code>\qr:kódovaný-text</code>, tak ji využije a&nbsp;nepočítá QR kód znovu. Makra mohou vypadat takto: </p><pre class='pr-3'><code>\def\Xqrdata{\bgroup\qrverbatim\XqrdataA} 
\def\XqrdataA#1#2#3{\sxdef{qr:#1}{{#2}{#3}}\egroup} 
\input qrcode 
\input opmac 
 
\openref 
\def\qrendhook{% 
   \qrmessage{&lt;Saving calculated QR code...}% 
      \sxdef{qr:\qretext\expandafter}{\qrdata}% 
      \toks0=\expandafter{\qrtext}% 
      \immediate\wref\Xqrdata{{\the\toks0}\qrdata}% 
   \qrmessage{done&gt;^^J}% 
} 
\def\qrbeginhook#1\qrendhook{% 
   \expandafter \ifx \csname qr:\qretext\endcsname \relax 
      #1%                  %%% do calculation 
   \else 
      \qrmessage{&lt;Restoring QR code from saved \string\qrdata...}% 
         \global\expandafter\let \expandafter\qrdata \csname qr:\qretext\endcsname 
         \qrrestore\qrdata %%% printing QR code from saved data 
      \qrmessage{done&gt;^^J}% 
   \fi 
   \qrendhook 
} 
</code></pre><p>Poznamenejme, že na pořadí záleží. Nejprve je třeba definovat <code>\Xqrdata</code>, pak provést <code>\input qrcode</code> dřív než <code>\input opmac</code> a&nbsp;nakonec definovat “hooks”. Poté může následovat dokument s&nbsp;QR kódy. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#qrcode' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0116</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2015-07-02'>02. 07. 2015</time></span> </footer></article>
                            </section>  <section id="vyznacovani" class="mb-5 rounded my-shadow" style="background-color: #778c94">
                                <header class="text-center">
                                  <div class="py-2">
                                    <h2 class="d-inline text-light font-weight-light">Vyznačování</h2>
                                    <a href="#vyznacovani"><i class="fas fa-link"></i></a>
                                  </div>
                                </header>
                                <article id='soul' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Podtržení, přeškrtnutí, prostrkání</h3> <a href='#soul'><i class='fas fa-link'></i></a></div></header><section><p>Implementujeme makro <code>\ul{tady je text}</code>, které vytvoří podtržený nebo přeškrtnutý text. Přidáme také makro <code>\ltsp{tady je text}</code>, které vytvoří prostrkaný text. Vlastnosti rozsáhlého balíčku <code>soul.sty</code> vměstnáme do deseti řádků kódu za cenu toho, že naše makro bude umět rozdělit text jen v&nbsp;mezislovních mezerách a&nbsp;pokud bychom chtěli rozdělit slovo, je potřeba makru napovědět <code>\ul{ta\-ko\-vým způ\-so\-bem}</code>. Následující trik 0065 ukazuje, jak vyhledat tato místa pro dělení slov automaticky. </p><pre class='pr-3'><code>\def\ul#1{{\ulRedefine\leavevmode\wordscanA #1 {} }} 
\def\wordscanA#1 {\ifx^#1^\unskip\else \wordscanB#1\-\end \expandafter\wordscanA\fi} 
\def\wordscanB#1\-#2\end{\ifx^#2^\wordprintA{#1}\else 
   \wordprintB{#1}\def\next{\wordscanB#2\end}\expandafter\next\fi} 
\def\wordprintA#1{\setbox0=\hbox{#1}\hbox{\rlap{\copy0}\uline\wd0}\uline\uspace\relax} 
\def\wordprintB#1{\setbox0=\hbox{#1}\hbox{\rlap{\copy0}\uline\wd0}\-} 
\def\uline{\leaders \vrule height-1.9pt depth2.3pt\hskip} 
\def\uspace{\fontdimen2\font plus\fontdimen3\font minus\fontdimen4\font} 
\def\ulRedefine{\def~{\egroup\hbox{\rlap{\copy0}\uline\wd0}\nobreak\uline\uspace\relax 
         \setbox0=\hbox\bgroup}} 
</code></pre><p>Makro spouští opakovaně <code>\wordscanA</code> na jednotlivá slova a&nbsp;pomocí <code>\wordscanB</code> tato slova rozdělí na části vyznačené <code>ta\-ko\-vým způ\-so\-bem</code>. Celé slovo nebo jeho koncovou část pak tiskne pomocí <code>\wordprintA</code> zatímco část ukončenou znakem <code>\-</code> tiskne pomocí <code>\printwordB</code>. Definováním makra <code>\uline</code> nastavíme výšku a&nbsp;tloušťku podtrhávací nebo přeškrtávací čáry. V&nbsp;příkladu je čára podtrhávací začínající 1,9pt pod účařím a&nbsp;mající tloušťku 0.4pt. V&nbsp;makru <code>\uspace</code> definujeme velikost mezislovní mezery včetně pružnosti. V&nbsp;příkladu přebíráme parametry běžné mezislovní mezery z&nbsp;příslušných <code>\fontdimen</code>. </p><p>Přítomnost vlnky jako nezlomitelné mezery v&nbsp;textu (např. <code>\ul{v~textu}</code>) je ošetřena poněkud trikoidním kódem v&nbsp;<code>\ulRedefine</code>. Jinak totiž má tato nezlomitelná mezera Wordoidní vlastnost, tj. nepruží. To by bylo samozřejmě špatně. </p><p>Makro <code>\ltps{prostrkaný text}</code> pracuje se stejnými makry <code>\wordscanA</code> a&nbsp;<code>\wordscanB</code>, ale jinak definuje <code>\printscanA</code> a&nbsp;<code>\printscanB</code>. Tato makra rozeberou slova nebo jejich části na jednotlivá písmena. Makro pracuje s&nbsp;dimen registry <code>\ltspA</code>, <code>\ltspB</code> a&nbsp;<code>\ltspC</code>. jejich význam je uveden níže v&nbsp;komentářích. </p><pre class='pr-3'><code>\def\ltsp#1{\ifhmode\hskip\ltspA \else\leavevmode\fi \wordscanA #1 {} \hskip\ltspA} 
\def\wordscanA#1 {\ifx^#1^\unskip\else \wordscanB#1\-\end \expandafter\wordscanA\fi} 
\def\wordscanB#1\-#2\end{\ifx^#2^\wordprintA{#1}\else 
   \wordprintB{#1}\def\next{\wordscanB#2\end}\expandafter\next\fi} 
\def\wordprintA#1{\letterspaceA #1{}\unskip\unpenalty\hskip\ltspB} 
\def\wordprintB#1{\letterspaceA #1{}\-} 
\def\letterspaceA#1{\if^#1^\else\hbox{#1}\nobreak\hskip\ltspC \expandafter\letterspaceA\fi} 
 
\newskip\ltspA \ltspA=6pt   % mezera vložená na začátek prostrkaného textu 
\newskip\ltspB \ltspB=5pt plus2pt minus1pt  % mezislovní mezera 
\newskip\ltspC \ltspC=2pt   % mezera mezi písmeny. 
</code></pre></section><footer class='text-right'><a href='opmac-tricks-e.html#soul' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0063</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2014-06-06'>06. 06. 2014</time></span> </footer></article> <article id='hyphprocess' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Vyhledání míst pro dělení slov ve slově</h3> <a href='#hyphprocess'><i class='fas fa-link'></i></a></div></header><section><p>Vytvoříme makro <code>\hyphenprocess{slovo}</code>, které vrátí parametr v&nbsp;makru <code>\listwparts</code> ve tvaru <code>slo\-vo</code> podle aktuálního nastavení dělení slov. </p><pre class='pr-3'><code>\newdimen\hyphdim 
\let\hyphentt=\tentt  \hyphdim=\fontdimen6\hyphentt \divide\hyphdim by2 
 
\def\hyphenprocess#1{\def\tmp{#1}\let\listwparts=\undefined 
   \setbox0=\vbox\bgroup\hyphenpenalty=-10000 \hsize=0pt \hfuzz=\maxdimen 
      \edef\hychar{\hyphenchar\hyphentt=\the\hyphenchar\hyphentt}\hyphenchar\hyphentt=45 
      \def~{\nobreak\hskip.5em\relax}\tt\noindent\hskip0pt\relax #1\par \hychar 
      \hyphenprocessA 
   \expandafter\let\expandafter\listwparts\expandafter\empty 
      \expandafter\hyphenprocessB\listwparts 
} 
\def\hyphenprocessA{\setbox2=\lastbox 
   \ifvoid2 \egroup \else \unskip \unpenalty 
      \setbox2=\hbox{\unhbox2}% 
      \tmpnum=\wd2 \advance\tmpnum by100 \divide\tmpnum by\hyphdim 
      \ifx\listwparts\undefined \xdef\listwparts{,}% 
      \else \advance\tmpnum by-1 \xdef\listwparts{\the\tmpnum,\listwparts}\fi 
              \expandafter\hyphenprocessA \fi 
} 
\def\hyphenprocessB#1,{\if^#1^\expandafter\hyphenprocessC 
   \else \tmpnum=#1 \expandafter\hyphenprocessD\tmp\end 
   \fi 
} 
\def\hyphenprocessC{\expandafter\addto\expandafter\listwparts\expandafter{\tmp}} 
\def\hyphenprocessD#1#2\end{\addto\listwparts{#1}% 
   \advance\tmpnum by-1 
   \ifnum\tmpnum&gt;0 \def\next{\hyphenprocessD#2\end}% 
   \else 
   \def\tmp{#2}\def\next{\addto\listwparts{\-}\expandafter\hyphenprocessB}\fi 
   \next 
} 
</code></pre><p>Makro si rozlomí slovo v&nbsp;pracovním <code>\vboxu</code> ve fontu <code>\hyphentta</code> pak v&nbsp;makru <code>\hyphenprocessA</code> posbírá boxy, proměří je a&nbsp;na základě toho rozpozná, z&nbsp;kolika písmen se skládají. Do <code>\listsparts</code> uloží počty písmen jednotlivých úseků, takže například pro slovo „rozdělení“ uloží do <code>\listwparts</code> čísla <code>3,2,,</code>. Povšimněte si, že číslo pro poslední úsek záměrně chybí, protože je nebudeme potřebovat. Makra <code>\hyphenprocessB</code>, <code>C</code> a&nbsp;<code>D</code> s&nbsp;těmito údaji pracují a&nbsp;sbírají z&nbsp;<code>\tmp</code> (kde je slovo uloženo) patřičný počet písmenek a&nbsp;přemisťují je do <code>\listwparts</code>. Mezi jednotlivé úseky vkládají znak <code>\-</code>. </p><p>Makro <code>\ul</code> nebo <code>\ltsp</code> z&nbsp;předchozího příkladu 0063 můžeme nyní snadno vylepšit, aby automaticky našlo dělení slov. Stačí předefinovat interní makro <code>\wordscanA</code> následovně: </p><pre class='pr-3'><code>\def\wordscanA#1 {\ifx^#1^\unskip\else 
   \hyphenprocess{#1}\expandafter\wordscanB\listwparts\-\end \expandafter\wordscanA\fi} 
</code></pre></section><footer class='text-right'><a href='opmac-tricks-e.html#hyphprocess' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0065</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2014-06-07'>07. 06. 2014</time></span> </footer></article> <article id='coltext' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Podbarvený text</h3> <a href='#coltext'><i class='fas fa-link'></i></a></div></header><section><p>Přímo v&nbsp;dokumentaci k&nbsp;OPmac je ukázka, jak vytvořit makro, které vysází text podbarvený specifikovanou barvou. Ovšem toto makro vytvoří text jako nezlomitelný box. V&nbsp;následujícím triku ukážeme makro <code>\coltext\BarvaA\BarvaB{text}</code>, které vytvoří uvnitř odstavce text v&nbsp;bavě <code>\BarvaA</code> podbarvený barvou <code>\BarvaB</code>, přitom tento text podléhá řádkovému zlomu jako běžný text v&nbsp;odstavci. Například: </p><pre class='pr-3'><code>Zde je běžný text odstavce. 
\coltext\Yellow\Blue{Tady je podbarvený textík, který se láme do řádků.} 
A pokračujeme v běžném textu odstavce. 
</code></pre><p>vytvoří: </p><p><img src='img/coltext.png' alt='Ukázka podbarveného textu' title='Ukázka podbarveného textu' class='img-fluid rounded mx-auto my-2 d-block'> </p><p>Makro je mírnou modifikací makra <code>\ul</code> z&nbsp;OPmac triku <a href='#soul' title='0063'>0063</a>, přitom využívá makro <code>\hyphenprocess</code> z&nbsp;OPmac triku <a href='#hyphprocess' title='0064'>0064</a>. </p><pre class='pr-3'><code>\def\coltextstrut{height2ex depth.6ex} 
\def\coltext#1#2#3{{\localcolor\let\Tcolor=#1\let\Bcolor=#2\relax 
   \setbox1=\hbox{-\kern.05em}% 
   \setbox1=\hbox{{\Bcolor\vrule\coltextstrut width\wd1}\kern-.05em\llap{\Tcolor -}}% 
   \def\-{\discretionary{\copy1}{}{}}% 
   \def\uline##1{\skip0=##1\advance\skip0 by.05em 
      \Bcolor\leaders \vrule\coltextstrut\hskip\skip0 \hskip-.05em\relax}% 
   \def\uspace{\fontdimen2\font plus\fontdimen3\font minus\fontdimen4\font}% 
   \def~{\egroup\hbox{\uline{\wd0}\llap{\Tcolor\copy0}}\nobreak{\uline\uspace}\relax \setbox0=\hbox\bgroup}% 
   \leavevmode\coltextA #3 {} }} 
\def\coltextA#1 {\ifx^#1^\unskip\unskip\else 
   \hyphenprocess{#1}\expandafter\coltextB\listwparts\-\end 
\expandafter\coltextA\fi} 
\def\coltextB#1\-#2\end{\ifx^#2^\coltextC{#1}\else 
   \coltextD{#1}\def\next{\coltextB#2\end}\expandafter\next\fi} 
\def\coltextC#1{\setbox0=\hbox{#1}\hbox{\uline{\wd0}\hbox{\llap{\Tcolor\copy0}}}\uline\uspace\relax} 
\def\coltextD#1{\setbox0=\hbox{#1}\hbox{\uline{\wd0}\llap{\Tcolor\copy0}}\-} 
</code></pre><p>Na rozdíl od makra <code>\ul</code> zde sázíme „přeškrtnutí a&nbsp;text“ v&nbsp;opačném pořadí, tj. nejprve „přeškrtnutí“ a&nbsp;potom „text“. Přitom „přeškrtnutí“ má nyní výšku a&nbsp;hloubku danou makrem <code>\coltextstrut</code>, tedy je natolik široké, že vytvoří podbarvení. V&nbsp;úvodu makra <code>\coltext</code> je také v&nbsp;odpovídajících barvách připraven <code>\hyphenchar</code> jako <code>\box1</code>. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#coltext' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0085</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2015-01-05'>05. 01. 2015</time></span> </footer></article> <article id='specline' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Čára v okraji vyznačující text</h3> <a href='#specline'><i class='fas fa-link'></i></a></div></header><section><p>Uživatel uzavře vyznačovaný text pomocí <code>\beginspec...\endspec</code>. Začátek textu může být někde uvnitř odstavce a&nbsp;konec třeba v&nbsp;dalším odstavci. Makro vytvoří v&nbsp;pravém okraji čáru začínající ve výšce prvního slova vyznačeného textu a&nbsp;končící ve výšce posledního slova vyznačeného textu. </p><p>Implementace se opírá o&nbsp;pdfTeXový primitivní příkaz <code>\pdfsavepos</code> a&nbsp;využívá REF soubor ke zjištění polohy začínajícího a&nbsp;končícího slova. Takže čáry se stabilizují ve správné poloze až po druhém běhu TeXu. Implementace vypadá takto: </p><pre class='pr-3'><code>\def\preparespec#1{\expandafter\ifx \csname spec:#1\endcsname \relax \sdef{spec:#1}{}\fi} 
\def\XspecB#1{\preparespec{\the\lastpage} 
    \expandafter\addto\csname spec:\the\lastpage\endcsname{,\specdraw{#1}}} 
\def\XspecE#1{\preparespec{\the\lastpage} 
    \expandafter\addto\csname spec:\the\lastpage\endcsname{{#1}}} 
 
\input opmac % načtení OPmac musí proběhnout až po definici \XspecB a \XspecE 
 
\newif\ifspecenv \specenvfalse 
\def\beginspec{\ifspecenv \opwarning{\noexpand\beginspec inside spec environment, ignored}% 
   \else \global\specenvtrue \openref 
      \ifvmode \pdfsavepos \else \vbox to0pt{\vss\pdfsavepos\kern\ht\strutbox}\fi 
      \wref\XspecB{{\the\pdflastypos}}\fi 
} 
\def\endspec{\ifspecenv \global\specenvfalse 
      \ifvmode \pdsavepos \else\vbox to0pt{\kern\dp\strutbox\pdfsavepos\vss}\fi 
      \wref\XspecE{{\the\pdflastypos}}% 
   \else \opwarning{\noexpand\endspec outside spec environment, ignored}\fi 
} 
\def\prepghook{\moveright\hsize\vbox to0pt{\preparespec{\the\pageno} 
   \expandafter\expandafter\expandafter 
   \specdrawB\csname spec:\the\pageno\endcsname \botypos\relax}\nointerlineskip 
} 
\def\specdraw#1#2#3{\moveright 5pt\vbox to0pt{ 
   \tmpnum=\topypos \advance\tmpnum by-#1 \kern\tmpnum sp 
   \tmpnum=-#2 \advance\tmpnum by#1 \hrule height\tmpnum sp width 2pt \vss}\nointerlineskip 
   \ifx#3\relax \global\let\specdrawB=\specdrawBrun \fi 
} 
\def\specdrawB#1{} 
\def\specdrawBrun#1#2{\gdef\specdrawB##1{}\specdraw{\topypos}{#1}{#2}} 
 
\tmpdim=\pdfpageheight \advance\tmpdim by-1in \advance\tmpdim by-\voffset \edef\topypos{\number\tmpdim} 
\advance\tmpdim by-\vsize \advance \tmpdim by-\dp\strutbox \edef\botypos{\number\tmpdim} 
</code></pre><p>Makra <code>\XspecB{od}</code> a&nbsp;<code>\XspecE{do}</code> uloží během načtení REF souboru údaje do maker <code>\spec:pageno</code> (pageno je číslo příslušné strany) a&nbsp;jsou tam ve tvaru: </p><pre class='pr-3'><code>,\specdraw{od}{do},\specdraw{od}{do},\specdraw{od}{do} 
</code></pre><p>V&nbsp;tomto tvaru je použije výstupní rutina v&nbsp;<code>\prepghook</code>: Spustí <code>\specdrawB</code> následovaný expandovaným <code>\spec:pagen</code>o&nbsp;následovaný dalšími dvěma tokeny <code>\botypos\relax</code>. Přitom <code>\specdrawB</code> typicky pouze ignoruje první čárku a&nbsp;<code>\specdraw</code> přečte <code>{od}</code> a&nbsp;<code>{do}</code> a&nbsp;následující token, který typicky rovněž ignoruje (tj. ignoruje následující čárku nebo token <code>\botypos</code>). Dále <code>\specdraw</code> nakreslí čáru <code>{od}--{do}</code>. </p><p>Zajímavá je situace, kdy čára na příslušné straně není uzavřena. Pak chybí údaj <code>{do}</code> a&nbsp;místo něj <code>\specdraw</code> načte <code>\botypos</code>, tj. polohu spodní hrany stránky. Třetí ignorovaný parametr je pak <code>\relax</code> a&nbsp;v takovém případě <code>\specdraw</code> předefinuje <code>\specdrawB</code> pro následující stranu jako <code>\specdrawBrun</code>, aby tam čára mohla pokračovat. Za domácí cvičení prostudujte definici <code>\specdrawBrun</code> a&nbsp;rozmyslete si, že makro funguje i&nbsp;pro případy, kdy <code>\spec:pageno</code> je prázdná a&nbsp;<code>\specdrawB</code> pracuje v&nbsp;původním významu (žádná čára na stránce) nebo ve významu <code>\specdrawBrun</code> (čára na stránce odshora dolů). </p><p>Další domácí úkol: modifikujte makro tak, aby vytvářelo barevné rámečky pod textem (užití <code>\beginspec</code> a&nbsp;<code>\endspec</code> se v&nbsp;tomto případě předpokládá ve vertikáním módu mezi odstavci). </p></section><footer class='text-right'><a href='opmac-tricks-e.html#specline' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0128</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2015-11-04'>04. 11. 2015</time></span> </footer></article>
                            </section>  <section id="makro-premety" class="mb-5 rounded my-shadow" style="background-color: #778c94">
                                <header class="text-center">
                                  <div class="py-2">
                                    <h2 class="d-inline text-light font-weight-light">Makro přemety</h2>
                                    <a href="#makro-premety"><i class="fas fa-link"></i></a>
                                  </div>
                                </header>
                                <article id='replacestrings' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Využití \replacestrings</h3> <a href='#replacestrings'><i class='fas fa-link'></i></a></div></header><section><p>OPmac disponuje makrem <code>\replacestrings</code>, které používá v&nbsp;makru <code>\url</code>. Makro <code>\replacestrings</code> v&nbsp;přechodném bufferu <code>\tmpb</code> vymění stringy za jiné stringy. Toto makro jsem využil, když jsem potřeboval v&nbsp;šabloně CTUStyle vygenerovat genitiv (tj. druhý pád) fakulty. Fakultu napíše student jen jako značku F1 až F8 do <code>\toks</code> stringu <code>\faculty</code>. Tedy například napíše <code>\faculty{F3}</code>. Pomocí <code>\mtext</code> je tato značka konvertovaná na název fakulty dle právě aktuálního jazyka. Když je tímto jazykem čeština, objeví se název fakulty v&nbsp;prvním pádě. Někdy ale potřebujeme jej ohnout do genitivu. Použil jsem následující kód: </p><pre class='pr-3'><code>\def\facultygenitiv{\edef\tmpb{\mtext{\the\faculty} }% 
   \replacestrings{ulta }{ulty }% 
   \replacestrings{á }{é }% 
   \tmpb} 
</code></pre><p>Když je například <code>\faculty{F4}</code> a&nbsp;jazyk český, pak se <code>\mtext{\the\faculty}</code> expanduje na „Fakulta jaderná a&nbsp;fyzikálně inženýrská“. Při použití makra <code>\facultygenitiv</code> přitom dostanu „Fakulty jaderné a&nbsp;fyzikálně inženýrské“. Pomocí výše uvedených čtyř řádků jsem schopen převést do genitivu všech osm fakult ČVUT. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#replacestrings' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0060</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2014-05-15'>15. 05. 2014</time></span> </footer></article> <article id='argofvector' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Výpočet směru vektoru</h3> <a href='#argofvector'><i class='fas fa-link'></i></a></div></header><section><p>Je dán vektor v&nbsp;rovině a&nbsp;je třeba najít úhel mezi tímto vektorem a&nbsp;osou <code>x</code> ve stupních. Je to potřebné, když chceme například otočit nějaký grafický prvek (např. hrot šipky) dle požadovaného směru. Vytvoříme makro </p><pre class='pr-3'><code>\calculateargofvector (X0 Y0) (X Y)  % (X0 Y0) je počátek vektoru, (X Y) konec 
například 
\calculateargofvector (0 0) (2 3) 
\calculateargofvector (1.1 2.7) (-4.7 6.3) 
</code></pre><p>které vrátí výsledek v&nbsp;makru <code>\argofvector</code>. Protože TeX nedisponuje interně implementovanými funkcemi pro odmocninu a&nbsp;<code>arccos</code>, je makro poněkud náročnější. </p><pre class='pr-3'><code>\newdimen\dimX  \newdimen\dimY 
 
\def\processatan #1 {\tmpdim=\ifx\relax#1\maxdimen \else.#1pt\fi\relax 
   \ifdim\dimY&lt;\tmpdim\expandafter\processatanE 
   \else \advance\tmpnum by1 \def\tmp{#1}\expandafter \processatan \fi} 
\def\processatanE #1\relax{} 
 
\def\calculateargofvector (#1 #2) (#3 #4){\def\tmp{0}\tmpnum=0 
   \dimX=#3pt \advance\dimX by-#1pt \dimY=#4pt \advance\dimY by-#2pt 
   \ifdim\dimX=0pt \ifdim\dimY=0pt \dimX=1pt \dimY=0pt \fi \fi 
   \ifdim\dimY&lt;0pt \dimY=-\dimY \dimX=-\dimX \advance\tmpnum by180 \fi 
   \ifdim\dimX&lt;0pt \tmpdim=\dimX \dimX=\dimY \dimY=-\tmpdim \advance\tmpnum by90 \fi 
   \ifdim\dimY&gt;\dimX \tmpdim=\dimX \advance\tmpdim by\dimY 
                   \advance\dimY by-\dimX \dimX=\tmpdim \advance\tmpnum by45 \fi 
   \ifdim\dimX&lt;63pt \multiply\dimX by256 \multiply\dimY by256 
   \else \ifdim\dimX&lt;1023pt \multiply\dimX by16 \multiply\dimY by16 \fi\fi 
   \divide\dimX by256 \divide\dimY by\dimX \multiply\dimY by256 
   \processatan 017 035 052 07 087 105 123 14 158 176 194 21 23 25 268 287 306 325 344 364 
                384 404 424 445 466 488 51 532 554 577 6 625 649 675 7 727 754 781 81 839 
                869 9 932 966 99999 {\relax} \relax 
   \edef\argofvector{\the\tmpnum}% 
   \ifdim\tmpdim=\maxdimen \tmpnum=0 \else 
      \advance\tmpdim by-.\tmp pt \advance\dimY by-.\tmp pt \multiply\dimY by10 
      \tmpnum=\dimY \divide\tmpnum by\tmpdim 
   \fi 
   \ifnum\tmpnum&gt;0 \edef\argofvector{\argofvector.\the\tmpnum}\fi 
} 
</code></pre><p>V&nbsp;prvé části výpočtu otočíme vektor případně o&nbsp;180 a&nbsp;90 stupňů, abychom jej dostali do prvého kvadrantu. Otočení ve stupních přičítáme k&nbsp;výsledku v&nbsp;<code>\tmpnum</code>. Dále vektor otočíme do první půle kvadrantu o&nbsp;45 stupňů, pokud tam již není. Při tomto otočení se změní jeho velikost, což nám nevadí, protože hned dalším krokem je normalizace vektoru tak, že má souřadnici X&nbsp;rovnou jedné. Tj. souřadnice <code>Y</code> je rovna tangentě hledaného úhlu. Za makrem <code>\processatan</code> jsou napsány tangenty úhlů 1, 2, 3&nbsp;až 45 a&nbsp;toto makro cyklem najde odpovídající úhlel a&nbsp;zbylá data až po <code>\relax</code> přeskočí. V&nbsp;závěru je výpočet desetiny úhlu lineární aproximací v&nbsp;intervalu <code>tg(n)--tg(n+1)</code>. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#argofvector' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0061</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2014-05-24'>24. 05. 2014</time></span> </footer></article> <article id='optdef' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Definování makra s nepovinným parametrem</h3> <a href='#optdef'><i class='fas fa-link'></i></a></div></header><section><p>Budeme chtít definovat <code>\makro</code> s&nbsp;dvojím využitím: </p><pre class='pr-3'><code>\makro parametry 
nebo 
\makro [optional] parametry 
</code></pre><p>K&nbsp;tomu účelu definujeme <code>\optdef</code>, což se použije třeba takto: </p><pre class='pr-3'><code>\optdef\makro [default] #1 #2 {opt=\opt, 1=#1, 2=#2.} 
 
\makro prvni druhy        ... expanduje na: opt=default, 1=prvni, 2=druhy. 
\makro [kuk] treti ctvrty ... expanduje na: opt=kuk, 1=treti, 2=ctvrty. 
</code></pre><p>Například je možné předefinovat kapitoly, sekce a&nbsp;podsekce, aby bylo možné zadat lejblík jako nepovinný parametr: </p><pre class='pr-3'><code>\let\chapOri=\chap  \let\secOri=\sec   \let\seccOri=\secc 
\optdef\chap [] {\ifx\opt\empty\else\label[\opt]\fi \chapOri} 
\optdef\sec  [] {\ifx\opt\empty\else\label[\opt]\fi \secOri} 
\optdef\secc [] {\ifx\opt\empty\else\label[\opt]\fi \seccOri} 
</code></pre><p>Makro <code>\optdef</code> může být definováno takto: </p><pre class='pr-3'><code>\def\optdef#1[#2]{% 
   \def#1{\def\opt{#2}\isnextchar[{\csname oA:\string#1\endcsname}{\csname oB:\string#1\endcsname}}% 
   \sdef{oA:\string#1}[##1]{\def\opt{##1}\csname oB:\string#1\nospaceafter\endcsname}% 
   \sdef{oB:\string#1\nospaceafter}% 
} 
\def\nospaceafter#1{\expandafter#1\romannumeral-`\.} 
</code></pre><p><code>\optdef</code> definuje <code>\makro</code> jako <code>\isnextchar[{\oA:\makro}{\oB:\makro}</code> a&nbsp;dále definuje <code>\oA:\makro[text]</code> jako <code>\def\opt{text}\oB:\makro</code> a&nbsp;konečně definuje <code>\oB:\makro</code> jako to, co napsal uživatel za <code>\opdef[text]</code>. Ignorování případné mezery za zavírací hranatou závorkou obstará příkaz <code>\rommannumeral-\.</code>, který expanduje na úplné nic, ale navíc při expanzi zkonzumuje případnou mezeru, která může následovat. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#optdef' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0067</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2014-06-12'>12. 06. 2014</time></span> </footer></article> <article id='noendspace' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Odstranění poslední mezery v parametru</h3> <a href='#noendspace'><i class='fas fa-link'></i></a></div></header><section><p>Například parametry příkazů <code>\chap</code>, <code>\sec</code> a&nbsp;<code>\secc</code> obvykle obsahují na svém konci mezeru, ale někdy taky ne. Například při <code>\sec Prokletý \LaTeX <prázný řádek></code> na konci parametru mezera není. OPmac řeší odstranění závěrečné mezery v&nbsp;těchto případech přidáním <code>\unskip</code>. Ovšem my bychom chtěli odstranit tuto závěrečnou případnou mezeru na úrovni maker. Přitom v&nbsp;parametru může být mezer více, nás zajímá jen ta na úplném konci. </p><p>Stačí si parametr uložit do <code>\tmpb</code> například pomocí <code>\def\tmpb{#1}</code> a&nbsp;dále provést: </p><pre class='pr-3'><code>\addto\tmpb\end \replacestrings{ \end}{}\replacestrings{\end}{} 
</code></pre><p>A&nbsp;nyní už <code>\tmpb</code> obsahuje parametr bez případné závěrečné mezery. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#noendspace' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0068</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2014-06-13'>13. 06. 2014</time></span> </footer></article> <article id='eoldef' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Makro s parametrem do konce řádku</h3> <a href='#eoldef'><i class='fas fa-link'></i></a></div></header><section><p>Makro <code>\eoldef</code> umožní definovat makro s&nbsp;jedním parametrem, který je separován koncem řádku. Například takto: </p><pre class='pr-3'><code>\eoldef\aha#1{\message{param: "#1"}} 
 
\aha tady je parametr 
a tu je další text. 
</code></pre><p>Vidíme, že pomocí <code>\eoldef</code> definujeme jakoby makro s&nbsp;neseparovaným parametrem, ale ono makro si vezme parametr až do konce řádku. V&nbsp;uvedeném příkladu si tedy do <code>#1</code> vezme text „tady je parametr“. </p><p>**Upozornění**. Od verze OPmac Apr. 2016 je makro <code>\eoldef</code> přímo součástí OPmac a&nbsp;pomocí <code>\eoldef</code> jsou definovány <code>\tit</code>, <code>\chap</code>, <code>\sec</code> a&nbsp;<code>\secc</code>. Změna není stoprocentně zpětně kompatibilní, ale přesto doufám, že výhody převáží nad nevýhodami. Odpadá třeba problém s&nbsp;případnou mezerou na konci parametru a&nbsp;dále problém uživatelů, napíšou-li <code>\sec</code> na poslední řádek souboru. Nevýhody: Chcete-li rozdělit titulek ve zdrojovém textu do více řádků, je třeba na konec pokračovacích řádků dát <code>%</code>. Pokud chcete použít <code>\sec</code> uvnitř vlastního makra, nelze psát <code>... \sec#1\par ...</code>, protože se objeví chybová hláška </p><pre class='pr-3'><code>! Paragraph ended before \eoldefA was complete. 
</code></pre><p>Je možné použít <code>\bracedparam</code> z&nbsp;OPmac triku <a href='#latexchap' title='0036'>0036</a> a&nbsp;psát ve svém makru třeba <code>... \bracedparam\sec{#1} ...</code> </p><p>Pokud chcete vypnout separaci koncem řádku a&nbsp;vrátit se k&nbsp;původní separaci parametru maker <code>\tit</code>, <code>\chap</code>, <code>\sec</code> a&nbsp;<code>\secc</code> prázdným řádkem, můžete použít: </p><pre class='pr-3'><code>\def\eoldefA{\endgroup\eoldefB} 
\def\eoldefB#1#2\par{\csname\string#1:M\endcsname{#2}} 
</code></pre></section><footer class='text-right'><a href='opmac-tricks-e.html#eoldef' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0121</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2015-08-14'>14. 08. 2015</time></span> </footer></article> <article id='keyval' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Slovníky tvaru klíč=hodnota</h3> <a href='#keyval'><i class='fas fa-link'></i></a></div></header><section><p>Umožníme zadávat údaje ve tvaru <code>klíčA=hodnotaA</code>, <code>klíčB=hodnotaB</code> atd., tj. čárkami oddělený seznam přiřazení. Makro <code>\kv{klíč}</code> pak expanduje na hodnotu nebo na <code>\kvunknown</code>, jestliže klíč nemá přidělenu hodnotu. Ke čtení seznamu přiřazení poslouží makro <code>\kvscan</code>, za kterým musí následovat seznam přiřazení ukončený čárkou, čárkou, rovnítkem, čárkou. Makra <code>\kv</code> a&nbsp;<code>\kvscan</code> využije programátor maker například takto </p><pre class='pr-3'><code>\def\mymacrodefault          {color={}, width=0.4pt} 
\optdef\mymacro [] {\bgroup 
   \expandafter \kvscan\mymacrodefault,,=,%  implicitni hodonty 
   \expandafter \kvscan\opt,,=,%  hodnoty dane uzivatelem 
   \if^\kv{color}^\else \localcolor \kv{color}\fi % nastaveni barvy 
   \let\vruleprimitive=\vrule 
   \def\vrule{\vruleprimitive width\kv{width}}% nastaveni sily car 
   ... 
   \egroup 
} 
</code></pre><p>Zde je navíc využito makro <code>\optdef</code> z&nbsp;triku <a href='#optdef' title='0067'>0067</a>. Uživatel pak může psát <code>\mymacro</code> bez parametrů, nebo třeba <code>\mymacro[width=.7pt]</code> nebo <code>\mymacro[width=.8pt, color=\Red]</code>. </p><p>Makra <code>\kv</code> a&nbsp;<code>\kvscan</code> lze implementovat takto: </p><pre class='pr-3'><code>\def\kv#1{\expandafter\ifx\csname kv:#1\endcsname \relax \expandafter\kvunknown 
   \else \csname kv:#1\expandafter\endcsname\fi 
} 
\def\kvunknown{???} 
\def\kvscan #1#2=#3,{\ifx#1,\else \kvdef{kv:#1#2}{#3}\expandafter\kvscan\fi} 
\let\kvdef=\sdef 
</code></pre><p>Makro <code>\kvscan</code> čte klíč rozložen do dvou parametrů <code>#1#2</code>. Tím umožní za čárkami v&nbsp;seznamu přiřazení dávat nepovinné mezery, které jsou parametrem <code>#1</code> ignorovány. Pokud umožníte uživateli dávat nepovinné mezery i&nbsp;kolem rovnítka, je možné upravit jeho seznam přiřazení třeba takto: </p><pre class='pr-3'><code>... \let\tmpb=\opt \replacestrings{ =}{=}\replacestrings{= }{=}% 
    \expandafter \kvscan\tmpb,,=,% 
</code></pre><p>Místo <code>\let\kvdef=\sdef</code> je možné použít třeba </p><pre class='pr-3'><code>\def\kvdef#1{\expandafter\edef\csname#1\endcsname} 
</code></pre><p>pokud si přejete, aby byly hodnoty expandovány v&nbsp;okamžiku přiřazení. Chcete-li ve svém makru ošetřit, zda má klíč přiřazenu hodnotu, použijte <code>\isdefined{kv:klíč}\iftrue</code>. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#keyval' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0069</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2014-06-16'>16. 06. 2014</time></span> </footer></article> <article id='flags' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Přepínače ve slovnících tvaru klíč=hodnota</h3> <a href='#flags'><i class='fas fa-link'></i></a></div></header><section><p>Do slovníku, který čárkami odděluje <code>klíč=hodnota</code>, chceme přimíchat čárkami oddělené „přepínače“, tj. samostatná slova bez následujícího rovnítka a&nbsp;hodnoty. Například: </p><pre class='pr-3'><code>\mymacroset {width=0.8pt, draft, silent} 
</code></pre><p>Řešením může být užití <code>\replacestrings</code>, jak je uvedeno v&nbsp;následujícím příkladu: </p><pre class='pr-3'><code>\def\mymacroset#1{\def\tmpb{#1,}\replacestrings{ =}{=}\replacestrings{= }{=}% 
   \replacestrings{draft,}{my-final=0,}% 
   \replacestrings{final,}{my-final=1,}% 
   \replacestrings{silent,}{my-message=0,}% 
   \replacestrings{verbose,}{my-message=1,}% 
   \expandafter\kvscan\tmpb,=,% 
   \if1\kv{my-message}\let\mymessage=\message \else \def\mymessage##1{}\fi 
   ... 
} 
\mymacroset {width=0.7pt, final, silent} % default values 
</code></pre><p>Přepínače jsme interně převedli na tvar <code>klíč=hodnota</code> a&nbsp;použili jsme <code>\kvscan</code> z&nbsp;předchozího OPmac triku 0069. </p><p>V&nbsp;dalších makrech se můžeme na použitý přepínač dotazovat například pomocí </p><pre class='pr-3'><code>\if1\kv{my-final}Byl použit přepínač final.\else Byl použit přepínač draft.\fi 
</code></pre></section><footer class='text-right'><a href='opmac-tricks-e.html#flags' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0114</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2014-06-30'>30. 06. 2014</time></span> </footer></article> <article id='balanced' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Vnořené závorky jiného typu než {}</h3> <a href='#balanced'><i class='fas fa-link'></i></a></div></header><section><p>TeX si hlídá automaticky párování a&nbsp;vnoření pouze jednoho typu závorek: <code>{}</code>. OPmac používá pro parametry občas ještě závorky <code>[]</code>, ale ty se nedají vnořovat. Napíšete-li tedy třeba <code>\label[a[b]c]</code>, dostanete lejblík <code>a[b</code> a&nbsp;dále <code>c]</code> se vytiskne. Pokud si chcete pohlídat i&nbsp;párování takových typů závorek (hranatých i&nbsp;jiných), můžete použít makro <code>\ensurerebalanced</code> tímto způsobem: </p><pre class='pr-3'><code>\def\makro[#1]{\ensurebalanced[]\makroA{#1}} 
\def\makroA#1{zde má parametr "#1" balancovány závorky [].} 
například: 
\makro[a[b]c] vytiskne: zde má parametr "a[b]c" balancovány závorky []. 
</code></pre><p>Můžete si předefinovat třeba makro <code>\label</code> tak, aby akceptovalo balancovaný text s&nbsp;hranatými závorkami: </p><pre class='pr-3'><code>\def\tmp{\def\labelA##1} 
\expandafter\tmp\expandafter{\label[#1]} 
\def\label[#1]{\ensurebalanced[]\labelA{#1}} 
</code></pre><p>Makro <code>\ensurebalanced</code> je definováno následovně: </p><pre class='pr-3'><code>\def\ensurebalanced#1#2#3#4{% 
   \isbalanced#1#2{#4}\iftrue #3{#4}% 
   \else 
      \def\ensurebalancedA##1##2#2{% 
         \isbalanced#1#2{##1#2##2}\iftrue #3{##1#2##2}% 
         \else \def\next{\ensurebalancedA{##1#2##2}}\expandafter\next\fi 
      }% 
      \def\next{\ensurebalancedA{#4}}\expandafter\next\fi 
} 
\def\isbalanced#1#2#3\iftrue{\tmpnum=0 \isbalancedA#1#2#3\isbalanced} 
\def\isbalancedA#1#2#3{% 
    \ifx\isbalanced#3\def\next{\csname ifnum\endcsname\tmpnum=0 }% 
    \else \def\next{\isbalancedA#1#2}% 
        \isonetoken#3\iftrue 
           \ifx#3#1\advance\tmpnum by1\fi 
           \ifx#3#2\advance\tmpnum by-1\fi 
     \fi\fi\next 
} 
\def\isonetoken#1#2\iftrue{\ifx\isbalanced#2\isbalanced} 
</code></pre><p>Makro <code>\ensurebalanced</code> pohlídá pomocí <code>\isbalanced</code>, zda je přečtený text balancovaný na závorky <code>[=#1</code> a&nbsp;<code>]=#2</code>. Pokud ano, spustí <code>\makroA</code>, tedy <code>#3</code> následované přečteným parametrem. Pokud ne, zavolá (případně i&nbsp;rekurzívně) makro <code>\ensurebalancedA</code>, které přečte další část textu parametru. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#balanced' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0077</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2014-08-09'>09. 08. 2014</time></span> </footer></article> <article id='readtoks' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Čtení parametru token po tokenu</h3> <a href='#readtoks'><i class='fas fa-link'></i></a></div></header><section><p>Vytvoříme makro <code>\readtoks{parametr}</code>, který čte jednotlivé tokeny parametru, může je na základě jejich typu třeba nějak modifikovat, a&nbsp;výsledek čtení a&nbsp;modifikace uloží do <code>\readtoksO</code>, což je implicitně definováno jako <code>\toks1</code>. Užití tohoto makra najdete v&nbsp;<a href='appendto' title='následujícím OPmac triku 0079'>následujícím OPmac triku 0079</a>, kde makro <code>\readtoks</code> prochází seznam tokenů a&nbsp;jakmile narazí na kříž (kategorii 6), promění ho ve dva kříže. Jakmile narazí na sekvenci <code>\internalXpram</code>, promění ji v&nbsp;jeden kříž. Takže třeba po </p><pre class='pr-3'><code>\readtoks{aha # uff {\internalXparam1 {a}} \line} 
budeme mít: 
\toks1={aha ## uff {#1 {a}} \line} 
</code></pre><p>Makro jsem též v&nbsp;mírných obměnách použil v&nbsp;odpovědích na <a href='http://tex.stackexchange.com/questions/200452/macro-parameter-delimited-by-more-than-one-delimiter' title='otázku o&nbsp;proměnlivých separátorech'>otázku o&nbsp;proměnlivých separátorech</a> nebo na <a href='http://tex.stackexchange.com/questions/196776/arguments-possibly-delimited-by-bgroup-and-egroup' title='otázku o&nbsp;alternaitvních svorkách'>otázku o&nbsp;alternaitvních svorkách</a> na tex.stackexchange.com </p><p>Základní problém makra <code>\readtoks</code> je, že nemůže bezhlavě nabírat jednotlivé tokeny do neseparovaného parametru, protože to zničí mezery a&nbsp;svorkaté závorky. Je tedy třeba tyto situace ošetřit zvlášť. </p><pre class='pr-3'><code>\newtoks\readtoksT \newif\ifreadtoksG 
\def\readtoks{\begingroup \let\bgroup=\relax \let\egroup=\relax 
   \readtoksT={}\readtoksGfalse \afterassignment\readtoksA \let\next= } 
\def\readtoksA{\futurelet\tmpc\readtoksB} 
\def\readtoksB{\let\next=\readtoksD \csname readtoksX\endcsname 
   \ifcat\space\noexpand\tmpc \let\next=\readtoksC \def\nexxt{\readtoksD{ }}\fi 
   \ifcat{\noexpand\tmpc      \let\next=\readtoksC \let\nexxt=\readtoksE \fi 
   \ifcat}\noexpand\tmpc      \let\next=\readtoksC \let\nexxt=\readtoksF \fi 
   \next 
} 
\def\readtoksC{\afterassignment\nexxt \let\next= } 
\def\readtoksD#1{\readtoksT=\expandafter{\the\readtoksT#1}\readtoksA} 
\def\readtoksE{\begingroup \readtoksGtrue \readtoksT={}\readtoksA} 
\def\readtoksF{\ifreadtoksG 
      \expandafter\endgroup\expandafter\readtoksT\expandafter\expandafter\expandafter 
         {\expandafter\the\expandafter\readtoksT\expandafter{\the\readtoksT}}% 
      \expandafter\readtoksA 
   \else 
      \expandafter\endgroup\expandafter\readtoksO\expandafter{\the\readtoksT}% 
   \fi 
} 
\def\readtoksO{\toks1} 
</code></pre><p>Makro postupně sbírá tokeny a&nbsp;spouští uživatelsky definované makro <code>\readtoksX</code>, ve kterém může uživatel tokeny pozměňovat. Pokud toto makro není definováno, pak se pouze postupným sbíráním tokenů naplní výsledný registr <code>\readtoksO</code> stejně, jako při přímém čtení <code>\readtoksO={parametr}</code>. Všimněte se, že nejvíce práce dají svorky. Narazíme-li na vstupní svorku, vnoříme se do nové skupiny, kde začínáme plnit <code>\readtoksT</code> od začátku, tedy naplníme ho vnitřním obsahem párujících svorek. Narazíme-li pak na ukončovací svorku, využijeme přečtený <code>\readtoksT</code>, který obalíme do svorek a&nbsp;před něj dáme původní <code>\readtoksT</code>, který obsahuje text načtený před zahajovací svorkou. A&nbsp;v rámci toho ukončíme skupinu. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#readtoks' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0088</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2015-01-20'>20. 01. 2015</time></span> </footer></article> <article id='etoks' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Expandující čtení textu token po tokenu</h3> <a href='#etoks'><i class='fas fa-link'></i></a></div></header><section><p>Předchozí OPmac trik popisuje možnost čtení jednotlivých tokenů hlavním procesorem. Nyní vytvoříme makro, které čte tokeny jen expand procesorem. TeX bohužel při čtení následujícího tokenu makrem s&nbsp;neseparovaným parametrem přeskočí případnou mezeru. Takže cyklus: </p><pre class='pr-3'><code>\def\apply#1{[#1]} 
\def\readtokens#1{\ifx\end#1\else\apply{#1}\expandafter\readtokens\fi} 
\readtokens Tady je nějaký text.\end 
</code></pre><p>přečte totéž, jako při <code>\readtokens Tadyjenějakýtext.\end</code>. Naším úkolem je vytvořit makro, které mezery respektuje a&nbsp;je plně expandující. Další problém při čtení tokenů makrem s&nbsp;neseparovaným parametrem spočívá v&nbsp;tom, že třeba <code>{abc}</code> přečte naráz a&nbsp;navíc odstraní kučeravé závorky. Naše makro <code>\etoks{tokeny}</code> oba problémy řeší a&nbsp;spustí makro <code>\eapply</code> na každý jednotlivý token svého parametru. Respektuje mezery i&nbsp;kučeravé závorky. Takže třeba po </p><pre class='pr-3'><code>\def\eapply#1{[#1]} % co provést s každým jednotlivým tokenem 
\message{... \etoks{ab c{ aa bc {bb}}cb}} 
</code></pre><p>dostaneme <code>... [a][b][ ][c]{[ ][a][a][ ][b][c][ ]{[b][b]}}[c][b]</code>. </p><p>Implementace makra je následující: </p><pre class='pr-3'><code>\def\etoks#1{\etoksA #1{\end}} 
\def\etoksA#1#{\etoksB#1 {\end} } 
\def\etoksB#1 #2 {\etoksC#1\end 
    \ifx\end#2\empty\expandafter\etoksD\else\eapply{ }\fihere{\etoksB#2 }\fi} 
\def\etoksC#1{\ifx\end#1\else\eapply{#1}\expandafter\etoksC\fi} 
\def\etoksD#1{\ifx\end#1\empty\else\fihere{{\etoks{#1}}\etoksA}\fi} 
\def\fihere#1\fi{\fi#1} 
</code></pre><p>Makro se opírá o&nbsp;možnost separace závorkou pomocí konstrukce <code>\def\x#1#{...}</code>. Dále pomocí <code>\etoksB</code> odlišuje jednotlivá „slova“ oddělená mezerami a&nbsp;<code>\etoksC</code> čte teprve jednotlivé tokeny ve slovech. Po ukončení čtení slov následuje závorka, kterou zpracuje <code>\etoksD</code> a&nbsp;případně rekurzivně zavolá <code>\etoks</code> na vnitřek závorky. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#etoks' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0153</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2016-06-06'>06. 06. 2016</time></span> </footer></article> <article id='appendto' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Vylepšené \addto pro makra s parametry</h3> <a href='#appendto'><i class='fas fa-link'></i></a></div></header><section><p>Makro <code>\addto</code> z&nbsp;OPmac přidává ke zvolenému makru další text. Ovšem zvolené makro musí být bez prametrů. Navrhnul jsem tedy další makra <code>\appendto</code> a&nbsp;<code>\prependto</code>, která dokáží rozšířit stávající makro (vzadu nebo vpředu) třebaže toto makro má parametry. Příklady použití: </p><pre class='pr-3'><code>\def\a#1==#2{#1 is equal #2} 
\appendto\a{ and this means that #1=#2.} 
% \a je nyní makro: #1==#2 -&gt; #1 is equal #2 and this means that #1=#2. 
\prependto\a{We have (#1) and (#2). The } 
% \a je nyní makro: #1==#2 -&gt; We have (#1) and (#2). 
%                        The #1 is equal #2 and this means that #1=#2. 
</code></pre><p>Pomocí <code>\let\appendprefix=\long</code> nebo <code>\let\appendprefix=\global</code> je možné specifikovat, jakého typu rozšířené makro bude. Tip: například pomocí </p><pre class='pr-3'><code>\def\appendtoprefix{\protected\long}\appendto\makro{} 
</code></pre><p>je možné přetypovat stávající <code>\makro</code> na jiný typ. </p><pre class='pr-3'><code>\let\appendtoprefix=\relax 
\def\appendto#1#2{\appendtoA#1% 
   \appendtoprefix\expandafter\def\expandafter#1\the\toks0\expandafter 
      {\the\toks1 #2}} 
\def\prependto#1#2{\appendtoA#1\toks2={#2}% 
   \appendtoprefix\expandafter\def\expandafter#1\the\toks0\expandafter 
      {\the\toks2\expandafter\space\the\toks1}} 
\def\appendtoA#1{\edef\tmpb{\expandafter\appendtoB\meaning#1\end}% 
   \scantokens\expandafter{\expandafter\toks\expandafter0\expandafter{\tmpb}}% 
   \expandafter\replacestrings\expandafter{\string##}{\#}% 
   {\def\###1{{\noexpand\internalXparam##1}}\xdef\tmpa{\toks1={\tmpb}}}\tmpa 
   \scantokens\expandafter{\expandafter\toks\expandafter1\expandafter{\the\toks1}}% 
   \toks1=\expandafter\expandafter\expandafter{\expandafter#1\the\toks1}% 
   \expandafter\readtoks\expandafter{\the\toks1}% 
} 
\def\appendtoB#1:#2-&gt;#3\end{#2} 
\def\readtoksX{% 
   \ifcat##\noexpand\tmpc   \let\next=\readtoksC \def\nexxt{\readtoksD{########}}\fi 
   \ifx\internalXparam\tmpc \let\next=\readtoksC \def\nexxt{\readtoksD{####}}\fi 
} 
\def\internalXparam{\internalXparam} 
 
</code></pre><p>Makra <code>\appendto</code> i&nbsp;<code>\prependto</code> nejprve připraví pomocí <code>\appendtoA</code> do <code>\toks0</code> masku prametrů původního makra a&nbsp;do <code>\toks1</code> obsah původního makra. Masku parametrů připraví tak, že si ji sejme pomocí <code>\meaning</code> a&nbsp;<code>\appendtoB</code> z&nbsp;výpisu významu makra. Pak ji prožene <code>\scantokens</code>, protože kategorie jsou ve výpisu <code>\meaning</code> nastaveny nevhodně. Dále provede <code>\appendtoA</code> tento trik: každý výskyt formálního parametru v&nbsp;masce parametrů obalí do svorek ve formě <code>\internalXparam číslo-parametru</code> a&nbsp;toto uloží přechodně do <code>\toks1</code>. Je-li třeba maska parametrů ve tvaru <code>#1x#2::#3</code>, pak v&nbsp;<code>\toks1</code> bude <code>{\internalXparam1}x{\internalXparam2}::{\internalXpram3}</code>. To provede pomocí <code>\replacestings #->\#</code> a&nbsp;dále definicí <code>\#</code> jako makra s&nbsp;parametrem, které vytvoří požadovaný výsledek expanzí takové masky. Takto připravený <code>\toks1</code> předloží původnímu makru, které tedy do <code>#1</code> nabere <code>\internalXparam1</code>, do <code>#2</code> nabere <code>\intenralXparam2</code> atd. Tento výsledek expanze proženeme makrem <code>\readtoks</code> <a href='#readtoks' title='z předchozího OPmac triku 0088'>z předchozího OPmac triku 0088</a> a&nbsp;tím dostaneme v&nbsp;<code>\toks1</code> seznam tokenů připravený k&nbsp;nové definici původního makra. Poznamenávám, že na rozdíl od podobného makra <code>\apptocmd</code> a&nbsp;<code>\pretocmd</code> z&nbsp;LaTeXového balíčku etoolbox, naše makro zachovává všechny kategorie v&nbsp;těle makra, takže je rozbustnější. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#appendto' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0079</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2015-01-17'>17. 01. 2015</time></span> </footer></article> <article id='patchto' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Makro \patchto na modifikaci makra</h3> <a href='#patchto'><i class='fas fa-link'></i></a></div></header><section><p>Pokud chceme implemetovat <code>\patchto</code>, které ve stávajícím makru vymění text za jiný text, tedy </p><pre class='pr-3'><code>\patchto\makro {vyhledaný text}{vyměněný za} 
</code></pre><p>pak můžeme využít předchozí <a href='#appendto' title='OPmac trik 0079'>OPmac trik 0079</a>, ale pro jednoduchost provedeme záměnu textu za text po detokenizaci. Záměnu provedeme pomocí <code>\replacestrings</code> a&nbsp;nakonec tělo makra zpětně tokenizujeme. Tedy v&nbsp;tomto případě makro pracuje analogicky jako makro <code>\patchcmd</code> z&nbsp;LaTeXového etoolbox. </p><pre class='pr-3'><code>\def\patchto#1#2#3{\appendtoA#1% 
   \edef\tmpb{\detokenize\expandafter{\the\toks1}}% 
   \edef\tmpa{\noexpand\replacestrings{\detokenize{#2}}{\detokenize{#3}}}\tmpa 
   \edef\tmpa{\noexpand\replacestrings{\string##\string##}{\string##}}\tmpa 
   \scantokens\expandafter{\expandafter\toks\expandafter1\expandafter{\tmpb}}% 
   \appendtoprefix\expandafter\def\expandafter#1\the\toks0\expandafter{\the\toks1 }} 
</code></pre></section><footer class='text-right'><a href='opmac-tricks-e.html#patchto' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0087</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2015-01-18'>18. 01. 2015</time></span> </footer></article> <article id='for' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Cyklus typu for</h3> <a href='#for'><i class='fas fa-link'></i></a></div></header><section><p>Vytvoříme makro <code>\for \i=X to Y by Z {tělo cyklu}</code>, které alokuje proměnnou <code>\i</code>, nastaví ji na hodnotu <code>X</code> a&nbsp;opakuje tělo cyklu tak dlouho, dokud proměnná <code>\i</code> nepřekročí <code>Y</code>, přitom po každém vykonání těla cyklu zvedne <code>\i</code> o&nbsp;<code>Z</code>. Například: </p><pre class='pr-3'><code>\for \i=1 to 10 by 1 {\for \j=1 to 10 by 1 {\message{a[\the\i,\the\j]}}} 
</code></pre><p>vypíše <code>a[1,1] a[1,2] ... a[1,10] a[2,1] a[2,2] ... a[10,9] a[10,10]</code>. </p><p>Celý cyklus probíhá uvnitř skupiny a&nbsp;je zahájen automatickou alokací proměnné cyklu, která je uvedena jako první parametr. Není tedy nutné tuto proměnnou alokovat. Ono to ani není žádoucí, protože řídicí sekvence <code>\i</code>, <code>\j</code> bývají v&nbsp;TeXu vyhrazeny k&nbsp;jiným účelům. Po skončení cyklu je <code>\i</code> znovu tím, čím bylo (například v&nbsp;plainTeXu) původně definováno. </p><p>Makro <code>\for</code> můžeme definovat třeba takto: </p><pre class='pr-3'><code>\def\for#1=#2to#3by#4#{\forA{#1}{#2}{#3}{#4}} 
\long\def\forA#1#2#3#4#5{\begingroup 
   {\escapechar=`\\ % allocation of #1 as counter: 
      \expandafter \ifx\csname for:\string#1\endcsname \relax 
         \csname newcount\expandafter\endcsname \csname for:\string#1\endcsname\fi 
    \expandafter}\expandafter\let\expandafter#1\csname for:\string#1\endcsname 
   #1=#2% 
   \def\forB{#5\advance#1by#4\relax \expandafter\forC}% 
   \ifnum#4&gt;0 \def\forC{\ifnum#1&gt;#3\relax\else\forB\fi}% 
   \else      \def\forC{\ifnum#1&lt;#3\relax\else\forB\fi}% 
   \fi 
   \ifnum#4=0 \let\forC=\relax \fi 
   \forC \endgroup 
} 
</code></pre><p>V&nbsp;prvé části makra po zjištění parametrů se globálně alokuje proměnná <code>\for:\i</code> (pokud je <code>#1=\i</code>) nebo <code>\for:\j</code> (pokud je <code>#1=\j</code>) atd. Tato alokace probíhá jen tehdy, pokud tato proměná nebyla dříve alokována. Tj. opakované použití <code>\for\i=...</code> nealokuje proměnnou <code>\for:\i</code> opakovaně. Následně se lokálně přiřadí uživatelem deklarovaná proměná cyklu (tj. <code>\i</code>, <code>\j</code> atd.) té globálně alokované. </p><p>Poté je nastavena hodnota této proměnné cyklu na výchozí hodnotu <code>X</code>. Cyklus samotný spočívá v&nbsp;opakovaném volání makra <code>\forC</code>, které obsahuje kontrolu, zda nebyla překročena koncová hodnota. Pokud ne, volá se <code>\forB</code>. Toto makro obsahuje jednak tělo cyklu <code>#5</code>, dále zvětšení proměnné cyklu o&nbsp;hodnotu <code>Z</code> a&nbsp;konečně nové volání makra <code>\forC</code> rekurzí. Jsou rozlišeny dva případy podmínky konce cyklu v&nbsp;závislosti na tom, zda krok <code>Z</code> je kladný nebo záporný. Je-li tento krok nulový (nekonečný cyklus), raději neprovedeme nic. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#for' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0115</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2015-07-01'>01. 07. 2015</time></span> </footer></article> <article id='rep' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Cyklus na úrovni expand procesoru</h3> <a href='#rep'><i class='fas fa-link'></i></a></div></header><section><p>Při zpracování cyklu je třeba měnit proměnnou cyklu a&nbsp;to vyžaduje přiřazení. Přiřazení ale nelze provést v&nbsp;expand procesoru. Ukážeme dvě řešení, jak to obejít. První je hodně trikoidní využívající <code>\romannumeral</code> a&nbsp;pracuje i&nbsp;v klasickém TeXu. Druhé řešení využívá toho, že eTeXový příkaz <code>\numexpr</code> pracuje v&nbsp;expand procesoru. </p><p>Vytvoříme makro <code>\rep{kolik}{co}</code>, které zopakuje <code>co</code> <code>kolik</code>rát, tedy třeba <code>\rep{5}{uf}</code> expanduje na <code>ufufufufuf</code>. </p><p>V&nbsp;klasickém TeXu by implementace makra <code>\rep</code> vypadala takto: </p><pre class='pr-3'><code>\def\rep#1#2{\expandafter\repA\romannumeral#1000.{#2}} 
\def\repA#1.#2{\repB{#2}#1.} 
\def\repB#1#2{\ifx.#2\expandafter\repC\else#1\expandafter\repB\fi{#1}} 
\def\repC#1{} 
</code></pre><p>Nejprve je <code>\rep{5}{uf}</code> expandováno na <code>\repA mmmmm.{uf}</code> (tedy 5krát <code>m</code>) a&nbsp;pořadí parametrů je pomocí <code>\repA</code> převráceno na <code>\repB {uf}mmmmm</code>. Makro <code>\repB</code> provede cyklus, při němž odebírá jednotlivá <code>m</code> a&nbsp;končí při tečce. </p><p>S&nbsp;využitím eTeXu může implementace makra <code>\rep</code> vypadat takto: </p><pre class='pr-3'><code>\def\rep#1#2{\repA 0{#1}{#2}} 
\def\repA#1#2#3{\ifnum#2&gt;#1 #3\expandafter\repB\else\expandafter\repC\fi{#1}{#2}{#3}} 
\def\repB#1{\expandafter\repA\expandafter{\the\numexpr#1+1}} 
\def\repC#1#2#3{} 
</code></pre><p>V&nbsp;tomto případě se opakuje <code>\repA</code> s&nbsp;parametry <code>{kolik-bylo}{kolik}{co}</code>. Toto makro vloží do výstupu <code>co</code> za předpokladu, že <code>kolik-bylo < kolik</code>. V&nbsp;takovém případě pomocí <code>\repB</code> a&nbsp;<code>\numexpr</code> zvětší hodnotu kolik-bylo o&nbsp;jedničku a&nbsp;zopakuje <code>\repA</code>. </p><p>Druhé řešení umožní za parametr <code>kolik</code> vkládat i&nbsp;registry nebo konstanty, tj. třeba <code>\chardef\x=10 \rep\x{ahoj}</code>, což první řešení neumožní a&nbsp;vyžaduje takový parametr prefixovat pomocí <code>\the</code>. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#rep' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0120</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2015-07-25'>25. 07. 2015</time></span> </footer></article> <article id='newcommand' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>LaTeXové newcommand</h3> <a href='#newcommand'><i class='fas fa-link'></i></a></div></header><section><p>Výjimečně se může stát, že potřebujeme číst LaTeXově napsaný kus kódu, ve kterém je použito <code>\newcommand</code>. Toto makro má poměrně obskurní syntaxi: za <code>\newcommand</code> následuje definovaná kontrolní sekvence. Pak může v&nbsp;hranaté závorce být uveden počet parametrů (není-li závorka uvedena, je tento počet roven nule). Pak může následovat druhá hranatá závorka, která obsahuje výchozí hodnotu prvního parametru, který se tímto stává nepovinným. Pak teprve následuje obvyklé tělo makra uvnitř svorek. Při deklaraci nepovinného parametru je pak možné definované makro volat dvěma způsoby, buď jako <code>\makro parametry</code> nebo jako <code>\makro [parametr]parametry</code>. V&nbsp;prvém případě má <code>#1</code> defaultní hodnotu a&nbsp;ve druhém hodnotu parametr. Ostatní (povinné) parametry se v&nbsp;tomto případě čtou do <code>#2</code>, <code>#3</code> atd. Uff. </p><p>Pokud se obejdeme bez kontroly, zda je makro už definováno, a&nbsp;bez hvězdičkové verze, je možno <code>\newcommand</code> definovat takto: </p><pre class='pr-3'><code>\def\newcommand#1{\isnextchar[{\newcommandA#1}{\newcommandA#1[0]}} 
\def\newcommandA#1[#2]{\edef\tmpp{\ifcase#2% 
   \or1\or12\or123\or1234\or12345\or123456\or1234567\or12345678\or123456789\fi}% 
   \edef\tmpp{\expandafter\addhashs\tmpp.}% 
   \isnextchar[{\newcommandB#1}{\long\expandafter\def\expandafter#1\tmpp}% 
} 
\def\newcommandB#1[#2]{% 
   \def#1{\isnextchar[{\runcommand#1}{\runcommand#1[#2]}}% 
   \long\expandafter\def\csname\string#1X\expandafter\endcsname\tmpp 
} 
\def\addhashs#1{\ifx.#1\else #####1\expandafter\addhashs\fi} 
\long\def\runcommand#1[#2]{\csname\string#1X\endcsname{#2}} 
</code></pre><p>Předpokládejme <code>\newcommand\makro[4]{cosi}</code>. Makro <code>\newcommandA</code> má v&nbsp;<code>#2</code> počet parametrů a&nbsp;tento počet pomocí <code>\ifcase</code> a&nbsp;následného <code>\addhashs</code> převede v&nbsp;<code>\tmpp</code> na sekvenci např. <code>#1#2#3#4</code> (pro případ čtyř parametrů). Když není deklarován nepovinný parametr, je definována přímo sekvence <code>\makro</code>. Je-li deklarován nepoviný parametr, je definována sekvence <code>\\makroX</code>. Kromě toho je definována sekvence <code>\makro</code> jako test, zda následuje hranatá závorka. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#newcommand' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0086</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2015-01-09'>09. 01. 2015</time></span> </footer></article> <article id='lipsum' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Testovací text Lorem ipsum dolor sit</h3> <a href='#lipsum'><i class='fas fa-link'></i></a></div></header><section><p>Občas se hodí pro testovací účely vyplnit sazbu nic neříkajícím textem. Takové texty bude generovat makro <code>\lipsum[číslo]</code> nebo <code>\lipsum[od-do]</code>. Například: </p><pre class='pr-3'><code>\lipsum[13] 
\lipsum[3-27] 
</code></pre><p>Uvedené číslo (nebo rozsah od do) určuje číslo odstavce (čísla odstavců), jež chceme vytisknout. V&nbsp;souboru <code>lipsum.sty</code> je připraveno 150 osdtavců s&nbsp;nic neříkajícím textem typu Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Je tedy třeba vybírat z&nbsp;rozsahu 1&nbsp;až 150. </p><pre class='pr-3'><code>{\long\def\lipsumskip#1\newcommand\lipsum@i{\newcommand\lipsum@i} 
 \def\lips@par{\lipsumpar}\let\lipsumpar=\relax 
 \def\newcommand#1#{\advance\tmpnum by1 \sxdef{lips:\the\tmpnum}} 
 \tmpnum=0 
 \expandafter\lipsumskip\input lipsum.sty } 
\def\lipsum[#1]{\lipsumA #1\empty-\empty\end} 
\def\lipsumA #1-#2\empty#3\end{\tmpnum=#1 \edef\tmp{\ifx^#2^#1\else#2\fi}% 
   \loop \csname lips:\the\tmpnum\endcsname 
         \ifnum\tmpnum&lt;\tmp \advance\tmpnum by1 \repeat 
} 
\let\lorem=\lipsum 
\let\lipsumpar=\par 
</code></pre><p>Makro využívá existující soubor <code>lipsum.sty</code> z&nbsp;LaTeXové distribuce, který obsahuje uvedené texty. Nejprve se přeskočí zbytečná makra v&nbsp;tomto souboru a&nbsp;pak se zahájí čtení vlastních textů za použití předefinovaného <code>\newcommand</code>. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#lipsum' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0100</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2015-04-15'>15. 04. 2015</time></span> </footer></article> <article id='showif' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Přeskakování textu podle čtenářů</h3> <a href='#showif'><i class='fas fa-link'></i></a></div></header><section><p>Chceme tisknout text podle toho, zda je určen pro konkrétní užití. Pomocí <code>\showallow{kdo}</code> umožníme čtenáři <code>kdo</code> tisknout text. Opakovaným <code>\showallow</code> umožníme tisknout text případně dalším čtenářům. Poté příkaz </p><pre class='pr-3'><code>\showif {admin,students} {text} 
</code></pre><p>vytiskne <code>text</code> pouze tehdy, pokud aspoň jeden z&nbsp;vyjmenovaných čtenářů (v čárkami odděleném seznamu) byl deklarován pomocí <code>\showallow</code>. Makro <code>\showif</code> pracuje na úrovni expand procesoru: za dané podmínky expanduje na <code>{text}</code> jinak expanduje na prázdný výstup. </p><p>Druhá možnost je psát </p><pre class='pr-3'><code>\showifbegin {admins,students} 
text 
\showifend 
</code></pre><p>To expanduje na text tentokrát bez uzavření do skupiny a&nbsp;také pouze tehdy, je-li aspoň jeden z&nbsp;vyjmenovaných čtenářů povolen. Přechody typu verbatim uvnitř textu jsou možné. </p><p>Implementace této vlastnosti mě napadla při poslechu příspěvku Borise Veytsmana „TeX and controlled access to information“ na <a href='https://tug.org/tug2015/program.html' title='TUG 2015'>TUG 2015</a> a&nbsp;vypadá takto: </p><pre class='pr-3'><code>\def\showif#1{\showifA#1,s:!,} 
\def\showifbegin#1{\showifA#1,l:!,} 
\def\showifA#1#2,{\expandafter\ifx\csname s:#1#2\endcsname\relax 
   \expandafter\showifA \else \csname s:#1#2\expandafter\endcsname \fi} 
\long\def\showifT#1:!,{\romannumeral-`\.} 
\long\expandafter\def\csname s:s:!\endcsname#1{} 
\long\expandafter\def\csname s:l:!\endcsname#1\showifend{} 
\def\showifend{} 
 
\def\showallow#1{\expandafter\let\csname s:#1\endcsname=\showifT} 
\def\showdeny#1{\expandafter\let\csname s:#1\endcsname=\relax} 
</code></pre></section><footer class='text-right'><a href='opmac-tricks-e.html#showif' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0117</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2015-07-22'>22. 07. 2015</time></span> </footer></article> <article id='plists' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Spojové seznamy</h3> <a href='#plists'><i class='fas fa-link'></i></a></div></header><section><p>Jako cvičení vytvoříme v&nbsp;TeXu strukturu spojových senznamů. Makro <code>\addtolist{název}{data}</code> přidá na konec spojového seznamu <code>název</code> další uzel obsahující <code>data</code>, nebo (pokud je seznam prázdný) založí v&nbsp;seznamu první uzel. Každý uzel odkazuje na předchozí a&nbsp;následující uzel v&nbsp;seznamu. Makro <code>\printlist{název}</code> expanduje na seznam dat odělených <code>\seplist</code> v&nbsp;pořadí od prvního do posledního a&nbsp;makro <code>\printlistrev{název}</code> expanduje seznam v&nbsp;opačném pořadí. Tato makra proběhnou na úrovni expand procesoru. </p><pre class='pr-3'><code>\newcount\listnum 
 
\def\addtolist#1#2{\advance\listnum by1 
   \expandafter\ifx\csname l:#1:1\endcsname \relax 
      \setlistnode \relax \relax {#2}{\the\listnum}% 
      \expandafter\edef\csname l:#1:0\endcsname{\the\listnum}% 
   \else 
      \edef\lastnodenum{\csname l:#1:1\endcsname}% 
      \expandafter\resetlistnode \csname l:\the\listnum\endcsname 2\lastnodenum 
      \expandafter\setlistnode \csname l:\lastnodenum\endcsname \relax {#2}{\the\listnum}% 
   \fi 
   \expandafter \edef\csname l:#1:1\endcsname{\the\listnum}% 
} 
\def\setlistnode #1#2#3#4{\expandafter\def\csname l:#4\endcsname{#1#2{#3}}} 
\def\resetlistnode #1#2#3{\def\tmp{\expandafter\def\csname l:#3\endcsname}% 
   \expandafter\expandafter\expandafter\resetlistnumA \csname l:#3\endcsname #2#1} 
\def\resetlistnumA #1#2#3#4#5{\ifcase #4\or\tmp{#5#2{#3}}\or\tmp{#1#5{#3}}\or\tmp{#1#2{#5}}\fi} 
 
\def\printlist#1{\expandafter\ifx\csname l:#1:0\endcsname \relax \else 
   \expandafter\expandafter\expandafter\printlistA 
      \csname l:\csname l:#1:0\endcsname\expandafter\endcsname \fi} 
\def\printlistA#1#2#3{#3\ifx#2\relax \else \listsep 
   \expandafter\expandafter\expandafter\printlistA\expandafter#2\fi} 
 
\def\printlistrev#1{\expandafter\ifx\csname l:#1:1\endcsname \relax \else 
   \expandafter\expandafter\expandafter\printlistAr 
      \csname l:\csname l:#1:1\endcsname\expandafter\endcsname \fi} 
\def\printlistAr#1#2#3{#3\ifx#1\relax \else \listsep 
   \expandafter\expandafter\expandafter\printlistAr\expandafter#1\fi} 
 
\def\listsep{;} 
</code></pre><p>Seznam <code>název</code> je reprezentován číslem prvního uzlu v&nbsp;makru <code>\l:název:0</code> a&nbsp;číslem posledního uzlu v&nbsp;<code>\l:název:1</code>. Každý uzel je makro s&nbsp;názvem <code>\l:číslo</code> a&nbsp;s obsahem <code>{\předchozí \další {data}}</code>, přitom <code>\předchozí</code> a&nbsp;<code>\další</code> jsou zase makra typu <code>\l:číslo</code> nebo to je <code>\relax</code>, pokud předchozí nebo další uzel neexistuje. Číslo je pro každý uzel unikátní. Pomocné makro <code>\setlistnode</code> <code>\předchozí\další{data}{číslo}</code> založí uzel <code>\l:číslo</code> s&nbsp;daným obsahem. Pomocné makro <code>\resetlistnode{co}{jak}{číslo}</code> pozmění uzel <code>číslo</code> tak, že <code>co</code> vloží jako první, druhý, nebo třetí údaj uzlu v&nbsp;závislosti na <code>jak</code>. Ostatní údaje uzlu zůstávají nezměněny. Takže třeba <code>\resetlistnode{data}3{číslo}</code> aktualízuje v&nbsp;<code>\l:číslo</code> jen data a&nbsp;ponechá pointery <code>\předchozí</code> a&nbsp;<code>\další</code> nezměněny. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#plists' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0118</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2015-07-22'>22. 07. 2015</time></span> </footer></article> <article id='revlist' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Expanze seznamu v obráceném pořadí</h3> <a href='#revlist'><i class='fas fa-link'></i></a></div></header><section><p>Na expandování seznamu údajů v&nbsp;obráceném pořadí není nutné vytvářet spojové seznamy. Ty byly v&nbsp;předchozím <a href='#plists' title='OPmac triku'>OPmac triku</a> uvedeny spíše jako řešení akademického problému. Napíšeme-li třeba </p><pre class='pr-3'><code>\revlist{aa,bb,ccc,dddd} 
</code></pre><p>pak na výstupu dostaneme <code>dddd,ccc,bb,aa</code>. Makro <code>\revlist</code> pracuje jen na úrovni expand procesoru, pokud je implementováno třeba takto: </p><pre class='pr-3'><code>\def\revlist#1{\revlistA{}#1,,} 
\def\revlistA#1#2,{\ifx,#2,\expandafter\revlistB\else \expandafter\revlistA\fi {#2,#1}} 
\def\revlistB#1{\revlistC #1,} 
\def\revlistC,#1,,{#1} 
</code></pre><p>Je-li <code>n</code> počet údajů, které je třeba uvést v&nbsp;opačném pořadí, pak makro <code>\revlist</code> má kvadratickou složitost <code>n^2</code> zatímco projití spojového seznamu z&nbsp;předchozího OPmac triku pozpátku má složitost lineární. Na druhé straně k&nbsp;vytvoření spojového seznamu potřebujeme alokovat <code>n</code> řídicích sekvencí, zatímco při použití makra <code>\revlist</code> si vystačíme se čtyřmi sekvencemi. To je obvyklé dilema mezi rychlostí a&nbsp;paměťovými nároky. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#revlist' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0119</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2015-07-22'>22. 07. 2015</time></span> </footer></article> <article id='sb' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Podtržítko se chová mimo matematický mód normálně</h3> <a href='#sb'><i class='fas fa-link'></i></a></div></header><section><p>Kategorie znaku <code>_</code> (podtržítko) je v&nbsp;plainTeXu nastavena na 8, aby jej bylo možno použít jako konstrutor indexů v&nbsp;matematické sazbě. Pak ale jeho užití mimo matematickou sazbu ohlásí chybu. Málokdo asi ví, že není nutno podtržítku dávat takovou katogorii. Když mu dáte třeba kategorii 12 (normální znak) pak se mimo matematickou sazbu bude chovat „normálně“, a&nbsp;v matematické sazbě zůstane jeho funkce konstruktoru indexu zachována. Vyzkoušejte: </p><pre class='pr-3'><code>\catcode`_=13 \let_=\sb \catcode`_=12 
 
% test: 
Tady je {\tt cosi_kdesi}. A v matematice stále funguje: $a_i^2$. 
</code></pre><p>Pointa je v&nbsp;tom, že plainTeX nastavuje mathkód podtržítka na <code>"8000</code>, ale protože je defaultně nastavena jeho kategorie na 8, není tento mathhkód využit. Ten se uplatní jen u&nbsp;znaků kategorie 11 nebo 12. A&nbsp;tento speciální kód <code>"8000</code> říká: chovej se v&nbsp;matematickém módu, jakobys byl aktivní. V&nbsp;době krátkého aktivního života tohoto znaku jsme mu přidělili význam <code>\sb</code>, což je alternativa znaku s&nbsp;kategorií 8, tedy je to konstruktor indexů. Podtržítko bude v&nbsp;matematice tvořit indexy, jako obvykle. </p><p>Sice jsme tímto jediným řádkem osvobodili podtržítko od přítěže býti pouze konstruktorem indexů, ale některé obskurity zůstávají. Knuth s&nbsp;tímto řešením asi nepočítal a&nbsp;dal do svého neobvyklého kódování CM fontů na pozici podtržítka akcent tečky. Takže nebude přímo fungovat toto_zde, dokud nevyměníte Knuthovsky kódovaný font za normálně kódovaný font. Všimněte si, že v&nbsp;ukázce výše jsme pro tisk podtržítka použili font <code>\tt</code>, který jako jediný ze sady Computer Modern fontů respektuje ASCII, takže s&nbsp;tímto fontem podtržítko funguje. </p><p>Opustit Knutovsky kódované fonty můžete například přechodem na XeTeX, ve kterém zavedete OTF fonty v&nbsp;Unicode. Nebo v&nbsp;pdfTeXu lze přejít na kódování T1 (Cork), které také respektuje ASCII. Používáte-li csplain s&nbsp;UTF8 vstupem, stačí na začátek dokumentu psát: </p><pre class='pr-3'><code>v pdfTeXu:  \input t1code  % přechod na T1 kódování 
            \input lmfonts % LM fonty (náhrada CM fontů) v T1 kódování 
 
v XeTeXu:   \input ucode   % přechod na Unicode kódování 
            \input lmfonts % LM fonty (náhrada CM fontů) v Unicode 
</code></pre></section><footer class='text-right'><a href='opmac-tricks-e.html#sb' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0156</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2016-06-09'>09. 06. 2016</time></span> </footer></article> <article id='stripspace' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Odstranění koncové mezery z parametru</h3> <a href='#stripspace'><i class='fas fa-link'></i></a></div></header><section><p>Někdy se stane, že přečteme parametr (například až po <code>\par</code>) a&nbsp;ten může a&nbsp;nemusí obsahovat koncovou mezeru. Vytvoříme expandující makro <code>\stripspace</code>, které případnou koncovou mezeru odstraní. Vnitřní mezery v&nbsp;parametru zůstávají zachovány. Příklad použití: </p><pre class='pr-3'><code>\def\neco#1\par{% nevíme, zda #1 obsahuje koncovou mezeru nebo ne 
    \stripspace\necoA{#1}} 
\def\necoA#1{% Nyní #1 určitě koncovou mezeru neobsahuje 
    ... \message{"#1"}} 
</code></pre><p>Makro <code>\stripspace</code> vypadá takto: </p><pre class='pr-3'><code>\def\stripspace#1#2{\stripspaceA#2\end/ \end/!#1{#2}} 
\def\stripspaceA#1 \end/#2!#3#4{% 
   \ifx!#2!\stripspaceB{#3{#4}}\else\stripspaceB{#3{#1}}\fi 
} 
\def\stripspaceB#1#2\fi{\fi#1} 
</code></pre><p>Na konec parametru přidáme <code>\end/␣\end/</code> a&nbsp;necháme jej přečíst až po <code>␣\end/</code>. Zbyde-li po čtení nějaký zbytek, pak parametr mezeru obsahoval a&nbsp;nezbyde-li nic, parametr mezeru neobsahoval. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#stripspace' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0164</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2017-10-29'>29. 10. 2017</time></span> </footer></article> <article id='varsep' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Variantní separátory parametrů</h3> <a href='#varsep'><i class='fas fa-link'></i></a></div></header><section><p>Může se stát, že jednotlivé parametry, které chceme postupně po jednom zpracovat, nejsou odděleny jediným separátorem, ale uživatel při psaní parametrů užívá více rozličných separátorů. Například kromě čárky ještě středník a&nbsp;dvojznak <code>--</code>. Napíše-li uživatel: </p><pre class='pr-3'><code>\makro {AAA,BBB;CCC--DDD,EEE} 
</code></pre><p>pak toto chceme zpracovat jako </p><pre class='pr-3'><code>\makroX{AAA}{,}\makroX{BBB}{;}\makroX{CCC}{--}\makroX{DDD}{,}\makroX{EEE}{} 
</code></pre><p><code>\makroX</code> se tedy dozví v&nbsp;<code>#1</code> jednak oddělený parametr a&nbsp;v <code>#2</code> se dozví, jakým oddělovačem byl parametr oddělen. </p><p>Pro řešení tohoto problému použijeme makro <code>\replacestrings</code>, které každému oddělovači předsune znak <code>&</code>. Pak parametry přečteme po znak <code>&</code>, a&nbsp;za ním si přečteme případný oddělovač. Definice makra <code>\makro</code> z&nbsp;výše uvedeného příkladu může vypadat takto: </p><pre class='pr-3'><code>\def\makro#1{\def\tmpb{#1}% 
   \replacestrings {,}  {&amp;,}% 
   \replacestrings {;}  {&amp;;}% 
   \replacestrings {--} {&amp;{--}}% 
   \expandafter\makroA\tmpb&amp;{}% 
} 
\def\makroA#1&amp;#2{\makroX{#1}{#2}\ifx&amp;#2&amp;\else\expandafter\makroA\fi} 
</code></pre><p>Povšimněte si, že víceznakový separátor musí být zapouzdřen do svorek a&nbsp;oddělovač posledního parametru je prázdný. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#varsep' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0165</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2017-10-29'>29. 10. 2017</time></span> </footer></article> <article id='vardelim' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Čtení parametru po variantní separátor</h3> <a href='#vardelim'><i class='fas fa-link'></i></a></div></header><section><p>Předchozí OPmac trik 0165 předpokládal, že nejprve skupinu parametrů celou načteme a&nbsp;pak je chceme oddělit od sebe podle separátorů. Jiný přístup je třeba zvolit, pokud chceme parametr načíst po proměnlivý separátor v&nbsp;textu, kde „nevíme co nás čeká“ a&nbsp;čtení chceme okamžitě zastavit, jakmile zjistíme přítomnost separátoru. </p><p>Napřílad <code>\memakro</code> má přečíst text až do konce odstavce nebo do výskytu <code>\enditems</code> podle toho, co nastane dříve. Pak můžeme použít <code>\vardelim{seznam separátorů}</code> těsně před <code>\def\memakro</code>, které definujeme jakoby s&nbsp;jedním neseparovaným parametrem: </p><pre class='pr-3'><code>\vardelim{\par\enditems}\def\memakro#1{\message{param:"#1"}} 
 
užití: \memakro text text 
       \enditems 
</code></pre><p>V&nbsp;tomto příkladě bude v&nbsp;<code>#1</code> <code>text text </code> a&nbsp;čtení je ukončeno výskytem <code>\enditems</code>. Pozor! Na rozdíl od klasického makra se separovaným parametrem ten výskyt separátoru <code>\enditems</code> není po provedení makra zničen, ale zůstává ve vstupní frontě a&nbsp;je pak znovu načten. Chceme-li jej zničit, můžeme definovat <code>\memakro</code> se dvěma parametry, tedy </p><pre class='pr-3'><code>\vardelim{\par\enditems}\def\memakro#1#2{\message{param:"#1", sep: "\noexpand#2"}} 
</code></pre><p>Pak je v&nbsp;<code>#2</code> použitý separátor. Proměnlivý separátor v&nbsp;našem řešení musí být jediným tokenem. Chcete-li obecnější řešení, kdy proměnlivý separátor může sestávat z&nbsp;libovolného počtu tokenů, pak můžete použít mé řešení uvedené <a href='https://tex.stackexchange.com/questions/200452/' title='zde na TeX stackexchange'>zde na TeX stackexchange</a> </p><p>Implementace makra <code>\vardelim</code> vypadá takto: </p><pre class='pr-3'><code>\long\def\vardelim#1#2#3{% 
   \def#3{\expandafter\vardelimA\csname var\string#3\endcsname{#1}}% 
   \long\expandafter#2\csname var\string#3\endcsname 
} 
\long\def\vardelimA#1#2{\bgroup \let\bgroupT=\bgroup \let\bgroup=\relax \def\tmp{}% 
   \def\vardelimF##1\vardelimN{\fi\expandafter\egroup\expandafter#1\expandafter{\tmp}}% 
   \def\vardelimP{}% 
   \vardelimB#2\vardelimB 
} 
\long\def\vardelimB#1{% 
   \ifx\vardelimB#1\expandafter\vardelimC\else 
      \addto\vardelimP{\vardelimH#1}\expandafter\vardelimB \fi 
} 
\def\vardelimC{\futurelet\next\vardelimD} 
\def\vardelimD{% 
   \ifx\next\bgroupT \vardelimG \fi 
   \expandafter\ifx\space\next \vardelimS \fi 
   \vardelimP 
   \vardelimN 
} 
\long\def\vardelimG#1\vardelimN#2{\fi\addto\tmp{{#2}}\vardelimC} 
\def\vardelimS#1\vardelimN{\fi\addto\tmp{ }\afterassignment\vardelimC\let\next= } 
\long\def\vardelimN#1{\addto\tmp#1\vardelimC} 
\long\def\vardelimH#1{\ifx\next#1\vardelimF\fi} 
</code></pre><p>Makro čte parametr token po tokenu {s výjimkou výskytu skupiny v&nbsp;parametru, kterou přečte celou} a&nbsp;parametr kumuluje v&nbsp;<code>\tmp</code>. Nakonec spustí makro s&nbsp;argumentem <code>{expandované \tmp}</code>. Makro pracuje vždy tak, jakoby bylo s&nbsp;prefixem <code>\long</code>. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#vardelim' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0166</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2018-04-07'>07. 04. 2018</time></span> </footer></article>
                            </section>  <section id="struktura" class="mb-5 rounded my-shadow" style="background-color: #778c94">
                                <header class="text-center">
                                  <div class="py-2">
                                    <h2 class="d-inline text-light font-weight-light">Struktura</h2>
                                    <a href="#struktura"><i class="fas fa-link"></i></a>
                                  </div>
                                </header>
                                <article id='latexchap' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>LaTeXové značkování kapitol a sekcí</h3> <a href='#latexchap'><i class='fas fa-link'></i></a></div></header><section><p>Některé editory nabízejí inteligentní chování, rozpoznají-li v&nbsp;textu LaTeXové značkování. Například podle <code>\chapter</code>, <code>\section</code>, <code>\subsection</code> interpretují stromovou strukturu textu a&nbsp;umožňují jednotlivé části textu dle potřeby kliknutím otevírat a&nbsp;zavírat. Bohužel OPmac přišel 30 let po LaTeXu a&nbsp;editory si na něj ještě nezvykly. Nechcete-li zrovna řešit překonfigurování editoru, můžete si jednoduše základní LaTeXové značkování doplnit a&nbsp;v dokumentu ty značky používat. Například: </p><pre class='pr-3'><code>\def\bracedparam#1{\csname\string#1:M\endcsname} 
\def\chapter{\bracedparam\chap} 
\def\section{\bracedparam\sec} 
\def\subsection{\bracedparam\secc} 
</code></pre><p>Pokud někdo naopak upraví konfiguraci svého editoru tak, aby spolupracoval se značkováním podle OPmac, uvítám o&nbsp;tom informaci a&nbsp;rád na stránkách OPmac dám na takové řešení odkaz. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#latexchap' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0036</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2014-01-29'>29. 01. 2014</time></span> </footer></article> <article id='sec' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Řešení konfliktu jména \sec</h3> <a href='#sec'><i class='fas fa-link'></i></a></div></header><section><p>OPmac předefinovává plainTeXové makro <code>\sec</code>, kterému Knuth přidělil úkol vytisknout matematickou funkci secans. Makro je v&nbsp;OPmac vyhrazeno pro vyznačení nadpisu sekce. Tato likvidace původního významu makra byla autorem OPmac provedena záměrně, protože užití <code>\sec</code> ve významu secans je velmi ojedinělé, ne-li žádné. Pokud ale uživatel chce používat <code>\sec</code> mimo matematický mód jako sekci a&nbsp;uvnitř matematického módu jako secans, může to zařídit třeba takto: </p><pre class='pr-3'><code>\let\section=\sec 
\def\secans{\mathop{\rm sec}\nolimits} 
\def\sec{\relax\ifmmode\secans \else \expandafter\section\fi} 
\addprotect\sec 
</code></pre><p>Povšimněme si, že je nutné deklarovat <code>\sec</code> pomocí <code>\addprotect</code>, aby i&nbsp;v obsahu správně fungovalo třeba toto: </p><pre class='pr-3'><code>\sec Význam funkce $\sec$ 
</code></pre></section><footer class='text-right'><a href='opmac-tricks-e.html#sec' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0129</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2015-11-05'>05. 11. 2015</time></span> </footer></article>
                            </section>  <section id="jazyky" class="mb-5 rounded my-shadow" style="background-color: #778c94">
                                <header class="text-center">
                                  <div class="py-2">
                                    <h2 class="d-inline text-light font-weight-light">Jazyky</h2>
                                    <a href="#jazyky"><i class="fas fa-link"></i></a>
                                  </div>
                                </header>
                                <article id='multilang' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Texty ve více jazycích</h3> <a href='#multilang'><i class='fas fa-link'></i></a></div></header><section><p>OPmac pracuje pouze s&nbsp;automaticky generovanými slovy Chapter/Kapitola/Kapitola, Table/Tabulka/Tabuľka a&nbsp;Figure/Obrázek/Obrázok. V&nbsp;dokumentaci je popsáno, jak se dají ta slova modifikovat nebo přidat další pomocí <code>\sdef</code>. Při tvorbě šablon <a href='custyle.html' title='CUstyle'>CUstyle</a> a&nbsp;<a href='ctustyle.html' title='CTUstyle'>CTUstyle</a> jsem potřeboval připravit mnoho dalších slov a&nbsp;umožnit psát v&nbsp;angličtině, češtině nebo slovenštině. Používání <code>\sdef</code> při deklaraci slov by bylo moc zlouhavé, vytvořil jsem tedy zkratku <code>\mtdef</code>: </p><pre class='pr-3'><code>\def\slet#1#2{\expandafter\let\csname#1\expandafter\endcsname\csname#2\endcsname} 
\def\mtdef#1#2#3#4{\sdef{mt:#1:en}{#2} \sdef{mt:#1:cz}{#3} 
  \if$#4$\slet{mt:#1:sk}{mt:#1:cz}\else \sdef{mt:#1:sk}{#4}\fi} 
 
\mtdef {abstract}     {Abstract}          {Abstrakt}       {} 
\mtdef {author}       {Author}            {Autor}          {} 
\mtdef {thanks}       {Acknowledgement}   {Poděkování}     {Poďakovanie} 
\mtdef {declaration}  {Declaration}       {Prohlášení}     {Prehlásenie} 
\mtdef {keywords}     {Keywords}          {Klíčová slova}  {Kľúčové slová} 
\mtdef {title}        {Title}             {Název práce}    {Názov práce} 
\mtdef {contents}     {Contents}          {Obsah}          {} 
\mtdef {tables}       {Tables}            {Tabulky}        {Tabuľky} 
\mtdef {figures}      {Figures}           {Obrázky}        {} 
\mtdef {supervisor}   {Supervisor}        {Vedoucí práce}  {Vedúci práce} 
\mtdef {supervisorD}  {Supervisor}        {Školitel}       {Školiteľ} 
\mtdef {bibliography} {References}        {Literatura}     {Literatúra} 
\mtdef {appendix}     {Appendix}          {Příloha}        {Príloha} 
\mtdef {specifi}      {Specification}     {Zadání}         {Zadanie} 
 
\mtdef {B} {Bachelor's thesis} {Bakalářská práce}  {Bakalárska práca} 
\mtdef {M} {Master's thesis}   {Diplomová práce}   {Diplomová práca} 
\mtdef {D} {Ph.D. thesis}      {Dizertační práce}  {Dizertačná práca} 
</code></pre><p>Pokud údaj pro slovenštinu chybí, není to proto, že bych si nemohl vzpomenout, ale je to tím, že je použito stejné slovo jako v&nbsp;češtině. </p><p>V&nbsp;makru pak v&nbsp;místě, kde se má potřebné slovo objevit, píšeme <code>\mtext{abstract}</code>, <code>\mtext{author}</code>, <code>\mtext{B}</code> atd. Vypíše se odpovídající slovo podle předchozího nastavení vzorů dělení slov <code>\ehyph</code>, <code>\chyph</code> nebo <code>\shyph</code>. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#multilang' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0014</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2013-08-17'>17. 08. 2013</time></span> </footer></article> <article id='nextlang' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Přidání dalšího jazyka</h3> <a href='#nextlang'><i class='fas fa-link'></i></a></div></header><section><p>Jakým způsobem se přidá další jazyk do csplainu je popsáno v&nbsp;souboru <code>hyphen.lan</code>. Předpokládejme, že je přidána němčina <code>\delang</code> a&nbsp;polština <code>\pllang</code>. Je pak možné vytvořit analogický příkaz k&nbsp;výše popsanému příkazu <code>\mtdef</code> a&nbsp;pomocí něj zavést stejné fráze do dalších jazyků: </p><pre class='pr-3'><code>\sdef{lan:21}{de}  \sdef{lan:121}{de} 
\sdef{lan:23}{pl}  \sdef{lan:123}{pl} 
\def\mtdefx#1#2#3{\sdef{mt:#1:de}{#2}\sdef{mt:#1:pl}{#3}} 
 
             % German              % Polish 
\mtdefx {D}  {Ph.D. Dissertation}  {Praca doktorska} 
... 
</code></pre><p>Když nyní zapneme vzory dělení třeba do polštiny (<code>\pllang</code>), vytiskne příkaz <code>\mtext{D}</code> frázi Praca doktorska. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#nextlang' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0049</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2014-04-26'>26. 04. 2014</time></span> </footer></article> <article id='Uppercase' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Uppercase německého ß</h3> <a href='#Uppercase'><i class='fas fa-link'></i></a></div></header><section><p>UTF-8 znak ß je v&nbsp;csplainu kódován jako <code>\ss</code> za pomocí encTeXu. Chceme-li tisknout německé texty konvertované automaticky na velká písmena, má se tento znak proměnit v&nbsp;SS. Toho lze dosáhnout třeba takto: </p><pre class='pr-3'><code>\def\Uppercase#1{\begingroup 
   \def\ss{SS}\uppercase{\edef\tmp{#1}}% 
   \expandafter\endgroup\tmp 
} 
 
\Uppercase{Mainstraße} 
</code></pre></section><footer class='text-right'><a href='opmac-tricks-e.html#Uppercase' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0083</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2014-12-20'>20. 12. 2014</time></span> </footer></article> <article id='exseven' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Konverze frází z \mtext na velká písmena</h3> <a href='#exseven'><i class='fas fa-link'></i></a></div></header><section><p>Makro <code>\mtext{id}</code> expanduje na skutečnou frázi ve třech krocích: </p><pre class='pr-3'><code>\mtext{id} -&gt; \csname mt:id:\csname lan:\the\language\endcsname\endcsname 
\csname mt:id:\csname lan:\the\language\endcsname\endcsname -&gt; \mt:id:cs 
\mt:id:cs -&gt; skutečný text 
</code></pre><p>Chceme-li konvertovat takový text na velká písmena, musíme nejprve provést všechny tři úrovně expanze, na což potřebujeme sedm příkazů <code>\expandafter</code>: </p><pre class='pr-3'><code>\def\exseven{\expandafter\expandafter\expandafter 
             \expandafter\expandafter\expandafter\expandafter} 
...\uppercase\exseven{\mtext{id}}... 
</code></pre></section><footer class='text-right'><a href='opmac-tricks-e.html#exseven' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0091</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2015-01-25'>25. 01. 2015</time></span> </footer></article> <article id='hebrew' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Hebrejština -- sazba zprava doleva</h3> <a href='#hebrew'><i class='fas fa-link'></i></a></div></header><section><p>Sazbu zprava doleva zvládá i&nbsp;pdfTeX vybavený eTeXem (toto rozšíření se aktivuje při inicializaci formátu a&nbsp;pdfcsplain je s&nbsp;ním obvykle inicializován), protože eTeX obsahuje modul TeXXeT. Tento modul začne pracovat po zadání <code>\TeXXeTstate=1</code> na začátku dokumentu a&nbsp;pak akceptuje příkazy <code>\beginR...\endR</code>, mezi kterými probíhá sazba (v horizontálním módu) zprava doleva. </p><p>Připravíme makro <code>\hebrew{...text v hejštině...}</code> a&nbsp;<code>\hebrewpar{... několik odstavců v hebrejštině ...}</code>, které vytvoří sazbu krátkých hebrejských textů. V&nbsp;pdfTeXu použijeme 8bitový font <code>rcjhbltx.tfm</code> (běžně dostupný v&nbsp;TeXových distribucích) a&nbsp;překódování z&nbsp;UTF-8 vstupu na tento font provedeme encTeXem. </p><p>Poznámka: v&nbsp;textovém editoru, který umí správně pracovat s&nbsp;UNICODE znaky hebrejštiny, píšete text v&nbsp;pořadí znaků, jak se čte, nicméně v&nbsp;okně editoru se automaticky sekvence znaků zobrazuje „pozpátku“, protože editor zná úseky znaků UNICODE tabulky, které má zobrazovat tímto způsobem. Do souboru je ale sekvence znaků uložena v&nbsp;pořadí, jak se čte. Proto je nutné toto pořadí znovu převrátit v&nbsp;sazbě příkazy <code>\beginR</code> a&nbsp;<code>\endR</code>. </p><pre class='pr-3'><code>\TeXXeTstate=1 
\font\hebrewfont=rcjhbltx 
\def\texthebrew#1{\leavevmode\beginR{\hebrewfont#1}\endR} 
\long\def\hebrewpar#1{\par\hbox{\beginR\vbox{\hebrewfont#1}\endR}} 
 
%      sekvence            UTF-8 kód                                     kód ve fontu 
\mubyte\HEBalef             ^^d7^^90\endmubyte      \chardef\HEBalef              39 
\mubyte\HEBbet              ^^d7^^91\endmubyte      \cahrdef\HEBbet               98 
... 
\mubyte\HEBshin             ^^d7^^a9\endmubyte      \chardef\HEBshin             152 
\mubyte\HEBshinshindotdages ^^ef^^ac^^ab\endmubyte  \chardef\HEBshinshindotdages 153 
... 
</code></pre><p>Kód znaku ve fontu zjistíte pohledem do souboru <code>cjhebltx.enc</code>, který je součástí TeXových distribucí. Pokud se vám nechce zjišťovat UTF-8 kódy všech znaků a&nbsp;jste schopni v&nbsp;editoru přímo tyto znaky napsat, můžete kódování fontu deklarovat i&nbsp;přímo pomocí těchto znaků (v ukázce je místo skutečného znaku jen zkratka heb-znak, protože skutečný znak na této WWW stránce zobrazit nelze). </p><pre class='pr-3'><code>\mubytein=0 
%      sekvence          skutečný znak                               kód ve fontu 
\mubyte\HEBalef             heb-znak\endmubyte  \chardef\HEBalef              39 
\mubyte\HEBbet              heb-znak\endmubyte  \cahrdef\HEBbet               98 
... 
\mubyte\HEBshin             heb-znak\endmubyte  \chardef\HEBshin             152 
\mubyte\HEBshinshindotdages heb-znak\endmubyte  \chardef\HEBshinshindotdages 153 
... 
\mubytein=1 
</code></pre><p>Je-li někdo ochoten zaslat mi hotovou tabulku s&nbsp;hebrejskými znaky a&nbsp;soubor s&nbsp;ukázkou sazby hebrejského textu, rád sem zařadím odkaz. </p><p>Podobně (ale bez pravolevé sazby) je v&nbsp;souboru <code>cyrchars.tex</code> řešena sazba promocí encTeXu azbukou. Soubor <code>cyrchars.tex</code> je součástí csplainu a&nbsp;přímo v&nbsp;něm je dokumentace a&nbsp;ukázky. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#hebrew' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0092</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2015-01-26'>26. 01. 2015</time></span> </footer></article>
                            </section>  <section id="matematicka-sazba" class="mb-5 rounded my-shadow" style="background-color: #778c94">
                                <header class="text-center">
                                  <div class="py-2">
                                    <h2 class="d-inline text-light font-weight-light">Matematická sazba</h2>
                                    <a href="#matematicka-sazba"><i class="fas fa-link"></i></a>
                                  </div>
                                </header>
                                <article id='alphachars' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>České texty v matematice</h3> <a href='#alphachars'><i class='fas fa-link'></i></a></div></header><section><p>V&nbsp;matematice nefungují akcentované znaky (č, á, ř atd.), protože nemají třídu 7&nbsp;a nejsou tedy zařazeny do matematické abecedy. Ve zlomku <code>$cena \over výkon$</code> chceme, aby byly texty zmenšeny (nelze je dát jednoduše do <code>\hbox</code>u) a&nbsp;navíc chceme, aby byly vytištěny správně. Rychlé řešení <code>$\rm cena\over výkon$</code> funguje při použití CSfontů, ale po přepnutí na jinou rodinu fontů nastávají potíže. Ty lze vyřešit zařazením české abecedy do znaků třídy 7&nbsp;(matematická abeceda) takto: </p><pre class='pr-3'><code>\def\setmathalphabetcode#1{\ifx\XeTeXmathcode\undefined 
     \tmpnum=\itfam \multiply\tmpnum by256 \advance\tmpnum by`#1 
     \advance\tmpnum by"7000 \mathcode`#1 = \tmpnum \relax 
   \else \XeTeXmathcode`#1 = 7 \itfam `#1 \fi 
} 
\def\mathalphabetchars#1{\if^#1^\else 
   \setmathalphabetcode#1\expandafter\mathalphabetchars\fi} 
 
\mathalphabetchars ÁáÄäČčĎďÉéĚěÍíĹĺĽľŇňÓóÖöÔôŔŕŘřŠšŤťÚúŮůÜüÝýŽž{} 
</code></pre><p>Nyní mají znaky české abecedy stejnou vlastnost, jako jiné znaky matematické abecedy a&nbsp;jsou implicitní v&nbsp;kurzívě a&nbsp;dají se přepínat. Je ovšem nutné, aby v&nbsp;dané matematické rodině byl zaveden font, který tyto znaky obsahuje (což nemusí být vždy splněno). </p><p>Makro <code>\setmathalphabetcode</code> přidělí znaku třídu 7&nbsp;s výchozí rodinou <code>\itfam</code>. Není-li přitomna 16bitová mašina, použije se k&nbsp;tomu primitiv <code>\mathcode</code>, jinak se použije primitiv <code>\XeTeXmathcode</code>. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#alphachars' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0025</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2013-09-02'>02. 09. 2013</time></span> </footer></article> <article id='eqnum' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Odkaz na předchozí rovnici</h3> <a href='#eqnum'><i class='fas fa-link'></i></a></div></header><section><p>V&nbsp;matematickém textu s&nbsp;číslovanými rovnicemi často odkazujeme na tu poslední nebo předposlední rovnici. Je pak možná zbytečné pro ně vymýšlet lejblíky a&nbsp;odkazovat na ně pomocí <code>\ref[lejblík]</code>. Stačí napsat <code>\eqmark</code> bez lejblíku a&nbsp;odkazovat pomocí <code>\lasteq</code> (poslední rovnice), <code>\preveq2</code> (předpolední rovnice), <code>\preveq3</code> (před-předposlední rovnice) atd. Takže třeba: </p><pre class='pr-3'><code>$$a^2 + b^2 = c^2  \eqmark$$ 
Předchozí rovnice \lasteq\ je tvrzením Pythagorovy věty. 
</code></pre><p>Makra <code>\lasteq</code> a&nbsp;<code>\preveq</code> je možné definovat takto: </p><pre class='pr-3'><code>\newcount\eqlabnum 
\addto\eqmark{{\global\advance\eqlabnum by1 
   \label[.eqlab:\the\eqlabnum]\wlabel\thednum}} 
\def\preveq#1{\tmpnum=\eqlabnum\advance\tmpnum by-#1\advance\tmpnum by1 
   \ref[.eqlab:\the\tmpnum]} 
\def\lasteq{\preveq1} 
</code></pre><p>Je zde zaveden globální registr <code>\eqlabnum</code>, pomocí kterého každé rovnici označené makrem <code>\eqmark</code> se přidělí interní lejblík <code>.eqlab:\the\eqlabnum</code>, přičemž číslo <code>\eqlabnum</code> se vždy zvětší o&nbsp;jedničku. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#eqnum' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0028</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2013-09-06'>06. 09. 2013</time></span> </footer></article> <article id='overtilde' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Natahovací tilde nad vzorcem jakékoli velikosti</h3> <a href='#overtilde'><i class='fas fa-link'></i></a></div></header><section><p>PlainTeX používá makro <code>\widetilde</code>, které odkazuje do fontu se třemi postupně se zvětšujícími velikostmi vlnky a&nbsp;dál není nic. To naprosto neuspokojí pokrývače, kteří chtějí pokrýt vzorec libovolné šířky vlnkou. Navrhneme tedy makro <code>\overtilde</code>, které změří pokrývaný vzorec a&nbsp;pomoci <code>\pdfscale</code> zvětší či zmenší největší element ve fontu pro <code>\widetilde</code> tak, že výsledek je vždy celý pokrytý. Například: </p><pre class='pr-3'><code>$$\displaylines{ 
  \overtilde{b} + \overtilde{ab} + \overtilde{a+bc}+{}\cr 
  {}+\overtilde{b+c+d}+ \overtilde{a+b+c+df} 
}$$ 
</code></pre><p>dá tento výsledek: </p><p><img src='img/overtilde.png' alt='Ukázka overtilde' title='Ukázka overtilde' class='img-fluid rounded mx-auto my-2 d-block'> </p><p>Makro <code>\overtilde</code> je definováno takto: </p><pre class='pr-3'><code>\mathchardef\widetildemax="0367 
 
\def\widetildeto #1{\bgroup\tmpdim=#1\setbox0=\hbox{$\widetildemax$}% 
   \tmpdim=16\tmpdim \tmpnum=\tmpdim \tmpdim=\wd0 \divide\tmpdim by16 
   \divide\tmpnum by\tmpdim 
   \hbox to#1{\pdfsave\rlap{\pdfscale{\the\tmpnum}{\ifnum\tmpnum&lt;588 1\else\the\tmpnum\fi}% 
                            \pdfscale{.00390625}{\ifnum\tmpnum&lt;588 1\else.0017\fi}% 
                            \vbox to0pt{\hbox{$\widetildemax$}\vss}}\pdfrestore\hss}% 
   \egroup 
} 
\def\overtilde#1{\setbox1=\hbox{$#1$}% 
  \vbox{\offinterlineskip \halign{\hfil##\hfil\cr 
        \widetildeto{\wd1}\cr\noalign{\kern.5ex\kern.02\wd1}\box1\cr}}% 
} 
</code></pre><p>Makro <code>\widetildeto</code> zvětší <code>\widetildemax</code> na požadovanou velikost <code>#1</code>. Čitatel pro výpočet poměru velikostí vynásobí <code>16</code>, jmenovatel vydělí <code>16</code>, takže výsledený poměr uložený v&nbsp;<code>\tmpnum</code> je <code>256</code> krát skutečný poměr. Proto jej do <code>\pdfscale</code> vložíme a&nbsp;následně vložíme <code>\pdfscale .00390625</code>, což je <code>1/256</code>. Výšku znaku necháme nezměněnu až do poměru <code>588/256</code>. Je-li poměr větší, je mírně zvětšena i&nbsp;výška znaku poměrem <code>0.4352</code> krát původní výška. Makro <code>\overtilde</code> změří pokrývaný vzorec v&nbsp;<code>\boxu1</code>, zavolá <code>\widetildeto</code> a&nbsp;sestaví vlnku a&nbsp;vzorec pod sebe pomocí <code>\halign</code>. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#overtilde' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0070</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2014-06-17'>17. 06. 2014</time></span> </footer></article> <article id='mathbox' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Box s textem ve velikosti podle kontextu (index, indexindex)</h3> <a href='#mathbox'><i class='fas fa-link'></i></a></div></header><section><p>V&nbsp;LaTeXu je k&nbsp;dispozici makro <code>\text{cosi}</code>, které v&nbsp;matematickém módu vysází <code>cosi</code> stejně jako <code>\hbox{cosi}</code>, ale velikost textu je přizpůsobena tomu, zda se příkaz vyskytuje v&nbsp;základu, indexu nebo indexindexu. Navíc si příkaz pamatuje vnější matematický kontext a&nbsp;když uvnitř textu napíšeme <code>$...$</code>, bude sazba ve stejném kontextu (displaystyle, textstyle). </p><p>Vytvoříme analogické makro <code>\mathbox{text}</code>, které se chová výše popsaným způsobem. Při použití OPmac k&nbsp;tomu potřebujeme tři řádky kódu: </p><pre class='pr-3'><code>\def\mathbox#1{{\mathchoice{\mathboxA\displaystyle[]{#1}}{\mathboxA\textstyle[]{#1}} 
    {\mathboxA\textstyle[700]{#1}}{\mathboxA\textstyle[500]{#1}}}} 
\def\mathboxA#1[#2]#3{\hbox{\everymath={#1}\if^#2^\else\typoscale[#2/]\relax\fi #3}} 
</code></pre></section><footer class='text-right'><a href='opmac-tricks-e.html#mathbox' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0078</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2014-09-04'>04. 09. 2014</time></span> </footer></article> <article id='mrepeat' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Opakování symbolu na zlomu řádku</h3> <a href='#mrepeat'><i class='fas fa-link'></i></a></div></header><section><p>V&nbsp;tradiční české sazbě (i jinde) se vyskytuje požadavek na opakování znaménka pro operaci či realaci, pokud je v&nbsp;tomto místě zlomen řádek. Připravíme makro <code>\mrepeatchar</code> znak, který předeklaruje znak tak, aby byl (pouze) v&nbsp;matematické sazbě aktivní a&nbsp;způsobil své opakování na zlomu řádku. Také připravíme makro <code>\mrepeatcs \sekvenceA \sekvenceB \sekvenceC ... \relax</code>, které předeklaruje význam uvedených sekvencí tak, že jako operace či relace se opakují na zlomu řádku. Například: </p><pre class='pr-3'><code>\mrepeatchar+ \mrepeatchar- \mrepeatchar= \mrepeatchar&lt; \mrepeatchar&gt; 
\mrepeatcs \approx \asymp \bot \cap \cdot \circ \cup \diamond 
   \div \equiv \geq \gg \in \leq \ll \odot \oplus \oslash \otimes \paralell 
   \perp \pm \prec \peceq \sim \simeq \subset \subseteq \supset \supseteq 
   \top \triangle \triangleleft \triangleright \uplus \vdash \vee \wedge \relax 
 
\hsize=5cm 
Test $a\sim b\sim c\sim d\sim e\sim f\sim g\sim i\sim k\sim l\sim m$. 
 
A taky $a+b+c+d+e+f+g+h+y+f&lt;e&lt;w&lt;e$. 
</code></pre><p>Po deklarování znaku (např. <code>\mrepeatchar+</code>) je možné použít <code>\NR+</code>, což se chová v&nbsp;matematické sazbě jako původní <code>+</code>. V&nbsp;textové sazbě se znak <code>+</code> nemění. Po deklarování sekvence (např. <code>\mrepeatcs \sim \relax</code>) je k&nbsp;dispozici sekvence <code>\NRsim</code>, která nese původní význam sekvence <code>\sim</code>. </p><p>Implementace může vypadat takto: </p><pre class='pr-3'><code>\def\NR#1{\csname NR:\string#1\endcsname} 
\def\mrepset#1{\begingroup \lccode`\~=`#1\lowercase{\endgroup\edef~}} 
\def\mrepeatchar#1{% 
   \isNRno\NR#1{\mathchardef\NR#1=\mathcode`#1 }% 
   \mrepset#1{\NR#1\nobreak \discretionary{}{\hbox{$\NR#1$}}{}} 
   \mathcode`#1="8000 
} 
\def\NRs#1{\csname NR\expandafter\NRx\string#1\endcsname} \def\NRx#1{} 
\def\mrepeatcs#1{\ifx#1\relax \else 
   \isNRno\NRs#1{\let\NRs#1=#1}% 
   \edef#1{\NRs#1\noexpand\nobreak \discretionary{}{\hbox{$\NRs#1$}}{}}% 
   \expandafter\mrepeatcs\fi 
} 
\def\isNRno#1#2#3{\expandafter\expandafter\expandafter\ifx#1#2\relax 
   \expandafter\expandafter\expandafter#3\else 
   \message{\string#2\space declared already}\fi} 
</code></pre><p>Řešení je robustní, chytré znaky můžete bez obav použít v&nbsp;nadpisech kapitol a&nbsp;sekcí. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#mrepeat' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0148</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2016-05-18'>18. 05. 2016</time></span> </footer></article> <article id='dots' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Inteligentní \dots jako v AMSTeXu</h3> <a href='#dots'><i class='fas fa-link'></i></a></div></header><section><p>AMSTeX nabízí některá zajímavá makra. Můžete si natáhnout <code>\input amstex</code> před <code>\input opmac</code> a&nbsp;tím tato makra využít. Je však třeba těsně za <code>\input amstex</code> napsat <code>\catcode\@=12</code>, protože AMSTeX nastavuje tento znak jako aktivní a&nbsp;to nedělá dobrotu. </p><p>Nebo si zajímavá makra naprogramujeme sami. Například makro <code>\dots</code> pracuje v&nbsp;AMSTeXu podle kontextu. V&nbsp;textovém módu se chová jako klasické <code>\dots</code>, v&nbsp;matematickém módu se chová jako <code>\cdots</code> nebo <code>\ldots</code> v&nbsp;závislosti na tom, čím je obklopeno. Tedy: </p><pre class='pr-3'><code>$$ 
  a_1,\dots a_n, \quad           % chová se jako \ldots 
  a_1 + \dots + a_n, \quad       % chová se jako \cdots 
  A_1 \subset \dots \subset A_n  % chová se jako \cdots 
$$ 
</code></pre><p>Takovou inteligenci je možné dát makru <code>\dots</code> pomocí následujícího kódu: </p><pre class='pr-3'><code>\let\textdots=\dots 
\def\dots{\ifmmode \expandafter\mathdots \else \expandafter\textdots \fi} 
\def\mathdots{\futurelet\next\mathdotsA} 
\def\mathdotsA{\mathdotsB +-=&lt;&gt;()[]\{\}\langle\rangle \end 
   \edef\tmpb{!\meaning\next}% 
   \expandafter\isinlist\expandafter\tmpb\expandafter{\expandafter!\string\mathchar"}% 
   \iftrue \expandafter\mathdotsC\tmpb \end \else \ldots \fi 
   \relax 
} 
\def\mathdotsB#1{\ifx\end#1\else 
      \ifx\next#1\cdots \expandafter\expandafter\expandafter\skiptorelax 
      \else \expandafter\expandafter\expandafter\mathdotsB 
   \fi\fi 
} 
\def\mathdotsC#1"#2#3\end{\let\next=\ldots 
   \ifnum#2=1 \let\next=\cdots \fi % Big OP 
   \ifnum#2=2 \let\next=\cdots \fi % Bin 
   \ifnum#2=3 \let\next=\cdots \fi % Rel 
   \ifnum#2=4 \let\next=\cdots \fi % Open 
   \ifnum#2=5 \let\next=\cdots \fi % Close 
   \next 
} 
\addprotect\dots 
</code></pre><p>Makro <code>\mathdots</code> spuštěné v&nbsp;matematickém módu vloží do <code>\next</code> následující token a&nbsp;za pomocí <code>\mathdotsA</code> a&nbsp;<code>\mathdotsB</code> zjišťuje, zda to je některý ze znaků <code>+-=<>()[]{}</code>. Pokud ano, vloží <code>\cdots</code> a&nbsp;pomocí <code>\skiptorelax</code> končí. Jinak ještě prozkoumá, zda <code>\next</code> je <code>\mathchar</code> (např. <code>\le</code>). Pokud ne, vloží <code>\ldots</code>. Pokud ano, zjistí, pomocí <code>\mathdotsC</code>, zda tento <code>\mathchar</code> je třídy 1, 2, 3, 4&nbsp;nebo 5. Pokud ano, vloží <code>\cdots</code>, pokud ne, vloží <code>\ldots</code>. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#dots' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0084</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2014-12-20'>20. 12. 2014</time></span> </footer></article> <article id='dddot' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>\dddot pro třetí derivaci</h3> <a href='#dddot'><i class='fas fa-link'></i></a></div></header><section><p>Plain TeX nabízí nejvýše <code>\ddot x</code> pro druhou derivaci <code>x</code> dle času a&nbsp;toto makro je implementováno pomocí <code>\mathaccent</code>. Akcent pro trojtečku v&nbsp;matematických fontech nemáme, takže makro <code>\dddot x</code> pro třetí derivaci bude trochu složitější: </p><pre class='pr-3'><code>\def\dddot#1{{\mathpalette\dddotA{#1}}} 
\def\dddotA#1#2{\setbox0=\hbox{$#1#2$}\tmpdim=\ht0 \mathop{#2\kern0pt}\limits 
   ^{\vbox to0pt{\kern-.04em\hbox to0pt{\hss\it$#1.\mkern-1.5mu.\mkern-1.5mu.$% 
     \kern-\slantcorr\hss}\vss}}} 
</code></pre><p>Makro díky <code>\mathpalette</code> pracuje správně i&nbsp;ve skriptoidní či skriptskriptoidní velikosti. Také díky makru <code>\slantcorr</code> z&nbsp;OPmac je umístění nad znakem s&nbsp;ohledem na skloněnou osu základního znaku. Konstanty v&nbsp;makru jsou voleny tak, aby to vizuálně co nejlépe navazovalo na <code>\ddot</code> z&nbsp;CM fontů. Můžete porovnat výstup <code>\dddot</code> z&nbsp;LaTeXu při použití <code>amstex.sty</code> s&nbsp;tímto řešením. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#dddot' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0145</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2016-04-27'>27. 04. 2016</time></span> </footer></article> <article id='bbgreek' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Řecká písmena jako \bbchar</h3> <a href='#bbgreek'><i class='fas fa-link'></i></a></div></header><section><p>OPmac používá makro soubor ams-math, který pro písmena zdvojených tahů zavádí font <code>msbm*.tfm</code> z&nbsp;rodiny fontů AMS. Taková písmena vypadají daleko lépe než písmena z&nbsp;fontu <code>bbold*.tfm</code>. Fonty msbm mají ale jednu nevýhodu: neobsahují zdvojená řecká písmena. Pokud je chcete, naučíte se v&nbsp;tomto OPmac triku vyměnit fonty jedné rodiny za jinou. Pak můžete psát: </p><pre class='pr-3'><code>$\alpha = {\bbchar\alpha}$ 
</code></pre><p>a&nbsp;objeví se „alfa je rovno dvojitému alfa“. Pohledem do souboru <code>ams-math.tex</code> zjistíte, že rodina pro <code>\bbchar</code> má číslo 5&nbsp;a označení <code>msbm</code>, takže bude stačit udělat toto: </p><pre class='pr-3'><code>\regtfm msbm 0 bbold5 5.5 bbold6 6.5 bbold7 7.5 bbold8 8.5 bbold9 
             9.5 bbold10 11.1 bbold12 15 bbold17 * % using bbchar from bbold*.tfm 
 
\mathchardef\bbalpha="50B   \mathchardef\bbbeta="50C    \mathchardef\bbgamma="50D 
\mathchardef\bbdelta="50E   \mathchardef\bbepsilon="50F \mathchardef\bbzeta="510 
\mathchardef\bbeta="511     \mathchardef\bbtheta="512   \mathchardef\bbiota="513 
\mathchardef\bbkappa="514   \mathchardef\bblambda="515  \mathchardef\bbmu="516 
\mathchardef\bbnu="517      \mathchardef\bbxi="518      \mathchardef\bbpi="519 
\mathchardef\bbrho="51A     \mathchardef\bbsigma="51B   \mathchardef\bbtau="51C 
\mathchardef\bbupsilon="51D \mathchardef\bbphi="51E     \mathchardef\bbchi="50F 
\mathchardef\bbpsi="520     \mathchardef\bbomega="57F 
 
\addto\bbchar{\let\alpha\bbalpha \let\beta\bbbeta \let\gamma\bbgamma 
   \let\delta\bbdelda \let\epsilon\bbepsilon \let\zeta\bbzeta \let\theta\bbtheta 
   \let\iota\bbiota \let\kappa\bbkappa \let\lambda\bblambda \let\mu\bbmu 
   \let\nu\bbnu \let\xi\bbxi \let\pi\bbpi \let\rho\bbrho \let\sigma\bbsigma 
   \let\tau\bbtau \let\upsilon\bbupsilon \let\phi\bbphi \let\chi\bbchi 
   \let\psi\bbpsi \let\omega\bbomega 
} 
</code></pre></section><footer class='text-right'><a href='opmac-tricks-e.html#bbgreek' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0144</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2016-04-11'>11. 04. 2016</time></span> </footer></article> <article id='smartgreek' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Nekurzivní řecká písmena</h3> <a href='#smartgreek'><i class='fas fa-link'></i></a></div></header><section><p>V&nbsp;matematické sazbě je <code>$\beta$</code> v&nbsp;kurzívě bez ohledu na to, zda napíšeme třeba <code>$\rm\beta$</code>. Toto chování je možné změnit po deklaraci <code>\smartgreek</code>. Pak se přizpůsobí fontu <code>\rm</code> i&nbsp;malá řecká písmena. Makro <code>\smartgreek</code> vypadá takto: </p><pre class='pr-3'><code>\def\smartgreek{% 
   \expandafter\ifx\csname updelta\endcsname\relax \eurmgreek \fi 
   \escapechar=-1 \setsmartgreekA 
      \alpha\beta\gamma\delta\epsilon\zeta\eta\theta\iota\kappa\lambda\mu\nu\xi\pi\rho\sigma 
      \tau\upsilon\phi\chi\omega\varepsilon\vartheta\varpi\varrho\varsigma\varphi\relax 
   \escapechar=`\\ 
} 
\def\setsmartgreekA#1{\ifx#1\relax \else 
   \expandafter \let \csname ori\string#1\endcsname = #1% 
   \edef#1{\relax \noexpand\ifnum\fam=0 \thecsname up\string#1\endcsname 
          \noexpand\else \noexpand\ifnum\fam=\rmfam \thecsname up\string#1\endcsname 
          \noexpand\else \thecsname ori\string#1\endcsname 
          \noexpand\fi \noexpand\fi}% 
   \expandafter\setsmartgreekA \fi 
} 
\def\thecsname{\expandafter\noexpand\csname} 
\def\eurmgreek{\regtfm eurm 0 eurm5 6 eurm7 8.5 eurm10 * 
   \csname newfam\endcsname \eurmfam \tmpnum=\eurmfam \advance\tmpnum by-10 
   \edef\eurmh{\ifcase\tmpnum A\or B\or C\or D\or E\or F\fi}% 
   \addto\normalmath{\loadmathfamily {\eurmfam} eurm }\normalmath 
   \addto\boldmath{\loadmathfamily {\eurmfam} eurm }% 
   \mathchardef \upalpha "0\eurmh 0B    \mathchardef \upbeta  "0\eurmh 0C 
   \mathchardef \upgamma "0\eurmh 0D    \mathchardef \updelta "0\eurmh 0E 
   \mathchardef \upepsilon "0\eurmh 0F  \mathchardef \upzeta  "0\eurmh 10 
   \mathchardef \upeta   "0\eurmh 11    \mathchardef \uptheta "0\eurmh 12 
   \mathchardef \upiota  "0\eurmh 13    \mathchardef \upkappa "0\eurmh 14 
   \mathchardef \uplambda "0\eurmh 15   \mathchardef \upmu    "0\eurmh 16 
   \mathchardef \upnu   "0\eurmh 17     \mathchardef \upxi   "0\eurmh 18 
   \mathchardef \uppi   "0\eurmh 19     \mathchardef \uprho   "0\eurmh 1A 
   \mathchardef \upsigma   "0\eurmh 1B  \mathchardef \uptau   "0\eurmh 1C 
   \mathchardef \upupsilon "0\eurmh 1D  \mathchardef \upphi   "0\eurmh 1E 
   \mathchardef \upchi   "0\eurmh 1F    \mathchardef \uppsi   "0\eurmh 20 
   \mathchardef \upomega   "0\eurmh 21  \mathchardef \upvarepsilon "0\eurmh 22 
   \mathchardef \upvartheta "0\eurmh 23 \mathchardef \upvarpi   "0\eurmh 24 
   \let \upvarrho=\varrho \let \upvarsigma=\varsigma 
   \mathchardef \upvarphi   "0\eurmh 27 
} 
</code></pre><p>Je-li natažen tx-math, využijí se znaky <code>\upalpha</code>, <code>\upbeta</code> atd. odtud, jinak je potřeba znaky deklarovat z&nbsp;fontu eurm, což provede makro <code>\eurmgreek</code>. Makro <code>\setsmartgreek</code> předefinuje znaky <code>\alpha</code>, <code>\beta</code>, atd. takto: </p><pre class='pr-3'><code>\let\orialpha=\alpha 
\def\alpha{\relax \ifnum\fam=0 \upalpha \else \ifnum\fam=\rmfam \upalpha \else \orialpha \fi\fi} 
</code></pre></section><footer class='text-right'><a href='opmac-tricks-e.html#smartgreek' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0130</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2015-11-11'>11. 11. 2015</time></span> </footer></article> <article id='bfmath' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Normální \bf a \bi v matematickém módu</h3> <a href='#bfmath'><i class='fas fa-link'></i></a></div></header><section><p>OPmac volá <code>ams-math.tex</code> pro zavedení matematických fontů. Tento soubor (z CSplainu) nastavuje pro <code>\bf</code> a&nbsp;<code>\bi</code> v&nbsp;matematickém módu *bezserifové* varianty písma, protože to je pro značení matic a&nbsp;vektorů v&nbsp;české sazbě obvyklejší. Ovšem někdo může chtít i&nbsp;matematické sazbě použít normální serifové varinaty písma pro <code>\bf</code> a&nbsp;<code>\bi</code>. Pak může psát: </p><pre class='pr-3'><code>\addto\normalmath{% 
   \setmathfamily {\bffam} \tenbf  \setmathfamily {\bifam} \tenbi 
} 
\addto\boldmath{% 
   \setmathfamily {\bffam} \tenbf  \setmathfamily {\bifam} \tenbi 
} 
\normalmath 
</code></pre><p>Typicky nejsou pro tučnou verzi matematické sazby k&nbsp;dispozici supertučné varianty písma, takže jsme se zde museli spokojit v&nbsp;<code>\boldmath</code> se stejným řešením jako v&nbsp;<code>\normalmath</code>. Používáte-li písmovou rodinu, která disponuje supertučnými písmy, pak můžete napsat něco podobného tomuto: </p><pre class='pr-3'><code>\addto\boldmath{% 
   \loadmathfamily {\bffam} heavy-bf \setmathfamily {\bifam} heavy-bi 
} 
</code></pre></section><footer class='text-right'><a href='opmac-tricks-e.html#bfmath' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0146</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2016-05-02'>02. 05. 2016</time></span> </footer></article> <article id='vecmath' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Vektory včetně řeckých znaků tučně bez serifů</h3> <a href='#vecmath'><i class='fas fa-link'></i></a></div></header><section><p>Jak bylo řečeno v&nbsp;předchozím OPmac triku, OPmac používá pro <code>\bf</code> a&nbsp;<code>\bi</code> v&nbsp;matematické sazbě tučný bezserifový font, protože je to v&nbsp;české sazbě vektorů a&nbsp;matic obvyklejší. Někdy bychom chtěli matice mít stojatě a&nbsp;vektory skloněné, přitom obojí označovat např. pomocí <code>\_A\_x = \_b</code>. Dále bychom chtěli po napsání <code>\_\gamma</code> dostat tučný bezseriový znak gamma, což implicitně <code>\bf</code> ani <code>\bi</code> neumějí. Postará se o&nbsp;to následující makro: </p><pre class='pr-3'><code>\addto\normalmath{\loadmathfamily 12 cmbrmb10 \loadmathfamily 13 cmssbx10 } 
\addto\boldmath{\loadmathfamily 12 cmbrmb10 \loadmathfamily 13 cmssbx10 } 
\normalmath 
 
\def\_#1{{\expandafter\vecboldify\string#1\end}} 
\def\vecboldify#1#2\end{% 
   \ifx\relax#2\relax 
      \ifnum\lccode`#1=`#1\bi#1\else\bf#1\fi % skolněná malá, stojatá velká  
   \else 
      \expandafter\expandafter\expandafter\vecboldifyG % tučný sans pro řečtinu 
      \expandafter\meaning \csname #2\endcsname\end 
   \fi 
} 
\def\vecboldifyG #1"#2#3\end{\ifx7#2\fam13\mathchar"7#3 \else \mathchar"C#3 \fi} 
</code></pre><p>Nejprve je zaveden font cmbrmb10 do matematické rodiny 12. Ten obsahuje bezserifovou tučnou řečtinu, bohužel i&nbsp;velká písmena této řečtiny jsou skolněná. Takže je zaveden ještě font cmssbx10 do rodiny 13 obsahující  bezserifové tučné verzálky řeckých písmen (ale zase bohužel nebsahuje řecké mínusky). </p><p>Makro pomocí <code>\string</code> ověří, zda následuje písmeno nebo řídicí sekvence. V&nbsp;prvém případě pak pomocí <code>\lccode</code> rozhodne, zda použije <code>\bf</code> nebo <code>\bi</code>. Ve druhém případě pomocí <code>\meaning</code> zjistí mathcode daného znaku. Začíná-li sedmičkou, jedná se o&nbsp;velká řecká písmena a&nbsp;použije se rodina 13. Jinak se použije rodina C=12. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#vecmath' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0170</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2019-10-20'>20. 10. 2019</time></span> </footer></article> <article id='dfam' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Matematické rodiny dynamicky přidělené</h3> <a href='#dfam'><i class='fas fa-link'></i></a></div></header><section><p>Klasický TeX i&nbsp;pdfTeX mají omezení na nejvýše 16 matematických rodin fontů v&nbsp;jednom vzorečku. OPmac pomocí <code>ams-math.tex</code> nebo <code>tx-math.tex</code> alokuje staticky (pro celý dokument) 12 resp. 14 rodin. Můžete jich staticky alokovat méně a&nbsp;dynamicky doplnit jen potřebné rodiny v&nbsp;rámci každého jednotlivého vzorečku. Pak můžete mít v&nbsp;dokumentu libovolné množství matematických rodin, jen omezení 16 rodin na vzoreček pochopitelně zůstává. </p><p>Vytvoříme makro <code>\dfam{jméno-rodiny}</code>, které se uvnitř vzorečku chová jako <code>\fam=číslo</code>, ale rodinu alokuje dynamicky. Dále vytvoříme makro </p><pre class='pr-3'><code>\dmathchardef\sekvence třída{jméno-rodiny}kód 
</code></pre><p>které deklaruje <code>\sekvenci</code> podobně jako <code>\matchardef</code>, ale odpovídající rodina se automaticky alokuje jen, pokud je <code>\sekvence</code> ve vzorečku použita. Pro příklad předpokládejme, že není staticky zavedena rodina eufm pro frakturu a&nbsp;rsfs pro skript. Pak je možné na začátku dokumentu deklarovat: </p><pre class='pr-3'><code>% obecně: \sdef{dfam:jméno-rodiny}{jméno-fontu-jako-v-\loadmathfamily} 
\sdef{dfam:fractur}{eufm}   \def\fractur{\dfam{fractur}} 
\sdef{dfam:script}{rsfs}    \def\script{\dfam{script}} 
% ... 
\dmathchardef\cosi 0{fractur}00  % znak třídy 0 kódu 00 (hex) z rodiny fractur 
% ... 
</code></pre><p>a&nbsp;následně to použít: </p><pre class='pr-3'><code>$a \times {\script B} = {\fractur C}$, a taky $ \beta = \cosi^2 $. 
</code></pre><p>V&nbsp;ukázce jsou dva vzorečky. Vedle staticky zavedených rodin jsou v&nbsp;prvním vzorečku navíc dynamicky alokovány rodiny rsfs a&nbsp;eufm a&nbsp;ve druhém jen rodina eufm. </p><p>Implementace je následující </p><pre class='pr-3'><code>\chardef\numfamilies=\count18  % počet staticky linkovaných rodin 
\everymath={\dfamstart} \everydisplay{\dfamstart} \def\dfamlist{} 
\def\dfamstart{\aftergroup\dfamreset \let\dfamstart=\relax} 
\def\dfamreset{\global\count18=\numfamilies \gdef\dfamlist{}} 
 
\def\dfam#1{\relax 
   \expandafter\ifx\csname dfam:#1\endcsname \relax 
      \opwarning{dynamic math family "#1" is not declared}% 
   \else 
      \isinlist\dfamlist{,#1,}\iftrue \else 
         \begingroup \def\wlog##1{}% 
            \csname newfam\expandafter\endcsname \csname dmn:#1\endcsname 
            \globaldefs=1 
            \loadmathfamily{\csname dmn:#1\endcsname} {\csname dfam:#1\endcsname} 
         \endgroup 
         \global\addto\dfamlist{,#1,}% 
         \tmpnum=\csname dmn:#1\endcsname 
         \ifnum \tmpnum&lt;10 \sxdef{dmh:#1}{\the\tmpnum}\else 
            \advance\tmpnum by-10 
            \sxdef{dmh:#1}{\ifcase\tmpnum A\or B\or C\or D\or E\or F\fi}% 
      \fi\fi 
      \fam=\csname dmn:#1\endcsname\relax 
   \fi 
} 
\def\dmathchar#1#2#3#4{\relax 
   \ifnum#1=0{\fi % aby fungovalo 2^\cosi bez nutnosti psát 2^{\cosi} 
   \isinlist\dfamlist{,#2,}\iftrue\else\begingroup\dfam{#2}\endgroup\fi 
   \mathchar"#1\csname dmh:#2\endcsname#3#4 
   \ifnum#1=0}\fi 
} 
\def\dmathchardef #1#2#3#4#5{\def#1{\dmathchar#2{#3}#4#5}} 
\addprotect\dfam \addprotect\dmathchar 
</code></pre><p>Jednotlivé rodiny se zavádějí pomocí <code>\loadmathfamily</code> až podle potřeby a&nbsp;globálně. Jména zavedených rodin se ukládají do <code>\dfamlist</code>. Sekvence <code>\dmn:jméno</code> obsahuje číslo rodiny a&nbsp;<code>\dmh:jméno</code> obsahuje totéž číslo jako hexa číslici. Na konci každého vzorečku se hodnoty týkající se dynamicky zavedených rodin resetují pomocí <code>\dfamreset</code>. Vnořené matematické vzorečky (např. <code>\hbox{...$vzorec$...}</code> uvnitř vzorce) tyto hodnoty neresetují, protože je přechodně nastaveno <code>\dfamstart</code> na <code>\relax</code>. </p><p>Při použití <code>\dfam</code> se doporučuje snížit počet staticky zavedených rodin jen na často používané předefinováním maker <code>\normalmath</code> a&nbsp;<code>\boldmath</code> a&nbsp;odpovídajícím snížením čísla <code>\count18</code>. Rodiny 0, 1, 2&nbsp;a 3&nbsp;musejí nutně zůstat staticky zavedené, protože TeX potřebuje jejich metriky v&nbsp;každém vzorečku. </p><p>Má-li rodina bold variantu, je možné ji deklarovat následujícím způsobem: </p><pre class='pr-3'><code>\newif \ifboldmath   \boldmathfalse 
\addto\normalmath{\boldmathfalse}  \addto\boldmath{\boldmathtrue} 
% příklad eufm a eufb: 
\sdef{dfam:fractur}{\ifboldmath eufb\else eufm\fi} 
</code></pre></section><footer class='text-right'><a href='opmac-tricks-e.html#dfam' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0131</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2015-11-22'>22. 11. 2015</time></span> </footer></article> <article id='matrixR' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Matice s vysunutým sloupcem</h3> <a href='#matrixR'><i class='fas fa-link'></i></a></div></header><section><p><img src='img/ukazka-matrixR.png' alt='MaticeR' title='MaticeR' class='img-fluid rounded mx-auto my-2 d-block'> </p><p>Vytvoříme makro <code>\matrixR</code>, které vytvoří matici s&nbsp;typickými natahovacími závorkami, ale poslední sloupec matice nebude umístěný „uvnitř matice“, ale vně obklopujících závorek. Například </p><pre class='pr-3'><code>$$ 
  \matrixR(){ccc}{1&amp;2&amp;3&amp;první řádek\cr 4&amp;5&amp;6&amp;druhý\cr 7&amp;8&amp;9\cr 10&amp;11&amp;12&amp;poslední} 
$$ 
</code></pre><p>vytvoří matici, jak je ukázáno na obrázku. Syntaktické pravidlo pro <code>\matrixR</code> je </p><pre class='pr-3'><code>\matrixR levá-závorka pravá-závorka {deklarace} {data} 
</code></pre><p>přitom <code>deklarace</code> obsahuje jen deklaraci sloupců unitř matice, zatímco <code>data</code> obsahují i&nbsp;jeden sloupec navíc, který se objeví mimo matici a&nbsp;je vytištěn v&nbsp;textovém módu. </p><p>Implementace: </p><pre class='pr-3'><code>\def\matrixR#1#2#3#4{% 
   \bgroup \def\tabiteml{$\ }\def\tabitemr{\ $}\dimen0=0pt 
   \def\tabdeclareR{\setbox0=\hbox{\,####\unsskip}\ifdim\dimen0&lt;\wd0 \global\dimen0=\wd0 \fi}% 
   \setbox1=\vbox{\table{#3R}{#4}}% 
   \setbox2=\hbox{$\left#1\vcenter{\copy1}\right#2$}% 
   \dimen1=\wd2 \advance\dimen1 by-\wd1 \divide\dimen1 by2 
   \def\tabdeclareR{\rlap{\kern\dimen1 \,####\unsskip}}% 
   \left#1\vcenter{\table{#3R}{#4}}\right#2\kern\dimen0 
   \egroup 
} 
</code></pre><p>V&nbsp;prvém průchodu je použita <code>\table</code> s&nbsp;přidanou deklarací R, která poslední sloupec pouze změří, ale nevytiskne. Nejširší položka z&nbsp;tohoto sloupce má šířku <code>\dimen0</code>. Výsledek prvního průchodu je uložen do boxu 1. Dále je sestaven <code>\box2</code>, který navíc obsahuje okolní závorky. Z&nbsp;rozdílů šířek těchto dvou boxů je vypočtena šířka natahovací závorky a&nbsp;uložena do <code>\dimen1</code>. Ve druhém průchodu je poslední sloupec R&nbsp;tištěn jako <code>\rlap</code> s&nbsp;odpovídajícím <code>\kern</code> o&nbsp;šířce natahovací závorky. Tento průchod už je skutečně tištěn do výstupu a&nbsp;je připojen <code>\kern\dimen0</code>, aby následující text za maticí pokračoval až za posledním sloupcem. </p><p>Analogicky můžete vytvořit <code>\matrixL</code> nebo <code>\matrixLR</code>. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#matrixR' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0137</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2016-01-15'>15. 01. 2016</time></span> </footer></article> <article id='matrixA' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Matice s vysunutým řádkem</h3> <a href='#matrixA'><i class='fas fa-link'></i></a></div></header><section><p>Vytvoříme makro <code>\matrixA</code>, které se chová stejně jako makro <code>\matrixR</code> z&nbsp;předchozího OPmac triku 0137, ale navíc je první řádek vysunut nad matici. Uživatel může ale nemusí použít poslední nedeklarovaný sloupec, tj. může vysunutí řádku kombinovat s&nbsp;vysunutím sloupce. Kromě toho vytvoříme makro <code>\matrixB</code>, které na rozdíl od <code>\matrixA</code> vysouvá pod matici poslední řádek. </p><p>Syntaktické pravidlo pro použití <code>\matrixA</code> a&nbsp;<code>\matrixB</code> je stejné, jako u&nbsp;<code>\matrixR</code> tedy: </p><pre class='pr-3'><code>\matrixA levá-závorka pravá-závorka {deklarace} {data} 
</code></pre><p>Implementace: </p><pre class='pr-3'><code>\def\matrixA#1#2#3#4{% 
   {\mathop{\matrixI#1#2{#3}{\noalign{\kern-\normalbaselineskip}#4}}% 
    \limits^{\textstyle\mathstrut}}} 
\def\matrixB#1#2#3#4{% 
   {\mathop{\matrixI#1#2{#3}{#4\crcr\noalign{\kern-\normalbaselineskip}}}% 
    \limits_{\textstyle\mathstrut}}} 
\let\matrixI=\matrixR  % use \matrixR from OPmac trick 0137 
</code></pre><p>Matice má vysunutý řádek díky <code>\noalign{\kern-\normalbaselineskip}</code>. Celá tato matice je schována do <code>\mathop</code> a&nbsp;je přidán horní (resp. dolní) neviditelný index, který vkládá strut, aby i&nbsp;vysunutý řádek měl svou běžnou výšku. Uživatel může napsat <code>\let\matrixI=\matrixL</code> nebo <code>\let\matrixI=\matrixLR</code>, pokud chce vysouvat i&nbsp;první sloupec a&nbsp;pokud si tato makra vytvořil. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#matrixA' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0138</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2016-01-16'>16. 01. 2016</time></span> </footer></article> <article id='mspecdef' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Názorné zkratky v matematické sazbě</h3> <a href='#mspecdef'><i class='fas fa-link'></i></a></div></header><section><p><img src='img/mspecdef.png' alt='Ukázka mspecdef' title='Ukázka mspecdef' class='img-fluid rounded mx-auto my-2 d-block'> </p><p>Je daleko názornější ve zdrojáku matematické sazby psát <code><=</code> místo <code>\leq</code>, <code>==></code> místo <code>\Rightarrow</code>, <code>+-</code> místo <code>\pm</code> atd. Takže zápis pak může vypadat takto: </p><pre class='pr-3'><code>$$ a &lt;= b &lt;= c ==&gt; a &lt;= c $$ 
</code></pre><p>Tuto inteligenci matematické sazby lze deklarovat pomocí makra <code>\msecdef</code> třeba takto: </p><pre class='pr-3'><code>\mspecdef &lt;&lt;   \ll 
\mspecdef &lt;&gt;   \neq 
\mspecdef &lt;=   \leq 
\mspecdef &lt;=&gt;  \Leftrightarrow 
\mspecdef &gt;&gt;   \gg 
\mspecdef &gt;=   \geq 
\mspecdef -+   \mp 
\mspecdef +-   \pm 
\mspecdef ==   \equiv 
\mspecdef =.   \doteq 
\mspecdef ==&gt;  \Rightarrow 
</code></pre><p>Konečně ukážeme, jak vypadá kód chytrého makra <code>\msecdef</code>: </p><pre class='pr-3'><code>\def\skipnext#1#2{#1} 
\def\trynext#1{\trynextA#1.\relax\relax} 
\def\trynextA#1#2\relax#3\relax#4#5{% 
   \ifx\relax#2\relax \def\next{#4}\else 
      \def\next{\isnextchar#1{\skipnext{\trynextA#2\relax#3#1\relax{#4}{#5}}}{#5#3}}\fi 
   \next 
} 
\def\mspecdefA#1#2#3 #4{\ifx#2\undefined 
   \def#2{\trynext{#3}{#4}{#1}}\else 
   \toks0={\trynext{#3}{#4}}\toks1=\expandafter{#2}% 
   \edef#2{\the\toks0{\the\toks1}}\fi 
} 
\def\mspecdef#1{% 
   \ifcat_#1 \expandafter\let\csname m:#1\endcsname=X \catcode`#1=12 \fi 
   \expandafter\ifx\csname m:#1\endcsname\relax 
      \expandafter\mathchardef\csname m:#1\endcsname=\mathcode`#1 \fi 
   \mathcode`#1="8000 \begingroup \lccode`~=`#1 
   \lowercase{\endgroup\expandafter\mspecdefA\csname m:#1\endcsname~}% 
} 
\def\tmp{\adef_##1{_{##1}}\adef^##1{^{##1}}}\tmp 
\catcode`_=12 \catcode`^=12 \mathcode`_="8000 \mathcode`^="8000 
</code></pre><p>Popis myšlenky: po <code>\mspecdef ax \U  \mspecdef axy \V  \mspecdef abcd \W</code> se deklaruje znak <code>a</code> jako math-aktivní (má kód <code>"8000</code>) a&nbsp;je definován jako: </p><pre class='pr-3'><code>\def a{\trynext{bcd}\W{\trynext{xy}\V{\trynext{x}\U{normal a}}}} 
</code></pre><p>Makro nejprve testuje, zda následuje string <code>bcd</code> (pomocí opakovaného <code>\isnextchar</code>). Pokud to je splněno, vynechá se zbytek makra a&nbsp;spustí se <code>\W</code>. Jinak se spustí zbytek makra. To znamená, že se testuje následující string <code>xy</code> a&nbsp;když není přítomen, testuje se <code>x</code> a&nbsp;když také není přítomen, vytiskne se normální <code>a</code>. Všimněte si, že delší stringy (začínající stejně) musejí být pomocí <code>\mspecdef</code> deklarovány později než stringy kratší. </p><p>Poslední dva řádky kódu zajistí, že <code>$a_+$</code> se automaticky převede na <code>$a_{+}$</code>, protože přímá syntax <code>$a_+$</code> přestává fungovat například po <code>\mspecdef +- \pm</code>. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#mspecdef' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0149</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2016-05-26'>26. 05. 2016</time></span> </footer></article> <article id='varstyle' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Sazba závislá na mathstylu</h3> <a href='#varstyle'><i class='fas fa-link'></i></a></div></header><section><p>K&nbsp;sazbě v&nbsp;matematickém módu, která je závislá na matematickém stylu (display, text, script, scriptscript) se používá primitivní příkaz <code>\mathchoice</code> a&nbsp;plainTeX definuje makro <code>\mathpalette</code>. Obojí je nešikovné. Vlastnost <code>\mathchoice</code> by mohla být implemenována v&nbsp;TeXu pomocí pozdrženého argumentu (jako při <code>\write</code>) bez nutnosti v&nbsp;TeXu sestavovat všechny čtyři varianty sazby. To ale nespravíme bez zásahu do samotného TeXu. Na druhé straně makro <code>\mathpalette</code>, které podává uživatelem definovanému makru přepínač stylu jako parametr, můžeme opustit a&nbsp;udělat si makro <code>\varstyle</code> s&nbsp;názornějším použitím a&nbsp;s daleko širšími možnostmi. Makro <code>\varstyle</code> má jeden parametr, který vytvoří matematický seznam. V&nbsp;rámci tohoto parametru je možné používat <code>\usestyle</code> pro přepnutí do matematického stylu aktivního v&nbsp;okamžiku užití <code>\varstyle</code> a&nbsp;dále je možné použít <code>\mathaxis</code> pro vzdálenost účaří od matematické osy a&nbsp;případně si definovat další na stylu závislá makra pomocí <code>\ifcase\mstylenum D\or T\or S\or SS\fi</code>. Například makro na dvojitou sumu (dva sumační znaky přes sebe) může vypadat takto: </p><pre class='pr-3'><code>\def\dbsumR{\ifcase\mstylenum .35\or.25\or.21\or.15\fi em} 
\def\dbsumU{\ifcase\mstylenum .15\or.12\or.09\or.07\fi em} 
\def\doublesum{\mathop{\varstyle{\raise\dbsumU\rlap{$\usestyle\sum$}{\kern\dbsumR\sum}}}} 
 
$\displaystyle \doublesum_{ij}^{DN} \textstyle \doublesum_{ij}^{DN}$ 
</code></pre><p>Makro <code>\varstyle</code> a&nbsp;příbuzná makra jsou definována pomocí <code>\mathchoice</code>: </p><pre class='pr-3'><code>\newcount\mstylenum 
\def\varstyle#1{\mathchoice{\mstylenum=0 #1}{\mstylenum=1 #1}{\mstylenum=2 #1}{\mstylenum=3 #1}} 
\def\usestyle{\ifcase\mstylenum \displaystyle\or\textstyle\or\scriptstyle\or\scriptscriptstyle\fi} 
\def\mathaxis{\fontdimen22\ifcase\mstylenum \textfont\or\textfont\or\scriptfont\or\scriptscriptfont\fi2 } 
</code></pre></section><footer class='text-right'><a href='opmac-tricks-e.html#varstyle' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0157</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2017-05-03'>03. 05. 2017</time></span> </footer></article>
                            </section>  <section id="tabulky" class="mb-5 rounded my-shadow" style="background-color: #778c94">
                                <header class="text-center">
                                  <div class="py-2">
                                    <h2 class="d-inline text-light font-weight-light">Tabulky</h2>
                                    <a href="#tabulky"><i class="fas fa-link"></i></a>
                                  </div>
                                </header>
                                <article id='etable' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Ukázka tabulky s přesahy položek do více řádků a sloupců</h3> <a href='#etable'><i class='fas fa-link'></i></a></div></header><section><p>OPmac verze Jun 2017 přidává některé nové vlastnosti pro makro <code>\table</code>: možnost opakování v&nbsp;deklaraci, deklarátor p, makro <code>\crlp</code> na částečné vodorovné čáry a&nbsp;konečně makro <code>\mspan</code> na položky přesahující více sloupců. </p><p>Ukážeme, jak sestavit tabulku </p><p><img src='img/etable-ukazka.png' alt='Příklad tabulky' title='Příklad tabulky' class='img-fluid rounded mx-auto my-2 d-block'> </p><p>pomocí makra <code>\table</code>. Tabulka je inspirovaná dotazem na <a href='https://tex.stackexchange.com/questions/132445/' title='StackExchange'>StackExchange</a>. Můžete porovnat přehlednost či nepřehlednost LaTeXového kódu diskutovaného na StackExchange s&nbsp;tímto příkladem, kde jsme vytvořili tutéž tabulku, ale pomocí maker z&nbsp;OPmac. </p><pre class='pr-3'><code>\def\low#1{\vbox to 0pt{\kern1.5ex\hbox{#1}\vss}} 
\def\tabstrut{\vrule height 20pt depth10pt width0pt} 
 
\table{|8{c|}}{\crlp{3-8} 
   \mspan2[c|]{} &amp;\mspan3[c|]{Singular} &amp;\mspan3[c|]{Plural} \crlp{3-8} 
   \mspan2[c|]{} &amp; Neuter &amp; Masculine &amp; Feminine &amp; Masculine &amp; Feminine &amp; Neuter \crl 
   \low I    &amp; Inclusive &amp;\mspan3[c|]{\low O} &amp;\mspan3[c|] X \crlp{2,6-8} 
             &amp; Exclusive &amp;\mspan3[c|]{} &amp;\mspan3[c|] X \crl 
   \low{II}  &amp; Informal  &amp;\mspan3[c|] X &amp;\mspan3[c|] X \crlp{2-8} 
             &amp; Formal    &amp;\mspan6[c|] X \crl 
   \low{III} &amp; Informal  &amp; \low O &amp; X &amp; X &amp;\mspan2[c|] X &amp; \low O \crlp{2,4-7} 
             &amp; Formal    &amp; &amp;\mspan4[c|] X &amp; \crl 
} 
</code></pre><p>Předefinovali jsme <code>\tabstrut</code>, aby tabulka byla vzdušnější. Na <a href='https://tex.stackexchange.com/questions/132445/' title='StackExchange'>StackExchange</a> je totiž typografický paskvil. Definovali jsme makro <code>\low</code> na snížení textu mírně pod řádek, což je použito v&nbsp;položkách, které vypadají jako dvouřádkové (obecnější řešení najdete v&nbsp;následujícím triku 0159). Konečně jsme použili <code>\mspan</code> na přesah přes více sloupců a&nbsp;<code>\crlp</code> na vodorovné čáry jen někde. Čáry v&nbsp;deklaraci <code>\mspan</code> jsou v&nbsp;souladu s&nbsp;dokumentací výhradně vpravo deklarátoru <code>c</code>. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#etable' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0158</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2017-06-17'>17. 06. 2017</time></span> </footer></article> <article id='tabcrow' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Umístění textu vertikálně centrovaného ve více řádcích tabulky</h3> <a href='#tabcrow'><i class='fas fa-link'></i></a></div></header><section><p>Vytoříme makro <code>\crow číslo {text}</code>, které sníží v&nbsp;daném řádku <code>text</code> tak, aby to vypadalo, že je vertikálně centrovaný přes <code>číslo</code> řádků. Chceme tedy místo ad hoc vytvořeného makra <code>\low{text}</code> z&nbsp;předchozího příkladu 0158 používat <code>\crow2{text}</code>. </p><pre class='pr-3'><code>\def\crow{\afterassignment\crowA \tmpnum=} 
\def\crowA#1{\setbox0=\hbox{\tabstrut}\tmpdim=\ht0 \advance\tmpdim by\dp0 
   \tmpdim=\the\tmpnum\tmpdim 
   \vbox to0pt{\kern-\ht0 \vbox to\tmpdim{\vss\hbox{#1}\kern-\prevdepth\vss}\vss}% 
} 
</code></pre><p>Makro uloží do <code>\tmpdim</code> výšku plus hloubku tabstrutu násobenou <code>číslem</code> a&nbsp;vytvoří <code>\vbox to\tmpdim</code>, který je schován ve <code>\vbox to0pt</code>, aby to v&nbsp;sazbě nepřekáželo. </p><p>Poznamenejme, že makro funguje za předpokladu, že všechny řádky tabulky jsou „jednořádkové“, tj. v&nbsp;položkách tabulky se nevyskytují celé víceřádkové odstavce. Potřebujeme totiž dopředu znát výšku všech řádků tabulky. Pokud se ale v&nbsp;řádcích vyskytují víceřádkové odstavce a&nbsp;dopředu nevíme, jak budou tyto položky tabulky vysoké, pak je lepší ručně vyladit posazení textu dolů podobně, jako v&nbsp;makru <code>\low</code> v&nbsp;předchozím OPmac triku. Nebo, trváte-li na automatickém výpočtu umístění textu, je někdy možné použít primitivní příkaz <code>\valign</code> místo <code>\halign</code>. Pokud jsou dopředu známy šířky všech sloupců v&nbsp;tabulce, je užití \halign (o které se opírá i&nbsp;makro <code>\table</code>) totiž nadbytečné, protože nepotřebujeme zarovnávat podle nejširší položky v&nbsp;každém sloupci. Potřebujeme ale zarovnávat podle nejvyšší položky v&nbsp;každém řádku, a&nbsp;k tomu se hodí <code>\valign</code>, což je transponované <code>\halign</code>. Ukázku implementace této myšlenky naleznete <a href='https://tex.stackexchange.com/questions/183235/' title='zde'>zde</a>. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#tabcrow' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0159</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2017-06-17'>17. 06. 2017</time></span> </footer></article> <article id='tabpmod' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Modifikace formátu odstavce při použití deklarátoru p</h3> <a href='#tabpmod'><i class='fas fa-link'></i></a></div></header><section><p>V&nbsp;manuálu k&nbsp;OPmac je zmíněno, že odstavec v&nbsp;tabulce deklarovaný pomocí <code>p{rozměr}</code> je implicitně formátován jako obvyklý odstavec mimo tabulku, tedy typicky do bloku. To může v&nbsp;úzkých sloupcích dělat potíže. Proto je uvedena možnost použití <code>p{rozměr\raggedright}</code> pro vytváření odstavců s&nbsp;pravým roztřepením. Můžete si definovat další možnosti: </p><pre class='pr-3'><code>\let\fL=\raggedright 
\def\fR{\leftskip=0pt plus 1fill} 
\def\fC{\leftskip=0pt plus1fill \rightskip=0pt plus 1fill} 
\def\fX{\leftskip=\iindent plus1fil 
        \rightskip=\iindent plus-1fil 
        \parfillskip=0pt plus2fil} 
</code></pre><p>a&nbsp;potom je odstavec v&nbsp;tabulce: </p><pre class='pr-3'><code>p{42mm}     ... zarovnán do bloku, 
p{42mm\fL}  ... zarovnán vlevo, 
p{42mm\fR}  ... zarovnán vpravo, 
p{42mm\fC}  ... s centrovanými řádky, 
p{42mm\fX}  ... zarovnán do bloku s centrovaným posledním řádkem. 
</code></pre><p>Všimněte si, že při zarovnání vlevo je možné dělení slov ale při zarovnání vpravo nikoli, protože dělení slov v&nbsp;takové úpravě odstavce není vhodné. Nechcete-li dělit slova ani při <code>\fL</code>, definujte jednoduše: </p><pre class='pr-3'><code>\def\fL{\rightskip=0pt plus 1fil} 
</code></pre></section><footer class='text-right'><a href='opmac-tricks-e.html#tabpmod' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0160</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2017-06-17'>17. 06. 2017</time></span> </footer></article> <article id='tablemb' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Odstavce v položkách jinak vertikálně usazené</h3> <a href='#tablemb'><i class='fas fa-link'></i></a></div></header><section><p>OPmac nabízí jen deklarátor <code>p{rozměr}</code>, který vytvoří v&nbsp;položce tabulky odstavec. Je-li takových odstavců v&nbsp;řádku tabulky více vedle sebe, jsou vertikálně umístěny podle prvního řádku (jako <code>\vtop</code>). V&nbsp;tomto OPmac triku zavedeme LaTeXovský deklarátor <code>m{rozměr}</code> chovající se jako <code>\vcenter</code> (centrování na střed) a&nbsp;konečně <code>b{rozměr}</code> chovající se jako <code>\vbox</code> (usazení podle spodního řádku). Návod, jak to udělat, je také v&nbsp;technické dokumentaci k&nbsp;OPmac. </p><pre class='pr-3'><code>\def\paramtabdeclarem#1{\tabiteml{$\vcenter{\hsize=#1\relax 
   \baselineskip=\normalbaselineskip \lineskiplimit=0pt 
   \noindent\vbox{\hbox{\tabstrutA}\kern-\prevdepth}##\unsskip 
   \vbox to0pt{\vss\hbox{\tabstrutA}}}$}\tabitemr 
} 
\def\paramtabdeclareb#1{\tabiteml\vbox{\hsize=#1\relax 
   \baselineskip=\normalbaselineskip \lineskiplimit=0pt 
   \noindent\vbox{\hbox{\tabstrutA}\kern-\prevdepth}##\unsskip}\tabitemr 
} 
</code></pre><p>Vimněte si, že na začátek textu přidáváme strut, který má výšku jako <code>\tabstrut</code>, ale nulovou hloubku a&nbsp;na konec textu přidáváme strut, který má hloubku jako <code>\tabstrut</code>, ale nulovou výšku. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#tablemb' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0161</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2017-06-17'>17. 06. 2017</time></span> </footer></article> <article id='crlpvv' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>\crlp a dvojité svislé linky</h3> <a href='#crlpvv'><i class='fas fa-link'></i></a></div></header><section><p>Makro <code>\crlp{seznam}</code>, které ukončí řádek tabulky a&nbsp;vloží pod něj vodorovné linky jen ve sloupcích podle seznamu, se chová jako <code>\crli</code>, tedy linky nezasahují do prostoru mezi dvojitou svislou čarou. Přitom k&nbsp;<code>\crli</code> máme alternativu <code>\crl</code>, která protne dvojité svislé čáry. Jakou alternativu máme, chceme-li nakreslit linku jen někde? </p><p>Touto alternativou je ukončit řádek pomocí <code>\cr</code> a&nbsp;nakreslit jakoby další řádek obsahující výhradně <code>\multispan</code> buď s&nbsp;prázdným obsahem nebo s&nbsp;<code>\hrulefill</code>. Například </p><pre class='pr-3'><code>\cr \multispan2 &amp; \multispan3\hrulefill &amp; \multipan1 &amp; \mutispan4\hrulefill \cr 
</code></pre><p>se chová jako <code>\crlp { 3-5, 7-10 }</code>, ale přesahuje případné svislé dvojité linky. Vyzkoušejte si: </p><pre class='pr-3'><code>\def\spankern{\kern-\vvkern\kern-\drulewidth} 
 
\table{||c||c||l}{\crl 
  a &amp; b &amp; c \crli 
  d &amp; e &amp; f \crlp{1-2} 
  g &amp; h &amp; i \cr \multispan2\hrulefill &amp; \multispan1 \cr 
  j &amp; k &amp; l \cr \multispan1\hrulefill &amp; \multispan2 \cr 
  m &amp; n &amp; o \crlp{1} 
  p &amp; q &amp; r \cr \multispan1 &amp; \multispan1\spankern\hrulefill &amp; \multispan1 \cr 
  s &amp; t &amp; u \crlp{2} 
  v &amp; w &amp; x \crl 
} 
</code></pre><p>Když si tuto ukázku vyzkoušíte a&nbsp;podrobně se podíváte na výsledek, shledáte, že je zde další problém: vodorovná linka vytvořená pomocí <code>\multispan</code> v&nbsp;sazbě překáží a&nbsp;v důsledku ní není pravá svislá linka souvislá. Je tedy třeba ještě zapustit vodorovnou linku do sazby pomocí <code>\noalign{\kern-\drulewidth}</code>. Tento příkaz vložte na konec řádků <code>j&k&l</code> a&nbsp;<code>p&q&r</code> (vždy za druhé <code>\cr</code>). Analogický záporný kern vkládá i&nbsp;makro <code>\crlp</code>, takže při užití <code>\crlp</code> není nutné tento problém řešit. </p><p>Konečně si všimněte definice a&nbsp;užití makra <code>\spankern</code>, které přidává záporný kern, aby čára pod řádem p&amp;q&amp;r protla i&nbsp;dvojitou čáru z&nbsp;předchozího sloupce. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#crlpvv' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0163</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2017-06-18'>18. 06. 2017</time></span> </footer></article> <article id='tableverb' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Verbatim text v tabulkách</h3> <a href='#tableverb'><i class='fas fa-link'></i></a></div></header><section><p>Protože <code>\table{deklarace}{data}</code> čte celý druhý parametr <code>data</code> před jeho vykonáním, není možné uvnitř tohoto parametru přecházet do verbatim (např. takto: <code>$#</code>) nebo dělat jiné změny kategorií znaků s&nbsp;požadavkem okamžitého efektu. A&nbsp;přitom stačí málo, číst parametr <code>data</code> a&nbsp;okamžitě ho vykonávat. To se dá udělat takto: </p><pre class='pr-3'><code>\activettchar" 
 
\tableverb{deklarace} 
data včetně "#&amp;$" verbatim 
\etable 
</code></pre><p>Všimněte si, že na rozdíl od makra <code>\table</code> nejsou <code>data</code> uzavřena do svorek a&nbsp;jsou ukončena makrem <code>\etable</code>. Kód pro tato makra vypadá takto: </p><pre class='pr-3'><code>\def\tableverb{\vbox\bgroup \catcode`\|=12 \tableB} 
\def\tableB#1{\offinterlineskip \colnum=0 \def\tmpa{}\tabdata={}\scantabdata#1\ 
   \halign\expandafter\bgroup\the\tabdata\cr} 
\def\etable{\crcr\egroup\egroup} 
</code></pre></section><footer class='text-right'><a href='opmac-tricks-e.html#tableverb' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0162</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2017-06-17'>17. 06. 2017</time></span> </footer></article> <article id='booktabs' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Tabulky jako v balíčku booktabs</h3> <a href='#booktabs'><i class='fas fa-link'></i></a></div></header><section><p>Ortodoxní zastánci LaTeXového balíčku booktabs by ohrnuli nos nad předchozí ukázkou a&nbsp;zdůraznili by, že jsem lama, která neví, že svislé čáry do tabulky nepatří a&nbsp;vodorovné jsou možné v&nbsp;různých tloušťkách, ale v&nbsp;žádném případě ne dvojité. A&nbsp;hlavně s&nbsp;čarami v&nbsp;tabulce je třeba zacházet umírněně a&nbsp;decentně. V&nbsp;dokumentaci mají tuto ukázku: </p><p><img src='img/tab3-ukazka.png' alt='Ukázka tabulky' title='Ukázka tabulky' class='img-fluid rounded mx-auto my-2 d-block'> </p><p>kterou pomocí <code>\table</code> z&nbsp;OPmac vytvoříme třeba takto: </p><pre class='pr-3'><code>\table{llr}{                            \crtop 
  \multispan2\hfil Item\hfil&amp;           \cr 
  \multispan2\tablinefil\kern.5em       \cr 
   Animal    &amp; Description &amp; Price (\$) \crmid 
   Gnat      &amp; per gram    &amp;      13.65 \cr 
             &amp; each        &amp;       0.01 \cr 
   Gnu       &amp; stuffed     &amp;      92.50 \cr 
   Emu       &amp; stuffed     &amp;      33.33 \cr 
   Armadillo &amp; frozen      &amp;       8.99 \crbot} 
</code></pre><p>Je ovšem potřeba definovat <code>\crtop</code>, <code>\crmid</code>, <code>\crbot</code> a&nbsp;pozměnit tloušťku čáry v&nbsp;<code>\tablinefil</code>: </p><pre class='pr-3'><code>\def\crtop{\crcr \noalign{\hrule height.6pt \kern2.5pt}} 
\def\crbot{\crcr \noalign{\kern2.5pt\hrule height.6pt}} 
\def\crmid{\crcr \noalign{\kern1pt\hrule\kern1pt}} 
\def\tablinefil{\leaders\hrule height.2pt\hfil\vrule height1.7pt depth1.5pt width0pt } 
</code></pre><p>Konečně je třeba odstranit mezery vlevo v&nbsp;první položce a&nbsp;vpravo v&nbsp;poslední, jinak by ty čáry poněkud přečuhovaly. Přidal jsem <code>\kern-.5em</code> do deklarace řádku tabulky zleva a&nbsp;zprava, protože <code>\tabiteml</code> a&nbsp;<code>\tabitemr</code> jsou definovány jako <code>\enspace</code>. K&nbsp;tomu účelu jsem mírně předefinoval interní makro OPmac <code>\tableA</code>: </p><pre class='pr-3'><code>\def\tableA#1#2{\offinterlineskip \def\tmpa{}\tabdata={\kern-.5em}\scantabdata#1\relax 
   \halign\expandafter{\the\tabdata\kern-.5em\tabstrutA\cr#2\crcr}\egroup} 
</code></pre></section><footer class='text-right'><a href='opmac-tricks-e.html#booktabs' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0009</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2013-08-15'>15. 08. 2013</time></span> </footer></article> <article id='crx' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Střídavě podbarvené řádky v tabulce</h3> <a href='#crx'><i class='fas fa-link'></i></a></div></header><section><p>V&nbsp;poslední době se rozmohla móda podbarvovat řádky v&nbsp;tabulce. </p><p><img src='img/tab2-ukazka.png' alt='Ukázka tabulky' title='Ukázka tabulky' class='img-fluid rounded mx-auto my-2 d-block'> </p><p>Pomocí <code>\table</code> vytvoříme výše uvedenou tabulku třeba takto: </p><pre class='pr-3'><code>\frame{\table{llllll}{\crx 
  aa &amp; bb &amp; cc &amp; dd &amp; ee &amp; ff \crx 
  gg &amp; hh &amp; ii &amp; jj &amp; kk &amp; ll \crx 
  mm &amp; nn &amp; oo &amp; pp &amp; qq &amp; rr \crx 
  ss &amp; tt &amp; uu &amp; vv &amp; ww &amp; xx \crx 
  ab &amp; cd &amp; ef &amp; gh &amp; ij &amp; kl \crx 
  mn &amp; op &amp; qr &amp; st &amp; uv &amp; wx}} 
</code></pre><p>K&nbsp;tomu stačí dodefinovat příkaz <code>\crx</code>, který střídavě vkládá/nevkládá do vertikálního seznamu mezi řádky šedé pruhy: </p><pre class='pr-3'><code>\newcount\tabline  \tabline=1 
\def\crx{\crcr \ifodd\tabline \colortabline \fi 
         \global\advance\tabline by1 } 
\def\colortabline{\noalign{\localcolor\LightGrey 
   \hrule height\ht\strutbox depth\dp\strutbox \kern-\ht\strutbox \kern-\dp\strutbox}} 
\def\tabiteml{\quad}\def\tabitemr{\quad} 
</code></pre></section><footer class='text-right'><a href='opmac-tricks-e.html#crx' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0010</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2013-08-15'>15. 08. 2013</time></span> </footer></article> <article id='cellcolor' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Jednotlivě podbarvené položky v tabulce</h3> <a href='#cellcolor'><i class='fas fa-link'></i></a></div></header><section><p>Vytvoříme deklarátory sloupce tabulky C, R, L, které fungují obdobně, jako c, r, l, ale navíc umožní každou položku podbarvit zvolenou barvou. Je-li první objekt v&nbsp;položce přepínač barvy, tato barva se použije pro podklad položky. Například: </p><pre class='pr-3'><code>   ... &amp; \Blue Text &amp;        ... % modře podbarvený černý text 
   ... &amp; \Green \Red  Text &amp; ... % zeleně podbarený červený text 
   ... &amp; \relax \Blue Text &amp; ... % modrý text, defaultní pozadí 
</code></pre><p>Podbarvení položek vypruží jako obvyklé mezery ve sloupci tabulky, tj. při C&nbsp;pruží z&nbsp;obou stran, při L&nbsp;pruží zprava a&nbsp;při R&nbsp;pruží zleva. Rovněž mezery <code>\tabiteml</code> a&nbsp;<code>\tabitemr</code> jsou podbarveny. </p><p>Je-li nastaveno <code>\cellcolor</code> pomocí <code>\let</code> jako barva (např. <code>\let\cellcolor=\Yellow</code>), pak tato barva se použije jako defualtní pozadí. Není-li <code>\cellcolor</code> nastaveno, je defaultní pozadí průhledné. </p><p>Mezi jednotlivými sloupci můžete vložit bílou mezeru pomocí nenulové hodnoty <code>\tabskip</code> a&nbsp;mezi jednotlivými řádky vznikne bílá mezera pomocí <code>\noalign{\kern...}</code>. Příklad: </p><pre class='pr-3'><code>\def\tabstrut{\lower4pt\vbox to15pt{}} 
\tabskip=2pt \def\cskip{\noalign{\kern2pt}} \let\cellcolor=\Yellow 
\table{CLR}{first item      &amp; second &amp; \Blue \White third item \cr\cskip 
            next long item  &amp; \Red X &amp; \Green       YES } 
</code></pre><p>vytvoří tabulku: </p><p><img src='img/tab4-ukazka.png' alt='Ukázka tabulky' title='Ukázka tabulky' class='img-fluid rounded mx-auto my-2 d-block'> </p><p>Implementace: </p><pre class='pr-3'><code>\def\tabdeclareC{\futurelet\next\setcellcolor##\end\hfil\hfil} 
\def\tabdeclareL{\futurelet\next\setcellcolor##\end\relax\hfil} 
\def\tabdeclareR{\futurelet\next\setcellcolor##\end\hfil\relax} 
\def\setcellcolor{\ifx\next\global \expandafter\setcellcolorC\else \expandafter\setcellcolorD\fi} 
\def\setcellcolorC#1\fi#2\end#3#4{% 
   \setbox0=\hbox{{\tabiteml\localcolor#2\unskip\tabitemr}}% 
   {\localcolor#1\fi\tabstrut\leaders\vrule\hskip\wd0 \ifx#3\hfil plus1fil\fi}% 
   \kern-\wd0 \box0 
   \ifx#4\hfil {\kern-.2pt \localcolor#1\fi\leaders\vrule\hskip.2pt plus1fil}\fi 
} 
\def\setcellcolorD{\ifx\cellcolor\undefined \let\next=\setcellcolorN 
   \else \def\next{\expandafter\expandafter\expandafter\setcellcolorC\cellcolor}% 
   \fi \next 
} 
\def\setcellcolorN#1\end#2#3{#2\tabiteml{\localcolor#1\unskip}\tabitemr#3} 
</code></pre><p>Makro <code>\setcellcolor</code> sebere první token z&nbsp;položky. Makro pracuje v&nbsp;deklarační části tabulky, takže první položku si sejme až po expanzi na úroveň prvního neexpandovatelného tokenu. Tímto tokenem v&nbsp;případě makra pro barvu je <code>\global</code> (viz makro <code>\setcmylcolor</code>). Je-li toto splněno, spustí se makro <code>\setcellcolorC</code>, které si do <code>#1</code> uloží rozexpandované tělo makra <code>\setcmykcolor</code> (až po poslední <code>\fi</code>), do <code>#2</code> si uloží zbylý text položky a&nbsp;do <code>#3</code> a&nbsp;<code>#4</code> uloží vzkaz o&nbsp;způsobu centrování položky. Dále toto makro změří šířku položky v&nbsp;boxu0 a&nbsp;podbarví box0 pomocí <code>\leaders</code>. Není-li první token položky <code>\global</code>, pak makro <code>\setcellcolorD</code> ještě rozhodne, zda je či není definováno makro <code>\cellcolor</code> a&nbsp;pokud je, podstrčí makru <code>\setcellcolorC</code> správně rozexpandovaný <code>\cellcolor</code>, jinak spustí <code>\setcellcolorN</code>, což nevytvoří žádný podklad. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#cellcolor' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0094</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2015-04-02'>02. 04. 2015</time></span> </footer></article> <article id='multispanc' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Podbarvené položky přes více sloupců</h3> <a href='#multispanc'><i class='fas fa-link'></i></a></div></header><section><p>K&nbsp;předchozímu <a href='#cellcolor' title='OPmac triku'>OPmac triku</a> přidáme možnost podvarvovat položky přes více sloupců. Přidáme makro <code>\multispanc{počet} \Barva {Text}</code>, které vytvoří položku přes <code>počet</code> sloupců podbarvené barvou <code>\Barva</code>. Chcete-li mít položku podbarvanou implicitní barvou, pište místo <code>\Barva</code> <code>\relax</code>. </p><p>Příklad: </p><pre class='pr-3'><code>\def\tabstrut{\lower4pt\vbox to15pt{}} 
\tabskip=2pt \def\cskip{\noalign{\kern2pt}} \let\cellcolor=\Yellow 
\table{CLR}{\Black\White\bf Table &amp;\multispanc2 \Black {\White\bf Title} \cr\cskip 
            first item      &amp; second &amp; \Blue \White third item \cr\cskip 
            next long item  &amp; \Red X &amp; \Green       YES } 
</code></pre><p>vytvoří: </p><p><img src='img/tab5-ukazka.png' alt='Ukázka tabulky' title='Ukázka tabulky' class='img-fluid rounded mx-auto my-2 d-block'> </p><p>Makro <code>\multispanc</code> může být definováno takto: </p><pre class='pr-3'><code>\def\multispanc#1#2#3{\multispan{#1}% 
   \expandafter\expandafter\expandafter\cellcolexp#2#3\end\hfil\hfil\ignorespaces} 
\def\cellcolexp{\futurelet\next\setcellcolor} 
</code></pre></section><footer class='text-right'><a href='opmac-tricks-e.html#multispanc' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0103</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2015-04-23'>23. 04. 2015</time></span> </footer></article> <article id='tableto' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Tabulky se stanovenou šířkou</h3> <a href='#tableto'><i class='fas fa-link'></i></a></div></header><section><p>Vytvoříme makro <code>\tableto{šířka}{deklarace}{data}</code>, které vytvoří tabulku se stanovenou šířkou. Mezery mezi sloupci se tomu přizpůsobí. K&nbsp;tomu stačí inspirovat se makrem <code>\table</code> z&nbsp;OPmac a&nbsp;zapracovat do něj práci s&nbsp;registrem <code>\tabskip</code>. </p><pre class='pr-3'><code>\def\tableto{\vbox\bgroup \catcode`\|=12 \tableAto} 
\def\tableAto#1#2#3{\offinterlineskip \def\tmpa{}% 
   \tabdata={\tabskip=0pt plus1fil minus1fil}\scantabdata#2\relax 
   \halign to#1\expandafter{\the\tabdata\tabskip=0pt\tabstrutA\cr#3\crcr}\egroup} 
</code></pre><p>Mezery <code>\tabiteml</code> a&nbsp;<code>\tabitemr</code> se nyní projeví vlevo od prvního sloupce a&nbsp;vpravo od posledního sloupce. Jinde mezi sloupci bude mezera upravena tak, aby celková šířka tabulky vyhověla stanovenému údaji. </p><p>Toto makro funguje na tabulky například z&nbsp;předchozích dvou příkladů. Nefunguje to správně na tabulky se svislými linkami mezi sloupci (na okrajích tabulky svislé linky nevadí). Pokud tedy nejste (stejně jako já) ortodoxní vyznavači booktabs a&nbsp;tedy výjimečně snesete i&nbsp;kultivovaně vedenou svislou linku, je třeba pro natahovací tabulky se svilými linkami použít jiné makro: </p><pre class='pr-3'><code>\newdimen\tabw 
\def\countcols#1{\ifx#1\relax\else 
   \ifx#1|\else\advance\tmpnum by2 \fi \expandafter\countcols \fi} 
\def\tableto#1#2#3{{\def\tabiteml{}\def\tabitemr{}\setbox0=\table{#2}{#3}% 
   \tmpnum=0 \countcols#2\relax \tabw=#1\advance\tabw by-\wd0 \divide\tabw by\tmpnum 
   \def\tabiteml{\kern\tabw}\def\tabitemr{\kern\tabw}\table{#2}{#3}}} 
</code></pre><p>Toto makro nejprve nanečisto do boxu0 vysází tabulku s&nbsp;prázdnými <code>\tabiteml</code> a&nbsp;<code>\tabitemr</code>. Pak odečte od požadované šířky šířku boxu0 a&nbsp;vydělí to dvojnásobkem počtu sloupců. Tento rozměr pak nacpe do <code>\tabiteml</code> a&nbsp;<code>\tabitemr</code> a&nbsp;znovu vytiskne. Nyní už bude mít tabulka požadovanou šířku. </p><p>Výhoda tohoto řešení (proti postupu např. v&nbsp;TBN, str. 141) je, že není potřeba měnit nic v&nbsp;datech tabulky. Počet sloupců zůstává zachován. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#tableto' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0011</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2013-08-16'>16. 08. 2013</time></span> </footer></article> <article id='partab' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Rozšířitelný sloupec v tabulce typu „odstavec“</h3> <a href='#partab'><i class='fas fa-link'></i></a></div></header><section><p>Vytvoříme makro <code>\tableto{šířkatab}{deklarace}{data}</code> podobně jako v&nbsp;předchozím příkladě. Předpokládáme, že v&nbsp;deklaraci bude použit jeden deklarátor <code>P</code>, který označuje sloupec typu odstavec a&nbsp;jehož šířka bude taková, aby celková šířka tabulky odpovídala spcifikovanému údaji <code>{šířkatab}</code>. </p><pre class='pr-3'><code>\newdimen\Pwidth  \newdimen\tabw 
\def\tabdeclareP {\tabiteml\vtop{\hsize=\Pwidth \rightskip=0pt plus1fil 
   \baselineskip=1.2em \lineskiplimit=0pt 
   \noindent ##\unsskip\vbox to0pt{\vss\hbox{\tabstrutA}}}\hss\tabitemr} 
\def\tableto#1#2#3{{\Pwidth=.5\hsize \setbox0=\table{#2}{#3} 
   \tabw=#1\relax \advance\tabw by-\wd0 \advance\Pwidth by\tabw \table{#2}{#3}}} 
</code></pre><p>Toto makro nejprve nanečisto vytvoří požadovanou tabulku s&nbsp;<code>\Pwidth=\hsize</code> do boxu0 a&nbsp;pak změří box0 a&nbsp;upraví podle toho konečnou hodnotu registru <code>\Pwidth</code>, </p></section><footer class='text-right'><a href='opmac-tricks-e.html#partab' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0012</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2013-08-16'>16. 08. 2013</time></span> </footer></article> <article id='decltab' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Deklarátory v tabulce z více písmen</h3> <a href='#decltab'><i class='fas fa-link'></i></a></div></header><section><p>Ačkoli se to v&nbsp;dokumentaci OPmac explicitně netvrdí, můžete vytvořit deklarátory z&nbsp;více než jednoho písmene. Takový deklarátor musí být v&nbsp;deklaraci obehnán svorkami, což udržuje názornost a&nbsp;přehlednost deklarace. Jako příklad vytvoříme sadu deklarátorů <code>ic</code>,<code>ir</code>,<code>il</code>, které se chovají jako <code>c</code>,<code>r</code>,<code>l</code>, ale provedou sazbu v&nbsp;kurzívě. </p><pre class='pr-3'><code>\def\tabdeclareic{\tabiteml\it\hfil##\unsskip\hfil\tabitemr} 
\def\tabdeclareil{\tabiteml\it##\unsskip\hfil\tabitemr} 
\def\tabdeclareir{\tabiteml\it\hfil##\unsskip\tabitemr} 
</code></pre><p>Příklad použití: </p><pre class='pr-3'><code>\table{cc{ic}c}{první &amp; druhý &amp; třetí &amp; čtvrtý \cr 
                    a &amp;     b &amp;     c &amp;      d } 
</code></pre><p>Třetí sloupec je v&nbsp;kurzívě, zatímco ostatní sloupce jsou v&nbsp;aktuálním fontu nastaveném před použitím <code>\table</code>. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#decltab' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0015</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2013-08-17'>17. 08. 2013</time></span> </footer></article> <article id='dekadic' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Desetinná čísla v tabulkách</h3> <a href='#dekadic'><i class='fas fa-link'></i></a></div></header><section><p>Vytvoříme deklarátor <code>D</code>, který umožní sazbu desetinných čísel s&nbsp;desetinnou čárkou pod sebou. </p><pre class='pr-3'><code>\def\tabdeclareD{\tabiteml\hfil\scandecnumber##&amp;##\hfil\tabitemr} 
\def\scandecnumber#1,{#1\ifdim\lastskip&gt;0pt \unskip\phantom,\else,\fi&amp;} 
</code></pre><p>Příklad použití: </p><pre class='pr-3'><code>\table{lDr}{číslo &amp;   3,24   &amp; první \cr 
            jiné  &amp; 112,1    &amp; druhé \cr 
            celé  &amp;  13     ,&amp; čárka vzadu \cr 
            další &amp;   0,123  &amp; malé} 
</code></pre><p>Je vidět, že pokud chceme do sloupce s&nbsp;desetinnými čísly vložit číslo celé bez desetinné čárky, musíme to ošetřit jako výjimku. Tj. vložit čárku na úplný konec položky. Tato čárka se pak nevytiskne. </p><p>Chtít po makru, aby výjimku pro celé číslo vyřešilo samo, je sice taky možné, ale makro by bylo podstatně komplikovanější. Ctíme přitom zásadu: „v jednoduchosti je síla“ a&nbsp;nevytváříme zbytečné komplikovanosti. </p><p>Sloupec D&nbsp;je implementován jako dva sloupce tabulky. Pokud jej tedy chceme přeskakovat pomocí <code>\multispan</code>, musíme toto vědět a&nbsp;započítat ho za dva sloupce. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#dekadic' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0016</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2013-08-17'>17. 08. 2013</time></span> </footer></article> <article id='dekadic2' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Desetinná čísla v tabulkách podruhé</h3> <a href='#dekadic2'><i class='fas fa-link'></i></a></div></header><section><p><a href='#dekadic' title='OPmac trik 0016'>OPmac trik 0016</a> pro desetiná čísla v&nbsp;tabulách zakládá „dvojsloupec“, což působí komplikace např. při použití <code>\tskip</code>. Zde je tedy jiné řešení, které navíc umožňuje mít ve sloupci i&nbsp;nenumerické texty, např. pro záhlaví tabulky. Řešení zakládá jediný sloupec, tj. nemělo by způsobovat potíže. </p><p>Je vytvořen nový deklarátor <code>N<číslo></code>, např. <code>N3</code>, který udává, že ve sloupci budou čísla (numbers) s&nbsp;desetinnou tečkou, přitom nejvíce cifer za tečkou se očekává <code><číslo></code>. Každé číslo se pak doplní o&nbsp;vhodný počet neviditelných desetinných cifer na stanovený počet a&nbsp;takto jsou čísla zarovnána vpravo. Tím je dosaženo lícování pod sebou desetinné tečky (která na výstupu může být čárkou, předefinujete-li <code>\decimalpoint</code>).  </p><p>Čísla jsou vysázena v&nbsp;matematickém módu, tj. znak „mínus“ vypadá, jak má. </p><p>Je-li v&nbsp;položce text bez tečky, je vysázen v&nbsp;textovém módu a&nbsp;je centrován  (když je menší než celková šířka čísel ve sloupci) nebo je zarovnán vpravo  (když je větší než celková šířka čísel).  Je možné přidat další neexistující cifry, tj. <code><číslo></code> může být větší než skutečný počet cifer, pokud se tím vizuálně zlepší např. umístění širšího nenumerického textu. Příklad: </p><pre class='pr-3'><code>\table{c|N3}{ 
  Ingredients      &amp; w/w (\%) \crl \tskip.2em 
  Water            &amp; -97.5    \cr 
  Agar powder      &amp;  2.0     \cr 
  Solidum chloride &amp;  0.43  
} 
</code></pre><p>Je-li cifer za tečkou více než devět, musíte použít složené závorky: <code>N{12}</code>. Také můžete stanovit necelý počet cifer, např. <code>N{2.5}</code>, je-li to k&nbsp;něčemu dobré. Implementace deklarátoru <code>N</code> je následující: </p><pre class='pr-3'><code>\def\decimalpoint{.} 
 
\def\paramtabdeclareN#1{\tabiteml\hfil\aligndecdigit#1##.\relax\tabitemr} 
\def\aligndecdigit#1#2.#3{% 
   \ifx\relax#3\hfil#2\unsskip\hfil \else 
   \dimen0=.5em \dimen0=#1\dimen0 $#2$\decimalpoint 
   \expandafter\aligndecdigitA\expandafter#3\fi 
} 
\def\aligndecdigitA#1.\relax{\hbox to\dimen0{$#1$\hss}} 
 
\def\tableA#1#2{\offinterlineskip \colnum=0 \def\tmpa{}\tabdata={}\scantabdata#1\relax 
   \def\tmpb{#2}\replacestrings{\crl}{\crcr\crl}% 
      \replacestrings{\crli}{\crcr\crli}\replacestrings{\crll}{\crcr\crll}% 
      \replacestrings{\crlli}{\crcr\crlli}\replacestrings{\crlp}{\crcr\crlp}% 
   \halign\expandafter{\the\tabdata\cr\tmpb\crcr}\egroup} 
 
</code></pre><p>Deklarátor je definován jako <code>\paramtabdeclareN</code>. Pomocí <code>\aligndecdigit</code> se přečte text až po tečku a&nbsp;vysází se v&nbsp;matematickém módu a&nbsp;pomocí <code>\aligndecdigitA</code> se vysází zbytek. </p><p>Položky s&nbsp;užitím deklarátoru <code>N</code> musejí bezpodmínečně končit znakem <code>&</code> nebo <code>\cr</code>, nikoli makrem, které symbol konce položky obsahuje. Protože v&nbsp;manuálu OPmac jsou zmíněna marka <code>\crl</code> (apod.), která obsahují <code>\cr</code>, je předefinována přípravná čast tabulky, kde se pomocí <code>\replacestrings</code> nahradí <code>\crl</code> za <code>\crcr\crl</code>, což udělá nakonec v&nbsp;tabulce stejnou práci. Druhá možnost je nepoužívat předefinování <code>\tableA</code> a&nbsp;ukáznit uživatele, ať před každé <code>\crl</code> (a jim podobné) předřadí <code>\cr</code>, pokud má sloupec <code>N</code> v&nbsp;tabule jako poslední. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#dekadic2' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0171</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2019-12-07'>07. 12. 2019</time></span> </footer></article> <article id='ltable1' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Tabulka přes více stránek</h3> <a href='#ltable1'><i class='fas fa-link'></i></a></div></header><section><p>Primitiv <code>\halign</code> vytvoří řádky tabulky a&nbsp;ty je možné rozlámat do stránek. Stačí ho neschovávat dovnitř <code>\vboxu</code>. Tuto vlastnost si ukážeme na jednoduché dlouhé tabulce, kde chceme mít linky mezi každým řádkem a&nbsp;pro jednoduchost nebudeme chtít opakovat nadpis tabulky na následujících stránkách (to je vyřešeno až v&nbsp;následující tipu). Uživatel napíše třeba </p><pre class='pr-3'><code>\longtable{|c|c|}{data &amp; data \cr 
                  data &amp; data \cr 
                  ... moc dat ... &amp; \cr} 
</code></pre><p>a&nbsp;vytvoří mu to centrovanou tabulku, která je ochotna se lámat do stránek. Bude asi potřeba deklarovat <code>\raggedbottom</code>, protože řádky tabulky neobsahují žádnou pružnost. Celý zázrak se ukrývá v&nbsp;následujících řádcích: </p><pre class='pr-3'><code>\def\longtable{\goodbreak \bgroup \catcode`\|=12 \tableL} 
\def\tableL#1#2{\setbox0=\table{#1}{#2}\setbox0=\hbox to\wd0{} % tabulka nanečisto 
   \tmpdim=\hsize \advance\tmpdim by-\wd0 \divide\tmpdim by2   % výpočet odsazení 
   \def\tabstrut{\vrule height1.1em depth.5em width0pt }       % volnější řádkování 
   \everycr={\longtablecr}\offinterlineskip                    % \everycr 
   \def\tmpa{}\tabdata={\kern\tmpdim}\scantabdata#1\relax      % \tabdata 
   \halign\expandafter{\the\tabdata\tabstrutA\cr#2\crcr}\egroup\goodbreak} 
\def\longtablecr{\noalign{\nobreak\ltrule\penalty0\kern-.4pt\ltrule\nobreak}} 
\def\ltrule{\moveright\tmpdim\hbox to\wd0{\hrulefill}} 
</code></pre><p>Hlavní idea makra spočívá v&nbsp;tom, že pomocí <code>\everycr</code> vložíme za každé <code>\cr</code> zhruba řečeno: <code>\noalign{\hrule\penalty0\kern-.4pt\hrule\nobreak}</code>. Takže kreslíme dvě stejné čáry (tloušťky <code>.4pt</code>) přes sebe a&nbsp;mezi nima povolíme pomocí <code>\penalty0</code> stránkový zlom. Když se rozlomí, první čára zůstane dole a&nbsp;druhá se objeví nahoře na další stránce. Ostatní čáry jsou kresleny přes sebe, takže jejich zdvojení není vidět. </p><p>Dále tento kód řeší centrování dlouhé tabulky. Kvůli tomu ji nejprve vytvoří nanečisto do <code>\box0</code> a&nbsp;do <code>\tmpdim</code> odměří velikost odsazení každého řádku. Toto odsazení pak je vloženo do deklarace tabulky v&nbsp;<code>\tabdata</code>. Místo <code>\hrule</code> je pak použita posunutá <code>\hrule</code> definovaná jako <code>\ltrule</code>. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#ltable1' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0023</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2013-08-31'>31. 08. 2013</time></span> </footer></article> <article id='ltable2' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Dlouhá tabulka s opakujícím titulkem</h3> <a href='#ltable2'><i class='fas fa-link'></i></a></div></header><section><p>Chce-li uživatel vytvořit dlouhou tabulku, která se bude lámat do stránek, na každé stránce zopakuje svůj titulek, a&nbsp;přitom bude mít čáru nad titulkem tabulky, pod titulkem tabulky, na konci stránek a&nbsp;na konci tabulky a&nbsp;jinde ne, může použít <code>\longtableT</code> takto: </p><pre class='pr-3'><code>\def\strutT {\vrule height1.1em depth.8em width0pt} % strut pro titulek 
\longtableT {|c|c|c|}{ hlava1 &amp; hlava2 &amp; hlava22 \cr \tskip3pt  % titulek 
                       data   &amp; data   &amp; data    \cr 
                       data   &amp; ... mraky &amp; dat ...\cr} 
</code></pre><p>Je třeba definovat <code>\strutT</code>, který vypodloží titulek. Kolem titulku budou čáry, které by při normálním <code>\strut</code> působily stísněně. Dále je povinnost za titulkem dát <code>\tskip</code>, který se použije nejen pod čárou titulku, ale taky na konci každé stránky před uzavírací čárou. V&nbsp;tabulce samotné nesmí být požadavek na vodorovnou čáru. Uvedené makro <code>\longtableT</code> je implementováno takto: </p><pre class='pr-3'><code>\def\longtableT#1#2{\goodbreak \bgroup \setbox0=\table{#1}{\strutT\relax#2} 
   \setbox1=\vbox{\unvbox0 \setbox2=\vbox{}\revertbox} 
   \setbox2=\vbox{\unvbox2 \global\setbox4=\lastbox\unskip \global\setbox5=\lastbox\unskip} 
   \whatfree4 \advance\tmpdim by-.8pt \ifdim\tmpdim&lt;\baselineskip \vfil\break \fi 
   \offinterlineskip \crule\center4\crule\center5 \printboxes 
   \center5\crule \egroup \goodbreak 
} 
\def\whatfree#1{\tmpdim=\vsize \advance\tmpdim by-\pagetotal 
   \advance\tmpdim by-\prevdepth \advance\tmpdim by-.4pt 
   \advance\tmpdim by-\ht#1 \advance\tmpdim by-\dp#1 \advance\tmpdim by-\ht5 } 
\def\revertbox {\setbox0=\lastbox\unskip 
   \ifvoid0 \else \global\setbox2=\vbox{\unvbox2\box0} \revertbox\fi } 
\def\printboxes{\setbox2=\vbox{\unvbox2 \global\setbox0=\lastbox\unskip} 
   \ifvoid0 \else \whatfree0 
      \ifdim\tmpdim&lt;0pt \center5\crule\vfil\break \crule\center4\crule\center5 \fi 
      \center0 \nobreak \printboxes \fi } 
\def\crule{\centerline{\hbox to\wd4{\hrulefill}}\nobreak} 
\def\center#1{\centerline{\copy#1}\nobreak} 
</code></pre><p>Makro nejprve sestaví tabulku do <code>\box0</code>, ten rozebere a&nbsp;boxy v&nbsp;opačném pořadí pomocí <code>\revertbox</code> vloží do boxu2. Titulek si z&nbsp;boxu2 odebere jako box4 a&nbsp;prostor pod ním z&nbsp;<code>\tskip</code> jako box5. Dále makrem <code>\printboxes</code> odebírá boxy zezadu z&nbsp;boxu2 a&nbsp;klade je do stránky pomocí \center, aby byly centrovány. Pomocí <code>\whatfree</code> vždy nejprve změří zbylý prostor na stránce a&nbsp;pokud se tam už další box nevejde, přidá <code>\box5\crule</code>, odstránkuje a&nbsp;na začátek další stránky přidá <code>\crule\box4\crule\box5</code>. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#ltable2' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0024</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2013-08-31'>31. 08. 2013</time></span> </footer></article>
                            </section>  <section id="obrazky" class="mb-5 rounded my-shadow" style="background-color: #778c94">
                                <header class="text-center">
                                  <div class="py-2">
                                    <h2 class="d-inline text-light font-weight-light">Obrázky</h2>
                                    <a href="#obrazky"><i class="fas fa-link"></i></a>
                                  </div>
                                </header>
                                <article id='inspicspace' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Mezera separující parametr makra \inspic</h3> <a href='#inspicspace'><i class='fas fa-link'></i></a></div></header><section><p>OPmac předpokládá, že název souboru, tedy parametr makra <code>\inspic</code>, bude ukončen mezerou. Je to z&nbsp;toho důvodu, že stejně jako primitivní příkaz <code>\input</code> nevyžaduje kučeravé závorky, rozhodl jsem se i&nbsp;u makra <code>\inspic</code> nic takového nevyžadovat. Pokud chcete načíst makrem <code>\inspic</code> soubor s&nbsp;mezerou, pište </p><pre class='pr-3'><code>\inspic {soubor s mezerou.pdf} 
</code></pre><p>a&nbsp;nezapomeňte za zavírací závorku dát další povinnou mezeru. </p><p>Bohužel, makro <code>\inspic</code> se chová poněkud jinak než primitivní příkaz <code>\input</code>. V&nbsp;případě <code>\inspic</code> je mezeru vždy nutné psát. Třeba na rozdíl od zápisu <code>\line{\input soubor}</code> je tedy nutné použít <code>\line{\inspic soubor.pdf }</code>. Koho to irituje, může pravidlo mezery z&nbsp;makra <code>\inspic</code> odstranit a&nbsp;důsledně pak psát parametr makra do kučeravých závorek. K&nbsp;tomu slouží tento kód: </p><pre class='pr-3'><code>\expandafter\def\expandafter\inspic\expandafter#\expandafter1\expandafter{\inspic{#1} } 
</code></pre></section><footer class='text-right'><a href='opmac-tricks-e.html#inspicspace' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0141</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2016-04-09'>09. 04. 2016</time></span> </footer></article> <article id='inkinspic' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Popisky k obrázkům z programu Inkscape</h3> <a href='#inkinspic'><i class='fas fa-link'></i></a></div></header><section><p>Program Inkscape umožňuje při ukládání do PDF rozdělit textové popisky od ostatních čar: stačí v&nbsp;dialogovém okně pro ukládání zaškrtnout PDF+LaTeX. Ostatní čáry vloží do souboru <code>file.pdf</code> a&nbsp;vedle tohoto souboru vytvoří ještě soubor <code>file.pdf_tex</code> s&nbsp;popisky zapsanými LaTeXovou synaxí. V&nbsp;TeXovém dokumentu stačí v&nbsp;místě obrázku psát </p><pre class='pr-3'><code>\inkinspic file.pdf 
</code></pre><p>Toto makro načte soubor <code>file.pdf</code> s&nbsp;čarami i&nbsp;soubor <code>file.pdf_tex</code> s&nbsp;popisky. Šířka obrázku je dána registrem <code>\picw</code> jako při použití makra <code>\inspic</code>. </p><p>Popisky jsou vysázeny ve velikosti a&nbsp;rodině fontu jako okolní sazba, takže Inkscape fonty vůbec neřeší. V&nbsp;náhledu Inkscape můžete použít libovolný font v&nbsp;libovolné velikosti a&nbsp;nebude to mít žádný vliv na výsledou sazbu. Do popisků v&nbsp;náhledu můžete psát TeXové příkazy (např. matematické vzorce vložené mezi dolary). Umístění popisku je možné buď nalevo, napravo nebo na centr pomocí nabídky v&nbsp;Inkscape. To je pak jediný bod, který se zaručeně v&nbsp;sazbě bude shodovat s&nbsp;tím, co vidíte v&nbsp;náhledu. Text můžete také obarvit nebo otáčet. </p><p>Abychom mohli v&nbsp;OPmac využít tento rys programu Inkscape připravený pro LaTeX, je potřeba emulovat některé LaTeXové příkazy, které se v&nbsp;exportovaném souboru vyskytují: <code>\begin{picture}</code>, <code>\put</code>, <code>\makebox</code> a&nbsp;další. K&nbsp;tomu stačí do definic dokumentu přidat následující kód: </p><pre class='pr-3'><code>\def\inkinspic #1 {\bgroup 
  \ifdim\picw=0pt 
    \setbox0=\hbox{\inspic#1 }% 
    \picw=\wd0 
  \fi 
  \the\inkdefs \input \picdir#1_tex \egroup 
} 
\newtoks\inkdefs  \inkdefs={%  
  %\ifdim\picw=0pt \message{inkinspic: \picw set to \hsize}\picw=\hsize \fi  
  \def\makeatletter#1\makeatother{}%  
  \def\includegraphics[#1]#2{\inkscanpage#1,page=,\end \inspic #2 \hss}%  
  \def\inkscanpage#1page=#2,#3\end{\ifx,#2,\else\def\inspicpage{page#2}\fi}%  
  \def\put(#1,#2)#3{\nointerlineskip\vbox to0pt{\vss\hbox to0pt{\kern#1\picw  
      \pdfsave\hbox to0pt{#3}\pdfrestore\hss}\kern#2\picw}}%  
  \def\begin#1{\csname begin#1\endcsname}% 
  \def\beginpicture(#1,#2){\vbox\bgroup\hbox to\picw{}\kern#2\picw \def\end##1{\egroup}}% 
  \def\begintabular[#1]#2#3\end#4{\vtop{\def\\{\cr}\def\tabiteml{}\def\tabitemr{}\table{#2}{#3}}}% 
  \def\color[#1]#2{\scancolor #2,}%  
  \def\scancolor#1,#2,#3,{\pdfliteral{#1 #2 #3 rg}}%  
  \def\makebox(#1)[#2]#3{\hbox to0pt{\csname mbx:#2\endcsname{#3}}}%  
  \sdef{mbx:lb}#1{#1\hss}\sdef{mbx:rb}#1{\hss#1}\sdef{mbx:b}#1{\hss#1\hss}%  
  \sdef{mbx:lt}#1{#1\hss}\sdef{mbx:rt}#1{\hss#1}\sdef{mbx:t}#1{\hss#1\hss}%  
  \def\rotatebox#1#2{\pdfrotate{#1}#2}% 
  \def\lineheight#1{}% 
  \def\setlength#1#2{}% 
} 
</code></pre><p>Pozor na mezeru: makro <code>\inkinspic</code> je (stejně jako makro <code>\inspic</code>) naprogramováno tak, že má svůj parametr ukončený mezerou. Chová se tedy analogicky, jako příkaz <code>\input</code>. Chcete-li například obrázek centrovat, pište: </p><pre class='pr-3'><code>\centerline{\picw=7cm \inkinspic obrazek.pdf } 
</code></pre></section><footer class='text-right'><a href='opmac-tricks-e.html#inkinspic' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0032</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2013-10-02'>02. 10. 2013</time></span> </footer></article> <article id='captiform' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Jinak formátované \caption</h3> <a href='#captiform'><i class='fas fa-link'></i></a></div></header><section><p>OPmac formátuje popisky pod obrázky a&nbsp;tabulkami implicitně tak, že centruje poslední řádek odstavce. Je možné, že chcete jiné formátování. Například takové, aby popisky centrovaly, pokud jsou na samostatném řádku, ale jinak aby se chovaly jako obyčejný odstavec, pokud přetečou na více řádků. To by mohl vyřešit následující kód: </p><pre class='pr-3'><code>\def\printcaption#1#2{\leftskip=\iindent \rightskip=\iindent 
   \setbox0=\hbox\bgroup \aftergroup\docaption{\bf#1 #2.}\enspace} 
\def\docaption{\tmpdim=\hsize \advance\tmpdim by-2\iindent 
   \ifdim\wd0&gt;\tmpdim \unhbox0 \else \hfil\hfil\unhbox0 \fi \endgraf \egroup} 
</code></pre><p>Makro přeměří text popisku uložený v&nbsp;boxu0 a&nbsp;pokud se vejde na jeden řádek, předřadí před něj <code>\hfil\hfil</code>, což je pružinka stejné síly, jako <code>\parfillskip</code> (v popiscích dle OPmac) a&nbsp;text centruje. Je-li popisek delší, žádná pružinka se nepředřadí a&nbsp;vysází se obyčejný odstavec. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#captiform' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0059</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2014-05-13'>13. 05. 2014</time></span> </footer></article> <article id='capside' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Popisek vedle obrázku</h3> <a href='#capside'><i class='fas fa-link'></i></a></div></header><section><p><img src='img/cap-side.png' alt='Popisek vedle obrázku' title='Popisek vedle obrázku' class='img-fluid rounded mx-auto my-2 d-block'> </p><p>Je-li obrázek spíše vysoký než široký, může se hodit umístit popisek k&nbsp;němu vedle obrázku a&nbsp;ne pod ním nebo nad ním. To lze provést třeba takto </p><pre class='pr-3'><code>\hbox to\hsize{\picw=.4\hsize \inspic mapa.jpg 
  \hfil\vbox{\hsize=.55\hsize \iindent=0pt \emergencystretch=2em 
    \caption/f Lorem ipsum dolor sit amet, consectetur adipiscing elit. 
       ... 
       Fusce sagittis lobortis nisi sed consectetur. 
   \par}} 
</code></pre><p>Poznamenejme, že je potřeba vnitřní <code>\vbox</code> ukončit <code>\par</code>, protože OPmac pro popisky lokálně předefinovává <code>\par</code> a&nbsp;jeho první použití vrací věci do normálu. Dále je zde nastaveno <code>\iindent=0pt</code>, protože nechceme mít zúžené okraje. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#capside' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0136</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2016-01-06'>06. 01. 2016</time></span> </footer></article> <article id='inspic' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>\inspic natáhne do PDF stejný obrázek jen jednou</h3> <a href='#inspic'><i class='fas fa-link'></i></a></div></header><section><p>Víme, že pomocí pimitivního příkazu pdfTeXu <code>\pdfximage</code> lze zařídit jedno vložení obrázku do výstupního PDF a&nbsp;dále tento obrázek opakovaně zobrazovat pomocí <code>\pdfrefximage</code>. Makro <code>\inspic</code> z&nbsp;OPmac je ale koncipováno jen pro jednorázové vložení obrázku, takže když použijete <code>\inspic</code> opakovaně se stejným obrázkem, vloží se do PDF dokumentu vícekrát a&nbsp;zbytečně plýtváte místem v&nbsp;PDF souboru. </p><p>Pro potřebu postupně odhalovaných slíd (viz <a href='#slidekuk' title='OPmac trik 0022'>OPmac trik 0022</a> a&nbsp;viz také CTUslides v&nbsp;<a href='http://petr.olsak.net/ctustyle.html' title='CTUstyle'>CTUstyle</a>) jsem potřeboval zvýšit inteligenci makra \inspic tak, aby opakovaně volaný obrázek nevkládal do PDF výstupu data obrázku opakovaně. Řešení je snadné: </p><pre class='pr-3'><code>\let\oriinspic=\inspic 
\def\picdim{\the\picwidth:\the\picheight} 
\def\inspic#1 {% 
   \expandafter\ifx\csname pic:#1:\picdim\endcsname \relax 
      \oriinspic#1 % prvé vložení obrázku 
      \global\expandafter\mathchardef\csname pic:#1:\picdim\endcsname=\pdflastximage 
   \else \expandafter\pdfrefximage \csname pic:#1:\picdim\endcsname % opakované vložení 
   \fi 
} 
</code></pre><p>Je vidět, že refenenční číslo obrázku je řídicí sekvence obsahující jednak název obrázku a&nbsp;také stav parametrů <code>\picwidth</code> a&nbsp;<code>\picheight</code>. Při jiném nastavení těchto parametrů je potřeba obrázek natáhnout znovu, nebo je potřeba využít už natažený obrázek a&nbsp;podrobit jej vhodné lineární transformaci. To by sice šlo, ale pro jednoduchost jsem se tím nezabýval. Opakované vložení různě velkých ale jinak stejných obrázků by si musel makroprogramátor ošetřit sám. </p><p>Řešení se bohužel opírá o&nbsp;vlastnosti pdfTeXu (dostupné i&nbsp;v LuaTeXu), které nejsou použitelné v&nbsp;XeTeXu. Tam by se to muslelo dělat jinak. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#inspic' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0110</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2015-06-04'>04. 06. 2015</time></span> </footer></article>
                            </section>  <section id="odstavec" class="mb-5 rounded my-shadow" style="background-color: #778c94">
                                <header class="text-center">
                                  <div class="py-2">
                                    <h2 class="d-inline text-light font-weight-light">Odstavec</h2>
                                    <a href="#odstavec"><i class="fas fa-link"></i></a>
                                  </div>
                                </header>
                                <article id='setparshape' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Pohodlné zadávání \parshape</h3> <a href='#setparshape'><i class='fas fa-link'></i></a></div></header><section><p>Obecný tvar odstavce lze specifikovat pomocí primitivu <code>\parshape</code>, ale příprava parametrů tohoto primitivu není pro uživatele příliš komfortní. V&nbsp;TBN strana 236 je ukázka marka <code>\oblom</code>, které se specializuje na obdélníkové výřezy odstavce. Zde navrhneme makro <code>\setparshape</code>, které umožní specifikovat levý nebo pravý okraj odstavce obecněji a&nbsp;poměrně pohodlně. Příklady: </p><pre class='pr-3'><code>\setparshape\left (3*0, 7*35)mm  % po třech řádcích obdélníkový výřez v sedmi řádcích 
% nebo 
\setparshape\right (4*0, 5,10,15,20,25,20,15,10,5)mm % trojúhelníkový výřez vpravo 
</code></pre><p>Makro <code>\setparshape</code> nejprve přečte <code>\left</code> nebo <code>\right</code>, což specifikuje okraj, který bude ovlivněn. Pak v&nbsp;kulaté závorce je čárkami oddělený seznam údajů ve tvaru <code>počet*rozměr</code>, kde <code>počet</code> odpovídá počtu řádků, které budou zkráceny o&nbsp;<code>rozměr</code>.  Není-li v&nbsp;údaji hvězdička, je tam <code>rozměr</code> týkající se jediného řádku. Za uzavírací kulatou závorkou následuje jednotka pro <code>rozměry</code> ukončená mezerou. Pokud chcete rozměry přímo specifikovat v&nbsp;datech, použijte <code>(...){}</code> tedy například: </p><pre class='pr-3'><code>\setparshape\left (3*0pt, 7*.4\hsize){} 
</code></pre><p>což vytvoří obdélníkový výřez v&nbsp;sedmi řádcích vlevo a&nbsp;dá to stejný výsledek jako: </p><pre class='pr-3'><code>\setparshape\left (3*0, 7*.4){\hsize} 
</code></pre><p>Nastavení <code>\setparshape</code> se implicitně týká jediného odstavce, který bezprostředně následuje. Pokud chcete ovlivnit několik odstavců pod sebou, je třeba předřadit <code>\globalshape</code>, tedy například psát: </p><pre class='pr-3'><code>\globalshape\setparshape\left (3*0, 12*55)mm 
</code></pre><p>Implementace je následující: </p><pre class='pr-3'><code>\newcount\parshapenum \newcount\globpar 
 
\def\setparshape#1(#2)#3 {\def\parshapedata{}\parshapenum=1 
   \let\parshapeside=#1\def\parshapeunit{#3}\setparshapeA#2,,% 
} 
\def\setparshapeA#1,{\ifx,#1,\parshape=\parshapenum\parshapedata0pt\hsize 
   \else\fihere\setparshapeB#1\empty*\empty\end\fi 
} 
\def\setparshapeB#1*#2\empty#3\end{% 
   \ifx,#3,\tmpnum=1 \tmpdim=#1\parshapeunit \relax 
   \else \tmpnum=#1\tmpdim=#2\parshapeunit \relax \fi 
   \loop \ifnum\tmpnum&gt;0 
      \advance\tmpnum by-1 \advance\parshapenum by1 
      \dimen0=\hsize \advance\dimen0 by-\tmpdim 
      \ifx\parshapeside\left 
          \edef\parshapedata{\parshapedata\the\tmpdim\space\the\dimen0}% 
      \else\edef\parshapedata{\parshapedata0pt\the\dimen0}\fi 
   \repeat 
   \setparshapeA 
} 
\def\fihere#1\fi{\fi#1} 
\def\globalshape{% TBN page 237 
   \global\globpar=0 \gdef\par{\ifhmode\shapepar\fi}% 
} 
\def\shapepar{\prevgraf=\globpar \parshape=\parshapenum\parshapedata0pt\hsize 
   \endgraf \global\globpar=\prevgraf 
   \ifnum\prevgraf&lt;\parshapenum \else \global\let\par=\endgraf\fi 
} 
</code></pre></section><footer class='text-right'><a href='opmac-tricks-e.html#setparshape' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0154</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2016-06-07'>07. 06. 2016</time></span> </footer></article> <article id='putshape' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Obrázek v obdélníkovém výřezu odstavce</h3> <a href='#putshape'><i class='fas fa-link'></i></a></div></header><section><p><img src='img/ukazka-kachna.png' alt='Ukázka kachny' title='Ukázka kachny' class='img-fluid rounded mx-auto my-2 d-block'> </p><p>Vytvoříme makro <code>\putshape strana číslo{objekt}</code>, které vloží <code>objekt</code> do následujícího odstavce (nebo více odstavců) s&nbsp;obdélníkovým vykrojením textu pro <code>objekt</code> vlevo (<code>strana</code> je <code>\left</code>) nebo vpravo (<code>strana</code> je <code>\right</code>) tak, že prvních <code>číslo</code> řádků odstavce je beze změny, pak následuje vykrojení textu s&nbsp;<code>objektem</code>. Velikost odsazení a&nbsp;počet odsazených řádků si makro spočítá samo na základě informace o&nbsp;tom, jak velký je <code>objekt</code>. Typické užití vypadá třeba takto: </p><pre class='pr-3'><code>\putshape\right 4 {\picw=3cm \inspic obrazek.png } 
</code></pre><p>Makro z&nbsp;ukázky vloží obrázek vpravo pod čtvrtý řádek následuhícího odstavce s&nbsp;obdélníkovým vykrojením závislým na velikosti obrázku. Mezi textem a&nbsp;objektem (obrázkem) je vložena vertikální mezera <code>\putvmargin</code> (nad a&nbsp;pod) a&nbsp;<code>\puthmargin</code> (vedle mezi obrázkem a&nbsp;textem). Tyto registry jsou implicitně nastaveny na <code>5pt</code>. </p><p>Implementace se opírá o&nbsp;makro <code>\setparshape</code> z&nbsp;předchozího <a href='#setparshape' title='OPmac triku 0154'>OPmac triku 0154</a>: </p><pre class='pr-3'><code>\newdimen\putvmargin \newdimen\puthmargin 
\putvmargin=5pt \puthmargin=5pt 
 
\def\putshape#1#2#{\let\tmpa=#1\def\tmpb{#2}\putshapeA} 
\def\putshapeA#1{\vskip\parskip 
   \setbox0=\vbox{\kern\putvmargin\hbox{#1}\kern\putvmargin}\tmpnum=\ht0 
   \advance\tmpnum by-10 \divide\tmpnum by\baselineskip \advance\tmpnum by1 
   \dimen0=\wd0 \advance\dimen0 by\puthmargin 
   \hbox to\hsize{\ifx\tmpa\right \hfill\fi 
      \vbox to0pt{\kern\tmpb\baselineskip\kern-.8\baselineskip 
         \vbox to\the\tmpnum\baselineskip{\vss\box0\vss}\vss}\hss} 
   \nobreak\vskip-\parskip\vskip-\baselineskip 
   \edef\tmpb{\tmpa(\tmpb*0pt,\the\tmpnum*\the\dimen0)} 
   \globalshape\expandafter\setparshape\tmpb{} 
} 
</code></pre></section><footer class='text-right'><a href='opmac-tricks-e.html#putshape' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0155</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2016-06-08'>08. 06. 2016</time></span> </footer></article>
                            </section>  <section id="slidy" class="mb-5 rounded my-shadow" style="background-color: #778c94">
                                <header class="text-center">
                                  <div class="py-2">
                                    <h2 class="d-inline text-light font-weight-light">Slídy</h2>
                                    <a href="#slidy"><i class="fas fa-link"></i></a>
                                  </div>
                                </header>
                                <article id='sparta' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Slídy ve spartánské úpravě</h3> <a href='#sparta'><i class='fas fa-link'></i></a></div></header><section><p>Pokud chceme připravit text pro projekci, je potřeba především mít landscape formát a&nbsp;dostatečně velké písmo. Hodí se použít písmo bezserifové. Pokud nepotřebujete další specialitky, je možné si vystačit s&nbsp;málem: </p><pre class='pr-3'><code>\input opmac 
 
\margins/1 a5l (1,1,1,1.2)cm        % landscape formát 
\input chelvet  \typosize[17/22]    % dostatečně velké písmo 
 
\def\sec#1\par{\centerline 
     {\secfont#1}\bigskip}          % sekce uprostřed a nebudou číslovány 
\def\pg{\vfil\break}                % makro pro odstránkování 
\begitems                           % celý dokument bude jako výčet 
</code></pre><p>Vlastní text členíme pomocí hvězdiček na jednotlivé výkřiky, dále můžeme použít <code>\sec</code> pro vyznačení nadpisů a&nbsp;makro <code>\pg</code> na odstránkování. </p><pre class='pr-3'><code>\sec Nějaká nosná myšlenka 
 
* výkřik první 
* výkřik druhý 
* výkřik třetí 
 
\pg 
\sec Další myšlenka 
 
* výkřik čtvrtý 
* výkřik pátý 
 
\enditems\end 
</code></pre><p>Pokud potřebujete mít firemní loga, zajímavou grafiku atd, je potřeba si s&nbsp;tím samozřejmě více pohrát a&nbsp;vytvořit si speciální styl. Doporučuji též použít <a href='#podklad' title='trik o&nbsp;podkladovém obrázku'>trik o&nbsp;podkladovém obrázku</a>. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#sparta' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0017</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2013-08-18'>18. 08. 2013</time></span> </footer></article> <article id='slidekuk' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Slideshow -- postupné odhalování</h3> <a href='#slidekuk'><i class='fas fa-link'></i></a></div></header><section><p>Někteří promítači svých myšlenek rádi odhalují skutečnosti postupně, tj. nejprve jen část stránky, pak další část a&nbsp;nakonec celou stránku. Takoví promítači do místa, kde se má myšlenka poodhalit, napíší <code>\kuk</code>. To vytvoří stránku až do tohoto místa. Na následující stránce bude vše opsáno a&nbsp;přidán případný další text po další <code>\kuk</code>. Definitivní konec stránky musí být označen pomocí <code>\pg\kuk</code> (před <code>\pg</code> se <code>\kuk</code> nepíše) a&nbsp;dokument končí sekvencí <code>\enditems\end\kuk</code>. Na začátku dokumentu (po přečtení všech maker) musí být napsáno <code>\kukstart</code>. Pokud je tento příkaz schován za procentem, probíhá normální stránkování a&nbsp;příkazy <code>\kuk</code> jsou ignorovány. </p><p>Implementace <code>\kuk</code> navazuje na předchozí ukázku o&nbsp;slídech spartánského vzhledu a&nbsp;přidává (za první <code>\begitems</code>) tato makra: </p><pre class='pr-3'><code>\let\kuk=\relax % je-li \kukstart zakomentovano, tiskne normalne dokument 
\def\kukdata{} 
\long\def\kukstart#1\kuk{\addto\kukdata{#1}% 
   \tmpnum=0 \def\endkukdata{}\expandafter\sumkuk \kukdata\sumkuk 
   \kukdata\endkukdata \vfil\break \kukstart 
} 
\long\def\sumkuk#1{\ifx\sumkuk#1% jsem na konci seznamu 
   \loop \ifnum\tmpnum&gt;0 \addto\endkukdata{\enditems}\advance\tmpnum by-1 \repeat 
   \else 
     \ifx\begitems#1\global\advance\tmpnum by1 \fi 
     \ifx\enditems#1\global\advance\tmpnum by-1 \fi 
     \expandafter\sumkuk \fi 
} 
\count1=1 
\def\advancepageno{\ifx\kukdata\empty \global\advance\pageno by1 \global\count1=1 
                   \else \global\advance\count1 by1 \fi} 
\def\pg{\def\kukdata{}\vfil\break} 
\kukstart 
</code></pre><p>Makro <code>\kukstart</code> se točí dokola a&nbsp;nabírá text až po <code>\kuk</code>, přidává ho k&nbsp;už nabranému textu z&nbsp;minula do <code>\kukdata</code> a&nbsp;tiskne stránky. Makro <code>\pg</code> nabraný text promaže. Nejvíce péče je vněnováno případu, kdy je <code>\kuk</code> napsáno uvnitř další úrovně odrážek (tedy ve skupině). Makro <code>\sumkuk</code> si spočítá úroveň vnoření a&nbsp;na základě toho doplní do <code>\endkukdata</code> příslušný počet <code>\enditems</code>. </p><p>Poznámka: důkladnější řešení postupného odhalování slíd najdete v&nbsp;<a href='http://petr.olsak.net/ftp/olsak/ctustyle/slidy.pdf' title='CTUslides'>CTUslides</a>, které je součástí <a href='http://petr.olsak.net/ctustyle.html' title='CTUstyle'>CTUstyle</a>. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#slidekuk' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0022</span> <span class='badge badge-info'>Autor: Mirek + P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2013-08-30'>30. 08. 2013</time></span> </footer></article>
                            </section>  <section id="bibliograficke-udaje" class="mb-5 rounded my-shadow" style="background-color: #778c94">
                                <header class="text-center">
                                  <div class="py-2">
                                    <h2 class="d-inline text-light font-weight-light">Bibliografické údaje</h2>
                                    <a href="#bibliograficke-udaje"><i class="fas fa-link"></i></a>
                                  </div>
                                </header>
                                <article id='pcite' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Odkazy s vloženou poznámkou</h3> <a href='#pcite'><i class='fas fa-link'></i></a></div></header><section><p>Někdy potřebujeme napsat odkaz s&nbsp;vloženou poznámkou, například s&nbsp;upřesněním strany v&nbsp;citovaném dokumentu. Třeba takto: </p><p>Obtékání obrázku textem je řešeno v&nbsp;[27, s. 236]. </p><p>To můžeme zařídit pomocí <code>\rcite</code> třeba takto: </p><pre class='pr-3'><code>Obtékání obrázku textem je řešeno v~[\rcite[tbn], s.~236]. 
</code></pre><p>Možná by se ale hodilo rozšířit funkčnost makra <code>\cite</code> tak, že když najde za <code>[lejblíkem]</code> lomítko: </p><pre class='pr-3'><code>Obtékání obrázku textem je řešeno v~\cite[tbn]/{s.~236}. 
</code></pre><p>vytvoří požadovaný výsledek [27, s. 236]. K&nbsp;tomu poslouží následující kód: </p><pre class='pr-3'><code>\def\cite[#1]{\isnextchar/{\pcite[#1]}{[\rcite[#1]]}} 
\def\pcite[#1]/#2{[\rcite[#1],~#2]} 
</code></pre><p>Makro <code>\cite</code> nyní testuje přítomnost lomítka. Pokud není přítomno, zavolá <code>\rcite</code> s&nbsp;obklopenými závorkami. Pokud je přítomno, zavolá <code>\pcite</code>, které vykoná požadovanou práci. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#pcite' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0038</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2014-04-01'>01. 04. 2014</time></span> </footer></article> <article id='ccite' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Komprimované odkazy typu [jméno, rok]</h3> <a href='#ccite'><i class='fas fa-link'></i></a></div></header><section><p>Při <code>\nonumcitations</code> a&nbsp;při značkách typu <code>[jméno, rok]</code> se hodí neopakovat stejné jméno v&nbsp;jednom balíku citací. Například při: </p><pre class='pr-3'><code>Česky se píše o \TeX{}u například v~\cite[tst,tbn,tpp,lpp]. 
</code></pre><p>dostaneme [Olšák, 1995, Olšák, 1997, Olšák, 2013, Satrapa, 2011], ale chtěli bychom spíše odkaz tvaru [Olšák, 1995, 1997, 2013, Satrapa, 2011]. Toto můžeme řešit pomocí <code>\ecite</code>, např. </p><pre class='pr-3'><code>[\rcite[tst], \ecite[tbn]{1997}, \ecite[tpp]{2013}, \rcite[lpp]] 
</code></pre><p>ale lepší by bylo, kdyby zkracování probíhalo automaticky. K&nbsp;tomu může posloužit následující kód. </p><pre class='pr-3'><code>\nonumcitations 
\def\printcite#1{\citesep 
   \prepcitelink{#1}\citelink{#1}{\the\bibmark}\def\citesep{,\hskip.2em\relax}% 
} 
\def\prepcitelink#1{% 
   \isdefined{bim:#1}\iftrue 
      \expandafter\expandafter\expandafter \ppclink \csname bim:#1\endcsname!\relax 
   \else \opwarning{comprimed cites: empty bibmark}\bibmark={#1}% 
   \fi 
} 
\def\ppclink #1, #2!\relax{\def\tmpa{#1}% 
   \ifx \lastcitedname\tmpa \bibmark={#2}% 
   \else \let\lastcitedname=\tmpa \if^#2^\bibmark={#1}\else\bibmark={#1, #2}\fi 
   \fi 
} 
</code></pre><p>Makro předefinovává makro z&nbsp;OPmac <code>\printcite</code> tak, že volá <code>\citelink</code> s&nbsp;prarametrem <code>\the\bibmark</code>. Přitom <code>\bibmark</code> je nejprve připraven pomocí <code>\prepcitelink</code>. Makro <code>\prepcitelink</code> rozloží značku ve spolupráci s&nbsp;<code>\ppclink</code> na část před čárkou s&nbsp;mezerou a&nbsp;zbytek (na jméno a&nbsp;rok). Makro <code>\lastcitedname</code> je na začátku implicitně nedefinované a&nbsp;přijímá naposledy citované jméno. Je-li v&nbsp;zápětí toto jméno stejné, je do <code>\bibmark</code> vložen jen rok. Jinak je tam vloženo jméno i&nbsp;rok. Protože je celý <code>\cite</code> proveden uvnitř skupiny, na konci <code>\cite</code> se <code>\lastcitedname</code> vrátí do nedefinovaného stavu, takže první údaj nového <code>\cite</code> bude vždy jméno obsahovat. </p><p>Upozorňuji, že kód funguje jen tehdy, když jsou všechny značky připraveny ve tvaru <code>jméno, rok</code>, kde uvedené dva údaje jsou odděleny čárkou následovanou mezerou. Chybí-li údaj <code>rok</code>, je třeba, aby značka byla ukončena čárkou a&nbsp;mezerou. BibTeXový styl <code>apalike</code> tomuto požadavku vyhovuje. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#ccite' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0039</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2014-04-01'>01. 04. 2014</time></span> </footer></article> <article id='modcite' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Modifikace odkazů typu (jméno rok)</h3> <a href='#modcite'><i class='fas fa-link'></i></a></div></header><section><p>Někdy se požaduje, aby odkazy typu „jméno rok“ byly bez čárek mezi autorem a&nbsp;rokem, např. [Olšák 2013]. V&nbsp;takovém případě stačí použít kód z&nbsp;předchozího triku a&nbsp;upravit v&nbsp;něm makro <code>\ppclink</code> takto: </p><pre class='pr-3'><code>\def\ppclink #1, #2!\relax{\def\tmpa{#1}% 
   \ifx \lastcitedname\tmpa \bibmark={#2}% 
   \else \let\lastcitedname=\tmpa \if^#2^\bibmark={#1}\else\bibmark={#1 #2}\fi 
   \fi 
} 
</code></pre><p>BibTeXový styl <code>apalike</code> sice čárky pro značky generuje, ale takto modifikované makro <code>\ppclink</code> je nakonec odstraní. </p><p>Taky se často požaduje, aby byly odkazy v&nbsp;kulatých závorkách, např. takto (Olšák 2013). Není nic jednoduššího, než definovat: </p><pre class='pr-3'><code>\def\cite[#1]{(\rcite[#1])} 
</code></pre></section><footer class='text-right'><a href='opmac-tricks-e.html#modcite' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0043</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2014-04-02'>02. 04. 2014</time></span> </footer></article> <article id='abib' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Značky v seznamu literatury při \nonumcitations</h3> <a href='#abib'><i class='fas fa-link'></i></a></div></header><section><p>OPmac při <code>\nonumcitations</code> píše místo čísel do místa <code>\cite</code> značky, ale tyto značky implicitně neopakuje v&nbsp;seznamu literatury. Předpokládá se totiž, že seznam je řazený podle jmen prvního z&nbsp;autorů každé citace a&nbsp;tato jména se ve značkách vyskytují. Zopakování značky v&nbsp;seznamu literatury je pak nadbytečné zejména při použití dlouhých značek typu (Olšák, 2001). Ale při použití krátkých značek [Ol01] může být žádoucí takovou značku v&nbsp;seznamu literatury zopakovat. </p><p>K&nbsp;zopakování značek při <code>\nonumcitations</code> v&nbsp;seznamu literatury je třeba předefinovat makro <code>\printbib</code>, které se stará o&nbsp;zahájení tisku jednoho záznamu v&nbsp;seznamu literatury. Třeba takto: </p><pre class='pr-3'><code>\def\printbib{\hangindent=2\iindent 
   \noindent\hskip2\iindent \llap{[\the\bibmark] }% 
} 
</code></pre></section><footer class='text-right'><a href='opmac-tricks-e.html#abib' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0096</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2015-04-12'>12. 04. 2015</time></span> </footer></article> <article id='bibmark' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Zkrácené značky při použití opmac-bib</h3> <a href='#bibmark'><i class='fas fa-link'></i></a></div></header><section><p>Příkaz <code>\cite</code> vypisuje značky místo čísel, pokud je nastaveno <code>\nonumcitations</code>. Makro pro přímé čtení <code>.bib</code> souborů <code>opmac-bib.tex</code> nabízí dva stylové soubory (<code>simple</code> a&nbsp;<code>iso690</code>), které generují tyto značky v&nbsp;dlouhém formátu <code>Jméno prvního autora, rok</code>. Některá nakladatelství preferují styl, ve kterém jsou tyto značky zkráceny. Třeba na první dvě písmena jména prvního autora následovaná dvěma ciframi určujícími rok, tedy například [Kn84]. Jak takové zkrácené značky dostat i&nbsp;do seznamu literatury popisuje <a href='http://petr.olsak.net/opmac-tricks.html#abib' title='OPmac trik 0096'>OPmac trik 0096</a>. Nyní si ukážeme, jak předefinovat generování těchto značek při použití <code>opmac-bib</code>, abychom dosáhli zkrácený formát bez nutnosti doplňovat pro každý záznam výjimku do <code>.bib</code> souboru pomocí bibmark. </p><p>Stylové soubory <code>opmac-bib-styl.tex</code> (od verze Apr. 2015) používají k&nbsp;vygenerování značek makro <code>\setbibmark</code>. Je tedy potřeba si definovat vlastní makro <code>\mysetbibmark</code> a&nbsp;dále pomocí <code>\bibtexhook</code> toto makro nastavit: </p><pre class='pr-3'><code>\def\mysetbibmark{% 
   \ifx\dobibmark\undefined \def\dobibmark{}\fi 
   \RetrieveFieldIn{bibmark}\tmp 
   \ifx\tmp\empty 
      \RetrieveFieldIn{year}\tmp 
      \edef\tmp{\expandafter\bibmarkA\dobibmark{}{}\relax \expandafter\bibmarkB\tmp{}{}{}{}\relax}% 
   \fi 
   \bibmark=\expandafter{\tmp}% 
} 
\def\bibmarkA#1#2#3\relax{#1#2}     % first two letters from the author name 
\def\bibmarkB#1#2#3#4#5\relax{#3#4} % lats two digits from the year 
 
\def\bibtexhook{\let\setbibmark=\mysetbibmark} 
</code></pre><p>Makro využije jméno autora uložené stylovým souborem v&nbsp;\dobibmark a&nbsp;přidá k&nbsp;němu rok. Z&nbsp;prvého extrahuje první dva tokeny použitím \bibmarkA a&nbsp;z druhého extrahuje cifry roku použitím <code>\bibmarkB</code>. </p><p>Pokud máte v&nbsp;seznamu dvě stejné značky (např. citujete plodného autora, který vytvořil více literárních výstupů za jeden rok), můžete deklarovat výjimku pomocí pole bibmark v&nbsp;<code>.bib</code> souboru. Nebo je možné zařadit do automatického generování přidávání písmen a, b, c&nbsp;atd. To ponechám jako cvičení pro šikovného makroprogramátora. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#bibmark' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0097</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2015-04-12'>12. 04. 2015</time></span> </footer></article> <article id='bibmarkcheck' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Kontrola unikátnosti značek bibmark</h3> <a href='#bibmarkcheck'><i class='fas fa-link'></i></a></div></header><section><p>Pokud nemáte k&nbsp;dispozici šikovného makroprogramátora, o&nbsp;kterém se hovoří v&nbsp;předchozím OPmac triku, možná uvítáte aspoň kontrolu, zda všechny značky tištěné v&nbsp;<code>\cite</code> při <code>\nonumcitations</code> jsou zadány jednoznačně. Implicitně tato kontrola neprobíhá, takže se může stát, že se v&nbsp;dokumentu pracuje se dvěma nebo více stejnými značkami, které příslušejí různým bibliografickým záznamům. </p><p>Kontrola je provedena v&nbsp;makru <code>\bibmarkcheck</code>, jehož definici i&nbsp;volání je možné vložit například na začátek dokumentu (někam za <code>\input opmac</code>). </p><pre class='pr-3'><code>\def\bibmarkcheck{\ifx\lastbibnum\undefined \else 
   \bgroup 
      \bibnum=0 
      \loop 
         \advance\bibnum by1 
         \isdefined{bim:\the\bibnum}\iftrue 
            \isdefined{\csname bim:\the\bibnum\endcsname}\iftrue 
               \opwarning{Duplicated bibmark: "\csname bim:\the\bibnum\endcsname"}% 
            \fi 
            \sdef{\csname bim:\the\bibnum\endcsname}{}% 
         \fi 
         \ifnum\bibnum&lt;\lastbibnum \relax \repeat 
   \egroup 
   \fi 
} 
\bibmarkcheck 
</code></pre></section><footer class='text-right'><a href='opmac-tricks-e.html#bibmarkcheck' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0098</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2015-04-12'>12. 04. 2015</time></span> </footer></article> <article id='bibnumindent' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Odsazení seznamu literatury dle největšího čísla</h3> <a href='#bibnumindent'><i class='fas fa-link'></i></a></div></header><section><p>OPmac ignoruje údaj generovaný BibTeXem o&nbsp;počtu cifer největšího čísla v&nbsp;seznamu literatury, protože jednak umožňuje seznam také vytvořit pomocí příkazů <code>\bib</code> mimo BibTeX, a&nbsp;dále při využití jednou generované databáze pro více účelů nemusí být údaj generovaný BibTeXem pravdivý. Místo toho OPmac zavádí makro <code>\lastbibnum</code>, které po přečtení REF souboru obsahuje největší číslo v&nbsp;seznamu literatury. Implicitně toto makro není nijak využito, ale můžete ho při formátování seznamu literatury použít. Například takto: </p><pre class='pr-3'><code>\def\printbib{% 
   \ifx\lastbibnum\undefined \tmpdim=\iindent 
   \else \setbox0=\hbox{[\lastbibnum] }% 
      \ifdim \parindent=0pt \tmpdim=\wd0 
      \else \tmpdim=0pt \loop \advance\tmpdim by\parindent 
                              \ifdim\tmpdim&lt;\wd0 \repeat 
   \fi\fi 
   \hangindent=\tmpdim \noindent \hskip\tmpdim \llap{[\the\bibnum] }% 
} 
</code></pre><p>Zde je předefinováno formátovací makro <code>\printbib</code>, které si změří box obsahující <code>[\lastbibnum]~</code>. Při nulovém <code>\parindent</code> nastaví <code>\tmpdim</code> na šířku tohoto boxu a&nbsp;při nenulovém <code>\parindent</code> nastaví <code>\tmpdim</code> na násobek <code>\parindent</code> tak, aby se box do vzniklé mezery vešel. Pak odsadí bibloigrafický záznam podle <code>\tmpdim</code>. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#bibnumindent' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0040</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2014-04-01'>01. 04. 2014</time></span> </footer></article> <article id='bibmarkindent' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Odsazení seznamu literatury dle nejširší značky</h3> <a href='#bibmarkindent'><i class='fas fa-link'></i></a></div></header><section><p>Seznam literatury nemusí být vždy číslovaný; může obsahovat například značky. Přitom poslední značka (na rozdíl od posledního čísla) nemusí být ta nejširší. Přesto chceme podle nejširší značky formátovat celý seznam literatury. </p><p>Je sice možné k&nbsp;tomu účelu použít <code>\halign</code>, ale seznamy literatury generované BibTeXem jsou celé ukryté ve skupině a&nbsp;to by činilo problémy. Ukážeme si zde jiné řešení přes REF soubor. Toto řešení je použitelné i&nbsp;v obdobných případech, kdy zrovna nemusí jít o&nbsp;seznam literatury. </p><p>Požádáme uživatele, aby na konec seznamu literatury přidal pokyn <code>\setbibindent</code>. Toto makro zapíše údaj o&nbsp;nejširší značce do REF souboru a&nbsp;při příštím čtení tohoto souboru jej využije formátovací makro <code>\printbib</code>. Makro <code>\printbib</code> mimo jiné měří šířky značek a&nbsp;údaj o&nbsp;nejširší z&nbsp;nich dává do <code>\bibindent</code>, aby jej mohlo makro <code>\setbibindent</code> uložit. Kód obou maker může vypadat takto: </p><pre class='pr-3'><code>\nonumcitations 
\def\printbib{% 
   \setbox0=\hbox{[\the\bibmark]\quad}% 
   \ifx\bibindent\undefined \def\bibindent{0pt}\fi 
   \ifdim\wd0&gt;\bibindent \edef\bibindent{\the\wd0}\fi 
   \ifx \Xbibindent\undefined 
      \hangindent=\wd0 \noindent [\the\bibmark]\quad 
   \else 
      \hangindent=\Xbibindent \noindent \hskip\Xbibindent \llap{[\the\bibmark]\quad}% 
   \fi 
} 
\def\setbibindent{\ifx\bibindent\undefined \else 
   \openref\immediate\write\reffile{\def\noexpand\Xbibindent{\bibindent}}\fi} 
</code></pre></section><footer class='text-right'><a href='opmac-tricks-e.html#bibmarkindent' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0041</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2014-04-01'>01. 04. 2014</time></span> </footer></article> <article id='morebibs' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Více nezávislých seznamů literatury v dokumentu</h3> <a href='#morebibs'><i class='fas fa-link'></i></a></div></header><section><p>Předpokládejme, že tvoříme třeba sborník, takže se náš dokument skládá z&nbsp;několika článků, přitom každý článek má svůj seznam literatury. Záznamy se mohou v&nbsp;různých seznamech překrývat, ale nebudou pravděpodobně stejně očíslovány. V&nbsp;každém seznamu probíhá číslování od jedné. Lejblíky se mohou rovněž pro různé seznamy překrývat. </p><p>Dejme tomu, že v&nbsp;článku prvním je seznam literatury, kde je TBN uvedeno pod číslem 3&nbsp;a v&nbsp;článku druhém je seznam literatury, kde je TBN pod číslem 21. Když se v&nbsp;článku prvním objeví <code>\cite[tbn]</code>, musí se vytisknout odkaz [3] a&nbsp;správně prolinkovat hyperlink. Když se v&nbsp;článku druhém objeví <code>\cite[tbn]</code>, musí se vytisknout [21] a&nbsp;rovněž se odpovídajícím způsobem nastaví hyperlink na seznam literatury ve druhém článku. </p><p>Stačí před každým článkem pronulovat <code>\bibnum</code> a&nbsp;nastavit jednoznačný identifikátor <code>\bibpart</code>: </p><pre class='pr-3'><code>\bibnum=0 \def\citelist{} \def\bibpart{A} %%% A je identifikátor prvního článku 
... první článek 
... 
\bibnum=0 \def\citelist{} \def\bibpart{B} %%% B je identifikátor druhého článku 
... druhý článek 
... 
</code></pre><p>Aby toto fungovalo, je třeba mírně modifikovat makra OPmac následujícím kódem: </p><pre class='pr-3'><code>\def\wbib#1#2#3{\dest[cite:\bibpart-\the\bibnum]% 
   \ifx\wref\wrefrelax\else \immediate\wref\Xbib{{\bibpart-#1}{\bibpart-#2}{#3}}\fi} 
 
\let\citeAA=\citeA 
\def\citeA #1#2,{\if#1,\def\citeAA##1,##2,{}\fi\citeAA \bibpart-#1#2,} 
 
\def\printcite#1{\citesep \prepcite#1\relax 
   \citelink{#1}{\tmpa}\def\citesep{,\hskip.2em\relax}} 
\def\prepcite #1-#2{\def\tmpa{\citelinkA{#2}}} 
\let\writeXcite=\addcitelist 
 
\def\nonumcitations{\lastcitenum=0 \def\sortcitesA{}\def\etalchar##1{$^{##1}$}% 
   \def\citelinkA##1{%  \citelinkA needs the \bibpart info: 
      \isdefined{bim:\bibpart-##1}\iftrue \csname bim:\bibpart-##1\endcsname 
      \else ##1% 
      \opwarning{\noexpand\nonumcitations + empty bibmark. Maybe bad BibTeX style}\fi} 
} 
</code></pre><p>Makra přidávají před každý lejblík <code>\bibpart-</code> a&nbsp;stejný prefix přidávají před každé číslo. V&nbsp;REF souboru tedy máme z&nbsp;jednotlivých článků lejblíky i&nbsp;čísla prefixovány odpovídajícím způsobem. V&nbsp;rámci zpracování v&nbsp;<code>\cite</code> je pak tento prefix před lejblík přidán a&nbsp;z čísla odstraněn. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#morebibs' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0042</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2014-04-01'>01. 04. 2014</time></span> </footer></article> <article id='bibtexenc' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>OPmac-bib: konec problémů s BibTeXem</h3> <a href='#bibtexenc'><i class='fas fa-link'></i></a></div></header><section><p><a href='http://www.bibtex.org/' title='BibTeX'>BibTeX</a> z&nbsp;roku 1985 umí pracovat jen v&nbsp;ASCII kódování. Máte-li <code>.bib</code> databáze v&nbsp;tomto kódování (tj. případné akcenty máte přepsány TeXovsky), nemáte problém s&nbsp;užitím BibTeXu. Jakmile ale do těchto databází přidáte přímý akcentovaný znak nebo něco podobného, mohou nastat problémy. Především podle těchto znaků BibTeX neumí řadit. To částečně řeší varianta programu bibtex8, která pracuje v&nbsp;osmibitovém kódování a&nbsp;řadí podle pravidel deklarovaných v&nbsp;externím souboru <code>.csf</code>. Ovšem dnes se používá výhradně vícebytové kódování UTF-8, se kterým si tyto varianty BibTeXu neporadí. Navíc často mohou zmršit výstup, protože iterpretují byte=znak. Takže když mají za úkol napsat např. jméno jen s&nbsp;iniciálním písmenem, může vzniknout po stránce kódování vadný soubor. Převádět <code>.bib</code> databáze do jednobytového kódování a&nbsp;pak číst .bbl v&nbsp;tomto jednobytovém kódování by se dalo, ale jistě uznáte, že to není řešení. </p><p>Mezi různými záplatami BibTeXu existuje i&nbsp;varianta nazvaná <code>bibtexu</code>, která by měla umět UTF-8 vstup/výstup a&nbsp;uvnitř by měla řadit v&nbsp;Unicode s&nbsp;využítím ICU knihovny. Bohužel projekt zůstal opuštěn v&nbsp;ne zcela funkčním stavu (program se dosti často interně zacyklí). </p><p>Vedle BibTeXu existuje nový projekt Biber, který je ale pro uživatele plainTeXu *naprosto nepoužitelný*: opustil princip „v jednoduchosti je síla“, předpokládá konfigurační soubory i&nbsp;data v&nbsp;XML a&nbsp;spolupracuje s&nbsp;makrem biblatex. Toto makro produkuje nadbytek elektronického smetí v&nbsp;podobě XML souborů, jež následně čte Biber. Ten na oplátku vyrobí lidsky skoro nečitelný .bbl, kterému rozumí jen biblatex. Toto není cesta, kterou by měl následovat OPmac. </p><p>OPmac je schopen přímo číst <code>.bib</code> soubory (pchopitelně v&nbsp;UTF-8 kódování)  a&nbsp;nahradit kompletně bibTeX. Slouží k&nbsp;tomu příkaz <code>\usebib</code>: </p><pre class='pr-3'><code>... \cite[cosi] a \cite[jiny]. 
 
Seznam: 
\usebib/s (simple) mybase 
\end 
</code></pre><p>Formátování položek seznamu je deklarováno ve stylovém souboru  <code>opmac-bib-simple.tex</code>. Podrobnosti jsou dokumentovány v&nbsp;souboru <code>opmac-bib.tex</code> a&nbsp;ve druhém stylovém souboru <code>opmac-bib-iso690.tex</code>. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#bibtexenc' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0047</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2014-04-19'>19. 04. 2014</time></span> </footer></article>
                            </section>  <section id="slovnicek" class="mb-5 rounded my-shadow" style="background-color: #778c94">
                                <header class="text-center">
                                  <div class="py-2">
                                    <h2 class="d-inline text-light font-weight-light">Slovníček</h2>
                                    <a href="#slovnicek"><i class="fas fa-link"></i></a>
                                  </div>
                                </header>
                                <article id='gloslast' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Slovníček pojmů na konci dokumentu</h3> <a href='#gloslast'><i class='fas fa-link'></i></a></div></header><section><p>V&nbsp;textu dokumentu se mohou vyskytovat například zkratky, které je potřeba čtenáři vysvětlit, nejlépe na konci dokumentu ve speciální sekci. V&nbsp;místě použití zkratky napíšeme <code>\glos{zkratka}{vysvětlení}</code>, přitom v&nbsp;tomto místě se v&nbsp;sazbě nic neobjeví. Například: </p><pre class='pr-3'><code>Pracuji na ČVUT.\glos{ČVUT}{České vysoké učení technické v Praze} 
</code></pre><p>Makro <code>\glos</code> si ukládá postupně informace do paměti a&nbsp;pak je na konci dokumentu vyvrhne v&nbsp;místě, kam napíšeme <code>\makeglos</code>. Makra <code>\glos</code> a&nbsp;<code>\makeglos</code> mohou vypadat takto: </p><pre class='pr-3'><code>\def\gloslist{} 
\def\glos #1#2{% 
   \expandafter\isinlist\expandafter\gloslist\csname;#1\endcsname 
   \iftrue \opwarning{Duplicated glossary item `#1'}% 
   \else 
      \global\sdef{;#1}{{#1}{#2}}% 
      \global\expandafter\addto\expandafter\gloslist\csname;#1\endcsname 
   \fi 
} 
\def\makeglos{% 
   \ifx\gloslist\empty \opwarning{Glossary data unavailable}% 
   \else 
      \bgroup 
        \let\iilist=\gloslist 
        \dosorting 
        \def\act##1{\ifx##1\relax \else \expandafter\printglos##1\expandafter\act\fi} 
        \expandafter\act\iilist\relax 
      \egroup 
   \fi 
} 
\newdimen\glosindent  \glosindent=2\parindent 
\def\printglos #1#2{\noindent \hangindent=\glosindent \hbox to\glosindent{#1\hss-- }#2\par} 
</code></pre><p>Slovníček bude abecedně seřazen podle zkratek. Chcete-li jej mít seřazen podle pořadí výskytu v&nbsp;textu, zakomentujte příkaz <code>\dosorting</code>. </p><p>Makro <code>\printglos</code> si můžete samozřejmě naprogramovat dle svého přání. Má dva parametry <code>{zkratka}{vysvětlení}</code> a&nbsp;jeho úkolem je vytisknout jeden údaj ve slovníčku. Výše je <code>\printglos</code> uděláno tak, že nastavuje pevné odsazení <code>2\parindent</code> pro všechny zkratky. To nemusí vyjít dobře. Je tedy možné údaj <code>\glosindent</code> nastavit jinak nebo použít myšlenku z&nbsp;<a href='#bibmarkindent' title='OPmac triku 0041'>OPmac triku 0041</a>. </p><p>Jiný jednodušší příklad makra <code>\printglos</code>: </p><pre class='pr-3'><code>\def\printglos #1#2{\noindent #1 -- #2\par} 
</code></pre><p>Vysvětlení makra. Makro <code>\glos</code> si ukládá do <code>\gloslist</code> postupně <code>\;zkratka</code> <code>\;zkratka</code> atd. a&nbsp;navíc definuje <code>\;zkratka</code> jako <code>{zkratka}{vysvětlení}</code>. Makro <code>\makeglos</code> lokálně převede <code>\gloslist</code> na <code>\iilist</code> a&nbsp;nechá jej seřadit jako rejstřík makrem z&nbsp;OPmac \dosorting. Nakonec jej postupným opakováním <code>\act</code> vytiskne. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#gloslast' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0051</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2014-05-11'>11. 05. 2014</time></span> </footer></article> <article id='glosfirst' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Slovníček pojmů na začátku dokumentu</h3> <a href='#glosfirst'><i class='fas fa-link'></i></a></div></header><section><p>Pokud chcete umístit <code>\makeglos</code> (z předchozího triku) na začátek dokumentu, máte dvě možnosti: nashromáždit všechny potřebné příkazy <code>\glos</code> před <code>\makeglos</code> na začátek dokumentu (protože na umístění příkazů <code>\glos</code> v&nbsp;dokumentu nezáleží) nebo použít REF soubor. Druhou možnost rozvedeme podrobněji. </p><p>Při prvním TeXování se data pro slovníček do REF souboru uloží a&nbsp;při opakovaném TeXování se použijí. </p><pre class='pr-3'><code>\def\gloslist{} 
\def\Xglos #1#2{% 
   \expandafter\isinlist\expandafter\gloslist\csname;#1\endcsname 
   \iftrue \opwarning{Duplicated glossary item `#1'}% 
   \else 
      \sdef{;#1}{{#1}{#2}}% 
      \expandafter\addto\expandafter\gloslist\csname;#1\endcsname 
   \fi 
} 
 
\input opmac 
 
\def\glos #1#2{\openref\toks0={#2}\immediate\wref\Xglos{{#1}{\the\toks0}}} 
</code></pre><p>Povšimněme si, že definici pomocného makra <code>\Xglos</code> a&nbsp;výchozí nastavení <code>\gloslist</code> musíme umístit před <code>\input opmac</code>, protože opmac čte REF soubor z&nbsp;předchozího běhu, takže v&nbsp;té době už musí makro <code>\Xglos</code> znát. </p><p>Makro <code>\makeglos</code> zůstává beze změny, jako v&nbsp;předchozím OPmac triku. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#glosfirst' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0052</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2014-05-11'>11. 05. 2014</time></span> </footer></article> <article id='glossort' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Slovníček pojmů setříděný dle českých pravidel</h3> <a href='#glossort'><i class='fas fa-link'></i></a></div></header><section><p>Slovníček z&nbsp;<a href='#gloslast' title='OPmac triku 0051'>OPmac triku 0051</a> je abecedně seřazen podle ASCII hodnot zkratek. Někdy je to postačující (například v&nbsp;anglicky psaném dokumentu), ale někdy bychom rádi řadili podle českých pravidel řazení stejně, jak to umí OPmac v&nbsp;případě rejstříku. V&nbsp;takovém případě přidejte do makra <code>\makeglos</code> před <code>\dosorting</code> ještě příkaz <code>\preparespecialsorting</code> (ostatní zůstává nezměněno) a&nbsp;tento příkaz definujte následovně: </p><pre class='pr-3'><code>\def\makeglos{% 
   ... 
   \preparespecialsorting \dosorting 
   ... 
} 
\def\preparespecialsorting{% 
   \setprimarysorting 
   \def\act##1{\ifx##1\relax\else \preparesorting##1% 
      \expandafter\edef\csname\string##1\endcsname{\tmpb}% 
      \expandafter\act\fi}% 
   \expandafter\act\iilist\relax 
   \def\firstdata##1{\csname\string##1\endcsname&amp;}% 
} 
</code></pre><p>Nyní při <code>\chyph</code> bude řazení české a&nbsp;při <code>\ehyph</code> bude anglické. </p><p>Vysvětlení makra. OPmac řadí <code>\iilist</code> obsahující <code>\?cosia \?cosib \?cosic</code>, kde <code>?</code> je jakýkoli znak. V&nbsp;rejstříku to je <code>\,cosia \,cosib \,cosic</code> zatímco ve slovníčku to je <code>\;cosia \;cosib \;cosic</code>. Tato makra musí osahovat <code>{první údaj}{druhý údaj}</code>, přitom OPmac řadí v&nbsp;prvním průchodu podle prvního údaje za použití makra <code>\firstdata</code>. Makro <code>\preparesorting \?cosi</code> připraví do <code>\tmpb</code> slovo makra (tj. např. cosi) zkonvertované přes <code>\lccode</code> do stavu vhodného pro české řazení. My si tento výsledek uložíme do <code>\\?cosi</code> a&nbsp;přesměrujeme tam i&nbsp;makro <code>\firstdata</code>, takže řazení v&nbsp;prvním průchodu probíhá podle <code>\\?cosi</code> a&nbsp;nikoli dle prvního údaje. Případný druhý průchod spustí dodatečnou konverzi slova (cosi) dle pravidel druhého průchodu a&nbsp;už to nikam neukládá, takže i&nbsp;druhý průchod funguje. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#glossort' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0053</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2014-05-11'>11. 05. 2014</time></span> </footer></article> <article id='glosref' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Slovníček pojmů s hyperlinky</h3> <a href='#glosref'><i class='fas fa-link'></i></a></div></header><section><p>Pokud chcete, aby v&nbsp;textu v&nbsp;místě použití zkratky byla zkratka obarvena a&nbsp;fungovala jako hyperlink, je možné psát do textu: </p><pre class='pr-3'><code>...text... \glosref{zkratka}{význam} ...text... \glosref{jiná zkratka}{význam} 
...text... \glosref{zkratka}{} 
... 
\makeglos 
</code></pre><p>V&nbsp;textu budou pak vytištěny zkratky obarvené barvou a&nbsp;fungující jako hyperlinky odkazující do místa, kde je seznam zkratek vytištěný pomocí <code>\makeglos</code>. Povšimněte si, že pro každou zkratku je třeba zapsat význam jen jednou a&nbsp;při opakování stejné zkratky je třeba nechat význam prázdný. Kdyby byla zkratka významově určena vícekrát, makro napíše varování a&nbsp;opakovaný význam ignoruje. </p><p>Řešení může vypadat třeba takto: </p><pre class='pr-3'><code>\hyperlinks\Blue\Blue 
 
\def\glosref #1#2{\if^#2^\else \glos{#1}{#2}\fi 
   \expandafter\isinlist\expandafter\gloslist\csname;#1\endcsname 
   \iftrue \makegloslink{#1}\link[glos:\tmp]{\localcolor\Blue}{#1}% 
   \else #1% 
   \fi 
} 
\def\printglos#1#2{\noindent \makegloslink{#1}\dest[glos:\tmp]#1 .. #2\par} 
 
\def\makegloslink#1{\def\tmp{}\expandafter\makegloslinkA#1\relax} 
\def\makegloslinkA#1{\ifx#1\relax\else 
   \edef\tmp{\tmp\number`#1.}\expandafter\makegloslinkA\fi} 
</code></pre><p>Řešení předpokládá některou z&nbsp;definic maker <code>\glos</code> a&nbsp;<code>\makeglos</code>, jak je uvedeno výše. Makro <code>\glosref</code> kontroluje, zda je druhý parametr prázdný a&nbsp;když není, použije <code>\glos</code>. Tam se zkontroluje, zda není význam deklarován vícekrát. Dále makro <code>\glosref</code> zavede hyperlink pomocí <code>\link</code> jen tehdy, když je údaj zanesen do <code>\gloslist</code> (což udělalo makro <code>\glos</code>, nebo se tak stane až při opakovaném TeXování). Důvod tohoto opatření: je třeba zabezpečit, aby link měl svůj cíl, což při prvním průchodu TeXem nemusí být pravda. </p><p>Makro <code>\printglos</code> *musí* obsahovat deklaraci cíle pomocí <code>\dest</code>. </p><p>Interní link je vytvořen ze zkratky pomocí <code>\makegloslink</code>, ale není to přímo zkratka, protože ta může obsahovat háčky a&nbsp;čárky a&nbsp;link pak nefunguje. Takže je každé píseno převedeno na číslo (svůj kód) a&nbsp;seznam takových kódů oddělených tečkami je použit jako interní link. </p><p>Pomocí <code>\def\glosborder{R G B}</code>, například <code>\def\glosborder{1 0 0}</code> je možno definovat barvu rámečků pro aktivní hyperlinky týkající se zkratek. </p><p>Poznámka: Hyperlinky v&nbsp;tomto řešení fungují od prvního výskytu hesla s&nbsp;neprázdným druhým parametrem. Předchází-li totéž heslo s&nbsp;prázdným parametrem, není pro něj sestaven hyperlink. Co s&nbsp;tím? Je možné například na začátek dokumentu uvést celý soubor dat pomocí <code>\glos{zkratka}{význam}</code> <code>\glos{jiná zkratka}{jiný význam}</code> atd. a&nbsp;poté do textu důsledně psát <code>\glosref</code> s&nbsp;prázdným druhým parametrem. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#glosref' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0054</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2014-05-11'>11. 05. 2014</time></span> </footer></article> <article id='acronym' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Akronymy</h3> <a href='#acronym'><i class='fas fa-link'></i></a></div></header><section><p>Pohrajeme si s&nbsp;makrem <code>\ac[lejblík]</code>, které při prvním výskytu v&nbsp;dokumentu vytiskne <code>dlouhý název (zkratka)</code> a&nbsp;při každém dalším výskytu vytiskne jen <code>zkratka</code>. K&nbsp;tomu účelu je potřeba nejprve akronym na začátku dokumentu definovat pomocí </p><pre class='pr-3'><code>\acrodef [lejblík] {zkratka} {dlouhý název} 
</code></pre><p>Explicitně zkratku vytiskneme pomocí <code>\acs[lejblík]</code> a&nbsp;dlouhý název pomocí <code>\acl[lejblík]</code>. Seznam všech zkratek (ve stejném pořadí, jak byly definovány na začátku dokumentu) vytiskneme pomocí <code>\acrolist</code>, což můžeme umístit kamkoli do dokumentu, ovšem až za sadu definic <code>\acrodef</code>. Na stránku, kde je poprvé akronym použit, je možné se odkazovat pomocí <code>\pgref[acro:lejblík]</code>. </p><p>Chceme-li vytisknout akronym s&nbsp;velkým písmenem na začátku, je možné použít <code>\Ac[lejblík]</code>. Chceme-li akronym s&nbsp;nějakou koncovkou, musíme kromě <code>\acrodef[lejblík]</code> definovat obdobně <code>\acrodefx[lejblík-koncovka]</code> a&nbsp;v textu použít <code>\ac[lejblík-koncovka]</code>. Příklad: </p><pre class='pr-3'><code>\acrodef  [CVUT]    {ČVUT} {České vysoké učení technické v Praze} 
\acrodefx [CVUT-em] {ČVUT} {Českým vysokým učením technickým v Praze} 
\acrodef  [UK]      {UK}   {Univerzita Karlova} 
\acrodef  [voda]    {$\rm H_2O$} {voda} 
 
Tady se seznámíme s \ac[CVUT-em], vedle kterého je \ac[UK]. Ještě jednou \ac[CVUT] a taky \ac[UK]. 
\Ac[voda] je základ života. Takže \ac[voda] se dá použit opakovaně. 
 
\acrolist 
</code></pre><p>Sada maker na akronymy může vypadat třeba takto: </p><pre class='pr-3'><code>\def\acrolist{} 
\def\acrodef[#1]#2#3{\sdef{as:#1}{#2}\sdef{al:#1}{#3}\addto\acrolist{\acroitem{#1}}} 
\def\acrodefx[#1-#2]#3#4{\sdef{as:#1-#2}{#3}\sdef{al:#1-#2}{#4}} 
\def\acs[#1]{\isdefined{as:#1}\iftrue \acroprint{as:#1}\else\acno{#1}\fi} 
\def\acl[#1]{\isdefined{al:#1}\iftrue \acroprint{al:#1}\else\acno{#1}\fi} 
\def\acno#1{\opwarning{acro [#1] undefined}ac?#1} 
\def\ac[#1]{\acX#1-\end 
   \isdefined{ad:\acA}\iftrue \acs[\acA\acB]\else 
   \label[acro:\acA]\openref\wlabel{}\global\sdef{ad:\acA}{}% 
   \acl[\acA\acB] \let\acrocap=\undefined(\acs[\acA\acB])\fi} 
\def\acX#1-#2\end{\def\acA{#1}\ifx\end#2\end \def\acB{}\else\acY#2\fi} 
\def\acY#1-{\def\acB{-#1}} 
\def\acroprint#1{{\expandafter\expandafter\expandafter\acroprintA\csname#1\endcsname\end}} 
\def\acroprintA#1#2\end{\ifx\acrocap\undefined\expandafter\acroprintB\else\uppercase\fi{#1}#2} 
\def\acroprintB#1{#1} 
\def\Ac[#1]{{\let\acrocap=\active\ac[#1]}} 
\def\acroitem#1{\par\noindent{\bf\boldmath\acs[#1]} -- \acl[#1] \dotfill \pgref[acro:#1]\par} 
\addprotect\acs \addprotect\acl 
</code></pre></section><footer class='text-right'><a href='opmac-tricks-e.html#acronym' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0113</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2015-06-25'>25. 06. 2015</time></span> </footer></article>
                            </section>  <section id="rejstrik" class="mb-5 rounded my-shadow" style="background-color: #778c94">
                                <header class="text-center">
                                  <div class="py-2">
                                    <h2 class="d-inline text-light font-weight-light">Rejstřík</h2>
                                    <a href="#rejstrik"><i class="fas fa-link"></i></a>
                                  </div>
                                </header>
                                <article id='sort' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Využití řadicího algoritmu rejstříku pro jiné účely</h3> <a href='#sort'><i class='fas fa-link'></i></a></div></header><section><p>OPmac má řadicí algoritmus zabudován do maker pro setavení rejsříku a&nbsp;není zcela snadné jej od rejstříku oddělit. V&nbsp;tomto triku to uděláme. Vytvoříme makro <code>\sort</code>, které přečte své agumenty, abecedně je zatřídí a&nbsp;výsledek uloží do pomocného makra <code>\tmpb</code>. Tedy: </p><pre class='pr-3'><code>\sort{uu}{tt}{zz}{aa}\relax 
nyní makro \tmpb obsahuje: {aa}{tt}{uu}{zz} 
</code></pre><p>Sadu parametrů makra <code>\sort</code> je nutné ukončit příkazem <code>\relax</code>. V&nbsp;parametrech nesmí být obsažen příkaz, který je neexpandovatelný (analogicky jako v&nbsp;parametru makra <code>\iindex</code>). Implementace může vypadat takto: </p><pre class='pr-3'><code>\def\sort{\begingroup\setprimarysorting\def\iilist{}\sortA} 
\def\sortA#1{\ifx\relax#1\sortB\else 
  \expandafter\addto\expandafter\iilist\csname,#1\endcsname 
  \expandafter\preparesorting\csname,#1\endcsname 
  \expandafter\edef\csname,#1\endcsname{{\tmpb}{}}% 
  \expandafter\sortA\fi 
} 
\def\sortB{\def\message##1{}\dosorting 
  \def\act##1{\ifx##1\relax\else \expandafter\sortC\string##1\relax \expandafter\act\fi}% 
  \gdef\tmpb{}\expandafter\act\iilist\relax 
  \endgroup 
} 
\def\sortC#1#2#3\relax{\global\addto\tmpb{{#3}}} 
</code></pre><p>Makro <code>\sort</code> pracuje ve skupině <code>\begingroup...\endgroup</code>, aby neovlivnilo data, která se používají v&nbsp;rámci rejsříku. Parametry připraví lokálně do <code>\iilist</code> a&nbsp;spustí třídicí algoritmus <code>\dosorting</code>. Výsledek řazení ukládá globálně do <code>\tmpb</code>. </p><p>Povšimněte si, že makro definuje druhé datové pole sekvencí <code>\,slovo</code> jako prázdné (na předposledním řádku <code>\sortA</code>). Toto pole můžete využít pro ukládání vlastních dat, která je pak možné zpětně vytěžit po zatřídění pomocí makra <code>\seconddata</code> z&nbsp;OPmac. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#sort' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0080</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2014-12-10'>10. 12. 2014</time></span> </footer></article> <article id='klikpgr' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Klikací stránky v rejstříku</h3> <a href='#klikpgr'><i class='fas fa-link'></i></a></div></header><section><p>Při vytvoření rejstříku pomocí makra <code>\makeindex</code> nejsou vedle hesel čísla stránek aktivní, ačkoli je použita deklarace <code>\hyperlinks</code>. Aktivní (připravené ke klikání) jsou jen čísla stránek v&nbsp;obsahu. </p><p>Důvod, proč OPmac neimplementuje aktivní čísla stránek v&nbsp;rejstříku jsou dva: drží se kréda „v jednoduchosti je síla“ a&nbsp;šetří pamětí TeXu. Za každý odkaz na stránku by totiž do makroprostoru musel přidat tři tokeny. Při tisíci heslech a&nbsp;průměrně třech odkazech u&nbsp;hesla dostáváme 9&nbsp;tisíc tokenů navíc. Tomu se chce OPmac vyhnout. </p><p>Pokud přesto chcete mít čísla stránek v&nbsp;rejstříku aktivní, stačí použít tento kód: </p><pre class='pr-3'><code>\def\printiipages#1&amp;{\usepglinks#1\relax\par} 
\def\usepglinks{\afterassignment\usepglinksA \tmpnum=} 
\def\usepglinksA{\pglink{\the\tmpnum}\futurelet\next\usepglinksB} 
\def\usepglinksB{\ifx\next\relax \def\next{}\else 
   \ifx\next,\def\next,{, \afterassignment\usepglinksA \tmpnum=}\else 
   \ifx\next-\def\next--{--\afterassignment\usepglinksA\tmpnum=}% 
   \fi\fi\fi\next} 
</code></pre><p>Makro <code>\usepglinks</code> má parametr např. <code>5, 15--18, 24</code> ukončený <code>\relax</code>. Makro očichá čísla ve svém parametru a&nbsp;každé z&nbsp;nich promění v&nbsp;<code>\pglink{číslo}</code>. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#klikpgr' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0006</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2013-08-13'>13. 08. 2013</time></span> </footer></article> <article id='iindexb' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Alternativní seznamy stránek v rejstříku</h3> <a href='#iindexb'><i class='fas fa-link'></i></a></div></header><section><p>Někdy je potřeba mít vedle rejstříkových hesel více seznamů stránek. Jeden seznam základní (většinou tištěn antikvou) a&nbsp;potom třeba zvýrazněné seznamy tištěné kurzívou nebo tučně. Najdeme to například v&nbsp;rejstříku TeXbooku, kde kurzívou nebo podtrženě jsou vytištěny výskyty hesla, které jsou nějakým způsobem významnější. </p><p>Od verze OPmac Jun. 2014 je k&nbsp;dispozici makro <code>\Xindexg{prefix}{heslo}{strana}</code>, které lze použít v&nbsp;REF souborech podobně, jako <code>\Xindex{heslo}{strana}</code>. Toto makro vytváří alternativní seznamy stránek uložené v&nbsp;sekvencích <code>\prefixheslo</code> a&nbsp;seznamy těchto sekvencí ukládá do <code>\iilist:prefix</code>. Seznam stránek je zpracován stejně jako standardní <code>\,heslo</code>, tj. data jsou ve dvou částech, v&nbsp;první je příznak zpracování a&nbsp;ve druhé je komprimovaný seznam stránek (např. <code>3,4,4,5</code> se redukuje na <code>3--5</code>). </p><p>Jako příklad vytvoříme makro <code>\iindexb{heslo}</code>, které uloží výskyt hesla do alternativního seznamu stránek prefixovaný pomocí <code>b:</code>. Pokud heslo bude mít tento seznam, budeme jej tisknout v&nbsp;rejstříku před obecný seznam stránek tučně a&nbsp;červeně. </p><pre class='pr-3'><code>\def\iindexb#1{\openref\wref\Xindexg{{b:}{#1}{\the\pageno}}} 
\def\printiipages#1&amp;{ % second space between word and pagelist 
   \expandafter \isinlist \csname iilist:b:\expandafter\endcsname \csname b:\currii\endcsname 
   \iftrue 
      \expandafter\seconddata \csname b:\currii\endcsname \XindexB 
      {\localcolor\Red \bf \tmp}, \fi 
   #1\par 
} 
</code></pre><p>V&nbsp;prvním řádku je definováno <code>\iindexb</code> tak, že výskyt hesla pošle do alternativního seznamu prefixovaného <code>b:</code>. Dále je předefinováno makro <code>\printiipages</code>, které dostane v&nbsp;prametru <code>#1</code> obecný seznam stránek a&nbsp;má je vytisknout. Pomocí <code>\isinlist \iilist:b: \b:heslo \iftrue</code> se zeptáme, zda heslo má alternativní seznam stránek. Pokud ano, vložíme <code>{\localcolor\Red \bf \tmp}</code>, přitom v&nbsp;<code>\tmp</code> je uložen druhý údaj z&nbsp;<code>\b:heslo</code> pomocí <code>\seconddata \b:heslo \Xindex</code>. </p><p>Uvedný příklad bude fungovat jen v&nbsp;případě, že heslo má i&nbsp;svůj normální výskyt, protože do rejstříku jsou zařazena a&nbsp;abecedně setříděna jen hesla s&nbsp;normálním výskytem. Dále se zde předpokládá, že seznam stránek prefixovaný pomocí <code>b:</code> bude uzavřen, nebo obsahuje jen izolované stránky. Není-li to pravda, je potřeba seznam nejprve uzavřít. Oba tyto problémy řeší následující modifikace makra. </p><pre class='pr-3'><code>\def\iindexb#1{\openref\wref\Xindexg{{b:}{#1}{\the\pageno}}\wref\Xindex{{#1}{}}} 
\def\printiipages#1&amp;{ % second space between word and pagelist 
   \expandafter \isinlist \csname iilist:b:\expandafter\endcsname \csname b:\currii\endcsname 
   \iftrue 
      \expandafter\firstdata  \csname b:\currii\endcsname \XindexA 
      \expandafter\seconddata \csname b:\currii\endcsname \XindexB 
      {\localcolor\Red \bf \tmp\ifx\tmpb-\pgfolioA{\tmpa}\fi}% 
      \if^#1^\else, \fi % comma only if the next list isn't empty 
   \fi 
   #1\par 
} 
</code></pre></section><footer class='text-right'><a href='opmac-tricks-e.html#iindexb' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0072</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2014-06-22'>22. 06. 2014</time></span> </footer></article> <article id='iibe' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Heslo pro rejstřík dané rozsahem od--do</h3> <a href='#iibe'><i class='fas fa-link'></i></a></div></header><section><p>Někdy je účelné říci, že dané heslo se vyskytuje na všech stránkách určité kapitoly nebo na všech stránkách od tohoto výskytu po tento výskyt. Nemusí to být vždy úplně pravda, ale to nebudeme řešit. Podstatné je, že uvnitř tohoto rozsahu nemusíme jednotlivě označovat výskyty hesla pro rejstřík. Navrhneme tedy dvojici maker <code>\iindexbeg{heslo} ... \iindexend{heslo}</code>, která vyznačují výchozí a&nbsp;konečnou stránku výskytu hesla, přitom se předpokládá, že se heslo vyskytuje na všech stránkách mezi nimi. V&nbsp;seznamu stránek s&nbsp;výskytem hesla bude tento interval stránek zahrnut a&nbsp;sloučen s&nbsp;ostatními stránkami vyznačujícími jednotlivé další výskyty hesla. </p><pre class='pr-3'><code>\def\Xindexgend#1#2#3{\bgroup \def~{ }% #1=prefix, #2=index-item, #3=pageno 
   \expandafter\firstdata \csname#1#2\endcsname \XindexA 
   \expandafter\seconddata \csname#1#2\endcsname \XindexB 
   \ifnum#3=\tmpa \else 
      \if\tmpb+% 
         \sxdef{#1#2}{{#3/-}{\tmp\iiendash}} 
      \else 
         \sxdef{#1#2}{{#3/-}{\tmp}} 
   \fi\fi \egroup 
} 
\input opmac 
 
\def\iindexbeg#1{\iindex{#1}\expandafter\iimute\csname,#1\endcsname} 
\def\iindexend#1{\expandafter\isinlist\expandafter\iimutelist\csname,#1\endcsname\iftrue 
   \wref\Xindexgend{,{#1}{\the\pageno}}\expandafter\iiunmute\csname,#1\endcsname \fi 
} 
\def\iindex#1{\expandafter\isinlist\expandafter\iimutelist\csname,#1\endcsname\iftrue 
   \else \openref\wref\Xindex{{#1}{\the\pageno}}\fi 
} 
\def\iimute#1{\global\addto\iimutelist#1} 
\def\iiunmute#1{\def\tmp##1#1##2\end{\gdef\iimutelist{##1##2}}\expandafter\tmp\iimutelist\end} 
\def\iimutelist{} 
</code></pre><p>Pomocné makro <code>\Xindexgend</code> budeme zapisovat do REF souboru, a&nbsp;proto je potřebujeme definovat před <code>\input opmac</code>. Makro <code>\iindexbeg</code> pouze zapíše výskyt hesla pomocí <code>\iindex</code> a&nbsp;dále umlčí makrem <code>\iimute</code> všechny pokusy typu <code>\iindex{heslo}</code> vyskytující se uvnitř rozsahu <code>\iindexbeg{heslo}</code> až <code>\iindexend{heslo}</code>. Tyto pokusy by nám totiž mohly rozbít souvislý sled stránek. Makro <code>\iindexend{heslo}</code> vloží do REF souboru <code>\Xindexgend,{heslo}{strana}</code> a&nbsp;toto makro při zpracování REF souboru otevře uzavřený seznam stránek od výchozí strany po aktuální nebo protáhne otevřený seznam stránek až po aktuální stranu. </p><p>Makro <code>\iindex</code> je předefinováno tak, aby do REF souboru zapisovalo jen hesla, která nejsou na seznamu <code>\iimutelist</code>. A&nbsp;konečně makra <code>\iimute</code> a&nbsp;<code>\iiunmute</code> přidávají a&nbsp;odebírají heslo ze seznamu <code>\iimutelist</code>. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#iibe' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0073</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2014-06-24'>24. 06. 2014</time></span> </footer></article> <article id='strcmp' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Experiment s lexikografickým řazením</h3> <a href='#strcmp'><i class='fas fa-link'></i></a></div></header><section><p>PdfTeX implementuje primitiv <code>\pdfstrcmp{string1}{string2}</code>, který vrátí nulu, když jsou stringy stejné, vrátí <code>-1</code>, když <code>string1</code> je lexikograficky menší než <code>string2</code>, a&nbsp;vrátí <code>1</code> jinak. OPmac řeší abecední řazení rejstříku v&nbsp;makru <code>\isAleB</code> na úrovní klasických nástrojů TeXu, tj. bez využití tohoto primitivu. Kvůli tomu postupně expanduje až do čtyř různých rekurzivních maker, odlupuje písmenka a&nbsp;porovnává je. Stálo za experiment vyměnit tato makra v&nbsp;OPmac za jednodušší makro, které využije <code>\pdfstrcmp</code>: </p><pre class='pr-3'><code>\def\isAleB #1#2{% 
   \edef\tmp{\noexpand\pdfstrcmp{\firstdata#1\empty}{\firstdata#2\empty}} 
   \ifnum\tmp&lt;0 \AleBtrue 
   \else \ifnum\tmp&gt;0 \AleBfalse 
   \else \bgroup \setsecondarysorting 
            \preparesorting#1\let\tmpa=\tmpb \preparesorting#2% 
            \edef\tmp{\noexpand\pdfstrcmp{\tmpa}{\tmpb}}% 
            \ifnum\tmp&lt;0 \global\AleBtrue \else \global\AleBfalse \fi 
         \egroup 
   \fi\fi 
} 
</code></pre><p>Ukazuje se, že jsme si překvapivě ve strojovém čase moc nepomohli. Řazení ukázky <code>kuk8.tex</code> z&nbsp;přednášky z&nbsp;prosince 2012 obsahující přes šest tisíc hesel trvalo s&nbsp;klasickými makry 4,13 sekundy a&nbsp;s využitím <code>\pdfstrcmp</code> 4,04 sekundy. Je vidět, že je v&nbsp;TeXu expanze maker implementována velmi efektivně a&nbsp;ani vestavěná funkce na lexikografické třídění ji o&nbsp;mnoho nepřekoná. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#strcmp' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0018</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2013-08-26'>26. 08. 2013</time></span> </footer></article> <article id='currchar' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Rozdělení rejstříku do oddílů nadepsaných písmeny</h3> <a href='#currchar'><i class='fas fa-link'></i></a></div></header><section><p>Slova v&nbsp;restříku chceme mít oddělena podle jejich prvního písmene do oddílů, každý oddíl má být uvozen „nadpisem“, který obsahuje zvětšené písmeno, kterým všechna slova daného oddílu začínají. </p><p>Řešení se opírá o&nbsp;makro <code>\everyii</code>, které je implicitně prázdné a&nbsp;OPmac ho vkládá před tisk každého hesla v&nbsp;rejstříku. </p><pre class='pr-3'><code>\def\lastchar{} 
\def\everyii{\expandafter\makecurrchar\currii\end 
   \ifx\currchar\lastchar \else 
      \bigskip{\typosize[20/24]\bf\currchar}\par\nobreak\medskip\noindent 
      \let\lastchar=\currchar 
   \fi 
} 
\def\makecurrchar#1#2\end{\uppercase{\def\currchar{#1}}} 
</code></pre><p>Na začátku je <code>\lastchar</code> prázdné. Před vytištěním každého slova se zjistí <code>\currchar</code> jako první písmeno slova zvětšené pomocí <code>\uppercase</code>. Je-li <code>\currchar</code> různé od <code>\lastchar</code>, vytiskneme záhlaví dalšího oddlílu a&nbsp;nastavíme nově <code>\lastchar</code> podle <code>\currchar</code>. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#currchar' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0140</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2016-06-08'>08. 06. 2016</time></span> </footer></article>
                            </section>  <section id="meta" class="mb-5 rounded my-shadow" style="background-color: #778c94">
                                <header class="text-center">
                                  <div class="py-2">
                                    <h2 class="d-inline text-light font-weight-light">Meta</h2>
                                    <a href="#meta"><i class="fas fa-link"></i></a>
                                  </div>
                                </header>
                                <article id='opformat' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Makra OPmac vložená do formátu</h3> <a href='#opformat'><i class='fas fa-link'></i></a></div></header><section><p>Aby uživatel neusel na začátku dokumentu neustále psát <code>\input opmac</code>, může si vygenerovat formát. Například <code>.ini</code> soubor pro csplain + OPmac s&nbsp;výstupem do PDF může vypadat takto: </p><pre class='pr-3'><code>\input csfonts    % implicitní fonty budou CSfonty 
\input plain      % Knuthův plain.tex 
\restorefont      % obnova původního významu primitivu font 
\input csfontsm   % základní makra pro zvětšování písma 
\input il2code    % výchozí kódování IL2 
\input etex-mac   % eTeXové rozšíření pro alokace registrů 
\input hyphen.lan % vzory dělení slov 
\input plaina4    % implicitní strana A4 
\input csenc-u    % UTF-8 kódování vstupu 
\pdfoutput=1      % implicitní výstup do PDF 
\input opmac      % makra OPmac 
\everyjob=\expandafter{\the\everyjob 
   \message{The format: csplain + OPmac, PDF output}% 
   \inputref} 
\dump 
generovat pomocí:  pdftex -ini -etex -enc tentosoubor.ini 
</code></pre><p>Protože OPmac během <code>\input opmac</code> načítá .ref soubor (pokud existuje) pomocí makra <code>\inputref</code>, je třeba toto makro přidat do <code>\everyjob</code>. Pak nebude muset uživatel formátu psát na začátek souboru zhola nic. </p><p>Chcete-li kombinovat OPmac s&nbsp;<code>etex.src</code> formátem, pak příslušný <code>.ini</code> soubor může vypadat takto: </p><pre class='pr-3'><code>\pdfoutput=1 
\input etex.src 
\input opmac 
\everyjob=\expandafter{\the\everyjob 
   \message{The format: etex.src + OPmac, PDF output}% 
   \inputref} 
\dump 
generovat pomocí:  pdftex -ini -etex tentosoubor.ini 
</code></pre></section><footer class='text-right'><a href='opmac-tricks-e.html#opformat' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0139</span> <span class='badge badge-info'>Autor: P. O.</span> <span class='badge badge-info'>Publikováno <time datetime='2016-03-12'>12. 03. 2016</time></span> </footer></article> <article id='curl' class='mb-2 p-3 bg-white rounded border'><header><div class='pb-2'><h3 class='d-inline'>Zobrazení seřazených názvů triků z této stránky</h3> <a href='#curl'><i class='fas fa-link'></i></a></div></header><section><p>Třeba uvítáte možnost si pomocí příkazového řádku zobrazit v&nbsp;terminálu seznam názvů všech triků seřazených podle jejich čísla, tedy relativně od nejstarších k&nbsp;nejnovějším. Můžete k&nbsp;tou použít tento příkaz: </p><pre class='pr-3'><code>  curl http://petr.olsak.net/opmac-tricks.html | tac \ 
   | sed -n '/CLASS.*datum/{:a;N;/&lt;h2&gt;&lt;a/!ba;s/\n.*\n//; s/&lt;a[^&gt;]*&gt;/ : /;s/&lt;[^&gt;]*&gt;//g;p}' | sort 
</code></pre><p>Tuto věc zveřejnil autor <a href='http://matouskojc.cz/pisalek.php?file_index=pcblog-2015' title='na své stránce'>na své stránce</a> v&nbsp;článku s&nbsp;názvem Opmac-triky -- sort. </p></section><footer class='text-right'><a href='opmac-tricks-e.html#curl' class='float-left badge badge-secondary'>English <img src='img/en.png' style='max-height: 1rem;'></a> <span class='badge badge-info'>ID: 0143</span> <span class='badge badge-info'>Autor: Radek Matoušek</span> <span class='badge badge-info'>Publikováno <time datetime='2015-12-11'>11. 12. 2015</time></span> </footer></article>
                            </section>

					</main>
				</div>
				<div class="py-3 px-2 px-sm-3 bg-light border-top">
					<footer class="my-content mb-5 mb-lg-0 mx-auto ml-xl-5">
						<p>Design webu a generování html a PDF souborů vytvořili studenti Jan Jirman a Ondřej Šodek v rámci své semestrální práce z předmětu <a href="http://petr.olsak.net/typotex.html">Typografie a TeX</a> v roce 2018.</p>
					</footer>
				</div>
			</div>

		</div>
	</div>

	<a id="back-to-top" href="#" class="btn btn-primary btn-lg back-to-top" role="button" title="Zpět na obsah" data-toggle="tooltip" data-placement="left">
		<i class="fas fa-chevron-up"></i>
	</a>

	<script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

	<script>
	$(document).ready(function(){
		var offset = 600;
		var duration = 300;

		$(window).scroll(function () {
			if ($(this).scrollTop() > offset && $(window).width() < 992) {
				$('#back-to-top').fadeIn();
			} else {
				$('#back-to-top').fadeOut();
			}
		});

		$('#back-to-top').click(function () {
			$('#back-to-top').tooltip('hide');
			$('body,html').animate({scrollTop: 0}, duration);
			return false;
		});

		$('#back-to-top').tooltip();
	});
	</script>

</body>
</html>
